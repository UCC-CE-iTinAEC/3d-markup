function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function o(e,t,i,n){for(var o=i*n*4,r=new Uint8Array(e,t,o),s=new Uint8Array(o),a=0,l=0,c=0;c<n;c++)for(var u=0;u<i;u++){var h=r[l];l++;var d=r[l];l++;var p=r[l];l++;var v=r[l];l++,s[a]=p,a++,s[a]=d,a++,s[a]=h,a++,s[a]=v,a++}return s}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,a=512,l=4,c=i("DXT1"),u=i("DXT3"),h=i("DXT5"),d=31,p=0,v=1,g=3,m=4,f=7,E=20,A=21,y=22,T=23,w=24,b=25,C=26,S=28,k=new Int32Array(e,0,d);if(k[p]!==s)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(!k[E]&l)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var x,M=k[A],R=!1;switch(M){case c:x=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case u:x=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case h:x=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==k[y]&&16711680&k[T]&&65280&k[w]&&255&k[b]&&4278190080&k[C]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",n(M)),r;R=!0,x=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,k[f]>0&&t!==!1&&(r.mipmapCount=Math.max(1,k[f])),r.isCubemap=!!(k[S]&a),r.width=k[m],r.height=k[g];for(var P=k[v]+4,V=r.width,I=r.height,N=r.isCubemap?6:1,D=0;D<N;D++){for(var L=0;L<r.mipmapCount;L++){if(R)var O=o(e,P,V,I),_=O.length;else var _=Math.max(4,V)/4*Math.max(4,I)/4*x,O=new Uint8Array(e,P,_);var H={data:O,width:V,height:I};r.mipmaps.push(H),P+=_,V=Math.max(.5*V,1),I=Math.max(.5*I,1)}V=r.width,I=r.height}return r}}function init_three_pvr_loader(){THREE.PVRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(e,t){var i=13,n=new Uint32Array(e,0,i),o={buffer:e,header:n,loadMipmaps:t};if(55727696===n[0])return THREE.PVRLoader._parseV3(o);if(559044176===n[11])return THREE.PVRLoader._parseV2(o);throw new Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(e){var t,i,n=e.header,o=n[12],r=n[2],s=n[6],a=n[7],l=(n[9],n[10]),c=n[11];switch(r){case 0:t=2,i=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+r)}return e.dataPtr=52+o,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,THREE.PVRLoader._extract(e)},THREE.PVRLoader._parseV2=function(e){var t,i,n=e.header,o=n[0],r=n[1],s=n[2],a=n[3],l=n[4],t=(n[5],n[6]),c=(n[7],n[8],n[9],n[10]),u=(n[11],n[12]),h=255,d=24,p=25,v=l&h,g=c>0;if(v===p)i=g?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,t=4;else{if(v!==d)throw new Error("pvrtc - unknown format "+v);i=g?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,t=2}return e.dataPtr=o,e.bpp=t,e.format=i,e.width=s,e.height=r,e.numSurfaces=u,e.numMipmaps=a+1,e.isCubemap=6===u,THREE.PVRLoader._extract(e)},THREE.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},i=e.buffer,n=e.dataPtr,o=e.bpp,r=e.numSurfaces,s=0,a=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),a=l*c*o/8,t.mipmaps.length=e.numMipmaps*r;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,v=e.height>>d;u=p/l,h=v/c,u<2&&(u=2),h<2&&(h=2),s=u*h*a;for(var g=0;g<r;g++){var m=new Uint8Array(i,n,s),f={data:m,width:p,height:v};t.mipmaps[g*e.numMipmaps+d]=f,n+=s}d++}return t}}function trace(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}function init_three_triangulator(){"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function e(e,t,i){var n=e<t?e+":"+t:t+":"+e;return i+":"+n}function t(t,i,n,o,r,s,a){this.pt1=t,this.pt2=i,this.p1=-1,this.p2=-1,this.eid1=e(n,o,a),this.eid2=e(r,s,a)}function i(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function n(e,t,i){this.pts=e,this.edges=t,this.bbox=i,this.pipResult=!1}function o(e,t){this.edges=e,this.bbox=t,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function r(e){this.indices=[],this.cset=e;var t=this.pts=e.pts;this.intervalTree=new n(e.pts,e.edges,e.bbox),this.intervalTree.build();for(var i=0;i<t.length;i++)t[i].id=i;var o=new lmv_poly2tri.SweepContext([]);if(o.points_=t.slice(),e.contours)for(var r=this.cset.contours,s=0;s<r.length;s++){for(var a=r[s],l=a[0]!==a[a.length-1],c=[],u=0;u<a.length-1;u++)c.push(t[a[u]]);o.initEdges(c,l)}else for(var h=this.cset.edges,i=0;i<h.length;i++){var d=h[i];if(d.p1!=d.p2){var p=[t[d.p1],t[d.p2]];o.initEdges(p,!0)}}this.triangulate(o),this.processResult(o)}var s=Autodesk.Viewing.Private;return n.prototype.splitNode=function(e){if(!(e.bbox.min.y>=e.bbox.max.y||e.node_edges.length<3)){var t=.5*(e.bbox.min.y+e.bbox.max.y);e.left=new i,e.right=new i;for(var n=this.pts,o=e.node_edges,r=[],s=new THREE.Vector2,a=0;a<o.length;a++){var l=this.edges[o[a]],c=n[l.p1].y,u=n[l.p2].y;if(c>u){var h=c;c=u,u=h}var d=null;u<t?(e.left.node_edges.push(o[a]),d=e.left.bbox):c>t?(e.right.node_edges.push(o[a]),d=e.right.bbox):r.push(o[a]),d&&(s.set(n[l.p1].x,n[l.p1].y),d.expandByPoint(s),s.set(n[l.p2].x,n[l.p2].y),d.expandByPoint(s))}e.node_edges=r,e.left.node_edges.length&&this.splitNode(e.left),e.right.node_edges.length&&this.splitNode(e.right)}},n.prototype.build=function(){this.root=new i;for(var e=this.root.node_edges,t=0;t<this.edges.length;t++)e.push(t);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},n.prototype.pointInPolygonRec=function(e,t,i){if(e.bbox.min.y<=i&&e.bbox.max.y>=i)for(var n=this.pts,o=e.node_edges,r=0,s=o.length;r<s;r++){var a=this.edges[o[r]],l=n[a.p1],c=l.x,u=l.y,h=u>=i,d=n[a.p2],p=d.x,v=d.y,g=v>=i;h!=g&&(v-i)*(c-p)>=(p-t)*(u-v)==g&&(this.pipResult=!this.pipResult)}var m=e.left;m&&m.bbox.min.y<=i&&m.bbox.max.y>=i&&this.pointInPolygonRec(m,t,i);var f=e.right;f&&f.bbox.min.y<=i&&f.bbox.max.y>=i&&this.pointInPolygonRec(f,t,i)},n.prototype.pointInPolygon=function(e,t){return this.pipResult=!1,this.pointInPolygonRec(this.root,e,t),this.pipResult},o.prototype.getPointIndex=function(e,t,i){var n=this.idmap[i];if(void 0!==n)return n;var o,r=0|e*this.scale,s=0|t*this.scale,a=this.xymap[r];return void 0===a?(this.xymap[r]=a={},o=void 0):o=a[s],void 0===o&&(a[s]=o=this.pts.length,this.idmap[i]=o,this.pts.push({x:e,y:t})),o},o.prototype.snapEdges=function(){for(var e=0;e<this.edges.length;e++){var t=this.edges[e];t.p1=this.getPointIndex(t.pt1.x,t.pt1.y,t.eid1),t.p2=this.getPointIndex(t.pt2.x,t.pt2.y,t.eid2)}},o.prototype.sanitizeEdges=function(){for(var e={},t=[],i=0,n=this.edges.length;i<n;i++){var o=this.edges[i];if(o.p1!==o.p2){var r=Math.min(o.p1,o.p2)+":"+Math.max(o.p1,o.p2);e[r]!==!0&&(e[r]=!0,t.push(o))}}this.edges=t},o.prototype.stitchContours=function(){for(var e={},t=0;t<this.edges.length;t++){var i=this.edges[t];i.p1!==i.p2&&(void 0!==e[i.p1]?e[i.p1].push(i.p2):e[i.p1]=[i.p2],void 0!==e[i.p2]?e[i.p2].push(i.p1):e[i.p2]=[i.p1])}var n=[];for(var o in e)if(2!==e[o].length){s.logger.warn("Incomplete edge table");break}for(;;){var r=void 0;for(var o in e)if(e[o].length>1){r=o;break}if(!r)for(var o in e)if(e[o].length>0){r=o;break}if(!r)break;var a=-1,l=parseInt(r),c=e[r];for(n.push(l);c&&c.length;){var u=c.shift();if(u===a&&(u=c.shift()),void 0===u){delete e[l];break}n.push(u),0==c.length?delete e[l]:c[0]===a&&delete e[l],a=l,l=u,c=e[u]}n.length&&(this.contours.push(n),n=[])}for(var h=[],t=0;t<this.contours.length;t++){var d=this.contours[t];d[0]!==d[d.length-1]&&h.push(d)}if(h.length)for(var p=!0;p;){p=!1;for(var v={},g=this.contours,t=0;t<g.length;t++){var d=g[t],m=d[0],f=d[d.length-1];m!==f&&(v[m]?v[m].push(-t-1):v[m]=[-t-1],v[f]?v[f].push(t):v[f]=[t])}for(var o in v){var E=v[o];if(2==E.length){var A=void 0;if(E[0]<0&&E[1]<0){var y=-E[0]-1,T=-E[1]-1;g[T].shift(),Array.prototype.push.apply(g[y].reverse(),g[T]),A=T}if(E[0]<0&&E[1]>0){var y=-E[0]-1,T=E[1];g[T].pop(),Array.prototype.push.apply(g[T],g[y]),A=y}if(E[0]>0&&E[1]<0){var y=E[0],T=-E[1]-1;g[y].pop(),Array.prototype.push.apply(g[y],g[T]),A=T}if(E[0]>0&&E[1]>0){var y=E[0],T=E[1];g[y].pop(),Array.prototype.push.apply(g[y],g[T].reverse()),A=T}void 0!==A&&(g.splice(A,1),p=!0);break}}}},r.prototype.triangulate=function(e){try{e.triangulate()}catch(e){}},r.prototype.processResult=function(e){for(var t=0;t<e.map_.length;t++){var i=e.map_[t],n=i.points_[0],o=i.points_[1],r=i.points_[2];void 0!==n.id&&void 0!==o.id&&void 0!==r.id&&this.filterFace(n.id,o.id,r.id)}},r.prototype.pointInEdgeList=function(e,t){for(var i,n,o,r,s,a,l=this.cset.pts,c=this.cset.edges,u=!1,h=0,d=c.length;h<d;++h){var p=c[h];o=l[p.p1].x,r=l[p.p1].y,i=r>=t,s=l[p.p2].x,a=l[p.p2].y,n=a>=t,i!=n&&(a-t)*(o-s)>=(s-e)*(r-a)==n&&(u=!u)}return u},r.prototype.pointInContour=function(e,t,i){var n,o,r,s,a,l,c=!1,u=this.cset.pts;r=u[i[i.length-1]].x,s=u[i[i.length-1]].y,n=s>=t;for(var h=0,d=i.length;h<d;++h)a=u[i[h]].x,l=u[i[h]].y,o=l>=t,n!=o&&(l-t)*(r-a)>=(a-e)*(s-l)==o&&(c=!c),n=o,r=a,s=l;return c},r.prototype.pointInPolygon=function(e,t){for(var i=!1,n=0;n<this.cset.contours.length;n++)this.pointInContour(e,t,this.cset.contours[n])&&(i=!i);return i},r.prototype.filterFace=function(e,t,i){var n=this.pts[e],o=this.pts[t],r=this.pts[i],s=(n.x+o.x+r.x)/3,a=(n.y+o.y+r.y)/3;if(this.intervalTree.pointInPolygon(s,a)){var l=o.x-n.x,c=o.y-n.y,u=r.x-n.x,h=r.y-n.y,d=l*h-u*c;d>0?this.indices.push(e,t,i):this.indices.push(e,i,t)}},{TriangulatedSurface:r,ContourSet:o,Edge:t}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function e(e){return Math.abs(e)<c}function t(t,i,n,o,r){var s=h.subVectors(n,i),a=t.normal.dot(s);if(e(a))return o.copy(i),r.copy(n),2;a=1/a;var l=-(i.dot(t.normal)*a+t.constant*a);if(l<-c||l>1+c)return 0;var u=s.multiplyScalar(l).add(i);return o.copy(u),1}function i(e,i,n,o,r,s,a,h,v){var g=e.distanceToPoint(i),m=e.distanceToPoint(n),f=e.distanceToPoint(o);if(g<-c&&m<-c&&f<-c)return null;if(g>c&&m>c&&f>c)return null;var E=Math.sign(g),A=Math.sign(m),y=Math.sign(f);if(0===E&&0===A&&0===y)return null;var T,w,b,C,S,k;if(E!==A){var x=t(e,i,n,d,p);if(2==x)return void h.push(new u(i.clone(),n.clone(),r,r,s,s,v));1==x?(b=r,C=s,T=d.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(A!==y){var x=t(e,n,o,d,p);if(2==x)return void h.push(new u(n.clone(),o.clone(),s,s,a,a,v));1==x?T?d.distanceTo(T)>c&&(S=s,k=a,w=d.clone()):(b=s,C=a,T=d.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(y!==E){var x=t(e,o,i,d,p);if(2==x)return void h.push(new u(o.clone(),i.clone(),a,a,r,r,v));1==x?T?d.distanceTo(T)>c&&(S=a,k=r,w=d.clone()):l.logger.warn("Unexpected single intersection point"):l.logger.warn("Unexpected zero intersections where at least one was expected")}T&&w?h.push(new u(T,w,b,C,S,k,v)):l.logger.warn("Unexpected one intersection where two were expected")}function n(e,t){v.set(t.min.x,t.min.y,t.min.z);var i=e.distanceToPoint(v),n=Math.sign(i);v.set(t.min.x,t.min.y,t.max.z);var o=e.distanceToPoint(v);return Math.sign(o)!==n||(v.set(t.min.x,t.max.y,t.min.z),o=e.distanceToPoint(v),Math.sign(o)!==n||(v.set(t.min.x,t.max.y,t.max.z),o=e.distanceToPoint(v),Math.sign(o)!==n||(v.set(t.max.x,t.min.y,t.min.z),o=e.distanceToPoint(v),Math.sign(o)!==n||(v.set(t.max.x,t.min.y,t.max.z),o=e.distanceToPoint(v),Math.sign(o)!==n||(v.set(t.max.x,t.max.y,t.min.z),o=e.distanceToPoint(v),Math.sign(o)!==n||(v.set(t.max.x,t.max.y,t.max.z),o=e.distanceToPoint(v),Math.sign(o)!==n))))))}function o(e,t,n){var o=t.geometry,r=n.length,s=o.attributes,a=t.matrixWorld;E.getInverse(a),A.copy(e).applyMatrix4(E);var l,c,u;if(void 0!==s.index){var h=s.index.array||o.ib,d=o.vb?o.vb:s.position.array,p=o.vb?o.vbstride:3,v=o.offsets;v&&0!==v.length||(v=[{start:0,count:h.length,index:0}]);for(var y=0,T=v.length;y<T;++y)for(var w=v[y].start,b=v[y].count,C=v[y].index,S=w,k=w+b;S<k;S+=3)l=C+h[S],c=C+h[S+1],u=C+h[S+2],g.x=d[l*p],g.y=d[l*p+1],g.z=d[l*p+2],m.x=d[c*p],m.y=d[c*p+1],m.z=d[c*p+2],f.x=d[u*p],f.y=d[u*p+1],f.z=d[u*p+2],i(A,g,m,f,l,c,u,n,t.fragId)}else for(var d=o.vb?o.vb:s.position.array,p=o.vb?o.vbstride:3,S=0,x=0,k=d.length;S<k;S+=3,x+=9)l=S,c=S+1,u=S+2,g.x=d[l*p],g.y=d[l*p+1],g.z=d[l*p+2],m.x=d[c*p],m.y=d[c*p+1],m.z=d[c*p+2],f.x=d[u*p],f.y=d[u*p+1],f.z=d[u*p+2],i(A,g,m,f,l,c,u,n,t.fragId);for(var S=r;S<n.length;S++)n[S].pt1.applyMatrix4(a),n[S].pt2.applyMatrix4(a)}function r(e,t,i){var n=t,o=Math.sqrt(1-n*n),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,u=r*a;i.set(c*s+n,c*a-o*l,c*l+o*a,0,c*a+o*l,u*a+n,u*l-o*s,0,c*l-o*a,u*l+o*s,r*l*l+n,0,0,0,0,1)}function s(t){var i=new THREE.Vector3(0,0,1),n=t.normal.clone().cross(i);n=n.normalize();var o=i.dot(t.normal),s=new THREE.Matrix4;return e(n.x)&&e(n.y)&&e(n.z)?s.elements[14]=o*t.constant:(r(n,o,s),s.elements[14]=t.constant),s}function a(e,t,i){for(var n=0;n<t.length;n++){var o=t[n];o.pt1.applyMatrix4(e),o.pt2.applyMatrix4(e),i.expandByPoint(o.pt1),i.expandByPoint(o.pt2)}}var l=Autodesk.Viewing.Private,c=1e-10,u=Autodesk.Viewing.Private.Triangulator.Edge,h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Matrix4,A=new THREE.Plane;return{makePlaneBasis:s,convertToPlaneCoords:a,intersectTrianglePlane:i,intersectMeshPlane:o,intersectBoxPlane:n}}())}function MobileCallbacks(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(e,t){window.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=window.JSINTERFACE}function init_WarpShader(){"undefined"==typeof window.WarpShader&&(WarpShader={uniforms:{tDiffuse:{type:"t",value:null},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,.22,.24,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(.996,-.004,1.014,0)}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 scale;","uniform vec2 scaleIn;","uniform vec2 lensCenter;","uniform vec4 hmdWarpParam;","uniform vec4 chromAbParam;","varying vec2 vUv;","vec4 sampleColor() {","vec2 uv = (vUv*2.0)-1.0;","vec2 theta = (uv-lensCenter)*scaleIn;","float rSq = theta.x*theta.x + theta.y*theta.y;","vec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);","  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);","  vec2 tcBlue = (lensCenter + scale * rBlue);","  tcBlue = (tcBlue+1.0)/2.0;","  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue)))","    return vec4(0.0, 0.0, 0.0, 1.0);","  vec2 tcGreen = lensCenter + scale * rvector;","  tcGreen = (tcGreen+1.0)/2.0;","  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);","  vec2 tcRed = lensCenter + scale * rRed;","  tcRed = (tcRed+1.0)/2.0;","  return vec4(texture2D(tDiffuse, tcRed).r, texture2D(tDiffuse, tcGreen).g, texture2D(tDiffuse, tcBlue).b, 1);","}","void main() {","vec4 texel = sampleColor();","gl_FragColor = texel;","}"].join("\n")})}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(e,t,i){THREE.Mesh.call(this,e,t,!1),this.plane=i,this.planeVec=new THREE.Vector4(i.normal.x,i.normal.y,i.normal.z,i.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,t=-1*this.getWorldPosition().dot(e);this.planeVec.set(e.x,e.y,e.z,t),this.plane.constant=t})}function init_TransformGizmos(){"use strict";var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(e,t,i,n){function o(e){var t=e.normalize().clone();t.index=u.vertices.push(t)-1;var i=a(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-n),t}function r(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);u.faces.push(n),A.copy(e).add(t).add(i).divideScalar(3);var o=a(A);u.faceVertexUvs[0].push([c(e.uv,e,o),c(t.uv,t,o),c(i.uv,i,o)])}function s(e,t){for(var i=Math.pow(2,t),n=(Math.pow(4,t),o(u.vertices[e.a])),s=o(u.vertices[e.b]),a=o(u.vertices[e.c]),l=[],c=0;c<=i;c++){l[c]=[];for(var h=o(n.clone().lerp(a,c/i)),d=o(s.clone().lerp(a,c/i)),p=i-c,v=0;v<=p;v++)0==v&&c==i?l[c][v]=h:l[c][v]=o(h.clone().lerp(d,v/p))}for(var c=0;c<i;c++)for(var v=0;v<2*(i-c)-1;v++){var g=Math.floor(v/2);v%2==0?r(l[c][g+1],l[c+1][g],l[c][g]):r(l[c][g+1],l[c+1][g+1],l[c+1][g])}}function a(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function c(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0;for(var u=this,h=0,d=e.length;h<d;h+=3)o(new THREE.Vector3(e[h],e[h+1],e[h+2]));for(var p=this.vertices,v=[],h=0,g=0,d=t.length;h<d;h+=3,g++){var m=p[t[h]],f=p[t[h+1]],E=p[t[h+2]];v[g]=new THREE.Face3(m.index,f.index,E.index,[m.clone(),f.clone(),E.clone()])}for(var A=new THREE.Vector3,h=0,d=v.length;h<d;h++)s(v[h],n);for(var h=0,d=this.faceVertexUvs[0].length;h<d;h++){var y=this.faceVertexUvs[0][h],T=y[0].x,w=y[1].x,b=y[2].x,C=Math.max(T,Math.max(w,b)),S=Math.min(T,Math.min(w,b));C>.9&&S<.1&&(T<.2&&(y[0].x+=1),w<.2&&(y[1].x+=1),b<.2&&(y[2].x+=1))}for(var h=0,d=this.vertices.length;h<d;h++)this.vertices[h].multiplyScalar(i);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(e,t,i,n,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:o},e=e||100,t=t||40,i=i||8,n=n||6,o=o||2*Math.PI;for(var r=new THREE.Vector3,s=[],a=[],l=0;l<=i;l++)for(var c=0;c<=n;c++){var u=c/n*o,h=l/i*Math.PI*2;r.x=e*Math.cos(u),r.y=e*Math.sin(u);var d=new THREE.Vector3;d.x=(e+t*Math.cos(h))*Math.cos(u),d.y=(e+t*Math.cos(h))*Math.sin(u),d.z=t*Math.sin(h),this.vertices.push(d),s.push(new THREE.Vector2(c/n,l/i)),a.push(d.clone().sub(r).normalize())}for(var l=1;l<=i;l++)for(var c=1;c<=n;c++){var p=(n+1)*l+c-1,v=(n+1)*(l-1)+c-1,g=(n+1)*(l-1)+c,m=(n+1)*l+c,f=new THREE.Face3(p,v,m,[a[p].clone(),a[v].clone(),a[m].clone()]);this.faces.push(f),this.faceVertexUvs[0].push([s[p].clone(),s[v].clone(),s[m].clone()]),f=new THREE.Face3(v,g,m,[a[v].clone(),a[g].clone(),a[m].clone()]),this.faces.push(f),this.faceVertexUvs[0].push([s[v].clone(),s[g].clone(),s[m].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var i=function(e,t,i){var n=new THREE.Geometry;i=i?i:1;for(var o=0;o<=64*i;++o)"x"==t&&n.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&n.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&n.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e));return n},n=function(e,t,i,n,o,r){var s=new THREE.Geometry,a=new THREE.Mesh(new THREE.CylinderGeometry(e,t,i,n,o,r));return a.position.y=.5,a.updateMatrix(),s.merge(a.geometry,a.matrix),s},o=function(e){var t=new THREE.Geometry;return"X"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),t};THREE.TransformGizmo=function(){var e=this,t=!1,i=!1;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({wireframe:!0});t.side=THREE.DoubleSide;var i={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};this.activePlane=i.XYZE,i.YZ.rotation.set(0,Math.PI/2,0),i.XZ.rotation.set(-Math.PI/2,0,0);for(var n in i)i[n].name=n,this.planes.add(i[n]),this.planes[n]=i[n],i[n].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=new THREE.Geometry;e.geometry instanceof THREE.BufferGeometry&&(e.geometry=(new THREE.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(e){e.visible=!1})},this.show=function(){this.traverse(function(i){i.visible=!0,i.parent!=e.pickers&&i.parent!=e.hemiPicker||(i.visible=t),i.parent==e.planes&&(i.visible=!1)}),this.activePlane.visible=i},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))})},this.setupGizmos=function(){var e=function(e,t){for(var i in e)for(var n=e[i].length;n--;){var o=e[i][n][0],r=e[i][n][1],s=e[i][n][2],a=e[i][n][3];o.name=i,r&&o.position.set(r[0],r[1],r[2]),s&&o.rotation.set(s[0],s[1],s[2]),a&&(o.visble=a),t.add(o)}};this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(e,t){var i=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse(function(r){r.name&&(r.name.search("E")!=-1?r.quaternion.setFromRotationMatrix(o.lookAt(t,i,n)):r.name.search("X")==-1&&r.name.search("Y")==-1&&r.name.search("Z")==-1||r.quaternion.setFromEuler(e))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(0,.05,.2,12,1,!1),r=o("X"),s=o("Y"),a=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:15805484}))]],Y:[[new THREE.Mesh(i,new e({color:768011})),[0,.5,0]],[new THREE.Line(s,new t({color:768011}))]],Z:[[new THREE.Mesh(i,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(i(1,"x",.5),new t({color:16711680}))]],RY:[[new THREE.Line(i(1,"y",.5),new t({color:65280}))]],RZ:[[new THREE.Line(i(1,"z",.5),new t({color:255}))]],RE:[[new THREE.Line(i(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new THREE.Line(i(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,u=new THREE.Quaternion,h=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),h.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),e.quaternion.copy(o))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=n(0,.05,.2,12,1,!1),i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));var o=.15;this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*o*Math.PI),new e({color:16711680})),[0,0,0],[o*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*o*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,(.5-o)*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*o*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[o*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*o*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,(.5-o)*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,
Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,u=new THREE.Quaternion,h=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),h.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),e.quaternion.copy(o))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(i){i.material&&i.material.highlight&&(i.name==e?(i.parent!=t.highlights&&i.parent!=t.handles||(i.visible=!0),i.material.highlight(!0)):(i.material.highlight(!1),i.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(.125,.125,.125),r=o("X"),s=o("Y"),a=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:16711680}))]],Y:[[new THREE.Mesh(i,new e({color:65280})),[0,.5,0]],[new THREE.Line(s,new t({color:65280}))]],Z:[[new THREE.Mesh(i,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,i){function n(i,n){var o=t.getBoundingClientRect(),r=(i.clientX-o.left)/o.width*2-1,s=2*-((i.clientY-o.top)/o.height)+1;e.isPerspective?(A.set(r,s,.5),A.unproject(e),E.set(e.position,A.sub(e.position).normalize())):(A.set(r,s,-1),A.unproject(e),y.set(0,0,-1),E.set(A,y.transformDirection(e.matrixWorld)));var a=E.intersectObjects(n,!0);return!!a[0]&&a[0]}switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},i){case"translate":this.gizmo[i]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[i]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[i]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[i]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[i]),this.gizmo[i].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===i){var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var r=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,r);var o=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,r);var o=new THREE.Geometry,r=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,r);var s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));s.magFilter=s.minFilter=THREE.NearestFilter;var o=new THREE.CircleGeometry(.1,32),r=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:s});this.centerMark=new THREE.Mesh(o,r),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));s.magFilter=s.minFilter=THREE.NearestFilter;var r=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:s}),a=.12,l=.25,c=1.15;this.ticks.RX=new THREE.Object3D;var o=new THREE.PlaneBufferGeometry(a,l),u=new THREE.Mesh(o,r);u.position.set(0,0,-c-l/2),u.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(u),u=u.clone(),u.position.set(0,c+l/2,0),u.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(u),u=u.clone(),u.position.set(0,0,c+l/2),u.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(u),u=u.clone(),u.position.set(0,-c-l/2,0),u.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(u),this.ticks.RY=new THREE.Object3D,u=u.clone(),u.position.set(0,0,-c-l/2),u.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(u),u=u.clone(),u.position.set(-c-l/2,0,0),u.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(u),u=u.clone(),u.position.set(0,0,c+l/2),u.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(u),u=u.clone(),u.position.set(c+l/2,0,0),u.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(u)}var h=this,d=!1,p=i,v={type:"change"},g={type:"mouseDown"},m={type:"mouseUp",mode:p},f={type:"objectChange"},E=new THREE.Raycaster,A=new THREE.Vector3,y=new THREE.Vector3,T=new THREE.Vector3,w=new THREE.Vector3,b=new THREE.Vector3,C=new THREE.Vector3,S=1,k=new THREE.Matrix4,x=new THREE.Vector3,M=new THREE.Matrix4,R=new THREE.Vector3,P=new THREE.Quaternion,V=new THREE.Vector3,I=new THREE.Vector3,N=new THREE.Vector3,D=new THREE.Quaternion,L=new THREE.Quaternion,O=new THREE.Quaternion,_=new THREE.Quaternion,H=new THREE.Quaternion,B=new THREE.Vector3,F=new THREE.Vector3,z=new THREE.Matrix4,U=new THREE.Matrix4,G=new THREE.Vector3,W=new THREE.Vector3,j=new THREE.Euler,Y=new THREE.Matrix4,q=new THREE.Vector3;new THREE.Euler;this.attach=function(e){h.object=e,this.gizmo[p].show(),h.update(),h.updateUnitVectors()},this.detach=function(e){h.object=void 0,this.axis=null,this.gizmo[p].hide()},this.setMode=function(e){p=e?e:p,"scale"==p&&(h.space="local"),this.gizmo[p].show(),this.update(),h.dispatchEvent(v)},this.getPicker=function(){return h.gizmo[p].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){P.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(P),this.unitY.applyQuaternion(P),this.unitZ.applyQuaternion(P),this.normal.copy(e),this.object&&this.object.quaternion.multiply(P),this.update()},this.setSnap=function(e,t){h.snap=e,h.snapDelta=t},this.setSize=function(e){h.size=e,this.update(),h.dispatchEvent(v)},this.setSpace=function(e){h.space=e,this.update(),h.dispatchEvent(v)},this.update=function(i){if(void 0!==h.object){h.object.updateMatrixWorld(),W.setFromMatrixPosition(h.object.matrixWorld),j.setFromRotationMatrix(M.extractRotation(h.object.matrixWorld)),e.updateMatrixWorld(),q.setFromMatrixPosition(e.matrixWorld),this.position.copy(W),this.quaternion.setFromEuler(j),this.normal.set(0,0,1),this.normal.applyEuler(j);var n=W.distanceTo(q),o=e.isPerspective?2*Math.tan(e.fov*Math.PI/360)*n:n,r=t.getBoundingClientRect();S=100*o/r.height,this.scale.set(S,S,S),i&&this.gizmo[p].highlight(h.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(j),this.unitY.applyEuler(j),this.unitZ.applyEuler(j)},this.showRotationGizmos=function(e){for(var t=this.gizmo[p].handles.children,i=0;i<t.length;i++){var n=t[i];n.visible=!0,n.name.search("R")!==-1&&(n.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[p].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===h.object||d===!0)return!1;var t=e.pointers?e.pointers[0]:e,i=n(t,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children),o=null,r="";return i&&(o=i.object.name,r=o.search("R")!=-1?"rotate":"translate"),h.axis!==o&&(h.axis=o,h.gizmo[p].activeMode=r,h.update(!0),h.dispatchEvent(v)),null===h.axis&&h.gizmo[p].show(),!!i},this.onPointerDown=function(t){if(void 0===h.object||d===!0)return!1;var i=t.pointers?t.pointers[0]:t;if("touch"===t.pointerType){var o=n(i,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children),r=null,s="";o&&(r=o.object.name,s=r.search("R")!=-1?"rotate":"translate"),h.axis!==r&&(h.axis=r,h.gizmo[p].activeMode=s)}var o=null;if((0===i.button||void 0===i.button)&&(o=n(i,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children))){h.dispatchEvent(g),h.axis=o.object.name,h.update(),x.copy(e.position).sub(W).normalize(),h.gizmo[p].setActivePlane(h.axis,x);var a=n(i,[h.gizmo[p].activePlane]);if(a&&w.copy(a.point),B.copy(h.object.position),F.copy(h.object.scale),z.extractRotation(h.object.matrix),Y.extractRotation(h.object.matrixWorld),h.object.parent?(U.extractRotation(h.object.parent.matrixWorld),G.setFromMatrixScale(M.getInverse(h.object.parent.matrixWorld))):(U.extractRotation(h.object.matrixWorld),G.setFromMatrixScale(M.getInverse(h.object.matrixWorld))),"transrotate"===p&&"rotate"===h.gizmo[p].activeMode){h.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(h.matrixWorld),h.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(h.matrixWorld),h.startLine.geometry.verticesNeedUpdate=!0,h.parent.add(h.startLine);var l=h.object.geometry.getAttribute("position"),c=(new THREE.Vector3).fromAttribute(l,0).applyMatrix4(h.object.matrixWorld),u=(new THREE.Vector3).fromAttribute(l,1).applyMatrix4(h.object.matrixWorld),v=(new THREE.Vector3).fromAttribute(l,2).applyMatrix4(h.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(l,3).applyMatrix4(h.object.matrixWorld);if("RX"===h.axis){c.lerp(v,.5),u.lerp(m,.5);var f=c.distanceTo(u);h.centerLine.material.dashSize=f/15,h.centerLine.material.gapSize=f/30,h.centerLine.geometry.vertices[0].copy(c),h.centerLine.geometry.vertices[1].copy(u)}else{c.lerp(u,.5),v.lerp(m,.5);var f=c.distanceTo(v);h.centerLine.material.dashSize=f/15,h.centerLine.material.gapSize=f/30,h.centerLine.geometry.vertices[0].copy(c),h.centerLine.geometry.vertices[1].copy(v)}h.centerLine.geometry.computeLineDistances(),h.centerLine.geometry.verticesNeedUpdate=!0,h.parent.add(h.centerLine),h.ticks[h.axis].position.copy(h.position),h.ticks[h.axis].quaternion.copy(h.quaternion),h.ticks[h.axis].scale.copy(h.scale),h.parent.add(h.ticks[h.axis])}}return d=!0,!!o},this.onPointerMove=function(e){if(void 0===h.object||null===h.axis||d===!1)return!1;var t=e.pointers?e.pointers[0]:e,i=n(t,[h.gizmo[p].activePlane]);i&&T.copy(i.point);var o=h.gizmo[p].activeMode;if("translate"==o)T.sub(w),T.multiply(G),"local"==h.space&&(T.applyMatrix4(M.getInverse(Y)),V.copy(this.unitX),I.copy(this.unitY),N.copy(this.unitZ),R.set(0,0,0),h.axis.search("X")!=-1&&(V.multiplyScalar(T.dot(this.unitX)),R.add(V)),h.axis.search("Y")!=-1&&(I.multiplyScalar(T.dot(this.unitY)),R.add(I)),h.axis.search("Z")!=-1&&(N.multiplyScalar(T.dot(this.unitZ)),R.add(N)),T.copy(R),T.applyMatrix4(z),h.object.position.copy(B),h.object.position.add(T)),"world"!=h.space&&h.axis.search("XYZ")==-1||(V.copy(this.unitX),I.copy(this.unitY),N.copy(this.unitZ),R.set(0,0,0),h.axis.search("X")!=-1&&(V.multiplyScalar(T.dot(this.unitX)),R.add(V)),h.axis.search("Y")!=-1&&(I.multiplyScalar(T.dot(this.unitY)),R.add(I)),h.axis.search("Z")!=-1&&(N.multiplyScalar(T.dot(this.unitZ)),R.add(N)),T.copy(R),T.applyMatrix4(M.getInverse(U)),h.object.position.copy(B),h.object.position.add(T));else if("scale"==o)T.sub(w),T.multiply(G),"local"==h.space&&("XYZ"==h.axis?(S=1+T.y/50,h.object.scale.x=F.x*S,h.object.scale.y=F.y*S,h.object.scale.z=F.z*S):(T.applyMatrix4(M.getInverse(Y)),"X"==h.axis&&(h.object.scale.x=F.x*(1+T.x/50)),"Y"==h.axis&&(h.object.scale.y=F.y*(1+T.y/50)),"Z"==h.axis&&(h.object.scale.z=F.z*(1+T.z/50))));else if("rotate"==o){if(T.sub(W),T.multiply(G),R.copy(w).sub(W),R.multiply(G),"RE"==h.axis){T.applyMatrix4(M.getInverse(k)),R.applyMatrix4(M.getInverse(k)),b.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),C.set(Math.atan2(R.z,R.y),Math.atan2(R.x,R.z),Math.atan2(R.y,R.x)),P.setFromRotationMatrix(M.getInverse(U));var r=b.z-C.z;if(null!==h.snap){var s=Math.round(r/h.snap)*h.snap;Math.abs(s-r)<h.snapDelta&&(r=s)}H.setFromAxisAngle(x,r),D.setFromRotationMatrix(Y),P.multiplyQuaternions(P,H),P.multiplyQuaternions(P,D),h.object.quaternion.copy(P)}else if("RXYZE"==h.axis){var a=T.clone().cross(R).normalize();P.setFromRotationMatrix(M.getInverse(U));var l=-T.clone().angleTo(R);if(null!==h.snap){var s=Math.round(l/h.snap)*h.snap;Math.abs(s-l)<h.snapDelta&&(l=s)}L.setFromAxisAngle(a,l),D.setFromRotationMatrix(Y),P.multiplyQuaternions(P,L),P.multiplyQuaternions(P,D),h.object.quaternion.copy(P)}else if("local"==h.space){T.applyMatrix4(M.getInverse(Y)),R.applyMatrix4(M.getInverse(Y));var c=T.dot(this.unitX),u=T.dot(this.unitY),g=T.dot(this.unitZ),m=R.dot(this.unitX),E=R.dot(this.unitY),A=R.dot(this.unitZ);b.set(Math.atan2(g,u),Math.atan2(c,g),Math.atan2(u,c)),C.set(Math.atan2(A,E),Math.atan2(m,A),Math.atan2(E,m));var y=b.x-C.x,j=b.y-C.y,r=b.z-C.z;if(null!==h.snap){if(h.axis.search("X")!=-1){var s=Math.round(y/h.snap)*h.snap;Math.abs(s-y)<h.snapDelta&&(y=s)}if(h.axis.search("Y")!=-1){var s=Math.round(j/h.snap)*h.snap;Math.abs(s-j)<h.snapDelta&&(j=s)}if(h.axis.search("Z")!=-1){var s=Math.round(r/h.snap)*h.snap;Math.abs(s-r)<h.snapDelta&&(r=s)}}L.setFromAxisAngle(this.unitX,y),O.setFromAxisAngle(this.unitY,j),_.setFromAxisAngle(this.unitZ,r),D.setFromRotationMatrix(z),"RX"==h.axis&&D.multiplyQuaternions(D,L),"RY"==h.axis&&D.multiplyQuaternions(D,O),"RZ"==h.axis&&D.multiplyQuaternions(D,_),h.object.quaternion.copy(D)}else if("world"==h.space){var c=T.dot(this.unitX),u=T.dot(this.unitY),g=T.dot(this.unitZ),m=R.dot(this.unitX),E=R.dot(this.unitY),A=R.dot(this.unitZ);b.set(Math.atan2(g,u),Math.atan2(c,g),Math.atan2(u,c)),C.set(Math.atan2(A,E),Math.atan2(m,A),Math.atan2(E,m)),P.setFromRotationMatrix(M.getInverse(U));var y=b.x-C.x,j=b.y-C.y,r=b.z-C.z;if(null!==h.snap){if(h.axis.search("X")!=-1){var s=Math.round(y/h.snap)*h.snap;Math.abs(s-y)<h.snapDelta&&(y=s)}if(h.axis.search("Y")!=-1){var s=Math.round(j/h.snap)*h.snap;Math.abs(s-j)<h.snapDelta&&(j=s)}if(h.axis.search("Z")!=-1){var s=Math.round(r/h.snap)*h.snap;Math.abs(s-r)<h.snapDelta&&(r=s)}}L.setFromAxisAngle(this.unitX,y),O.setFromAxisAngle(this.unitY,j),_.setFromAxisAngle(this.unitZ,r),D.setFromRotationMatrix(Y),"RX"==h.axis&&P.multiplyQuaternions(P,L),"RY"==h.axis&&P.multiplyQuaternions(P,O),"RZ"==h.axis&&P.multiplyQuaternions(P,_),P.multiplyQuaternions(P,D),h.object.quaternion.copy(P)}"transrotate"===p&&(h.add(h.endLine),h.add(h.centerMark))}return h.object.matrixAutoUpdate=!0,h.update(!0),h.dispatchEvent(v),h.dispatchEvent(f),!!i},this.onPointerUp=function(e){return d&&null!==h.axis&&(m.mode=p,h.dispatchEvent(m)),d=!1,this.gizmo[p].show(),this.updateUnitVectors(),"transrotate"===p&&"rotate"===this.gizmo[p].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}var AutodeskNamespace=function(e){for(var t=getGlobal(),i=e.split("."),n=0;n<i.length;++n)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t};AutodeskNamespace("Autodesk.Viewing.Private"),AutodeskNamespace("Autodesk.Viewing.Extensions"),AutodeskNamespace("Autodesk.Viewing.Shaders"),AutodeskNamespace("Autodesk.Viewing.UI"),AutodeskNamespace("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=getGlobal,Autodesk.Viewing.AutodeskNamespace=AutodeskNamespace,Autodesk.Viewing.Private.initializeLegacyNamespaces=function(e){var t=Autodesk.Viewing,i=t.Shaders,n=t.Private;n.InstanceTreeStorage=WGS.InstanceTreeStorage,n.InstanceTreeAccess=WGS.InstanceTreeAccess,n.BVHBuilder=WGS.BVHBuilder,n.NodeArray=WGS.NodeArray,e||(i.PackDepthShaderChunk=WGS.PackDepthShaderChunk,i.TonemapShaderChunk=WGS.TonemapShaderChunk,i.OrderedDitheringShaderChunk=WGS.OrderedDitheringShaderChunk,i.CutPlanesUniforms=WGS.CutPlanesUniforms,i.CutPlanesShaderChunk=WGS.CutPlanesShaderChunk,i.PackNormalsShaderChunk=WGS.PackNormalsShaderChunk,i.HatchPatternShaderChunk=WGS.HatchPatternShaderChunk,i.EnvSamplingShaderChunk=WGS.EnvSamplingShaderChunk,i.IdUniforms=WGS.IdUniforms,i.IdFragmentDeclaration=WGS.IdFragmentDeclaration,i.IdOutputShaderChunk=WGS.IdOutputShaderChunk,i.FinalOutputShaderChunk=WGS.FinalOutputShaderChunk,i.ThemingUniform=WGS.ThemingUniform,i.ThemingFragmentDeclaration=WGS.ThemingFragmentDeclaration,i.ThemingFragmentShaderChunk=WGS.ThemingFragmentShaderChunk,i.BackgroundShader=WGS.BackgroundShader,i.BlendShader=WGS.BlendShader,i.CelShader=WGS.CelShader,i.CopyShader=WGS.CopyShader,i.FXAAShader=WGS.FXAAShader,i.SAOBlurShader=WGS.SAOBlurShader,i.SAOMinifyFirstShader=WGS.SAOMinifyFirstShader,i.SAOMinifyShader=WGS.SAOMinifyShader,i.SAOShader=WGS.SAOShader,i.NormalsShader=WGS.NormalsShader,i.LineShader=WGS.LineShader,n.LineStyleDefs=WGS.LineStyleDefs,n.CreateLinePatternTexture=WGS.CreateLinePatternTexture,n.FloatToHalf=WGS.FloatToHalf,n.HalfToFloat=WGS.HalfToFloat,n.IntToHalf=WGS.IntToHalf,n.HalfToInt=WGS.HalfToInt,n.HalfTest=WGS.HalfTest,i.createShaderMaterial=WGS.createShaderMaterial,i.setMacro=WGS.setMacro,i.removeMacro=WGS.removeMacro,i.LmvShaderPass=WGS.ShaderPass,i.GaussianPass=WGS.GaussianPass,i.GroundShadow=WGS.GroundShadow,i.createGroundShape=WGS.createGroundShape,i.setGroundShapeTransform=WGS.setGroundShapeTransform,i.GroundReflection=WGS.GroundReflection,n.FireflyWebGLShader=WGS.WebGLShader,n.PrismMaps=WGS.PrismMaps,n.GetPrismMapChunk=WGS.GetPrismMapChunk,n.FireflyWebGLProgram=WGS.WebGLProgram,i.ShadowMapCommonUniforms=WGS.ShadowMapCommonUniforms,i.ShadowMapUniforms=WGS.ShadowMapUniforms,i.ShadowMapDeclareCommonUniforms=WGS.ShadowMapDeclareCommonUniforms,i.ShadowMapVertexDeclaration=WGS.ShadowMapVertexDeclaration,i.ShadowMapVertexShaderChunk=WGS.ShadowMapVertexShaderChunk,i.ShadowMapFragmentDeclaration=WGS.ShadowMapFragmentDeclaration,i.FireflyPhongShader=WGS.PhongShader,i.PrismShader=WGS.PrismShader,i.GetPrismMapUniforms=WGS.GetPrismMapUniforms,i.GetPrismMapSampleChunk=WGS.GetPrismMapSampleChunk,i.GetPrismMapUniformChunk=WGS.GetPrismMapUniformChunk,i.AverageOfFloat3=WGS.AverageOfFloat3,n.createPrismMaterial=WGS.createPrismMaterial,n.clonePrismMaterial=WGS.clonePrismMaterial,n.ShadowMapShader=WGS.ShadowMapShader,n.GroundShadowShader=WGS.GroundShadowShader,n.ShadowMapOverrideMaterials=WGS.ShadowMapOverrideMaterials,n.SHADOWMAP_NEEDS_UPDATE=WGS.SHADOWMAP_NEEDS_UPDATE,n.SHADOWMAP_INCOMPLETE=WGS.SHADOWMAP_INCOMPLETE,n.SHADOWMAP_VALID=WGS.SHADOWMAP_VALID,n.ShadowConfig=WGS.ShadowConfig,n.ShadowRender=WGS.ShadowRender,n.ShadowMaps=WGS.ShadowMaps,n.FrustumIntersector=WGS.FrustumIntersector,n.OUTSIDE=WGS.OUTSIDE,n.INTERSECTS=WGS.INTERSECTS,n.CONTAINS=WGS.CONTAINS,n.VBIntersector=WGS.VBIntersector,n.memoryOptimizedLoading=WGS.memoryOptimizedLoading,n.GPU_MEMORY_LIMIT=WGS.GPU_MEMORY_LIMIT,n.GPU_OBJECT_LIMIT=WGS.GPU_OBJECT_LIMIT,n.FRAGS_PERSISTENT_COUNT=WGS.FRAGS_PERSISTENT_COUNT,n.FRAGS_PERSISTENT_MAX_COUNT=WGS.FRAGS_PERSISTENT_MAX_COUNT,n.GEOMS_COUNT_LIMIT=WGS.GEOMS_COUNT_LIMIT,n.onDemandLoading=WGS.onDemandLoading,n.cullGeometryOnLoading=WGS.cullGeometryOnLoading,n.pageOutGeometryEnabled=WGS.pageOutGeometryEnabled,n.PAGEOUT_SUCCESS=WGS.PAGEOUT_SUCCESS,n.PAGEOUT_FAIL=WGS.PAGEOUT_FAIL,n.PAGEOUT_NONE=WGS.PAGEOUT_NONE,n.PAGEOUT_PERCENTAGE=WGS.PAGEOUT_PERCENTAGE,n.GEOMS_PAGEOUT_COUNT=WGS.GEOMS_PAGEOUT_COUNT,n.GeometryList=WGS.GeometryList,n.MESH_VISIBLE=WGS.MESH_VISIBLE,n.MESH_HIGHLIGHTED=WGS.MESH_HIGHLIGHTED,n.MESH_HIDE=WGS.MESH_HIDE,n.MESH_ISLINE=WGS.MESH_ISLINE,n.MESH_MOVED=WGS.MESH_MOVED,n.MESH_TRAVERSED=WGS.MESH_TRAVERSED,n.MESH_RENDERFLAG=WGS.MESH_RENDERFLAG,n.FragmentPointer=WGS.FragmentPointer,n.FragmentList=WGS.FragmentList,n.RENDER_NORMAL=WGS.RENDER_NORMAL,n.RENDER_HIGHLIGHTED=WGS.RENDER_HIGHLIGHTED,n.RENDER_HIDDEN=WGS.RENDER_HIDDEN,n.RENDER_SHADOWMAP=WGS.RENDER_SHADOWMAP,n.RENDER_FINISHED=WGS.RENDER_FINISHED,n.RenderBatch=WGS.RenderBatch,t.rescueFromPolymer=WGS.rescueFromPolymer,n.FireflyWebGLRenderer=WGS.WebGLRenderer,n.ModelIteratorLinear=WGS.ModelIteratorLinear,n.ModelIteratorBVH=WGS.ModelIteratorBVH,n.BufferGeometryUtils=WGS.BufferGeometry,n.RenderScene=WGS.RenderScene,n.SortedList=WGS.SortedList,n.ModelIteratorTexQuad=WGS.ModelIteratorTexQuad,n.TexQuadConfig=WGS.TexQuadConfig,n.InstanceTree=WGS.InstanceTree,t.SelectionMode=WGS.SelectionMode,n.MaterialConverter=WGS.MaterialConverter)};var av=Autodesk.Viewing,avp=av.Private;av.getGlobal=getGlobal;var isBrowser=av.isBrowser="undefined"!=typeof navigator,isIE11=av.isIE11=isBrowser&&!!navigator.userAgent.match(/Trident\/7\./);"undefined"!=typeof window&&isIE11&&!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t,t<0&&(t=0)),e<0&&(e=this.byteLength+e,e<0&&(e=0)),t<=e)return new ArrayBuffer;for(var i=t-e,n=new Uint8Array(this,e,i),o=new Uint8Array(i),r=0;r<i;r++)o[r]=n[r];return o.buffer}),function(){Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var launchFullscreen=av.launchFullscreen=function(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)},exitFullscreen=av.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},inFullscreen=av.inFullscreen=function(){return"webkitIsFullScreen"in document?document.webkitIsFullScreen:!!(document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenEnabled||document.querySelector(".viewer-fill-browser"))},fullscreenElement=av.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},isFullscreenAvailable=av.isFullscreenAvailable=function(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen},getAndroidVersion=av.getAndroidVersion=function(e){var e=e||navigator.userAgent,t=e.match(/Android\s([0-9\.]*)/);return!!t&&t[1]},isTouchDevice=av.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window};av.isIOSDevice=function(){return!!isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},av.isAndroidDevice=function(){return!!isBrowser&&navigator.userAgent.toLowerCase().indexOf("android")!==-1},av.isMobileDevice=function(){return!!isBrowser&&(av.isIOSDevice()||av.isAndroidDevice())},av.isSafari=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")!==-1&&e.indexOf("chrome")===-1},av.isFirefox=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return e.indexOf("firefox")!==-1},av.isMac=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return e.indexOf("mac os")!==-1},av.isWindows=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return e.indexOf("win32")!==-1||e.indexOf("windows")!==-1};var detectWebGL=av.detectWebGL=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<4;n++)try{if(i=e.getContext(t[n]),i=rescueFromPolymer(i),i&&"function"==typeof i.getParameter)return 1}catch(e){}return 0}return-1},touchStartToClick=av.touchStartToClick=function(e){e.preventDefault(),e.stopPropagation(),e.target.click()};!function(){var e=getGlobal();e.performance||(e.performance=Date)}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private;if(avp.BUILD_LMV_WORKER_URL="lmvworker.min.js",avp.LMV_WORKER_URL=avp.BUILD_LMV_WORKER_URL,avp.ENABLE_DEBUG=avp.ENABLE_DEBUG||!1,avp.ENABLE_TRACE=avp.ENABLE_TRACE||!1,avp.ENABLE_INLINE_WORKER=!0,function(){"use strict";function e(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(n.ENABLE_TRACE?n.LogLevels.DEBUG:n.LogLevels.ERROR)}function t(){return"undefined"!=typeof window?encodeURI(window.location.href):""}var i=Autodesk.Viewing,n=Autodesk.Viewing.Private;n.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0},e.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var o=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+o.substring(4))}this.environmentInfo={touch:i.isTouchDevice(),env:n.env,referer:t(),version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE};var r={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type};this.track(r);var s=this;this.interval=setInterval(function(){s.reportRuntimeStats()},6e4)},e.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},e.prototype.track=function(e){if(this.updateRuntimeStats(e),!n.offline&&this.sessionId){e.timestamp=Date.now(),e.sessionId=this.sessionId;var t=this.logToADP(e);this.callback&&this.callback(e,{adp:t})}},e.prototype.logToADP=function(e){if(!this.adp)return!1;var i="",n="";switch(e.category){case"tool_changed":case"pref_changed":i="CLICK_OPERATION",n=e.category+"/"+e.name;break;case"screen_mode":i="CLICK_OPERATION",n="pref_changed/"+e.category;break;case"metadata_load_stats":i="DOCUMENT_START",n="stats",e.full_url=t();break;case"model_load_stats":i="DOCUMENT_FULL",n="stats";break;case"error":i="BACKGROUND_CALL",n="error"}return!!i&&(this.adp.trackEvent(i,{operation:{id:e.sessionId,type:n,stage:"",status:"C",meta:e}}),!0)},e.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},e.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},e.prototype.setLevel=function(e){if(this.level!==e){this.level=e;var t=function(){},i=n.LogLevels;this.debug=e>=i.DEBUG?console.log.bind(console):t,this.log=e>=i.LOG?console.log.bind(console):t,this.info=e>=i.INFO?console.info.bind(console):t,this.warn=e>=i.WARNING?console.warn.bind(console):t,this.error=e>=i.ERROR?console.error.bind(console):t}},Autodesk.Viewing.Private.logger=new e}(),"undefined"!=typeof window&&!function(e,t,i,n){"use strict";function o(e,t,i){return setTimeout(u(e,i),t)}function r(e,t,i){return!!Array.isArray(e)&&(s(e,i[t],i),!0)}function s(e,t,i){var o;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==n)for(o=0;o<e.length;)t.call(i,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(i,e[o],o,e)}function a(e,t,i){for(var o=Object.keys(t),r=0;r<o.length;)(!i||i&&e[o[r]]===n)&&(e[o[r]]=t[o[r]]),r++;return e}function l(e,t){return a(e,t,!0)}function c(e,t,i){var n,o=t.prototype;n=e.prototype=Object.create(o),n.constructor=e,n._super=o,i&&a(n,i)}function u(e,t){return function(){return e.apply(t,arguments)}}function h(e,t){return typeof e==ue?e.apply(t?t[0]||n:n,t):e}function d(e,t){return e===n?t:e}function p(e,t,i){s(f(t),function(t){e.addEventListener(t,i,!1)})}function v(e,t,i){s(f(t),function(t){e.removeEventListener(t,i,!1)})}function g(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function m(e,t){return e.indexOf(t)>-1}function f(e){return e.trim().split(/\s+/g)}function E(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function A(e){return Array.prototype.slice.call(e,0)}function y(e,t,i){for(var n=[],o=[],r=0;r<e.length;){var s=t?e[r][t]:e[r];E(o,s)<0&&n.push(e[r]),o[r]=s,r++}return i&&(n=t?n.sort(function(e,i){return e[t]>i[t]}):n.sort()),n}function T(e,t){for(var i,o,r=t[0].toUpperCase()+t.slice(1),s=0;s<le.length;){if(i=le[s],o=i?i+r:t,o in e)return o;s++}return n}function w(){return ve++}function b(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function C(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){h(e.options.enable,[e])&&i.handler(t)},this.init()}function S(e){var t,i=e.options.inputClass;return new(t=i?i:fe?B:Ee?U:me?W:H)(e,k)}function k(e,t,i){var n=i.pointers.length,o=i.changedPointers.length,r=t&Ce&&n-o===0,s=t&(ke|xe)&&n-o===0;i.isFirst=!!r,i.isFinal=!!s,r&&(e.session={}),i.eventType=t,x(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function x(e,t){var i=e.session,n=t.pointers,o=n.length;i.firstInput||(i.firstInput=P(t)),o>1&&!i.firstMultiple?i.firstMultiple=P(t):1===o&&(i.firstMultiple=!1);var r=i.firstInput,s=i.firstMultiple,a=s?s.center:r.center,l=t.center=V(n);t.timeStamp=pe(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=L(a,l),t.distance=D(a,l),M(i,t),t.offsetDirection=N(t.deltaX,t.deltaY),t.scale=s?_(s.pointers,n):1,t.rotation=s?O(s.pointers,n):0,R(i,t);var c=e.element;g(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function M(e,t){var i=t.center,n=e.offsetDelta||{},o=e.prevDelta||{},r=e.prevInput||{};(t.eventType===Ce||r.eventType===ke)&&(o=e.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=o.x+(i.x-n.x),t.deltaY=o.y+(i.y-n.y)}function R(e,t){var i,o,r,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=xe&&(l>be||a.velocity===n)){var c=a.deltaX-t.deltaX,u=a.deltaY-t.deltaY,h=I(l,c,u);
o=h.x,r=h.y,i=de(h.x)>de(h.y)?h.x:h.y,s=N(c,u),e.lastInterval=t}else i=a.velocity,o=a.velocityX,r=a.velocityY,s=a.direction;t.velocity=i,t.velocityX=o,t.velocityY=r,t.direction=s}function P(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:he(e.pointers[i].clientX),clientY:he(e.pointers[i].clientY)},i++;return{timeStamp:pe(),pointers:t,center:V(t),deltaX:e.deltaX,deltaY:e.deltaY}}function V(e){var t=e.length;if(1===t)return{x:he(e[0].clientX),y:he(e[0].clientY)};for(var i=0,n=0,o=0;t>o;)i+=e[o].clientX,n+=e[o].clientY,o++;return{x:he(i/t),y:he(n/t)}}function I(e,t,i){return{x:t/e||0,y:i/e||0}}function N(e,t){return e===t?Me:de(e)>=de(t)?e>0?Re:Pe:t>0?Ve:Ie}function D(e,t,i){i||(i=Oe);var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]];return Math.sqrt(n*n+o*o)}function L(e,t,i){i||(i=Oe);var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]];return 180*Math.atan2(o,n)/Math.PI}function O(e,t){return L(t[1],t[0],_e)-L(e[1],e[0],_e)}function _(e,t){return D(t[0],t[1],_e)/D(e[0],e[1],_e)}function H(){this.evEl=Be,this.evWin=Fe,this.allow=!0,this.pressed=!1,C.apply(this,arguments)}function B(){this.evEl=Ge,this.evWin=We,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function F(){this.evTarget=Ye,this.evWin=qe,this.started=!1,C.apply(this,arguments)}function z(e,t){var i=A(e.touches),n=A(e.changedTouches);return t&(ke|xe)&&(i=y(i.concat(n),"identifier",!0)),[i,n]}function U(){this.evTarget=Ke,this.targetIds={},C.apply(this,arguments)}function G(e,t){var i=A(e.touches),n=this.targetIds;if(t&(Ce|Se)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var o,r,s=A(e.changedTouches),a=[],l=this.target;if(r=i.filter(function(e){return g(e.target,l)}),t===Ce)for(o=0;o<r.length;)n[r[o].identifier]=!0,o++;for(o=0;o<s.length;)n[s[o].identifier]&&a.push(s[o]),t&(ke|xe)&&delete n[s[o].identifier],o++;return a.length?[y(r.concat(a),"identifier",!0),a]:void 0}function W(){C.apply(this,arguments);var e=u(this.handler,this);this.touch=new U(this.manager,e),this.mouse=new H(this.manager,e)}function j(e,t){this.manager=e,this.set(t)}function Y(e){if(m(e,tt))return tt;var t=m(e,it),i=m(e,nt);return t&&i?it+" "+nt:t||i?t?it:nt:m(e,et)?et:$e}function q(e){this.id=w(),this.manager=null,this.options=l(e||{},this.defaults),this.options.enable=d(this.options.enable,!0),this.state=ot,this.simultaneous={},this.requireFail=[]}function X(e){return e&ct?"cancel":e&at?"end":e&st?"move":e&rt?"start":""}function K(e){return e==Ie?"down":e==Ve?"up":e==Re?"left":e==Pe?"right":""}function Q(e,t){var i=t.manager;return i?i.get(e):e}function Z(){q.apply(this,arguments)}function J(){Z.apply(this,arguments),this.pX=null,this.pY=null}function $(){Z.apply(this,arguments)}function ee(){q.apply(this,arguments),this._timer=null,this._input=null}function te(){Z.apply(this,arguments)}function ie(){Z.apply(this,arguments)}function ne(){q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function oe(e,t){return t=t||{},t.recognizers=d(t.recognizers,oe.defaults.preset),new re(e,t)}function re(e,t){t=t||{},this.options=l(t,oe.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=S(this),this.touchAction=new j(this,this.options.touchAction),se(this,!0),s(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function se(e,t){var i=e.element;s(e.options.cssProps,function(e,n){i.style[T(i.style,n)]=t?e:""})}function ae(e,i){var n=t.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var le=["","webkit","moz","MS","ms","o"],ce=t.createElement("div"),ue="function",he=Math.round,de=Math.abs,pe=Date.now,ve=1,ge=/mobile|tablet|ip(ad|hone|od)|android/i,me="ontouchstart"in e,fe=T(e,"PointerEvent")!==n,Ee=me&&ge.test(navigator.userAgent),Ae="touch",ye="pen",Te="mouse",we="kinect",be=25,Ce=1,Se=2,ke=4,xe=8,Me=1,Re=2,Pe=4,Ve=8,Ie=16,Ne=Re|Pe,De=Ve|Ie,Le=Ne|De,Oe=["x","y"],_e=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(b(this.element),this.evWin,this.domHandler)}};var He={mousedown:Ce,mousemove:Se,mouseup:ke},Be="mousedown",Fe="mousemove mouseup";c(H,C,{handler:function(e){var t=He[e.type];t&Ce&&0===e.button&&(this.pressed=!0),t&Se&&1!==e.which&&(t=ke),this.pressed&&this.allow&&(t&ke&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:Te,srcEvent:e}))}});var ze={pointerdown:Ce,pointermove:Se,pointerup:ke,pointercancel:xe,pointerout:xe},Ue={2:Ae,3:ye,4:Te,5:we},Ge="pointerdown",We="pointermove pointerup pointercancel";e.MSPointerEvent&&(Ge="MSPointerDown",We="MSPointerMove MSPointerUp MSPointerCancel"),c(B,C,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),o=ze[n],r=Ue[e.pointerType]||e.pointerType,s=r==Ae,a=E(t,e.pointerId,"pointerId");o&Ce&&(0===e.button||s)?0>a&&(t.push(e),a=t.length-1):o&(ke|xe)&&(i=!0),0>a||(t[a]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:r,srcEvent:e}),i&&t.splice(a,1))}});var je={touchstart:Ce,touchmove:Se,touchend:ke,touchcancel:xe},Ye="touchstart",qe="touchstart touchmove touchend touchcancel";c(F,C,{handler:function(e){var t=je[e.type];if(t===Ce&&(this.started=!0),this.started){var i=z.call(this,e,t);t&(ke|xe)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:Ae,srcEvent:e})}}});var Xe={touchstart:Ce,touchmove:Se,touchend:ke,touchcancel:xe},Ke="touchstart touchmove touchend touchcancel";c(U,C,{handler:function(e){var t=Xe[e.type],i=G.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:Ae,srcEvent:e})}}),c(W,C,{handler:function(e,t,i){var n=i.pointerType==Ae,o=i.pointerType==Te;if(n)this.mouse.allow=!1;else if(o&&!this.mouse.allow)return;t&(ke|xe)&&(this.mouse.allow=!0),this.callback(e,t,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Qe=T(ce.style,"touchAction"),Ze=Qe!==n,Je="compute",$e="auto",et="manipulation",tt="none",it="pan-x",nt="pan-y";j.prototype={set:function(e){e==Je&&(e=this.compute()),Ze&&(this.manager.element.style[Qe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return s(this.manager.recognizers,function(t){h(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),Y(e.join(" "))},preventDefaults:function(e){if(!Ze){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var n=this.actions,o=m(n,tt),r=m(n,nt),s=m(n,it);return o||r&&i&Ne||s&&i&De?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var ot=1,rt=2,st=4,at=8,lt=at,ct=16,ut=32;q.prototype={defaults:{},set:function(e){return a(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(r(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=Q(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return r(e,"dropRecognizeWith",this)?this:(e=Q(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(r(e,"requireFailure",this))return this;var t=this.requireFail;return e=Q(e,this),-1===E(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(r(e,"dropRequireFailure",this))return this;e=Q(e,this);var t=E(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?X(n):""),e)}var i=this,n=this.state;at>n&&t(!0),t(),n>=at&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=ut)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ut|ot)))return!1;e++}return!0},recognize:function(e){var t=a({},e);return h(this.options.enable,[this,t])?(this.state&(lt|ct|ut)&&(this.state=ot),this.state=this.process(t),void(this.state&(rt|st|at|ct)&&this.tryEmit(t))):(this.reset(),void(this.state=ut))},process:function(){},getTouchAction:function(){},reset:function(){}},c(Z,q,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=t&(rt|st),o=this.attrTest(e);return n&&(i&xe||!o)?t|ct:n||o?i&ke?t|at:t&rt?t|st:rt:ut}}),c(J,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Le},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ne&&t.push(nt),e&De&&t.push(it),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,o=e.direction,r=e.deltaX,s=e.deltaY;return o&t.direction||(t.direction&Ne?(o=0===r?Me:0>r?Re:Pe,i=r!=this.pX,n=Math.abs(e.deltaX)):(o=0===s?Me:0>s?Ve:Ie,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=o,i&&n>t.threshold&&o&t.direction},attrTest:function(e){return Z.prototype.attrTest.call(this,e)&&(this.state&rt||!(this.state&rt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=K(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),c($,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&rt)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=e.scale<1?"in":"out";this.manager.emit(this.options.event+t,e)}}}),c(ee,q,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[$e]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!n||!i||e.eventType&(ke|xe)&&!r)this.reset();else if(e.eventType&Ce)this.reset(),this._timer=o(function(){this.state=lt,this.tryEmit()},t.time,this);else if(e.eventType&ke)return lt;return ut},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===lt&&(e&&e.eventType&ke?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=pe(),this.manager.emit(this.options.event,this._input)))}}),c(te,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&rt)}}),c(ie,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ne|De,pointers:1},getTouchAction:function(){return J.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(Ne|De)?t=e.velocity:i&Ne?t=e.velocityX:i&De&&(t=e.velocityY),this._super.attrTest.call(this,e)&&i&e.direction&&e.distance>this.options.threshold&&de(t)>this.options.velocity&&e.eventType&ke},emit:function(e){var t=K(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),c(ne,q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[et]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&Ce&&0===this.count)return this.failTimeout();if(n&&r&&i){if(e.eventType!=ke)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||D(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e;var l=this.count%t.taps;if(0===l)return this.hasRequireFailures()?(this._timer=o(function(){this.state=lt,this.tryEmit()},t.interval,this),rt):lt}return ut},failTimeout:function(){return this._timer=o(function(){this.state=ut},this.options.interval,this),ut},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==lt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),oe.VERSION="2.0.4",oe.defaults={domEvents:!1,touchAction:Je,enable:!0,inputTarget:null,inputClass:null,preset:[[te,{enable:!1}],[$,{enable:!1},["rotate"]],[ie,{direction:Ne}],[J,{direction:Ne},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ht=1,dt=2;re.prototype={set:function(e){return a(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?dt:ht},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,n=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&lt)&&(o=t.curRecognizer=null);for(var r=0;r<n.length;)i=n[r],t.stopped===dt||o&&i!=o&&!i.canRecognizeWith(o)?i.reset():i.recognize(e),!o&&i.state&(rt|st|at)&&(o=t.curRecognizer=i),r++}},get:function(e){if(e instanceof q)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(r(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(r(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(E(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return s(f(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return s(f(e),function(e){t?i[e].splice(E(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&ae(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&se(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(oe,{INPUT_START:Ce,INPUT_MOVE:Se,INPUT_END:ke,INPUT_CANCEL:xe,STATE_POSSIBLE:ot,STATE_BEGAN:rt,STATE_CHANGED:st,STATE_ENDED:at,STATE_RECOGNIZED:lt,STATE_CANCELLED:ct,STATE_FAILED:ut,DIRECTION_NONE:Me,DIRECTION_LEFT:Re,DIRECTION_RIGHT:Pe,DIRECTION_UP:Ve,DIRECTION_DOWN:Ie,DIRECTION_HORIZONTAL:Ne,DIRECTION_VERTICAL:De,DIRECTION_ALL:Le,Manager:re,Input:C,TouchAction:j,TouchInput:U,MouseInput:H,PointerEventInput:B,TouchMouseInput:W,SingleTouchInput:F,Recognizer:q,AttrRecognizer:Z,Tap:ne,Pan:J,Swipe:ie,Pinch:$,Rotate:te,Press:ee,on:p,off:v,each:s,merge:l,extend:a,inherit:c,bindFn:u,prefixed:T}),"undefined"!=typeof module&&module.exports,e[i]=oe}(window,document,"Hammer"),LmvMatrix4=function(e){e?this.elements=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(e,t,i,n,o,r,s,a,l,c,u,h,d,p,v,g){var m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=n,m[1]=o,m[5]=r,m[9]=s,m[13]=a,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=p,m[11]=v,m[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,u=i*a,h=i*l,d=n*a,p=n*l,v=o*l,g=r*s,m=r*a,f=r*l;return t[0]=1-(d+v),t[4]=u-f,t[8]=h+m,t[1]=u+f,t[5]=1-(c+v),t[9]=p-g,t[2]=h-m,t[6]=p+g,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,o=this.elements,r=i[0],s=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],v=i[6],g=i[10],m=i[14],f=i[3],E=i[7],A=i[11],y=i[15],T=n[0],w=n[4],b=n[8],C=n[12],S=n[1],k=n[5],x=n[9],M=n[13],R=n[2],P=n[6],V=n[10],I=n[14],N=n[3],D=n[7],L=n[11],O=n[15];return o[0]=r*T+s*S+a*R+l*N,o[4]=r*w+s*k+a*P+l*D,o[8]=r*b+s*x+a*V+l*L,o[12]=r*C+s*M+a*I+l*O,o[1]=c*T+u*S+h*R+d*N,o[5]=c*w+u*k+h*P+d*D,o[9]=c*b+u*x+h*V+d*L,o[13]=c*C+u*M+h*I+d*O,o[2]=p*T+v*S+g*R+m*N,o[6]=p*w+v*k+g*P+m*D,o[10]=p*b+v*x+g*V+m*L,o[14]=p*C+v*M+g*I+m*O,o[3]=f*T+E*S+A*R+y*N,o[7]=f*w+E*k+A*P+y*D,o[11]=f*b+E*x+A*V+y*L,o[15]=f*C+E*M+A*I+y*O,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],o=e[12],r=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],p=e[3],v=e[7],g=e[11],m=e[15];return p*(+o*a*u-n*l*u-o*s*h+i*l*h+n*s*d-i*a*d)+v*(+t*a*d-t*l*h+o*r*h-n*r*d+n*l*c-o*a*c)+g*(+t*l*u-t*s*d-o*r*u+i*r*d+o*s*c-i*l*c)+m*(-n*s*c-t*a*u+t*s*h+n*r*u-i*r*h+i*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,o=n[0],r=n[4],s=n[8],a=n[12],l=n[1],c=n[5],u=n[9],h=n[13],d=n[2],p=n[6],v=n[10],g=n[14],m=n[3],f=n[7],E=n[11],A=n[15];i[0]=u*g*f-h*v*f+h*p*E-c*g*E-u*p*A+c*v*A,i[4]=a*v*f-s*g*f-a*p*E+r*g*E+s*p*A-r*v*A,i[8]=s*h*f-a*u*f+a*c*E-r*h*E-s*c*A+r*u*A,i[12]=a*u*p-s*h*p-a*c*v+r*h*v+s*c*g-r*u*g,i[1]=h*v*m-u*g*m-h*d*E+l*g*E+u*d*A-l*v*A,i[5]=s*g*m-a*v*m+a*d*E-o*g*E-s*d*A+o*v*A,i[9]=a*u*m-s*h*m-a*l*E+o*h*E+s*l*A-o*u*A,i[13]=s*h*d-a*u*d+a*l*v-o*h*v-s*l*g+o*u*g,i[2]=c*g*m-h*p*m+h*d*f-l*g*f-c*d*A+l*p*A,i[6]=a*p*m-r*g*m-a*d*f+o*g*f+r*d*A-o*p*A,i[10]=r*h*m-a*c*m+a*l*f-o*h*f-r*l*A+o*c*A,i[14]=a*c*d-r*h*d-a*l*p+o*h*p+r*l*g-o*c*g,i[3]=u*p*m-c*v*m-u*d*f+l*v*f+c*d*E-l*p*E,i[7]=r*v*m-s*p*m+s*d*f-o*v*f-r*d*E+o*p*E,i[11]=s*c*m-r*u*m-s*l*f+o*u*f+r*l*E-o*c*E,i[15]=r*u*d-s*c*d+s*l*p-o*u*p-r*l*v+o*c*v;var y=o*i[0]+l*i[4]+d*i[8]+m*i[12];if(0==y){var T="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(T);return console.warn(T),this.identity(),this}return this.multiplyScalar(1/y),this},scale:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z;return t[0]*=i,t[4]*=n,t[8]*=o,t[1]*=i,t[5]*=n,t[9]*=o,t[2]*=i,t[6]*=n,t[10]*=o,t[3]*=i,t[7]*=n,t[11]*=o,this},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),o=1-i,r=e.x,s=e.y,a=e.z,l=o*r,c=o*s;return this.set(l*r+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*r,0,l*a-n*s,c*a+n*r,o*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},transformPoint:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements;return e.x=o[0]*t+o[4]*i+o[8]*n+o[12],e.y=o[1]*t+o[5]*i+o[9]*n+o[13],e.z=o[2]*t+o[6]*i+o[10]*n+o[14],e},transformDirection:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements;e.x=o[0]*t+o[4]*i+o[8]*n,e.y=o[1]*t+o[5]*i+o[9]*n,e.z=o[2]*t+o[6]*i+o[10]*n;var r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(r>0){var s=1/r;e.x*=s,e.y*=s,e.z*=s}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new LmvMatrix4).fromArray(this.elements)}},!function(e){var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.lmv_poly2tri=e()}(function(){return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return o(i?i:e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,i){t.exports={version:"1.3.5"}},{}],2:[function(e,t,i){"use strict";var n=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},o=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};o.prototype.head=function(){return this.head_},o.prototype.setHead=function(e){this.head_=e},o.prototype.tail=function(){return this.tail_},o.prototype.setTail=function(e){this.tail_=e},o.prototype.search=function(){return this.search_node_},o.prototype.setSearch=function(e){this.search_node_=e},o.prototype.findSearchNode=function(){return this.search_node_},o.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},o.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),n=i.point.x;if(t===n){if(e!==i.point)if(e===i.prev.point)i=i.prev;else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");i=i.next}}else if(t<n)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=o,t.exports.Node=n},{}],3:[function(e,t,i){"use strict";function n(e,t){if(!e)throw new Error(t||"Assert Failed")}t.exports=n},{}],4:[function(e,t,i){"use strict";var n=e("./xy"),o=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};o.prototype.toString=function(){return n.toStringBase(this)},o.prototype.toJSON=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set_zero=function(){return this.x=0,this.y=0,this},o.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},o.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},o.prototype.mul=function(e){return this.x*=e,this.y*=e,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},o.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},o.negate=function(e){return new o(-e.x,-e.y)},o.add=function(e,t){return new o(e.x+t.x,e.y+t.y)},o.sub=function(e,t){return new o(e.x-t.x,e.y-t.y)},o.mul=function(e,t){return new o(e*t.x,e*t.y)},o.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new o(-e*t.y,e*t.x):"number"==typeof t?new o(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},o.toString=n.toString,o.compare=n.compare,o.cmp=n.compare,o.equals=n.equals,o.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=o},{"./xy":11}],5:[function(e,t,i){"use strict";var n=e("./xy"),o=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+n.toString(t[i])};o.prototype=new Error,o.prototype.constructor=o,t.exports=o},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict";var n=t.poly2tri;i.noConflict=function(){return t.poly2tri=n,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext");var o=e("./sweep");i.triangulate=o.triangulate,i.sweep={Triangulate:o.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict";function n(e){e.initTriangulation(),e.createAdvancingFront(),o(e),r(e)}function o(e){var t,i=e.pointCount();for(t=1;t<i;++t)for(var n=e.getPoint(t),o=s(e,n),r=n._p2t_edge_list,l=0;r&&l<r.length;++l)a(e,r[l],o)}function r(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);e.meshClean(t)}function s(e,t){var i=e.locateNode(t),n=u(e,t,i);return t.x<=i.point.x+H&&h(e,i),d(e,n),n}function a(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,c(i.triangle,t.p,t.q)||(y(e,t,i),l(e,t.p,t.q,i.triangle,t.q))}function l(e,t,i,n,o){if(!c(n,t,i)){var r=n.pointCCW(o),s=F(i,r,t);if(s===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,r,t]);var a=n.pointCW(o),u=F(i,a,t);if(u===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,a,t]);s===u?(n=s===B.CW?n.neighborCCW(o):n.neighborCW(o),l(e,t,i,n,o)):R(e,t,i,n,o)}}function c(e,t,i){var n=e.edgeIndex(t,i);if(n!==-1){e.markConstrainedEdgeByIndex(n);var o=e.getNeighbor(n);return o&&o.markConstrainedEdgeByPoints(t,i),!0}return!1}function u(e,t,i){var n=new L(t,i.point,i.next.point);n.markNeighbor(i.triangle),e.addToMap(n);var o=new O(t);return o.next=i.next,o.prev=i,i.next.prev=o,i.next=o,v(e,n)||e.mapTriangleToNodes(n),o}function h(e,t){var i=new L(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,v(e,i)||e.mapTriangleToNodes(i)}function d(e,t){for(var i=t.next;i.next&&!U(i.point,i.next.point,i.prev.point);)h(e,i),i=i.next;for(i=t.prev;i.prev&&!U(i.point,i.next.point,i.prev.point);)h(e,i),i=i.prev;t.next&&t.next.next&&p(t)&&f(e,t)}function p(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y;return N(i>=0,"unordered y"),t>=0||Math.abs(t)<i}function v(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var n=t.getNeighbor(i);if(n){var o=t.getPoint(i),r=n.oppositePoint(t,o),s=n.index(r);if(n.constrained_edge[s]||n.delaunay_edge[s]){t.constrained_edge[i]=n.constrained_edge[s];continue}var a=g(o,t.pointCCW(o),t.pointCW(o),r);if(a){t.delaunay_edge[i]=!0,n.delaunay_edge[s]=!0,m(t,o,n,r);var l=!v(e,t);return l&&e.mapTriangleToNodes(t),l=!v(e,n),l&&e.mapTriangleToNodes(n),t.delaunay_edge[i]=!1,n.delaunay_edge[s]=!1,!0}}}return!1}function g(e,t,i,n){var o=e.x-n.x,r=e.y-n.y,s=t.x-n.x,a=t.y-n.y,l=o*a,c=s*r,u=l-c;if(u<=0)return!1;var h=i.x-n.x,d=i.y-n.y,p=h*r,v=o*d,g=p-v;if(g<=0)return!1;var m=s*d,f=h*a,E=o*o+r*r,A=s*s+a*a,y=h*h+d*d,T=E*(m-f)+A*g+y*u;return T>0}function m(e,t,i,n){var o,r,s,a;o=e.neighborCCW(t),r=e.neighborCW(t),s=i.neighborCCW(n),a=i.neighborCW(n);var l,c,u,h;l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=i.getConstrainedEdgeCCW(n),h=i.getConstrainedEdgeCW(n);var d,p,v,g;d=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),v=i.getDelaunayEdgeCCW(n),g=i.getDelaunayEdgeCW(n),e.legalize(t,n),i.legalize(n,t),i.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(n,v),i.setDelaunayEdgeCW(n,g),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(n,u),i.setConstrainedEdgeCW(n,h),e.clearNeighbors(),i.clearNeighbors(),o&&i.markNeighbor(o),r&&e.markNeighbor(r),s&&e.markNeighbor(s),a&&i.markNeighbor(a),e.markNeighbor(i)}function f(e,t){for(F(t.point,t.next.point,t.next.next.point)===B.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,E(e,e.basin.bottom_node))}}function E(e,t){if(!A(e,t)){h(e,t);var i;if(t.prev!==e.basin.left_node||t.next!==e.basin.right_node){if(t.prev===e.basin.left_node){if(i=F(t.point,t.next.point,t.next.next.point),i===B.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(i=F(t.point,t.prev.point,t.prev.prev.point),i===B.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;E(e,t)}}}function A(e,t){var i;return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}function y(e,t,i){e.edge_event.right?T(e,t,i):S(e,t,i)}function T(e,t,i){for(;i.next.point.x<t.p.x;)F(t.q,i.next.point,t.p)===B.CCW?w(e,t,i):i=i.next}function w(e,t,i){i.point.x<t.p.x&&(F(i.point,i.next.point,i.next.next.point)===B.CCW?b(e,t,i):(C(e,t,i),w(e,t,i)))}function b(e,t,i){h(e,i.next),i.next.point!==t.p&&F(t.q,i.next.point,t.p)===B.CCW&&F(i.point,i.next.point,i.next.next.point)===B.CCW&&b(e,t,i)}function C(e,t,i){F(i.next.point,i.next.next.point,i.next.next.next.point)===B.CCW?b(e,t,i.next):F(t.q,i.next.next.point,t.p)===B.CCW&&C(e,t,i.next)}function S(e,t,i){for(;i.prev.point.x>t.p.x;)F(t.q,i.prev.point,t.p)===B.CW?k(e,t,i):i=i.prev}function k(e,t,i){i.point.x>t.p.x&&(F(i.point,i.prev.point,i.prev.prev.point)===B.CW?M(e,t,i):(x(e,t,i),k(e,t,i)))}function x(e,t,i){F(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===B.CW?M(e,t,i.prev):F(t.q,i.prev.prev.point,t.p)===B.CW&&x(e,t,i.prev)}function M(e,t,i){h(e,i.prev),i.prev.point!==t.p&&F(t.q,i.prev.point,t.p)===B.CW&&F(i.point,i.prev.point,i.prev.prev.point)===B.CW&&M(e,t,i)}function R(e,t,i,n,o){var r=n.neighborAcross(o);N(r,"FLIP failed due to missing triangle!");var s=r.oppositePoint(n,o);if(n.getConstrainedEdgeAcross(o)){var a=n.index(o);throw new D("poly2tri Intersecting Constraints",[o,s,n.getPoint((a+1)%3),n.getPoint((a+2)%3)])}if(z(o,n.pointCCW(o),n.pointCW(o),s))if(m(n,o,r,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(r),o===i&&s===t)i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,i),r.markConstrainedEdgeByPoints(t,i),v(e,n),v(e,r));else{var c=F(i,s,t);n=P(e,c,n,r,o,s),R(e,t,i,n,o)}else{var u=V(t,i,r,s);I(e,t,i,n,r,u),l(e,t,i,n,o)}}function P(e,t,i,n,o,r){var s;return t===B.CCW?(s=n.edgeIndex(o,r),n.delaunay_edge[s]=!0,v(e,n),n.clearDelaunayEdges(),i):(s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,v(e,i),i.clearDelaunayEdges(),n)}function V(e,t,i,n){var o=F(t,n,e);if(o===B.CW)return i.pointCCW(n);if(o===B.CCW)return i.pointCW(n);throw new D("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}function I(e,t,i,n,o,r){var s=o.neighborAcross(r);N(s,"FLIP failed due to missing triangle");var a=s.oppositePoint(o,r);if(z(i,n.pointCCW(i),n.pointCW(i),a))R(e,i,a,s,a);else{var l=V(t,i,s,a);I(e,t,i,n,s,l)}}var N=e("./assert"),D=e("./pointerror"),L=e("./triangle"),O=e("./advancingfront").Node,_=e("./utils"),H=_.EPSILON,B=_.Orientation,F=_.orient2d,z=_.inScanArea,U=_.isAngleObtuse;i.triangulate=n},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict";var n=e("./pointerror"),o=e("./point"),r=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),l=a.Node,c=.3,u=function(e,t){
if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},h=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};h.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var d=function(){this.constrained_edge=null,this.right=!1},p=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new h,this.edge_event=new d,this.initEdges(this.points_)};p.prototype.addHole=function(e){this.initEdges(e);var t,i=e.length;for(t=0;t<i;t++)this.points_.push(e[t]);return this},p.prototype.AddHole=p.prototype.addHole,p.prototype.addHoles=function(e){var t,i=e.length;for(t=0;t<i;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},p.prototype.addPoint=function(e){return this.points_.push(e),this},p.prototype.AddPoint=p.prototype.addPoint,p.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},p.prototype.triangulate=function(){return s.triangulate(this),this},p.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},p.prototype.getTriangles=function(){return this.triangles_},p.prototype.GetTriangles=p.prototype.getTriangles,p.prototype.front=function(){return this.front_},p.prototype.pointCount=function(){return this.points_.length},p.prototype.head=function(){return this.head_},p.prototype.setHead=function(e){this.head_=e},p.prototype.tail=function(){return this.tail_},p.prototype.setTail=function(e){this.tail_=e},p.prototype.getMap=function(){return this.map_},p.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,n=this.points_[0].y,r=this.points_[0].y,s=this.points_.length;for(e=1;e<s;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<i&&(i=a.x),a.y>n&&(n=a.y),a.y<r&&(r=a.y)}this.pmin_=new o(i,r),this.pmax_=new o(t,n);var l=c*(t-i),u=c*(n-r);this.head_=new o(t+l,r-u),this.tail_=new o(i-l,r-u),this.points_.sort(o.compare)},p.prototype.initEdges=function(e,t){var i,n=e.length,o=t?e.length-1:e.length;for(i=0;i<o;++i)this.edge_list.push(new u(e[i],e[(i+1)%n]))},p.prototype.getPoint=function(e){return this.points_[e]},p.prototype.addToMap=function(e){this.map_.push(e)},p.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},p.prototype.createAdvancingFront=function(){var e,t,i,n=new r(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),i=new l(n.getPoint(2)),this.front_=new a(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},p.prototype.removeNode=function(e){},p.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)));i&&(i.triangle=e)}},p.prototype.removeFromMap=function(e){var t,i=this.map_,n=i.length;for(t=0;t<n;t++)if(i[t]===e){i.splice(t,1);break}},p.prototype.meshClean=function(e){for(var t,i,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||n.push(t.getNeighbor(i))},t.exports=p},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict";var n=e("./xy"),o=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},r=n.toString;o.prototype.toString=function(){return"["+r(this.points_[0])+r(this.points_[1])+r(this.points_[2])+"]"},o.prototype.getPoint=function(e){return this.points_[e]},o.prototype.GetPoint=o.prototype.getPoint,o.prototype.getPoints=function(){return this.points_},o.prototype.getNeighbor=function(e){return this.neighbors_[e]},o.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},o.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},o.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},o.prototype.isInterior=function(){return this.interior_},o.prototype.setInterior=function(e){return this.interior_=e,this},o.prototype.markNeighborPointers=function(e,t,i){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=i;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=i;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}},o.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},o.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},o.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},o.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},o.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},o.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},o.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},o.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},o.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},o.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},o.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},o.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},o.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},o.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},o.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},o.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},o.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},o.prototype.oppositePoint=function(e,t){var i=e.pointCW(t);return this.pointCW(i)},o.prototype.legalize=function(e,t){var i=this.points_;if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2],i[2]=i[1],i[1]=t}},o.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},o.prototype.edgeIndex=function(e,t){var i=this.points_;if(e===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1},o.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},o.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},o.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_;t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=o},{"./xy":11}],10:[function(e,t,i){"use strict";function n(e,t,i){var n=(e.x-i.x)*(t.y-i.y),o=(e.y-i.y)*(t.x-i.x),r=n-o;return r>-1e-12&&r<s?a.COLLINEAR:r>0?a.CCW:a.CW}function o(e,t,i,n){var o=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);if(o>=-1e-12)return!1;var r=(e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y);return!(r<=s)}function r(e,t,i){var n=t.x-e.x,o=t.y-e.y,r=i.x-e.x,s=i.y-e.y;return n*r+o*s<0}var s=1e-12;i.EPSILON=s;var a={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=a,i.orient2d=n,i.inScanArea=o,i.isAngleObtuse=r},{}],11:[function(e,t,i){"use strict";function n(e){return"("+e.x+";"+e.y+")"}function o(e){var t=e.toString();return"[object Object]"===t?n(e):t}function r(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function s(e,t){return e.x===t.x&&e.y===t.y}t.exports={toString:o,toStringBase:n,compare:r,equals:s}},{}]},{},[6])(6)}),function(){"use strict";var e=Autodesk.Viewing;e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.fireEvent=e.EventDispatcher.prototype.fireEvent,t.dispatchEvent=e.EventDispatcher.prototype.fireEvent},addEventListener:function(e,t){e&&(void 0===this.listeners&&(this.listeners={}),"undefined"==typeof this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t))},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[e]&&i[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(e&&(void 0===this.listeners&&(this.listeners={}),this.listeners[e]instanceof Array))for(var i=this.listeners[e],n=0,o=i.length;n<o;n++)if(i[n]===t){i.splice(n,1);break}},fireEvent:function(e){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this.listeners[e.type]instanceof Array)for(var t=this.listeners[e.type].slice(),i=0;i<t.length;i++)t[i].call(this,e)}}}(),Autodesk.Viewing.FileLoader=function(e){this.viewer=e},Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader,Autodesk.Viewing.FileLoader.prototype.loadFile=function(e,t,i,n){return!1},function(){"use strict";var e=function(){function e(e,t,i){return!o[e]&&(o[e]={loader:i,extensions:t},!0)}function t(e){return o[e]?o[e].loader:null}function i(e){return!!o[e]&&(delete o[e],!0)}function n(e){e=e?e.toLowerCase():"";for(var t in o){var i=o[t];if(i)for(var n=0;n<i.extensions.length;n++)if(i.extensions[n].toLowerCase()===e)return i.loader}return null}var o={};return{registerFileLoader:e,getFileLoader:t,getFileLoaderForExtension:n,unregisterFileLoader:i}},t=Autodesk.Viewing;t.FileLoaderManager=new e}(),function(){"use strict";function e(e){for(var t=0;t<r.length;++t)document.addEventListener(r[t],e,!1)}function t(e){for(var t=0;t<r.length;++t)document.removeEventListener(r[t],e,!1)}function i(t){this.viewer=t,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener)}var n=Autodesk.Viewing,o=n.Private,r=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];n.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},n.ScreenModeDelegate=i,i.prototype.uninitialize=function(){t(this.bindFullscreenEventListener),this.viewer=null},i.prototype.isModeSupported=function(e){return!0},i.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},i.prototype.getMode=function(){throw"Implement getMode() in derived class"},i.prototype.getNextMode=function(){var e,t=this.getMode(),i=n.ScreenMode;return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},i.prototype.getEscapeMode=function(){return this.getMode()!==n.ScreenMode.kNormal?n.ScreenMode.kNormal:void 0},i.prototype.fullscreenEventListener=function(){if(n.inFullscreen())this.viewer.resize();else{var e=n.ScreenMode;this.doScreenModeChange(e.kFullScreen,e.kNormal),this.onScreenModeChanged(e.kFullScreen,e.kNormal)}},i.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},i.prototype.onScreenModeChanged=function(i,o){i===n.ScreenMode.kFullScreen?t(this.bindFullscreenEventListener):o===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:n.FULLSCREEN_MODE_EVENT,mode:o})},n.AppScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.AppScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.AppScreenModeDelegate.prototype.constructor=n.AppScreenModeDelegate,n.AppScreenModeDelegate.prototype.isModeSupported=function(e){return e!==n.ScreenMode.kFullBrowser},n.AppScreenModeDelegate.prototype.getMode=function(){return n.inFullscreen()?n.ScreenMode.kFullScreen:n.ScreenMode.kNormal},n.AppScreenModeDelegate.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container;t===n.ScreenMode.kNormal?(i.classList.remove("viewer-fill-browser"),n.exitFullscreen()):t===n.ScreenMode.kFullScreen&&(i.classList.add("viewer-fill-browser"),n.launchFullscreen(i))},n.ApplicationScreenModeDelegate=n.AppScreenModeDelegate,n.NullScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.NullScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.NullScreenModeDelegate.prototype.constructor=n.ScreenModeDelegate,n.NullScreenModeDelegate.prototype.isModeSupported=function(e){return!1},n.NullScreenModeDelegate.prototype.getMode=function(){return n.ScreenMode.kNormal},n.ScreenModeMixin=function(){},n.ScreenModeMixin.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),e?this.screenModeDelegateClass=e:null===e?this.screenModeDelegateClass=n.NullScreenModeDelegate:this.screenModeDelegateClass=n.AppScreenModeDelegate},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=n.ScreenModeMixin.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};e.ModelUnits=i;var n=function(e){WGS.RenderModel.call(this),this.myData=e,this.sharedPath=null,this.propWorker=null,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)}};e.EventDispatcher.prototype.apply(n.prototype),n.prototype.constructor=n,n.prototype.setData=function(e){this.myData=e},n.prototype.getData=function(){return this.myData},n.prototype.getDocumentNode=function(){return this.myData.loadOptions?this.myData.loadOptions.bubbleNode||null:null},n.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},n.prototype.getRootId=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0},n.prototype.getUnitScale=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}},n.prototype.getUnitString=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},n.prototype.getDisplayUnit=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},n.prototype.getMetadata=function(e,t,i){if(this.myData){var n=this.myData.metadata;if(n){var o=n[e];if(void 0!==o){if(!t)return o;var r=o[t];if(void 0!==r)return r}}}return i},n.prototype.getDefaultCamera=function(){var e=this.myData;if(!e)return null;var t=null,i=e.cameras?e.cameras.length:0;if(0<i){var n=this.getMetadata("default camera","index",null);if(null!==n&&e.cameras[n])t=e.cameras[n];else{for(var o=0;o<i;o++){var r=e.cameras[o];if(r.isPerspective){t=r;break}}t||(t=e.cameras[0])}}return t},n.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},n.prototype.geomPolyCount=function(){return this.myData?this.myData.geomPolyCount:null},n.prototype.instancePolyCount=function(){return this.myData?this.myData.instancePolyCount:null},n.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(t.logger.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},n.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},n.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},n.prototype.getProperties=function(e,t,i){this.myData&&this.myData.propWorker&&e>0&&this.myData.propWorker.getProperties(e,t,i)},n.prototype.getBulkProperties=function(e,t,i,n){this.myData&&this.myData.propWorker&&this.myData.propWorker.getBulkProperties(e,t,i,n)},n.prototype.getExternalIdMapping=function(e,t){this.myData&&this.myData.propWorker.getExternalIdMapping(e,t)},n.prototype.getObjectTree=function(e,t){this.myData&&this.myData.propWorker?this.myData.propWorker.getObjectTree(e,t):t&&t()},n.prototype.search=function(e,t,i,n,o){var r=this;this.isLoadDone()?this.myData.propWorker.searchProperties(e,n,t,i,o):this.getObjectTree(function(){r.myData.propWorker.searchProperties(e,n,t,i,o)})};var o=function(e){var t=.001,i=e;if(Math.abs(i[0])<t)if(Math.abs(i[4])>t)for(var n=0;n<4;n++){var o=i[n];i[n]=i[n+4],i[n+4]=o}else for(var n=0;n<4;n++){var o=i[n];i[n]=i[n+8],i[n+8]=o}if(Math.abs(i[5])<t)for(var n=4;n<8;n++){var o=i[n];i[n]=i[n+4],i[n+4]=o}},r=function(e,t,i,n){var o,r,s,a,l,c,u=!1;s=n[i[i.length-1]].x,a=n[i[i.length-1]].y,o=a>=t;for(var h=0,d=i.length;h<d;++h)l=n[i[h]].x,c=n[i[h]].y,r=c>=t,o!=r&&(c-t)*(s-l)>=(l-e)*(a-c)==r&&(u=!u),o=r,s=l,a=c;return u};n.prototype.pointInPolygon=function(e,t,i,n){for(var o=!1,s=0;s<i.length;s++)r(e,t,i[s],n)&&(o=!o);return o},n.prototype.getPageToModelTransform=function(e){if(this.myData.pageToModelTransform)return this.myData.pageToModelTransform;var t=this.myData,i=t.metadata,n=i.page_dimensions,r=t.viewports[e];if(!r)return new THREE.Matrix4;t.viewportTransforms||(t.viewportTransforms=new Array(t.viewports.length));var s=t.viewportTransforms[e];if(s)return s;var a=new LmvMatrix4(!0).set(n.logical_width/n.page_width,0,0,n.logical_offset_x,0,n.logical_height/n.page_height,0,n.logical_offset_y,0,0,1,0,0,0,0,1),l=r.transform.slice();o(l);var c=new LmvMatrix4(!0);c.elements.set(l);var u=new LmvMatrix4(!0);return u.getInverse(c),u.multiply(a),t.viewportTransforms[e]=u,u},n.prototype.pageToModel=function(e,t,i){var n=this.getPageToModelTransform(i),o=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(n),r=(new THREE.Vector3).set(t.x,t.y,0).applyMatrix4(n);e.x=o.x,e.y=o.y,t.x=r.x,t.y=r.y},n.prototype.pointInClip=function(e,t){for(var i=this.myData.clips,n=[],o=1;o<i.length;o++)if(o!==t){for(var r=[],s=[],a=i[o].contourCounts,l=i[o].points,c=0,u=[],h=0;h<a.length;h++){for(var d=0;d<a[h];d++)r.push(c),c++;s.push(r),r=[]}for(var h=0;h<l.length;h+=2){var p={x:l[h],y:l[h+1]};u.push(p)}var v=this.pointInPolygon(e.x,e.y,s,u);v&&n.push(o)}return n},n.prototype.getClip=function(e){for(var t=this.myData.clips,i=[],n=[],o=t[e].contourCounts,r=t[e].points,s=0,a=[],l=0;l<o.length;l++){for(var c=0;c<o[l];c++)i.push(s),s++;n.push(i),i=[]}for(var l=0;l<r.length;l+=2){var u={x:r[l],y:r[l+1]};a.push(u)}return{contours:n,points:a}},n.prototype.getTopoIndex=function(e){if(this.myData&&this.myData.fragments){var t=this.myData.fragments.topoIndexes;if(t)return t[e]}},n.prototype.getTopology=function(e){if(this.myData){var t=this.myData.topology;if(t){var i=t[e];if(i)return i}}},n.prototype.hasTopology=function(){if(this.myData){var e=this.myData.topology;if(e)return!0}return!1},n.prototype.hasGeometry=function(){return!!this.myData&&(!!this.myData.isLeaflet||this.myData.fragments.length>0)},e.Model=n}(),function(){"use strict";function e(e){var t=e.split("/");if(0==t.length)return e;for(var i=[],n=0;n<t.length;++n){var o=t[n];"."!==o&&(".."===o&&i.length?i.pop():i.push(o))}return 0==i.length?"":i.join("/")}function t(e,t){for(var i=e.length-t,n=new ArrayBuffer(i),o=new Uint8Array(n,0),r=0,s=t;r<i;r++,s++)o[r]=255&e.charCodeAt(s);return o}function i(e,t){return t.indexOf("file://")===-1&&(t.indexOf("://")!==-1||(!!e||void 0))}function n(e,t,i,n){function o(e){if("json"==n.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){i(e)}return e}0===e.indexOf("file://")&&(e=e.substr(7)),require("fs").readFile(e,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):31==s[0]&&139==s[1]?require("zlib").gunzip(s,null,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):(s=o(s),n.ondata&&n.ondata(s),t(s))}):(s=o(s),n.ondata&&n.ondata(s),t(s))})}function o(e,t){t.hasOwnProperty("asynchronous")?t.asynchronous||s.logger.warn("LMV: Sync XHR used. Performance warning."):t.asynchronous=!0,t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.withCredentials=!!e.auth,t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}var r=Autodesk.Viewing,s=r.Private;s.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window;var a;"undefined"!=typeof XMLHttpRequest?a=XMLHttpRequest:(a=require("xhr2"),a.prototype._restrictedHeaders.cookie=!1);var l={},c=!1;l.OSS_PREFIX="urn:adsk.objects:os.object:",l.getDirectOSSUrl=function(t,i){var n=i.indexOf(l.OSS_PREFIX);if(n!==-1){var o=i.substr(n+l.OSS_PREFIX.length),s=o.substr(0,o.indexOf("/")),a=o.substr(o.indexOf("/")+1);return a=e(a),r.makeOssPath(t.endpoint,s,a)}},l.generateUrl=function(t,i,n){if(n=e(n),0!==decodeURIComponent(n).indexOf("urn:"))return n;switch("items"!==i&&(n=n.substr(4)),i){case"items":return r.getItemApi(t)+n;case"bubbles":return r.getManifestApi(t)+n;case"thumbnails":return r.getThumbnailApi(t)+n}},l.rawGet=function(e,o,u,h,d,p){function v(e){d&&d(f.status,f.statusText,{url:u})}function g(e){if(200===f.status)if(f.response&&f.response instanceof ArrayBuffer){var t=new Uint8Array(f.response);if(!p.skipDecompress&&31==t[0]&&139==t[1]){c||(c=!0,s.logger.warn("An LMV resource ("+u+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=new Zlib.Gunzip(t).decompress()}catch(e){d(r.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:u,exception:e.toString(),stack:e.stack})}}h(t)}else h(f.response||f.responseText);else v(e)}var p=p?p:{};if(r.isNodeJS&&!i(e,u))return void n(u,h,d,p);var m=l.getDirectOSSUrl(p,u);u=m?m:l.generateUrl(e,o,u),p.queryParams&&(u=u+"?"+p.queryParams);var f=new a;try{var E=!p.hasOwnProperty("asynchronous")||p.asynchronous;if(f.open(p.noBody?"HEAD":"GET",u,E),p.hasOwnProperty("responseType")&&(f.responseType=p.responseType),f.withCredentials=!0,p.hasOwnProperty("withCredentials")&&(f.withCredentials=p.withCredentials),p.headers)for(var A in p.headers)f.setRequestHeader(A,p.headers[A]),"authorization"===A.toLocaleLowerCase()&&(f.withCredentials=!1);E&&(f.onload=g,f.onerror=v,f.ontimeout=v,p.ondata&&(f.overrideMimeType("text/plain; charset=x-user-defined"),p._dlProgress={streamOffset:0,counter:0},f.onreadystatechange=function(){if(f.readyState>2){var e=f.responseText;if(p._dlProgress.streamOffset>=e.length)return;var i=t(e,p._dlProgress.streamOffset);p._dlProgress.streamOffset=e.length,p.ondata(i)}})),f.send(),p.skipAssetCallback||(s.inWorkerThread?self.postMessage({assetRequest:[u,p.headers,null]}):s.assets.push([u,p.headers,null])),E||g()}catch(e){d(f.status,f.statusText,{url:u,exception:e})}},l.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(r.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(r.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(r.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(r.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:i.url,exception:i.exception.toString(),stack:i.exception.stack}):this.raiseError(r.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},l.getItem=function(e,t,i,n,r){r=r||{},o(e,r);var s=t.indexOf("urn:"),a=t.indexOf("?");s!==-1&&(t=a!==-1?t.substr(0,s)+encodeURIComponent(t.substring(s,a))+t.substr(a):t.substr(0,s)+encodeURIComponent(t.substr(s))),l.rawGet(e.endpoint,"items",t,i,n,r)},l.getManifest=function(e,t,i,n,r){r=r||{},r.hasOwnProperty("responseType")||(r.responseType="json"),o(e,r),l.rawGet(e.endpoint,"bubbles",t,i,n,r)},l.getThumbnail=function(e,t,i,n,r){if(r=r||{},o(e,r),!r.queryParams){var s=r.role||"rendered",a=r.size||400;r.queryParams="guid="+encodeURIComponent(r.guid)+"&role="+s+"&width="+a+"&height="+a}l.rawGet(e.endpoint,"thumbnails",t,i,n,r)},l.getACMSession=function(e,t,i,n){var o,s={};for(var a in t)"oauth2AccessToken"===a?o=t[a]:a.indexOf("x-ads-acm")!==-1&&(s[a]=t[a]),r.isMobileDevice()&&(r.HTTP_REQUEST_HEADERS=s);s.application="autodesk";var l=new XMLHttpRequest;l.open("POST",e+"/oss-ext/v2/acmsessions",!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization","Bearer "+o),l.responseType="json",l.onload=function(){if(200===l.status&&l.response){var e="string"==typeof l.response?JSON.parse(l.response):l.response;e&&e.acmsession?i(e.acmsession):n(l.status,"Can't get acm session from response.")}else n(l.status)},l.onerror=n,l.ontimeout=n,l.send(JSON.stringify(s)),delete s.application},s.ViewingService=l}(),"undefined"!=typeof window){var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(e,t,i){var n=null,o=e.split(":");if(0===o[0].indexOf("stun"))n={url:e};else if(0===o[0].indexOf("turn")&&(e.indexOf("transport=udp")!==-1||e.indexOf("?transport")===-1)){var r=e.split("?");n={url:r[0],credential:i,username:t}}return n},attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t,e.play()},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject,e.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40,createIceServer=function(e,t,i){var n=null,o=e.split(":");if(0===o[0].indexOf("stun"))n={url:e};else if(0===o[0].indexOf("turn"))if(webrtcDetectedVersion<28){var r=e.split("turn:");n={url:"turn:"+t+"@"+r[1],credential:i}}else n={url:e,credential:i,username:t};return n},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(e,t){"undefined"!=typeof e.srcObject?e.srcObject=t:"undefined"!=typeof e.mozSrcObject?e.mozSrcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}!function(){"use strict";function e(e,t){function o(){return i.config.userName&&i.config.userName.length?i.config.userName:g?g.slice(0,5):"Unknown";
}function r(e){switch(e.type){case"txt":c(e);break;case"joinok":l(e);break;case"join_error":break;case"sessionId":i.logger.info("Connect successful, your id is: "+e.id),g=e.id;break;case"joined":e.userStatus="joined",s(e);break;case"left":e.userStatus="left",a(e);break;case"camera":case"pointer":break;default:i.logger.log(e)}var t=e.roomId,n={type:v[e.type],data:e,channelId:t};y.dispatchEvent(n)}function s(e){if(e.user.name&&e.user.name.length||(e.user.name=e.user.id.slice(0,5)),e.roomId){var t=A[e.roomId];t?(t.users.push(e.user),i.logger.info(e.user+" joined room "+e.roomId)):i.logger.warn("Channel "+e.roomId+" does not exist for socket "+g)}}function a(e){i.logger.info(e.user+" left room "+e.room);for(var t in A){for(var n=A[t].users,o=-1,r=0;r<n.length;r++)if(n[r].id==e.user){o=r;break}o!=-1&&n.splice(o,1),delete A[t].userSet[e.user]}}function l(e){var t=A[e.roomId];i.logger.info("joined channel "+e.roomId),e.users&&e.users.length?t.users=e.users:t.users=[];for(var n=0;n<t.users.length;n++)t.users[n].name&&t.users[n].name.length||(t.users[n].name=t.users[n].id.slice(0,5));var r=o(),s=Autodesk.Viewing.i18n.translate("you"),a={id:g,name:r+" ("+s+")",isSelf:!0,status:0};t.userSet[g]||(t.users.push(a),t.userSet[g]=a),0!=a.id.indexOf(r)&&y.sendChatMessage("/nick "+r,e.roomId)}function c(e){if(0==e.msg.indexOf("/nick ")){var t=y.getUserById(e.from,e.roomId),i=e.msg.slice(6);if(i.length&&(t.name=i,t.id==g)){var n=Autodesk.Viewing.i18n.translate("you");t.name+=" ("+n+")"}y.dispatchEvent({type:"userListChange",data:e,channelId:e.roomId})}}function u(e){f<m.length?(i.logger.info("Connect failed, trying another server..."),p.disconnect(),p=null,f++,y.connect(y.sessionID)):y.dispatchEvent({type:"socketError",data:e})}function h(e){y.dispatchEvent({type:"socketError",data:e})}function d(e){f=0;for(var t in E)y.join(t)}var p,v={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},g=null,m=Array.isArray(e)?e:[e],f=0,E={},A={},y=this;this.connect=function(e){if(!p)return"undefined"!=typeof window.WebSocket&&(n||(n="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=e,p=n.connect(m[f]+"?sessionID="+e,{path:t,forceNew:!0}),p.on("connect",d),p.on("message",r),p.on("connect_error",u),p.on("error",h),!0)},this.join=function(e){return p&&p.connected?(delete E[e],A[e]={id:e,users:[],userSet:{}},void p.emit("join",{roomId:e,name:o()})):void(E[e]=1)},this.disconnect=function(){p&&(p.disconnect(),p=null,A={},g=null)},this.sendMessage=function(e,t,i){var n={type:e,from:g,msg:t,roomId:i};p.emit("message",n)},this.sendPrivateMessage=function(e,t){var i={type:"private",target:e,from:g,msg:t};p.emit("message",i)},this.sendChatMessage=function(e,t){var i={type:"txt",from:g,msg:e,roomId:t};p.emit("message",i),r(i)},this.getUserById=function(e,t){for(var i=A[t].users,n=0;n<i.length;n++)if(i[n].id==e)return i[n];return null},this.getLocalId=function(){return g},this.getChannelInfo=function(e){return A[e]},this.isConnected=function(){return p}}var t=Autodesk.Viewing,i=t.Private;i.config={userName:""},i.setUserName=function(e){i.config.userName=e};var n;e.prototype.constructor=e,t.EventDispatcher.prototype.apply(e.prototype);var o={};e.GetInstance=function(e,t){e||(e=i.EnvironmentConfigurations[i.env].LMV.RTC),Array.isArray(e)||(e=[e]);var n=o[e[0]];return n?n:(n=new i.MessageClient(e,t),o[e[0]]=n,n)},Autodesk.Viewing.Private.MessageClient=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var t=Autodesk.Viewing,i=t.Private;i.P2PClient=function(t){function n(e){try{u=new RTCPeerConnection(A),u.onicecandidate=function(e){e.candidate?m.sendPrivateMessage(h,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):i.logger.log("End of candidates.")},u.ondatachannel=function(e){i.logger.log("Data channel added."),v=e.channel,v.onmessage=a,g.dispatchEvent({type:"dataChannelAdded",data:e.channel})},u.onaddstream=function(e){i.logger.log("Remote stream added."),p=e.stream,g.dispatchEvent({type:"remoteStreamAdded",data:e.stream})},u.onremovestream=function(e){i.logger.log("Remote stream removed. Event: ",e),p=null,g.dispatchEvent({type:"remoteStreamRemoved",data:e.stream})},e&&(v=u.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),v.onmessage=a)}catch(e){return i.logger.error("Failed to create PeerConnection, exception: "+e.message),void alert("Cannot create RTCPeerConnection object.")}}function o(t){i.logger.error("createOffer() error: ",e)}function r(e){if(u.setLocalDescription(e),m.sendPrivateMessage(h,e),E.length){for(var t=0;t<E.length;t++)u.addIceCandidate(E[t]);E=[]}}function s(e){for(var t=e.split("\n"),i=!1,n=!1,o=!1,r=0;r<t.length;r++)0==t[r].indexOf("a=mid:data")&&(i=!0),0==t[r].indexOf("a=mid:video")&&(o=!0),0==t[r].indexOf("a=mid:audio")&&(n=!0);return i&&!o&&!n}function a(e){var t=JSON.parse(e.data);switch(t.type){case"camera":g.dispatchEvent({type:"cameraChange",data:t});break;case"joystick":g.dispatchEvent({type:"joystick",data:t});break;case"state":g.dispatchEvent({type:"viewerState",data:t})}}function l(e){var t=e.data.msg;if(i.logger.debug("Client received message:"+JSON.stringify(t)),"offer"!=t.type||f)if("answer"===t.type&&f)u.setRemoteDescription(new RTCSessionDescription(t));else if("candidate"===t.type){var n=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});f?u.addIceCandidate(n):E.push(n)}else"bye"===t&&f&&(g.dispatchEvent({type:"remoteHangup",data:null}),i.logger.info("Session terminated."),c());else i.logger.log("Received offer. Accepting."),g.receiveCall(e.data)}function c(){f=!1,u.close(),u=null,d=null,p=null,h=null}var u,h,d,p,v,g=this,m=t,f=!1,E=[],A={iceServers:[{url:"stun:stun.l.google.com:19302"}]},y={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},T={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};m.addEventListener("privateMessage",l),this.hangup=function(){i.logger.log("Hanging up."),f&&(m.sendPrivateMessage(h,"bye"),c())},this.initUserMedia=function(e){function t(t){i.logger.log("Adding local stream."),e&&e(t),g.dispatchEvent({type:"localStreamAdded",data:t})}function n(e){i.logger.error("getUserMedia error: ",e)}var o={video:!0,audio:!0};window.getUserMedia(o,t,n),i.logger.log("Getting user media with constraints",o)},this.callUser=function(e,t){return h?void i.logger.warn("Already in a call. Ignoring call request."):(h=e,i.logger.info("Calling user "+h),void(t?(n(!0),f=!0,i.logger.log("Sending data channel offer to peer"),u.createOffer(r,o)):this.initUserMedia(function(e){d=e,f||"undefined"==typeof d||(n(!1),u.addStream(d),f=!0,i.logger.log("Sending audio/video offer to peer"),u.createOffer(r,o))})))},this.receiveCall=function(e){h=e.from,h||(h=e.senderId);var t=e.msg.sdp;s(t)?(n(!0),f=!0,u.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending data-only answer to peer."),u.createAnswer(r,null,T)):this.initUserMedia(function(t){d=t,f||"undefined"==typeof d||(n(!1),u.addStream(d),f=!0),u.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending audio+video answer to peer."),u.createAnswer(r,null,y)})},this.getCurrentCallTarget=function(){return h},this.dataChannel=function(){return v}},i.P2PClient.prototype.constructor=i.P2PClient,Autodesk.Viewing.EventDispatcher.prototype.apply(i.P2PClient.prototype)}(),function(){var e=Autodesk.Viewing.Private;Autodesk.Viewing.Private.LiveReviewClient=function(e){this.viewer=e,this.messageClient=null,this.presenceChannelId=null,this.p2p=null,this.viewtx=null,this.interceptor=null},Autodesk.Viewing.Private.LiveReviewClient.prototype.destroy=function(){this.leaveLiveReviewSession()},Autodesk.Viewing.Private.LiveReviewClient.prototype.joinLiveReviewSession=function(t){this.messageClient||(this.messageClient=e.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(t),this.viewtx||(this.viewtx=new e.ViewTransceiver(this.messageClient)),this.viewtx.channelId=t,this.viewtx.attach(this.viewer),this.p2p||(this.p2p=new e.P2PClient(this.messageClient)),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new e.InteractionInterceptor(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},Autodesk.Viewing.Private.LiveReviewClient.prototype.leaveLiveReviewSession=function(){this.p2p&&this.p2p.hangup(),this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.p2p=null,this.viewtx=null,this.messageClient=null,this.interceptor=null};var t=Autodesk.Viewing,e=t.Private;e.InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},e.ViewTransceiver=function(i){function n(e){g=!0;var t=JSON.parse(e.data.msg);w.restoreState(t),v.impl.invalidate(!0,!1,!0),g=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg;t[1]===!0||f||(t[0]!=d&&(d=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),m=!1,v.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),v.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(m||f){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z];r(n),n.unshift(f),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),d!=n[0]&&(d=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:d}}))}}function l(e,t,i){e&&!y&&(y=document.createElement("div"),y.classList.add("collabPointer")),e&&!T?(v.container.appendChild(y),T=!0):!e&&T&&(v.container.removeChild(y),T=!1),e&&(y.style.left=t-6+"px",y.style.top=i-6+"px")}function c(e){if(!m&&!f){var t=e.data.msg;A.origin.set(t[1],t[2],t[3]),A.direction.set(t[4],t[5],t[6]);var i=A.at(v.getCamera().near);i.project(v.getCamera()),i=v.impl.viewportToClient(i.x,i.y),l(!0,i.x,i.y)}}function u(e){if(m){var t=v.impl.clientToViewport(e.canvasX,e.canvasY);v.impl.viewportToRay(t,A);var n=[A.origin.x,A.origin.y,A.origin.z,A.direction.x,A.direction.y,A.direction.z];r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function h(e){if(!g){var t=w.getState(b);i.sendMessage("state",JSON.stringify(t),p.channelId)}}var d,p=this,v=this.viewer=null,g=!1,m=!1,f=!1,E=this.client=i,A=new THREE.Ray,y=null,T=!1;this.channelId=null;var w,b={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){m=!0,l(!1)},this.updatePointer=function(e){u(e)},this.connectCamera=function(e){f=!e},this.attach=function(i,o){v&&this.detach(),this.viewer=v=i,w=new e.ViewerState(v),E.addEventListener("cameraChange",s),E.addEventListener("pointerMove",c),v.hasEventListener(t.CAMERA_CHANGE_EVENT,a)||v.addEventListener(t.CAMERA_CHANGE_EVENT,a),o||(E.addEventListener("viewerState",n),v.hasEventListener(t.SELECTION_CHANGED_EVENT,h)||(v.addEventListener(t.SELECTION_CHANGED_EVENT,h),v.addEventListener(t.ISOLATE_EVENT,h),v.addEventListener(t.HIDE_EVENT,h),v.addEventListener(t.SHOW_EVENT,h),v.addEventListener(t.EXPLODE_CHANGE_EVENT,h),v.addEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,h),v.addEventListener(t.CUTPLANES_CHANGE_EVENT,h)))},this.detach=function(){l(!1),E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),v&&(v.removeEventListener(t.CAMERA_CHANGE_EVENT,a),v.removeEventListener(t.SELECTION_CHANGED_EVENT,h),v.removeEventListener(t.ISOLATE_EVENT,h),v.removeEventListener(t.HIDE_EVENT,h),v.removeEventListener(t.SHOW_EVENT,h),v.removeEventListener(t.EXPLODE_CHANGE_EVENT,h),v.removeEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,h),v.removeEventListener(t.CUTPLANES_CHANGE_EVENT,h),this.viewer=v=null,w=null)}},e.ViewTransceiver.prototype.constructor=e.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(e.ViewTransceiver.prototype)}();var avp=Autodesk.Viewing.Private;avp.Autocam=avp.Autocam||function(e,t){function i(t){A=!0,e.target.copy(m.center),e.pivot.copy(m.pivot),e.worldup?e.worldup.copy(m.sceneUpDirection):e.up.copy(m.sceneUpDirection),m.cameraChangedCallback&&m.cameraChangedCallback(t),A=!1}function n(e,t){var i=e.clone();return Math.abs(i.clone().dot(t))<Number.MIN_VALUE?(i.normalize(),i):(i=o(e,t),i.length()<Number.MIN_VALUE&&(i=r(t)),i.normalize(),i)}function o(e,t){t.normalize();var i=e.clone().dot(t),n=t.clone().multiplyScalar(i);return n=e.clone().sub(n)}function r(e){for(var t=new THREE.Vector3(0,0,0),i=[new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],n=0;n<7;n++)if(Math.abs(i[n].dot(e))<Number.MIN_VALUE){t=i[n];break}return t}function s(e,t){var i=new THREE.Vector2(0,0);return i.x=e/window.innerWidth,i.y=t/window.innerHeight,i}function a(t){t.y=Math.abs(t.y-window.innerHeight);var i,n,o=e.position,r=m.center,s=r.clone().sub(o),a=e.up,l=s.clone().cross(a),c=s.clone().length(),u=c*Math.tan(THREE.Math.degToRad(e.leftFov)),h=c*Math.tan(THREE.Math.degToRad(e.rightFov)),d=c*Math.tan(THREE.Math.degToRad(e.topFov)),p=c*Math.tan(THREE.Math.degToRad(e.bottomFov)),v=u+h,g=d+p,f=t.x*v/window.innerWidth,E=f-u,A=t.y*g/window.innerHeight,y=A-p;return a=a.clone().normalize().clone().multiplyScalar(y),l=l.clone().normalize().clone().multiplyScalar(E),m.ortho?(i=o.clone().add(l).clone().add(a),n=s):(i=o,n=s.clone().add(a).clone().add(l)),{rayO:i,rayD:n}}function l(e,t,i){var n,o,r,s;n=o=r=s=0;var a=0,l=null,c=null,u=m.snapOrbitDeadZone,h=m.orbitMultiplier;return"h"==e?(n=m.snapOrbitThresholdH,o=m.snapOrbitAccelerationAX,r=m.snapOrbitAccelerationBX,s=1-m.snapOrbitAccelerationPointX,c=m.lockDeltaX,l=m.lockedX):(n=m.snapOrbitThresholdV,o=m.snapOrbitAccelerationAY,r=m.snapOrbitAccelerationBY,s=1-m.snapOrbitAccelerationPointY,c=m.lockDeltaY,l=m.lockedY),l?(c+=i,c<-u?(a=(c+u)*h*1/r,l=!1):c>u&&(a=(c-u)*h*1/r,l=!1)):(a=Math.abs(t)>n?i*h:Math.abs(t)>s*n?i*t>0?i*h*o:i*h*1/o:i*t>0?i*h*r:i*h*1/r,a*t>0&&Math.abs(a)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,l=!0,a=t)),a}function c(){return m.combined}function u(e,t){var i=30,n=!1,o=window.innerWidth,r=e.x%o,s=window.innerHeight,a=e.y%s,l=r>0?r-t.x:o+r-t.x,c=a>0?a-t.y:s+a-t.y;return Math.abs(l)<i&&Math.abs(c)<i&&(n=!0),n}function h(e,t,i){i.x=(e.x-t.x)/window.innerWidth,e.x=t.x+(e.x-t.x)%window.innerWidth,i.y=(e.y-t.y)/window.innerHeight,e.y=t.y+(e.y-t.y)%window.innerHeight}function d(e,t,i){if(!F||!e){if(e){var n=30,o=new THREE.Vector2,r=t.x,s=t.y;h(t,i,o),H=window.innerWidth*o.x,B=window.innerHeight*o.y,r<i.x?r-=2*n:r+=2*n,s<i.y?s-=2*n:s+=2*n}F=e}}function p(e,t,i){if(0===t)return 0;var n=e,o=m.saveEye.clone().sub(worldUp.clone().multiplyScalar(i+n)),r=m.saveEye.clone().sub(worldUp.clone().multiplyScalar(i)),s=0,a=(m.maxSceneBound-m.minSceneBound)/1e3;m.topLimit&&t>0?(s=m.maxSceneBound-a,m.topLimit=!1):m.bottomLimit&&t<0?(s=m.minSceneBound+a,m.bottomLimit=!1):s=o.dot(worldUp);var l=r.dot(worldUp);return s<m.minSceneBound?l<m.minSceneBound&&(m.bottomLimit=!0,n=0):s>m.maxSceneBound&&l>m.maxSceneBound&&(m.topLimit=!0,n=0),n}function v(e){var t=Math.pow(e,2);e<0&&(t=-t);var i=s(0,t),n=m.maxSceneBound-m.minSceneBound,o=.01*n;i.y*=o;var r=m.userHeightSpeed*i.y;return r=p(r,e,m.m_amount)}function g(e){var t=m.sceneFrontDirection.clone().cross(m.sceneUpDirection),i=Math.abs(Math.abs(e.dot(m.sceneUpDirection))-1),n=Math.abs(Math.abs(e.dot(m.sceneFrontDirection))-1),o=Math.abs(Math.abs(e.dot(t))-1);return i<1e-5||n<1e-5||o<1e-5}var m=this,f=null,E=null,A=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null;var T,w=Date.now(),b=!1;this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null},this.showPivot=function(e){this.pivotDisplayCallback&&this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){A||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){var e=this.getWorldUpVector();return e.cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};m.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:e.isPerspective===!1}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),b=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,i=e.target?e.target:this.pivot,n=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),isOrtho:e.isPerspective===!1},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:e.isPerspective===!1}},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),i(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),i(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var i=this.dir.clone(),n=i.cross(t).normalize();0===n.lengthSq()&&(i.copy(this.dir),t.z>t.y?i.y+=1e-4:i.z+=1e-4,n=i.cross(t).normalize()),e.up.copy(n).cross(this.dir).normalize()},function e(){requestAnimationFrame(e);var t=Date.now();T=t-w,w=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new THREE.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone();var C,S,k,M;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var R,P,V=new THREE.Quaternion,I=new THREE.Quaternion,N=new THREE.Quaternion,D=new THREE.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=THREE.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new THREE.Vector3(-1,0,0),this.alignDirTable[1]=new THREE.Vector3(1,0,0),this.alignDirTable[2]=new THREE.Vector3(0,-1,0),this.alignDirTable[3]=new THREE.Vector3(0,1,0),this.alignDirTable[4]=new THREE.Vector3(0,0,-1),this.alignDirTable[5]=new THREE.Vector3(0,0,1),this.alignDirTable[6]=new THREE.Vector3(-1,-1,0),this.alignDirTable[7]=new THREE.Vector3(-1,1,0),this.alignDirTable[8]=new THREE.Vector3(1,-1,0),this.alignDirTable[9]=new THREE.Vector3(1,1,0),this.alignDirTable[10]=new THREE.Vector3(0,-1,-1),this.alignDirTable[11]=new THREE.Vector3(0,-1,1),this.alignDirTable[12]=new THREE.Vector3(0,1,-1),this.alignDirTable[13]=new THREE.Vector3(0,1,1),this.alignDirTable[14]=new THREE.Vector3(-1,0,-1),this.alignDirTable[15]=new THREE.Vector3(1,0,-1),this.alignDirTable[16]=new THREE.Vector3(-1,0,1),this.alignDirTable[17]=new THREE.Vector3(1,0,1),this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1),this.alignDirTable[19]=new THREE.Vector3(-1,-1,1),this.alignDirTable[20]=new THREE.Vector3(-1,1,-1),this.alignDirTable[21]=new THREE.Vector3(-1,1,1),this.alignDirTable[22]=new THREE.Vector3(1,-1,-1),this.alignDirTable[23]=new THREE.Vector3(1,-1,1),this.alignDirTable[24]=new THREE.Vector3(1,1,-1),this.alignDirTable[25]=new THREE.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var L={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=L;var O,_;this.zoomDelta=new THREE.Vector2;var H,B,F,z=0,U=new THREE.Vector3,G=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new THREE.Vector2(0,0),this.menuOrigin=new THREE.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.loadObject=function(e,t,i){loader=new THREE.JSONLoader,loader.load(e,function(e,n){var o=new THREE.MeshPhongMaterial(n);mesh=new THREE.Mesh(e,o),mesh.scale=t,mesh.position.copy(i),mesh.geometry.computeBoundingBox();var r=mesh.geometry.boundingBox.clone();G.set(r.max.x,r.max.y,r.max.z),U.set(r.min.x,r.min.y,r.min.z),G.multiply(t),U.multiply(t),scene.add(mesh),objects.push(mesh)})},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var i=t.worldup?t.worldup:t.up;i.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(i),b&&!this.navApi.getTransitionActive()&&(b=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},THREE.Box2.prototype.setCenter=function(e){var t=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},THREE.Box2.prototype.getIcon2DCoords=function(e,t){var i=this.center;t.set((e.x-i.x)/(this.size().x/2),(e.y-i.y)/(this.size().y/2))},THREE.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,u=i*a,h=i*l,d=n*a,p=n*l,v=o*l,g=r*s,m=r*a,f=r*l;return t[0]=1-(d+v),t[3]=u-f,t[6]=h+m,t[1]=u+f,t[4]=1-(c+v),t[7]=p-g,t[2]=h-m,t[5]=p+g,t[8]=1-(c+d),this},THREE.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,i=e.elements,n=i[0],o=i[3],r=i[6],s=i[1],a=i[4],l=i[7],c=i[2],u=i[5],h=i[8],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(r-c)*t,this.z=(s-o)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this.w=(u-l)/t,this.x=.25*t,this.y=(o+s)/t,this.z=(r+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this.w=(r-c)/t,this.x=(o+s)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this.w=(s-o)/t,this.x=(r+c)/t,this.y=(l+u)/t,this.z=.25*t),this},THREE.Quaternion.prototype.rotate=function(e){var t=(new THREE.Matrix4).makeRotationFromQuaternion(this),i=t.elements,n=(new THREE.Matrix3).set(i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]);return e.applyMatrix3(n)},THREE.Vector3.prototype.findAngleWith=function(e,t){var i=0,n=this.clone().normalize().clone().dot(e.clone().normalize()),o=this.clone().cross(e).clone().normalize();if(o.clone().length()<Number.MIN_VALUE)i=n>0?0:180;else{var r=o.clone().dot(t.clone().normalize());t=r>0?o:-o;var s=(new THREE.Quaternion).setFromAxisAngle(t,90*THREE.Math.degToRad);s=s.clone().rotate(e).clone().normalize().clone().dot(this),i=Math.acos(n)*THREE.Math.radToDeg,Math.abs(i-90)<Number.MIN_VALUE&&(i=90),(i<90&&n*s>0||i>90&&n*s<0||90==i&&s>0)&&(i*=-1)}return i=THREE.Math.degToRad(i)},"contains"in String.prototype||(String.prototype.contains=function(e,t){return-1!==String.prototype.indexOf.call(this,e,t)}),Math.linearClamp=function(e,t,i){return e<=t?0:e>=i?1:(e-t)/(i-t)},Math.easeClamp=function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;var n=(e-t)/(i-t);return.5*(Math.sin((n-.5)*Math.PI)+1)},Math.linearInterp=function(e,t,i){return t*(1-e)+i*e},Math.equalityClamp=function(e,t,i){return e<=t?t:e>=i?i:e},Math.round2=function(e){return Math.round(100*e)/100},Math.round1=function(e){return Math.round(10*e)/10},this.animateTransition=function(t){if(t){var n=!1,o=0;if(this.setCameraOrtho(t.isOrtho),m.elapsedTime>=L.duration)return o=1,m.center.copy(t.center),m.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,n=!t.worldUp.equals(this.sceneUpDirection),n&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,i(n),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),void this.navApi.setTransitionActive(!1);this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var r=L.destinationPercent;o=Math.easeClamp(m.elapsedTime/L.duration,0,r);var s=1-o;m.elapsedTime+=T/500;var a=m.center.clone().multiplyScalar(s).add(t.center.clone().multiplyScalar(o)),l=e.position.clone().multiplyScalar(s).add(t.position.clone().multiplyScalar(o)),c=e.up.clone().multiplyScalar(s).add(t.up.clone().multiplyScalar(o)),u=e.pivot.clone().multiplyScalar(s).add(t.pivot.clone().multiplyScalar(o)),h=this.sceneUpDirection.clone().multiplyScalar(s).add(t.worldUp.clone().multiplyScalar(o)),d=e.fov*s+t.fov*o;m.center.copy(a),m.pivot.copy(u),e.position.copy(l),e.up.copy(c),e.target.copy(a),t.isOrtho||(e.fov=d),e.dirty=!0,n=h.distanceToSquared(this.sceneUpDirection)>1e-4,n&&this.setWorldUpVector(h),e.lookAt(m.center),i(n),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){m.animateTransition(t)})}},this.sphericallyInterpolateTransition=function(t){var n,o,r,s=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),m.elapsedTime>=L.duration)s=1,this.currentlyAnimating=!1;else{var a=L.destinationPercent;s=Math.easeClamp(m.elapsedTime/L.duration,0,a),m.elapsedTime+=T/500}if(1===s)o=_.position,n=_.center,r=_.up;else{var l=new THREE.Matrix3,c=V.clone();c.slerp(I,s),l.makeRotationFromQuaternion(c);var u=Math.linearInterp(s,R,P),h=l.elements;n=O.center.clone().multiplyScalar(1-s).add(_.center.clone().multiplyScalar(s)),o=n.clone().sub(new THREE.Vector3(h[0],h[1],h[2]).multiplyScalar(u)),r=new THREE.Vector3(h[3],h[4],h[5])}m.center.copy(n),e.position.copy(o),e.up.copy(r),m.navApi.getUsePivotAlways()||m.pivot.copy(n),e.lookAt(m.center),this.currentlyAnimating===!0?(this.showPivot(!0),requestAnimationFrame(function(){m.sphericallyInterpolateTransition(t)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),i(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=Math.round1(e.up.x),i=Math.round1(e.up.y),n=Math.round1(e.up.z),o=this.sceneFrontDirection.clone(),r=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();o.x=Math.round1(o.x),o.y=Math.round1(o.y),o.z=Math.round1(o.z),r.x=Math.round1(r.x),r.y=Math.round1(r.y),r.z=Math.round1(r.z),s.x=Math.round1(s.x),s.y=Math.round1(s.y),s.z=Math.round1(s.z);var a=s.clone().multiplyScalar(-1),l=r.clone().multiplyScalar(-1),c=o.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"right":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"left";if(o.x==t&&o.y==i&&o.z==n)return"right";break;case"left":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(o.x==t&&o.y==i&&o.z==n)return"left";if(c.x==t&&c.y==i&&c.z==n)return"right";break;case"back":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(a.x==t&&a.y==i&&a.z==n)return"right";if(s.x==t&&s.y==i&&s.z==n)return"left";break;case"top":if(c.x==t&&c.y==i&&c.z==n)return"down";if(o.x==t&&o.y==i&&o.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"bottom":if(o.x==t&&o.y==i&&o.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),i(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),
this.sceneUpDirection.copy(e.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),i(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(e.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),i(!0)},this.calculateCubeTransform=function(t){var i=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();O=e.clone(),O.center=m.center.clone(),O.pivot=m.pivot.clone(),_=e.clone(),_.center=m.center.clone(),_.pivot=m.pivot.clone();var r=new THREE.Vector3(0,0,0);t.contains("back")&&(r=r.add(n)),t.contains("front")&&(r=r.sub(n)),t.contains("top")&&(r=r.add(i)),t.contains("bottom")&&(r=r.sub(i)),t.contains("right")&&(r=r.add(o)),t.contains("left")&&(r=r.sub(o));var s=i,a=r.clone().normalize();if(1-Math.abs(a.dot(i))<Number.MIN_VALUE)for(var l=this.getView().normalize(),c=[n.clone(),n.clone().negate(),o.clone(),o.clone().negate()],u=a.dot(i)>0?1:-1,h=l.clone().add(e.up.clone().multiplyScalar(u)).normalize(),d=-2,p=0;p<4;p++){var v=h.dot(c[p]);v>d&&(d=v,s=c[p].multiplyScalar(u))}P=R=this.getView().length(),_.position.copy(_.center.clone().add(r.multiplyScalar(P/r.length()))),_.up.copy(s);var g=O.center.clone().sub(O.position).normalize(),f=g.clone().cross(O.up).normalize(),E=f.clone().cross(g).normalize(),A=new THREE.Matrix3;A.set(g.x,E.x,f.x,g.y,E.y,f.y,g.z,E.z,f.z),V.setFromRotationMatrix3(A),g=_.center.clone().sub(_.position).normalize(),f=g.clone().cross(_.up).normalize(),E=f.clone().cross(g).normalize(),A.set(g.x,E.x,f.x,g.y,E.y,f.y,g.z,E.z,f.z),N.setFromAxisAngle(g,0),D.setFromAxisAngle(E,0),I.setFromRotationMatrix3(A),I.multiply(N).multiply(D).normalize()},this.centerShot=function(t){O&&!t||(m.elapsedTime=0,O=_=e.clone(),O.center=m.center);var n=m.pivot.clone(),o=n.clone().sub(O.position),r=O.center.clone().sub(O.position).normalize(),s=O.up.clone(),a=r.clone().cross(s).normalize();s=a.clone().cross(r).normalize();var l=a.clone().multiplyScalar(a.dot(o)),c=s.clone().multiplyScalar(s.dot(o)),u=l.clone().add(c);_.position.copy(O.position.clone().add(u)),_.center=n,_.pivot=n;var h=0;if(m.elapsedTime>=L.duration)h=1;else{var d=L.destinationPercent;h=Math.easeClamp(m.elapsedTime/L.duration,0,d),m.elapsedTime+=T/2e3}var p=e.position.clone().multiplyScalar(1-h).add(_.position.clone().multiplyScalar(h)),v=m.center.clone().multiplyScalar(1-h).add(_.center.clone().multiplyScalar(h)),g=m.pivot.clone().multiplyScalar(1-h).add(_.pivot.clone().multiplyScalar(h));e.position.copy(p),m.center.copy(v),m.pivot.copy(g),e.lookAt(m.center),i(!1),1===h?this.addHistoryElement():requestAnimationFrame(function(){m.centerShot(!1)})},this.levelShot=function(){var t=this.getView(),i=t.length(),n=this.sceneUpDirection.clone(),o=e.up.clone().normalize(),r=t.normalize(),s=r.dot(n);if(1-Math.abs(s)>Number.MIN_VALUE){var a=r.clone().cross(n);r=n.clone().cross(a),r.normalize()}else r=o.clone();r.multiplyScalar(i);var l={center:r.add(e.position),up:n,position:e.position,pivot:m.center.clone().add(r),fov:e.fov,worldUp:n};m.elapsedTime=0,m.animateTransition(l)},this.fitToWindow=function(){var t=this.getView(),i=e.up.clone();t.normalize(),i.normalize(),_=e.clone(),_.center=m.center,i=n(i,t),i.normalize(),_.up.copy(i);var o=t.clone().cross(i);o.normalize();var r=U.clone(),s=G.clone(),a=[r,s],l=new THREE.Vector3(s.x-r.x,s.y-r.y,s.z-r.z);a[2]=new THREE.Vector3(s.x,r.y,s.z),a[3]=new THREE.Vector3(s.x,r.y,r.z),a[4]=new THREE.Vector3(s.x,s.y,r.z),a[5]=new THREE.Vector3(r.x,s.y,s.z),a[6]=new THREE.Vector3(r.x,s.y,r.z),a[7]=new THREE.Vector3(r.x,r.y,s.z);for(var c=0;c<8;c++){var u=a[c].clone().sub(e.position);a[c].setX(u.clone().dot(o)),a[c].setY(u.clone().dot(i)),a[c].setZ(u.clone().dot(t))}var h,d,p,v,g=THREE.Math.degToRad(e.topFov),f=THREE.Math.degToRad(e.bottomFov),E=THREE.Math.degToRad(e.leftFov),A=THREE.Math.degToRad(e.rightFov);h=E>=0?Number.MAX_VALUE:Number.MIN_VALUE,d=A>=0?Number.MAX_VALUE:Number.MIN_VALUE,p=g>=0?Number.MAX_VALUE:Number.MIN_VALUE,v=f>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var y=1/Math.tan(A),T=-1/Math.tan(E),w=1/Math.tan(g),b=-1/Math.tan(f),C=0;C<8;C++){var S=a[C].clone(),k=S.z-T*S.x;h=E>=0?Math.min(h,k):Math.max(h,k),k=S.z-y*S.x,d=A>=0?Math.min(d,k):Math.max(d,k),k=S.z-w*S.y,p=g>=0?Math.min(p,k):Math.max(p,k),k=S.z-b*S.y,v=f>=0?Math.min(v,k):Math.max(v,k)}var x=(d-h)/(T-y),M=T*x+h,R=(v-p)/(w-b),P=w*R+p,V=0;if(M<=P){var I=(g-f)/2;if(Math.abs(I)>Number.MIN_VALUE){var N=1/Math.tan(I);R=R-P/N+M/N}V=M}else{var D=(A-E)/2;if(Math.abs(D)>Number.MIN_VALUE){var L=1/Math.tan(D);x=x-M/L+P/L}V=P}var O=new THREE.Vector3(x,R,V),H=o.clone().multiplyScalar(O.x),B=i.clone().multiplyScalar(O.y),F=t.clone().multiplyScalar(O.z);O=H.clone().add(B.clone().add(F)),_.position.add(O);var z=l.clone().sub(_.position).dot(t);_.center=_.position.clone().add(t.multiplyScalar(z)),_.pivot=l.clone();var W={center:_.center,up:_.up,position:_.position,pivot:_.pivot,fov:e.fov,worldUp:m.sceneUpDirection.clone()};m.elapsedTime=0,m.animateTransition(W)},this.updatePivotPosition=function(t){var i,n,o=new THREE.Vector3(t.x/window.innerWidth*2-1,2*-(t.y/window.innerHeight)+1,.5);if(o=o.unproject(e),i=new THREE.Raycaster(e.position,o.sub(e.position).normalize()),n=i.intersectObjects(objects),"zoom"==m.mode)if(void 0!==n[0]){var r=n[0].point;m.pivot.copy(r)}else{var s=a(t);m.pivot.copy(s.rayO.clone().add(s.rayD))}else if(void 0!==n[0]){wheel.cursorImage("pivot");var r=n[0].point;m.isMouseDown||m.pivot.copy(r)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(t,i,n,o,r){var s=86,a=new THREE.Vector3(0,1,0),l=e.position.clone().dot(a),c=Math.linearClamp(l,m.minSceneBound,m.maxSceneBound),u=c-.5;E&&(E.find("img#updownImageA").remove(),E.prepend('<img src="'+r+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(n-s*u)+"px; left:"+i+'px;"/>'),o||E.prepend('<img src="'+r+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(n-s*u)+"px; left:"+i+'px;"/>'))},this.drawDropdownMenu=function(e,t,i,n,o,r,s){var a=0;if(f)r.appendChild(f);else{f=document.createElement("div"),f.className="dropDownMenu",f.style.top="100px",f.style.left="-400px";for(var l=0,c=0,u=0;u<e.length;u++){var h;if(null===e[u])h=document.createElement("li"),h.style.height="1px",l+=1,h.style.backgroundColor="#E0E0E0";else{var d=Autodesk.Viewing.i18n.translate(e[u]);if(c=d.length>c?d.length:c,i[u]){h=document.createElement("div");var p=document.createElement("input"),v=document.createElement("label");p.type="radio",p.className="dropDownMenuCheck",v.innerHTML=d,v.className="dropDownMenuCheckText",h.appendChild(p),h.appendChild(v),h.className="dropDownMenuCheckbox"}else h=document.createElement("li"),h.textContent=d,h.className=t[u]?"dropDownMenuItem":"dropDownMenuItemDisabled";h.id="menuItem"+a,a++,l+=25,h.setAttribute("data-i18n",e[u])}f.appendChild(h)}r.appendChild(f),f.style.minWidth=Math.max(256,7.4*c)+"px";var g=f.getBoundingClientRect().width;this.menuSize.x=g,this.menuSize.y=l}a=0;for(var u=0;u<e.length;u++)if(null!==e[u]){if(i[u]){var m="menuItem"+a,E=document.getElementById(m);E&&(E.children[0].checked=i[u]())}a++}var A=o-15,y=n+1,T=this.canvas.getBoundingClientRect();y+this.menuSize.x>T.right&&(y=n-this.menuSize.x-1),A+this.menuSize.y>T.bottom&&(A=T.bottom-this.menuSize.y),A-=s.y,y-=s.x,f.style.top=A+"px",f.style.left=y+"px",this.menuOrigin.x=y,this.menuOrigin.y=A},this.removeDropdownMenu=function(e){e.removeChild(f)},this.isFaceView=function(){var t=this.center.clone().sub(e.position).normalize();return g(t)&&g(e.up)},this.startInteraction=function(e,t){this.startCursor=new THREE.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,n,o,r){if(this.navApi.isActionEnabled("orbit")&&this.currentlyAnimating!==!0){var a="wheel";if(m.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),r&&r.saveEye.copy(this.camera.position)),r&&(a="cube"),"cube"==a?(this.saveCenter.copy(r.saveCenter),this.saveEye.copy(r.saveEye),this.savePivot.copy(r.savePivot),this.saveUp.copy(r.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),c()&&void 0==S&&(S=this.saveCenter.clone(),C=this.saveEye.clone(),M=this.savePivot.clone(),k=this.saveUp.clone()),this.preserveOrbitUpDirection){var u=s(t.x-n.x,t.y-n.y),h=s(o.x,o.y),d=this.sceneUpDirection.clone(),p=this.sceneFrontDirection.clone(),v=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),g=c()?M:this.savePivot,f=c()?C:this.saveEye,E=c()?S:this.saveCenter,A=c()?k:this.saveUp,y=g.clone().sub(f).normalize(),T=E.clone().sub(f).normalize(),w=T.clone().cross(A),b=f.clone().sub(g).length(),x=f.clone().sub(E).length(),R=y.clone().multiplyScalar(-1),P=T.clone().multiplyScalar(-1),V=w,I=A.clone(),N=0,D=0;if(!this.constrainOrbitHorizontal){var L=d.dot(this.saveUp),O=.009;L<-O&&(u.x=-u.x,h.x=-h.x);var _=0;_=c()?h.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+l("h",N,-h.x):u.x*this.orbitMultiplier,this.lastSnapRotateX=_;var H=(new THREE.Quaternion).setFromAxisAngle(d,-_);R.applyQuaternion(H),P.applyQuaternion(H),V.applyQuaternion(H),I.applyQuaternion(H)}if(!this.constrainOrbitVertical){var B=p.clone().multiplyScalar(p.dot(V)),F=v.clone().multiplyScalar(v.dot(V)),z=B.clone().add(F);z.clone().normalize();var U=0;if(c())U=h.y*this.orbitMultiplier;else{var G=l("v",D,h.y);U=this.useSnap?this.lastSnapRotateY+G:u.y*this.orbitMultiplier}var W=(new THREE.Quaternion).setFromAxisAngle(z,-U);if(this.navApi.getOrbitPastWorldPoles())R.applyQuaternion(W).normalize(),P.applyQuaternion(W).normalize(),I.applyQuaternion(W).normalize();else{var j=I.clone();j.applyQuaternion(W).normalize();var Y=d.dot(j);if(Y<0){var q=P.clone();q.applyQuaternion(W).normalize();var X=q.angleTo(d);Math.abs(X)>.5*Math.PI&&(X-=X>0?Math.PI:-Math.PI),U-=X,W.setFromAxisAngle(z,-U),R.applyQuaternion(W).normalize(),P.applyQuaternion(W).normalize(),I.applyQuaternion(W).normalize()}else R.applyQuaternion(W).normalize(),P.applyQuaternion(W).normalize(),I.applyQuaternion(W).normalize()}this.lastSnapRotateY=U}var K=R.multiplyScalar(b).add(g);e.position.copy(K),e.up.copy(I),this.center.copy(K),this.center.sub(P.multiplyScalar(x)),c()&&(S.copy(this.center),C.copy(e.position),M.copy(this.pivot),k.copy(e.up))}e.lookAt(this.center),i(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var n=s(t.x,t.y),o=this.userLookSpeed,r=this.getView(),a=e.up,l=r.clone().cross(a).normalize(),c=this.sceneUpDirection.clone(),u=n.clone();u.x*=Math.PI,u.y*=Math.PI/e.aspect,u.multiplyScalar(o);var h=(new THREE.Quaternion).setFromAxisAngle(l,-u.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var d=a.clone();if(d.applyQuaternion(h).normalize(),d.dot(c)<0){var p=r.clone();p.applyQuaternion(h);var v=p.angleTo(c);Math.abs(v)>.5*Math.PI&&(v-=v>0?Math.PI:-Math.PI),u.y-=v,h.setFromAxisAngle(l,-u.y)}}r=h.clone().rotate(r),a=h.clone().rotate(a),a.normalize();var g=e.keepSceneUpright?c:a,m=(new THREE.Quaternion).setFromAxisAngle(g,-u.x);r=m.clone().rotate(r),a=m.clone().rotate(a),this.center.copy(r.add(e.position)),e.up.copy(a),e.lookAt(this.center),i(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=s(t.x,t.y);var n=this.getView(),o=e.up.clone().cross(n),r=n.clone().cross(o);o.normalize(),r.normalize(),n.normalize();var a=this.pivot.clone().sub(e.position),l=n.clone().dot(a),c=l*(Math.tan(THREE.Math.degToRad(e.leftFov))+Math.tan(THREE.Math.degToRad(e.rightFov))),u=l*(Math.tan(THREE.Math.degToRad(e.topFov))+Math.tan(THREE.Math.degToRad(e.bottomFov))),h=t.x*Math.abs(c),d=t.y*Math.abs(u),p=new THREE.Vector3,v=o.clone().multiplyScalar(h),g=r.clone().multiplyScalar(d);p=v.clone().add(g).clone().multiplyScalar(this.userPanSpeed),e.position.add(p),this.center.add(p),e.lookAt(this.center),i(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var n=this.userZoomSpeed,o=Number.MAX_VALUE,r=t.x+t.y,s=Math.pow(n,r),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(m.D.clone().multiplyScalar(m.D.clone().dot(this.pivot.clone().sub(a).clone())));if(!(s>=o)){if(r>0){var c=0;Math.pow(n,r-c);if(r<c)return void(z=0);e.position.copy(a),this.center.copy(l);var u=a.clone().sub(this.saveEye).dot(m.D);u>o?(e.position.copy(this.saveEye.sub(m.D).clone().multiplyScalar(o)),z=o>0?-1:0):z=-(u/o)}else e.position.copy(a),this.center.copy(l);e.lookAt(this.center),i(!1)}}},this.walk=function(t,n,o,r,a){if(this.navApi.isActionEnabled("walk")){var l=this.sceneUpDirection.clone(),c=this.sceneFrontDirection.clone(),h=this.sceneFrontDirection.clone().cross(this.sceneUpDirection),p=!0,v=.01;u(t,n)?(wheel.cursorImage("SWWalk"),d(!0,t,n),x=n.x,y=n.y):d(!1,t,n),x=t.x,y=t.y;var g=s(x-n.x,y-n.y),m=-g.x,f=-g.y,E=m<0?-1:1,A=f<0?-1:1,T=Math.abs(m),w=Math.abs(f),b=new THREE.Vector2(30,30);b=s(b.x,b.y),T=u(t,n)?0:Math.abs(m)-b.x,w=u(t,n)?0:Math.abs(f)-b.y;var C=.25;T/=C,w/=C,T=T<1?Math.easeClamp(T,0,1):Math.pow(T,1),w=w<1?Math.easeClamp(w,0,1):Math.pow(w,1);var S=T>0?T*E:0,k=w>0?w*A:0,M=this.getView(),R=M.length();M.normalize();var P=M.clone().cross(e.up);P.normalize();var V=h.clone().multiplyScalar(h.clone().dot(M)),I=c.clone().multiplyScalar(c.clone().dot(M)),N=I.clone().add(V);N=N.clone().length()>Number.MIN_VALUE?N.normalize():e.up;var D=1,L=k*(this.walkMultiplier*D),O=p?N:M;if(p){var _=Math.cos(.65);1!=_&&(l.clone().dot(e.up)<-Number.MIN_VALUE&&l.clone().dot(M)<-_||l.clone().dot(e.up)>Number.MIN_VALUE&&l.clone().dot(M)>_)&&(O=-O)}var H=-S*this.walkMultiplier*.05,B=e.up;p&&((l.clone().dot(e.up)<-Number.MIN_VALUE||Math.abs(l.clone().dot(e.up))<Number.MIN_VALUE&&l.clone().dot(M)>Number.MIN_VALUE)&&(H=-H),B=l);var F=(new THREE.Quaternion).setFromAxisAngle(B,H);F.normalize(),M=F.clone().rotate(M),M.normalize(),e.up.copy(F.clone().rotate(e.up)),e.up.normalize(),e.position.add(O.clone().multiplyScalar(L)),this.center.copy(e.position.clone().add(M.clone().multiplyScalar(R))),O=p?l:e.up,O.normalize(),0===L&&(L=v),e.lookAt(this.center),i(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var n=t,o=v(n);m.m_amount+=o;var r=new THREE.Vector3(0,1,0),s=m.saveEye.clone().sub(r.clone().multiplyScalar(m.m_amount)),a=s.clone().dot(r);e.position.copy(s),a<m.minSceneBound&&e.position.add(r.clone().multiplyScalar(m.minSceneBound-a)),a>m.maxSceneBound&&e.position.add(r.clone().multiplyScalar(m.maxSceneBound-a)),this.center.copy(e.position.clone().add(m.saveCenter.clone().sub(m.saveEye))),e.lookAt(this.center),i(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(e){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var t=0;t<this.rewindParams.history.length;t++){var i=t-this.rewindParams.timelineIndex,n=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[t].thumbnailBounds.setCenter(new THREE.Vector2(e.x+i*n,e.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[t].weight=t==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);var n=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=e.clone(),this.rewindParams.openLocationOrigin=e.clone(),this.rewindParams.openBracket=e.clone(),this.rewindParams.openBracketA=new THREE.Vector2(n,e.y),this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-n,e.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var o=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=o}this.rewindParams.locationOffset=new THREE.Vector2(0,0),this.rewindParams.snapOffset=new THREE.Vector2(0,0)},this.slideTimeline=function(e){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var t=e.clone().add(this.rewindParams.locationOffset),i=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),n=i,o=window.innerWidth-i,r=this.rewindParams.history[0].thumbnailBounds.center().x,s=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,a=0;if(t.x<this.rewindParams.openBracketA.x){a=t.x-this.rewindParams.openBracketA.x;var l=r-a;n<l&&(a=Math.min(a+(l-n),0))}if(t.x>this.rewindParams.openBracketB.x){a=t.x-this.rewindParams.openBracketB.x;var c=s-a;o>c&&(a=Math.max(a+(c-o),0))}this.rewindParams.openLocation.x+=a,this.rewindParams.openBracketA.x+=a,this.rewindParams.openBracketB.x+=a,this.rewindParams.openBracket.x=t.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var u=new THREE.Vector2(-a,0),h=t.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));u.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var d=!1;if(this.rewindParams.snappingEnabled)for(var p=4,v=16,g=0;g<this.rewindParams.history.length;g++){var m=this.rewindParams.history[g].thumbnailBounds.center().add(u);if(Math.abs(m.x-h.x)<p||this.rewindParams.snapped&&Math.abs(m.x-h.x)<v){d=!0,0!==a?(this.rewindParams.snapOffset.x=m.x-h.x,u.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=m.x-h.x,h.x=m.x;break}}this.rewindParams.snapped=d;for(var f=-1,E=0,A=0;A<this.rewindParams.history.length;A++){var y=this.rewindParams.history[A].thumbnailBounds.clone();if(this.rewindParams.history[A].thumbnailBounds.setCenter(this.rewindParams.history[A].thumbnailBounds.center().add(u)),this.rewindParams.history[A].thumbnail){var T=this.rewindParams.history[A].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+A).css("left",T),$("#rewindBorder"+A).css("left",T-4)}var w=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));y.setFromCenterAndSize(y.center(),w);var b=new THREE.Vector2(0,0);y.getIcon2DCoords(h,b);var C=1-Math.abs(Math.equalityClamp(b.x,-1,1));this.rewindParams.history[A].weight=C,0===A&&h.x<y.center().x&&(this.rewindParams.history[A].weight=1),A===this.rewindParams.history.length-1&&h.x>y.center().x&&(this.rewindParams.history[A].weight=1),E+=this.rewindParams.history[A].weight,this.rewindParams.history[A].weight>f&&(f=this.rewindParams.history[A].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[A].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[A].thumbnailBounds.center().x-h.x,this.rewindParams.timelineIndexSlide=A)}for(var S=0;S<this.rewindParams.history.length;S++)this.rewindParams.history[S].weight=this.rewindParams.history[S].weight/E;var k=this.rewindParams.history[0].thumbnailBounds.center().x,x=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<k?(this.rewindParams.locationOffset.x+=k-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=k):this.rewindParams.openBracket.x>x&&(this.rewindParams.locationOffset.x+=x-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=x)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,m.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var t=this.rewindParams.timelineIndex,n=0;if(m.elapsedTime>=L.duration)n=1;else{var o=L.destinationPercent;n=Math.easeClamp(m.elapsedTime/L.duration,0,o),m.elapsedTime+=T/500}m.center.copy(m.center.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.center.clone().multiplyScalar(n))),e.position.copy(e.position.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.position.clone().multiplyScalar(n))),e.up.copy(this.rewindParams.history[t].camera.up),m.pivot.copy(m.center),e.lookAt(m.center),i(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==n&&requestAnimationFrame(function(){m.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);t.center=new THREE.Vector3(0,0,0),t.pivot=new THREE.Vector3(0,0,0),t.leftFov=0,t.rightFov=0,t.topFov=0,t.bottomFov=0,t.up.set(0,0,0);for(var n=0;n<this.rewindParams.history.length;n++){var o=this.rewindParams.history[n].camera,r=this.rewindParams.history[n].weight;t.center.add(o.center.clone().multiplyScalar(r)),t.position.add(o.position.clone().multiplyScalar(r)),t.up.add(o.up.clone().multiplyScalar(r)),t.rotation.add(o.rotation.clone().multiplyScalar(r)),t.pivot.add(o.pivot.clone().multiplyScalar(r)),t.leftFov+=o.leftFov*r,t.rightFov+=o.rightFov*r,t.topFov+=o.topFov*r,t.bottomFov+=o.bottomFov*r}e.position.copy(t.position),e.up.copy(t.up),e.rotation=t.rotation,e.leftFov=t.leftFov,e.rightFov=t.rightFov,e.topFov=t.topFov,e.bottomFov=t.bottomFov,m.center.copy(t.center),m.pivot.copy(t.pivot),e.lookAt(m.center),e.up.normalize(),i(!1)}};var avp=Autodesk.Viewing.Private;avp.Autocam.ViewCube=function(e,t,i,n){function o(e,t){var i={};return 0===e.type.indexOf("touch")?e.touches.length>0?(i.clientX=e.touches[0].clientX,i.clientY=e.touches[0].clientY,i.pageX=e.touches[0].pageX,i.pageY=e.touches[0].pageY,i.screenX=e.touches[0].screenX,i.screenY=e.touches[0].screenY,i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY,i.which=s.navApi.getUseLeftHandedInput()?3:1):i=t.prevCoords:(i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,i.screenX=e.screenX,i.screenY=e.screenY,i.which=e.which,W?(i.movementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,i.movementY=e.movementY||e.mozMovementY||e.webkitMovementY||0):(i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY)),t.prevX=i.screenX,t.prevY=i.screenY,t.prevCoords=i,i}var r=this,s=t,a=t.camera;t.setCube(this),r.currentFace="front";var l,c,u,h,d,p,v=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],g=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],m=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],f=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],E=[null,null,function(){return!s.orthographicFaces&&!a.isPerspective},function(){return!s.orthographicFaces&&a.isPerspective},function(){return s.orthographicFaces},null,null,null,null,null,null,null,null];r.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),r.camera.position.copy(a.position),r.center=new THREE.Vector3(0,0,0),r.camera.lookAt(r.center);var A,y,T,w,b,C,S,k,x,M,R,P,V,I,N=[],D=[],L=[],O=[],_=[],H=null,B=null,F=null,z=0,U=0,G=!0,W=!1,j=!1,Y=!1,q=navigator.userAgent.search("Chrome")!=-1,X=navigator.platform.search("Win32")!=-1,K=!1,Q=!1,Z=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var J=function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},$=function(e){e.preventDefault(),e.stopPropagation(),j=document.pointerLockElement===i||document.mozPointerLockElement===i||document.webkitPointerLockElement===i},ee=function(){var e=i.getBoundingClientRect();r.width=e.width,r.height=e.height,I=J(i),S=r.width/2,k=r.height/2,p=new THREE.PerspectiveCamera(70,r.height/r.width,1,1e4),p.position.set(0,0,500),l=new THREE.Scene,c=new THREE.Scene,u=new THREE.Scene,h=new THREE.Scene,d=new THREE.Scene,G=!0,z=200,r.viewScale=3.5*z;var t=THREE.LinearFilter,o=Autodesk.Viewing.Private.getResourceUrl,a="res/textures/",v=n||a,g=(new THREE.DDSLoader).load(o(v+"VCcrossRGBA8small.dds"));g.minFilter=g.maxFilter=t;var m=THREE.ShaderLib.cube,f=Autodesk.Viewing.Shaders.createShaderMaterial(m);f.depthWrite=!1,f.uniforms.tCube.value=g;var E=new THREE.BoxGeometry(z,z,z,4,4,4),N=new THREE.BoxGeometry(z+1,z+1,z+1,4,4,4);A=new THREE.Mesh(E,f),A.position.set(0,0,0),c.add(A);var L=oe(o(a+"VCedge1.png"));L.minFilter=L.maxFilter=t,y=new THREE.Mesh(N,new THREE.MeshBasicMaterial({map:L,overdraw:!1,transparent:!0,shading:THREE.SmoothShading})),y.position.set(0,0,0),h.add(y);var _=z,H=new THREE.Geometry,B=new THREE.Vector3(-30,0,0),F=new THREE.Vector3(30,0,0),U=new THREE.Vector3(0,-30,0);H.vertices.push(B),H.vertices.push(F),H.vertices.push(U),H.faces.push(new THREE.Face3(1,0,2)),H.computeFaceNormals();var j=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),Y=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),q=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),X=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),K=new THREE.PlaneBufferGeometry(.5*z,.3*z,2,2),Q=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),ee=new THREE.Mesh(H,j),te=new THREE.Mesh(K,Q);ee.position.set(0,_,0),te.position.set(0,.9*_,.1);var ie=new THREE.Mesh(H,Y),ne=new THREE.Mesh(K,Q);ie.position.set(0,-_,0),ne.position.set(0,.9*-_,.1),ie.rotation.z+=Math.PI,ne.rotation.z+=Math.PI;var se=new THREE.Mesh(H,q),ae=new THREE.Mesh(K,Q);se.position.set(_,0,0),ae.position.set(.9*_,0,.1),se.rotation.z-=Math.PI/2,ae.rotation.z-=Math.PI/2;var ce=new THREE.Mesh(H,X),ue=new THREE.Mesh(K,Q);ce.position.set(-_,0,0),ue.position.set(.9*-_,0,.1),ce.rotation.z+=Math.PI/2,ue.rotation.z+=Math.PI/2,C=new THREE.Object3D,C.position.set(0,0,0),C.add(ee),C.add(ie),C.add(se),C.add(ce),d.add(te),d.add(ne),d.add(ae),d.add(ue),d.add(C),D.push(te),D.push(ne),D.push(ae),D.push(ue);var he=new THREE.PlaneBufferGeometry(z/3,z/3,2,2),pe=new THREE.MeshBasicMaterial({map:oe(o(a+"VChome.png")),transparent:!0,shading:THREE.FlatShading});T=new THREE.Mesh(he,pe),T.position.set(-z,z,0),P=O.length,d.add(T),O.push(T);var ve=new THREE.PlaneBufferGeometry(1.5*z,1.5*z,2,2),ge=new THREE.MeshBasicMaterial({map:oe(o(a+"VCarrows.png")),shading:THREE.FlatShading,transparent:!0}),me=new THREE.Mesh(ve,ge);me.position.set(.5*z+20,.5*z+20,0);var fe=new THREE.PlaneBufferGeometry(.6*z,.45*z,2,2),Ee=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),Ae=new THREE.Mesh(fe,Ee);Ae.position.set(.5*z+20,z+20,.1);var ye=new THREE.PlaneBufferGeometry(.45*z,.6*z,2,2),Te=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),we=new THREE.Mesh(ye,Te);we.position.set(z+20,.5*z+20,.1),d.add(me),d.add(Ae),d.add(we),x=O.length,O.push(Ae),M=O.length,O.push(we),R=O.length,O.push(me);var be=new THREE.PlaneBufferGeometry(z/2.3,z/2.3,2,2),Ce=new THREE.MeshBasicMaterial({map:oe(o(a+"VCcontext.png")),transparent:!0,shading:THREE.FlatShading});b=new THREE.Mesh(be,Ce),b.position.set(z,-z,0),V=O.length,d.add(b),O.push(b);var Se=new THREE.Geometry;Se.vertices.push(new THREE.Vector3(0,0,0)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,z/2)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,z/2)),Se.faces.push(new THREE.Face3(4,3,2)),Se.faces.push(new THREE.Face3(4,2,1));var ke;ke=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),w=new THREE.Mesh(Se,ke),l.add(w),re(),"CANVAS"===s.renderer.toUpperCase()?r.renderer=new THREE.CanvasRenderer:"WEBGL"===s.renderer.toUpperCase()?r.renderer=new avp.FireflyWebGLRenderer({alpha:!0,antialias:!1}):(avp.logger.warn("Incorrect use of Autocam.renderer property"),r.renderer=new THREE.CanvasRenderer),r.useTransparency(!0),r.setSize(r.width,r.height),r.camera.topFov=r.camera.bottomFov=r.camera.fov/2,r.camera.leftFov=r.camera.rightFov=r.camera.aspect*r.camera.fov/2,r.renderer.autoClear=!1,r.renderer.setSize(r.width,r.height),r.renderer.sortObjects=!1,i.appendChild(r.renderer.domElement),i.addEventListener("touchstart",le,!1),i.addEventListener("mousedown",le,!1),i.addEventListener("mousemove",de,!1),W=!1,W&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,document.addEventListener("pointerlockchange",$,!1),document.addEventListener("mozpointerlockchange",$,!1),document.addEventListener("webkitpointerlockchange",$,!1)),Z.push(oe(o(a+"VChomeS.png"))),Z.push(oe(o(a+"VCarrowsS0.png"))),Z.push(oe(o(a+"VCarrowsS1.png"))),Z.push(oe(o(a+"VChome.png"))),Z.push(oe(o(a+"VCarrows.png"))),Z.push(oe(o(a+"VCcontext.png"))),Z.push(oe(o(a+"VCcontextS.png")))},te=function(){s.navApi.isActionEnabled("orbit")&&(i.style.opacity="1.0",Q=!1),requestAnimationFrame(r.render)},ie=function(e){if(Q||s.viewCubeMenuOpen||!s.navApi.isActionEnabled("orbit"))s.navApi.isActionEnabled("orbit")&&(i.style.opacity=1);else{var t=Math.max(4*Math.abs((e.clientX-I.x)/I.w-.5)-1,0),n=Math.max(4*Math.abs((e.clientY-I.y)/I.h-.5)-1,0),o=Math.max(0,Math.min(Math.sqrt(t*t+n*n),1));i.style.opacity=1-o*(1-r.inactiveOpacity)}},ne=function(){s.viewCubeMenuOpen||(i.style.opacity=r.inactiveOpacity,Q=!0,requestAnimationFrame(r.render))},oe=function(e){var t=new Image,i=av.getUseCredentials()&&(e.indexOf("://")===-1||e.indexOf(window.location.host)!==-1);i?t.crossOrigin="use-credentials":t.crossOrigin="anonymous";var n=new THREE.Texture(t);return t.onload=function(){n.needsUpdate=!0,U++,U>=11&&requestAnimationFrame(r.render)},t.src=e,n},re=function(){var e,t=[],i=[];t[0]=me(0,0),t[1]=me(0,Math.PI/2),t[2]=me(0,-Math.PI/2),t[3]=me(0,Math.PI),t[4]=me(Math.PI/2,0),t[5]=me(Math.PI/2,Math.PI/2),t[6]=me(Math.PI/2,-Math.PI/2),t[7]=me(Math.PI/2,Math.PI),i[0]=ge(0,0,0),i[1]=ge(0,Math.PI/2,0),i[2]=ge(0,-Math.PI/2,0),i[3]=ge(0,Math.PI,0),i[4]=ge(Math.PI/2,0,0),
i[5]=ge(Math.PI/2,Math.PI/2,0),i[6]=ge(Math.PI/2,-Math.PI/2,0),i[7]=ge(Math.PI/2,Math.PI,0),i[8]=ge(0,0,Math.PI/2),i[9]=ge(0,0,-Math.PI/2),i[10]=ge(-Math.PI/2,0,-Math.PI/2),i[11]=ge(-Math.PI,0,-Math.PI/2),N.push(ve(0,0)),N[0].name="front",L.push(N[0]),_.push(N[0]),u.add(N[0]),N.push(ve(0,Math.PI/2)),N[1].name="right",L.push(N[1]),_.push(N[1]),u.add(N[1]),N.push(ve(0,Math.PI)),N[2].name="back",L.push(N[2]),_.push(N[2]),u.add(N[2]),N.push(ve(0,-Math.PI/2)),N[3].name="left",L.push(N[3]),_.push(N[3]),u.add(N[3]),N.push(ve(Math.PI/2,0)),N[4].name="bottom",L.push(N[4]),_.push(N[4]),u.add(N[4]),N.push(ve(-Math.PI/2,0)),N[5].name="top",L.push(N[5]),_.push(N[5]),u.add(N[5]),e=N.length;var n;for(n=0;n<t.length;n++)N.push(t[n]),N[e+n].name=g[n],u.add(N[e+n]),L.push(N[e+n]),_.push(N[e+n]);for(e=N.length,n=0;n<i.length;n++)N.push(i[n]),N[e+n].name=v[n],u.add(N[e+n]),L.push(N[e+n]),_.push(N[e+n])},se=function(e,t,i){var n,o,r=new THREE.Vector3;return r.copy(e),r=r.unproject(t),n=new THREE.Raycaster(t.position,r.sub(t.position).normalize()),o=n.intersectObjects(i)},ae=function(e,t){var i=e.clientX-t.x,n=e.clientY-t.y;return i=i/t.w*2-1,n=(t.h-n)/t.h*2-1,new THREE.Vector3(i,n,.5)},le=function(e){if(e.preventDefault(),e.stopPropagation(),s.navApi.isActionEnabled("orbit")&&!s.currentlyAnimating){var t=o(e,r);I=J(i),i.removeEventListener("mousemove",de,!1),document.addEventListener("mouseup",he,!1),document.addEventListener("touchend",he,!1),s.navApi.getUsePivotAlways()||(s.pivot.copy(s.center),s.navApi.setPivotPoint(s.center),s.navApi.setPivotSetFlag(!1)),s.startInteraction(t.pageX,t.pageY);var n,a;0==s.rewindParams.history.length&&s.addHistoryElement(),s.rewindParams.snapped&&s.rewindParams.timelineIndex+1==s.rewindParams.history.length||s.addIntermediateHistoryElement();var l=s.navApi.getUseLeftHandedInput()?1:3;if(t.which!==l){if(r.animSpeed<=0)return void avp.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation");a=ae(t,I),n=se(a,r.camera,_),n.length>0&&(Ae(),r.draggable&&(document.addEventListener("mousemove",ce,!1),document.addEventListener("touchmove",ce,!1),W&&(i.requestPointerLock(),Y=q&&X)))}}},ce=function(e){if(e.preventDefault(),e.stopPropagation(),r.animSpeed<=0)return document.removeEventListener("mousemove",ce,!1),document.removeEventListener("touchmove",ce,!1),void avp.logger.error("animSpeed cannot be 0 or less");if(!s.currentlyAnimating){var t=o(e,r);if(W&&Y&&(Y=!1,t.movementX=t.movementY=0),j&&(t.movementX>300||t.movementY>300)&&(t.movementX=0,t.movementY=0),t.movementX===t.movementY&&0===t.movementX)return void(s.currentlyAnimating=!1);G=!1,K=!0,s.showPivot(!0),s.currentCursor=new THREE.Vector2(t.pageX,t.pageY),s.orbit(s.currentCursor,s.startCursor,new THREE.Vector3(-t.movementX,t.movementY,0),s.startState),r.camera.lookAt(r.center),requestAnimationFrame(r.render)}},ue=function(e){e||(document.removeEventListener("mouseup",he,!1),document.removeEventListener("touchend",he,!1)),document.removeEventListener("mousemove",ce,!1),document.removeEventListener("touchmove",ce,!1),i.addEventListener("mousemove",de,!1),j&&document.exitPointerLock()},he=function(e){e.preventDefault(),e.stopPropagation();var t,n,l;if(s.currentlyAnimating||K)return s.endInteraction(),s.showPivot(!1),K=!1,void ue(!1);var c=o(e,r);if(s.viewCubeMenuOpen){var u=c.clientX-I.x,h=c.clientY-I.y;if(s.menuOrigin.x<=u&&u<=s.menuOrigin.x+s.menuSize.x&&s.menuOrigin.y<=h&&h<=s.menuOrigin.y+s.menuSize.y){var d=Math.floor((h-5-s.menuOrigin.y)/25),v=function(e){avp.logger.track({name:"navigation/"+e,aggregate:"count"})};switch(d){case 0:v("home"),s.goHome();break;case 1:v("setortho"),s.setOrthographicFaces(!1),s.toOrthographic();break;case 2:v("setpersp"),s.setOrthographicFaces(!1),s.toPerspective();break;case 3:s.setOrthographicFaces(!0),G?s.toOrthographic():s.toPerspective();break;case 4:v("sethome"),s.setCurrentViewAsHome(!1);break;case 5:v("focushome"),s.setCurrentViewAsHome(!0);break;case 6:v("resethome"),s.resetHome();break;case 7:v("setfront"),s.setCurrentViewAsFront();break;case 8:v("settop"),s.setCurrentViewAsTop();break;case 9:s.resetOrientation()}}return s.viewCubeMenuOpen=!1,s.removeDropdownMenu(i),(c.clientX<I.x||c.clientX>I.w+I.x||c.clientY<I.y||c.clientY>I.h+I.y)&&ne(),r.mouseMoveSave&&r.processMouseMove(r.mouseMoveSave),void ue(!1)}var g=s.navApi.getUseLeftHandedInput()?1:3;if(c.which===g)return s.viewCubeMenuOpen=!0,s.drawDropdownMenu(m,f,E,c.clientX,c.clientY,i,I),void ue(!0);var A=ae(c,I);if(t=se(A,r.camera,_),n=se(A,p,D),l=se(A,p,O),n.length>0&&G){var y=s.getOrientation();switch(r.currentFace){case"front":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"right":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"left":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"back":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"top":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front")}break;case"bottom":switch(y){case"up":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back")}}s.elapsedTime=0,s.sphericallyInterpolateTransition()}if(l.length>0){if(s.elapsedTime=0,r.wantHomeButton&&l[0].object===O[P])return s.goHome(),void ue(!1);if(r.wantContextMenu&&l[0].object===O[V])return s.viewCubeMenuOpen=!0,s.drawDropdownMenu(m,f,E,c.clientX,c.clientY,i,I),void ue(!0);if(r.wantRollArrows&&G&&(l[0].object===O[x]||l[0].object===O[M])){var T=l[0].object===O[M],w={center:s.center.clone(),position:a.position.clone(),pivot:a.pivot.clone(),fov:a.fov,worldUp:s.sceneUpDirection.clone(),isOrtho:a.isPerspective===!1},b=s.center.clone().sub(a.position).normalize();T?w.up=a.up.clone().cross(b):(w.up=a.up.clone().multiplyScalar(-1),w.up.cross(b)),w.up.normalize(),s.elapsedTime=0,s.animateTransition(w)}}if(t.length>0){var C=t[0].object.name;r.mouseMoveSave=e,r.cubeRotateTo(C)}ue(!1)};this.cubeRotateTo=function(e){r.currentFace=e,s.orthographicFaces&&r.currentFace.indexOf(",")!==-1&&s.setCameraOrtho(!1),s.calculateCubeTransform(r.currentFace),s.elapsedTime=0,s.sphericallyInterpolateTransition(function(){r.mouseMoveSave&&r.processMouseMove(r.mouseMoveSave)})},this.processMouseMove=function(e){var t,i,n;if(s.viewCubeMenuOpen||s.currentlyAnimating)return void(r.mouseMoveSave=e);r.mouseMoveSave=null;var a=o(e,r),l=ae(a,I);if(t=se(l,r.camera,L),i=se(l,p,D),n=se(l,p,O),H&&!K&&(H.material.color.setHex(14540253),H=null,requestAnimationFrame(r.render)),i.length>0&&!K){H=i[0].object;for(var c=C.children.length;--c>=0;)if(H===D[c]){H=C.children[c],H.material.color.setHex(45055);break}requestAnimationFrame(r.render)}B&&!K&&(B.material.opacity=0,B=null,requestAnimationFrame(r.render)),t.length>0&&!K&&(B=t[0].object,B.material.opacity=.3,requestAnimationFrame(r.render)),n.length>0&&!K?F!==n[0].object&&(r.wantHomeButton&&n[0].object===O[P]?(F=n[0].object,O[P].material.map=Z[0]):r.wantRollArrows&&n[0].object===O[x]?(F=n[0].object,O[R].material.map=Z[1]):r.wantRollArrows&&n[0].object===O[M]?(F=n[0].object,O[R].material.map=Z[2]):r.wantContextMenu&&n[0].object===O[V]?(F=n[0].object,O[V].material.map=Z[6]):r.wantHomeButton&&F===O[P]?(F=null,O[P].material.map=Z[3]):!r.wantRollArrows||F!==O[x]&&F!==O[M]&&F!==O[R]?r.wantContextMenu&&F===O[V]&&(F=null,O[V].material.map=Z[5]):(F=null,O[R].material.map=Z[4]),requestAnimationFrame(r.render)):null===F||K||(r.wantHomeButton&&F===O[P]?(F=null,O[P].material.map=Z[3]):!r.wantRollArrows||F!==O[x]&&F!==O[M]&&F!==O[R]?r.wantContextMenu&&F===O[V]&&(F=null,O[V].material.map=Z[5]):(F=null,O[R].material.map=Z[4]),requestAnimationFrame(r.render))};var de=function(e){s.navApi.isActionEnabled("orbit")&&r.processMouseMove(e)},pe=function(){I=J(i),r.width=i.offsetWidth,r.height=i.offsetHeight,S=r.width/2,k=r.height/2,r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix(),r.camera.topFov=r.camera.bottomFov=r.camera.fov/2,r.camera.leftFov=r.camera.rightFov=r.camera.aspect*r.camera.fov/2,r.renderer.setSize(r.width,r.height),requestAnimationFrame(r.render)},ve=function(e,t){var i,n=45,o=60,r=n+o,s=new THREE.Geometry,a=new THREE.Vector3(0,0,0),l=new THREE.Vector3(o,-o,r),c=new THREE.Vector3(o,o,r),u=new THREE.Vector3(-o,o,r),h=new THREE.Vector3(-o,-o,r);return s.vertices.push(a),s.vertices.push(l),s.vertices.push(c),s.vertices.push(u),s.vertices.push(h),s.faces.push(new THREE.Face3(1,2,3)),s.faces.push(new THREE.Face3(1,3,4)),s.applyMatrix((new THREE.Matrix4).makeRotationX(e)),s.applyMatrix((new THREE.Matrix4).makeRotationY(t)),s.computeFaceNormals(),s.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(s,i)},ge=function(e,t,i){var n,o,r=45,s=60,a=r+s,l=new THREE.Geometry,c=new THREE.Vector3(s,a,a),u=new THREE.Vector3(-s,a,a),h=new THREE.Vector3(-s,s,a),d=new THREE.Vector3(s,s,a),p=new THREE.Vector3(s,a,s),v=new THREE.Vector3(-s,a,s),g=new THREE.Vector3(-s,a,a),m=new THREE.Vector3(s,a,a);return l.vertices.push(c),l.vertices.push(u),l.vertices.push(h),l.vertices.push(d),l.vertices.push(p),l.vertices.push(v),l.vertices.push(g),l.vertices.push(m),l.faces.push(new THREE.Face3(0,1,2)),l.faces.push(new THREE.Face3(0,2,3)),l.faces.push(new THREE.Face3(4,5,6)),l.faces.push(new THREE.Face3(4,6,7)),l.applyMatrix((new THREE.Matrix4).makeRotationX(e)),l.applyMatrix((new THREE.Matrix4).makeRotationY(t)),l.applyMatrix((new THREE.Matrix4).makeRotationZ(i)),l.computeFaceNormals(),l.computeVertexNormals(),n=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),o=new THREE.Mesh(l,n)},me=function(e,t){var i,n,o=45,r=60,s=o+r,a=new THREE.Geometry,l=new THREE.Vector3(s,s,s),c=new THREE.Vector3(r,s,s),u=new THREE.Vector3(r,r,s),h=new THREE.Vector3(s,r,s),d=new THREE.Vector3(s,s,r),p=new THREE.Vector3(s,s,s),v=new THREE.Vector3(s,r,s),g=new THREE.Vector3(s,r,r),m=new THREE.Vector3(s,s,s),f=new THREE.Vector3(s,s,r),E=new THREE.Vector3(r,s,r),A=new THREE.Vector3(r,s,s);return a.vertices.push(l),a.vertices.push(c),a.vertices.push(u),a.vertices.push(h),a.vertices.push(d),a.vertices.push(p),a.vertices.push(v),a.vertices.push(g),a.vertices.push(m),a.vertices.push(f),a.vertices.push(E),a.vertices.push(A),a.faces.push(new THREE.Face3(0,1,2)),a.faces.push(new THREE.Face3(0,2,3)),a.faces.push(new THREE.Face3(4,5,6)),a.faces.push(new THREE.Face3(4,6,7)),a.faces.push(new THREE.Face3(8,9,10)),a.faces.push(new THREE.Face3(8,10,11)),a.applyMatrix((new THREE.Matrix4).makeRotationX(e)),a.applyMatrix((new THREE.Matrix4).makeRotationY(t)),a.computeFaceNormals(),a.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),n=new THREE.Mesh(a,i)},fe=function(e){var t=s.cubeFront.clone(),i=s.sceneUpDirection.clone(),n=t.clone().cross(i);i.copy(n).cross(t),t.normalize(),i.normalize(),n.normalize();var o=new THREE.Vector3(t.x,i.x,n.x).multiplyScalar(e.x);return o.add(new THREE.Vector3(t.y,i.y,n.y).multiplyScalar(e.y)),o.add(new THREE.Vector3(t.z,i.z,n.z).multiplyScalar(e.z)),o};this.render=function(){var e=r.compass?r.viewScaleFactorCompass*r.viewScale:r.viewScale,t=s.center.clone().sub(a.position).normalize(),i=a.up.normalize();t=fe(t),i=fe(i),r.camera.position.copy(t),r.camera.position.multiplyScalar(-e/r.camera.position.length()),r.camera.up=i.normalize(),r.camera.lookAt(r.center),Ee();var n=r.renderer;n&&(n.clear(),n.render(l,r.camera),n.render(c,r.camera),n.render(h,r.camera),n.render(u,r.camera),n.render(d,p))};var Ee=function(){G=s.isFaceView(),!G||Q||s.currentlyAnimating?Ae():ye(),Q?Te():we(),Q?be():Ce()},Ae=function(){d.remove(C),O[R].material.opacity=0,O[V].material.opacity=0},ye=function(){d.add(C);var e=r.wantRollArrows?1:0;O[R].material.opacity=e,O[V].material.opacity=e},Te=function(){b.material.opacity=av.isMobileDevice()?1:0},we=function(){b.material.opacity=r.wantContextMenu?1:0},be=function(){T.material.opacity=0},Ce=function(){T.material.opacity=r.wantHomeButton?1:0};this.refreshCube=function(){pe()},this.setSize=function(e,t){if(r.width=e,r.height=t,i.children.length>1)for(var n=1;n<i.children.length;n++)i.children[n].style.bottom=(r.height/5).toString()+"px";pe()},this.useTransparency=function(e){Q=e,e?(i.onmouseover=te,i.onmousemove=ie,i.onmouseout=ne,ne()):(i.onmouseover=null,i.onmouseout=null,i.onmousemove=null,i.style.opacity="1.0")},this.dtor=function(){this.renderer=null},ee()},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224},Autodesk.Viewing.ToolController=function(e,t,i,n,o){function r(e,i){return t.navigation.getUseLeftHandedInput()&&0===e||c&&1===e||l&&!h&&0===e&&i.ctrlKey}var s=Autodesk.Viewing,a=Autodesk.Viewing.Private;this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=i,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var l=navigator.userAgent.search("Mac OS")!=-1,c=navigator.userAgent.search("Firefox")!=-1,u=navigator.userAgent.search("Chrome")!==-1,h=navigator.userAgent.search("Safari")!==-1&&!u,d=0,p=2,v=2,g=500,m={},f=[],E=!1,A=-1,y=-1,T=!1,w=null,b=void 0,C=!1,S={},k=this,x=Autodesk.Viewing.KeyCode;this.__registerToolByName=function(e,t){m[t]=e},this.registerTool=function(e){var t=e.getNames();if(!t||0==t.length)return a.logger.warn("Cannot register tool with no name."),!1;for(var i=!1,o=0;o<t.length;++o)"default"!==t[o]&&(this.__registerToolByName(e,t[o]),i=!0);return e.utilities=n,e.controller=this,e.register&&e.register(),i},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0==t.length)return!1;for(var i=t.length;--i>=0;)this.__deregisterToolName(t[i]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){function t(e){for(var t=f.length;--t>=0;)f[t].activeName===e&&(m[e].deactivate(e),f.splice(t,1))}e in m&&(t(e),delete m[e])},this.getTool=function(e){return m[e]},this.getActiveToolName=function(){var e=f.length;return e>0?f[e-1].activeName:"default"},this.getActiveTool=function(){var e=f.length;return e>0?f[e-1]:m.default},this.isToolActivated=function(e){for(var t=0;t<f.length;t++)if(f[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=m[e];t&&(t.activeName=e)},this.activateTool=function(i){if(E)return!1;var n=m[i];if(n){void 0===n.count&&(n.count=0);var o=null;f.length&&"intercept"===f[f.length-1].activeName&&(o=f.pop());for(var r=0;r<f.length;r++)f[r]===n&&n.count++;return n.activeName=i,0===n.count&&(n.count++,f.push(n)),n.activate(i,t),o&&f.push(o),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:i,tool:n,active:!0}),e.track({category:"tool_changed",name:i}),!0}return a.logger.warn("activateTool not found: "+i),!1},this.deactivateTool=function(e){if(E)return!1;for(var i=f.length;--i>=0;)if(f[i].activeName===e)return 1===m[e].count&&f.splice(i,1),m[e].count--,m[e].deactivate(e),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:e,tool:f[i],active:!1}),!0;return a.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(m)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return m.default},this.setDefaultTool(o),this.setIsLocked=function(e){var t=E;return E=!!e,t},this.getIsLocked=function(){return E},this.__checkCursor=function(){for(var e=null,i=f.length;--i>=0;){var n=f[i];if(n.getCursor&&(e=n.getCursor()))break}e||(e="auto"),w!=e&&(t.canvas.style.cursor=e,w=e)},this.update=function(e){this.__checkCursor();var i=!1;n&&n.update()&&(i=!0);for(var o=f.length;--o>=0;){var r=f[o];r.update&&r.update(e)&&(i=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),i=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,i)t.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){var s=this.moveDelay-Date.now();s>0?i=!0:this.moveDelay=0}return i},this.__clientToCanvasCoords=function(t,i,n){var o=e.canvas.getBoundingClientRect(),r=o.width,s=o.height,a=t.clientX-o.left,l=t.clientY-o.top;t.canvasX=a,t.canvasY=l,t.normalizedX=a/r*2-1,t.normalizedY=(s-l)/s*2-1,i&&i.set(a/r,l/s,0),n&&n.set(a,l)},this.__invokeStack=function(e,t,i){for(var n=f.length;--n>=0;){var o=f[n];if(o[e]&&o[e](t,i))return!0}var r=this.getDefaultTool();return!(!r[e]||!r[e](t,i))},this.distributeEvent=function(e,t,i){return this.__invokeStack(e,t,i)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=f.length;--e>=0;){var i=f[e];i.handleResize&&i.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e)&&(t.preventDefault(),t.stopPropagation())},this.applyButtonMappings=function(e){var i=e.button;return"buttons"in e&&(e.firefoxSpoof?i=d:!T||1&e.buttons?i===p&&1&e.buttons&&(i=d,e.firefoxSpoof=T=!0):(e.firefoxSpoof=!0,T=!1,i=d)),t.navigation.getUseLeftHandedInput()&&(i=i===d?p:i===p?d:i),i},this.applyKeyMappings=function(e,t){switch(e.keyCode){case x.LCOMMAND:case x.RCOMMAND:case x.COMMANDMOZ:return l&&e.metaKey&&e.shiftKey?null:x.CONTROL;case x.SHIFT:return t&&l&&e.metaKey?null:x.SHIFT;case x.EQUALSMOZ:return x.EQUALS;case x.DASHMOZNEW:case x.DASHMOZ:return x.DASH}return e.keyCode},this.handleKeyDown=function(e){var t=this.applyKeyMappings(e,!0);t&&this.__invokeStack("handleKeyDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleKeyUp=function(e){var t=this.applyKeyMappings(e,!0);t&&this.__invokeStack("handleKeyUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&(e.preventDefault(),e.stopPropagation())},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&(e.preventDefault(),e.stopPropagation())},this.keydown=function(e){if(!(!k.domElement.contains(b)||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var t=document.activeElement.getAttribute("contenteditable");if("true"===t||""===t)return}l&&e.metaKey&&e.keyCode!=x.LCOMMAND&&e.keyCode!=x.RCOMMAND||k.handleKeyDown(e)}},this.keyup=function(e){l&&e.metaKey&&e.keyCode!=x.LCOMMAND&&e.keyCode!=x.RCOMMAND||k.handleKeyUp(e)},this.mousedown=function(e){function t(e){var n=k.applyButtonMappings(e);n===i&&(document.removeEventListener("mouseup",t),k.mouseup(e))}s.isIE11&&s.inFullscreen()||document.activeElement&&document.activeElement.blur(),k.__clientToCanvasCoords(e);var i=k.applyButtonMappings(e);if(k.handleButtonDown(e,i),A=e.canvasX,y=e.canvasY,r(i,e)){var n=S,o=void 0!==n.time&&e.timeStamp-n.time<g,a=void 0!==n.x&&void 0!==n.y&&Math.abs(n.x-e.canvasX)<=v&&Math.abs(n.y-e.canvasY)<=v;(!o||!a||n.clickCount&&2<=n.clickCount)&&(n.clickCount=0),n.clickCount?1===n.clickCount&&(n.clickCount=2):(n.clickCount=1,n.x=e.canvasX,n.y=e.canvasY,n.time=e.timeStamp)}document.addEventListener("mouseup",t,!1),k.registerWindowMouseMove()},this.mousemove=function(e){k.__clientToCanvasCoords(e);var t=A-e.canvasX,i=y-e.canvasY;(Math.abs(t)>v||Math.abs(i)>v)&&(A=-1,y=-1),k.handleMouseMove(e)},this.mouseup=function(e){k.__clientToCanvasCoords(e);var t=k.applyButtonMappings(e);k.handleButtonUp(e,t);var i=A-e.canvasX,n=y-e.canvasY;if(A=-1,y=-1,Math.abs(i)<=v&&Math.abs(n)<=v&&k.handleSingleClick(e),r(t,e)){var o=S;2===o.clickCount&&(k.handleDoubleClick(e),o.clickCount=0,o.x=void 0,o.y=void 0,o.time=void 0)}k.unregisterWindowMouseMove()},this.doubleclick=function(e){k.__clientToCanvasCoords(e),A=e.canvasX,y=e.canvasY,k.handleDoubleClick(e)},this.mousewheel=function(e){if(k.scrollInputEnabled){var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail),k.handleWheelInput(t,e)}},this.blur=function(e){k.handleBlur(e)},this.mouseover=function(e){b=e.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",k.mousemove),window.addEventListener("mouseover",k.mouseover),k.domElement.removeEventListener("mousemove",k.mousemove),k.domElement.removeEventListener("mouseover",k.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",k.mousemove),window.removeEventListener("mouseover",k.mouseover),k.domElement.addEventListener("mousemove",k.mousemove),k.domElement.addEventListener("mouseover",k.mouseover)},this.enableMouseButtons=function(e){e&&!C?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&C&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=C;return C=e,t},this.enableMouseButtons(!0),this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(C&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",k.mousemove),window.removeEventListener("mouseover",k.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;f.length>0;)this.deactivateTool(f[f.length-1].activeName);m=null,f=null,k=null,n=null,t=null,e=null,b=null},this.set2DMode=function(e){},this.setAutocam=function(e){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();i.sync(e),i.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ViewingUtilities=function(e,t,i){function n(e){var t=500,i=32512,n=.6,o=0,r=new THREE.SphereGeometry(1),s=new THREE.MeshPhongMaterial({color:i,ambient:i,opacity:n,transparent:!0}),a=new THREE.Mesh(r,s),l=e;l.createOverlayScene("pivot"),a.visible=!1,this.shown=function(){return a.visible},this.show=function(e,i,r){a.scale.x=i,a.scale.y=i,a.scale.z=i,a.position.set(e.x,e.y,e.z),s.opacity=n,a.visible=!0,l.addOverlay("pivot",a),l.invalidate(!1,!1,!0),o=r?Date.now()+t:0},this.hide=function(){a.visible&&(a.visible=!1,l.removeOverlay("pivot",a),l.invalidate(!1,!1,!0),o=0)},this.fade=function(){if(o>0){var e=o-Date.now();if(e<=0)return this.hide(),!0;var i=e/t*n;return s.opacity=i,!0}return!1},this.fading=function(){return o>0}}function o(e,t,i){var n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var o=n.clone().cross(i);return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()}this.autocam=t,this.viewerImpl=e;var r=5,s=i.getCamera(),a={},l={},c=new n(this.viewerImpl);this.transitionView=function(e,n,r,a,l,c,u){
l=l||i.getWorldUpVector();var h=c?o(e,n,l):a;h||(h=s.up),u=u||n;var d={position:e,center:n,pivot:u,fov:r,up:h,worldUp:l,isOrtho:s.isPerspective===!1};t.goToView(d)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){t=1-t,e=2*e-1,t=2*t-1;var i=new THREE.Vector3(e,t,1),n=this.viewerImpl.hitTestViewport(i,!1);return n?n.intersectPoint:null},this.activatePivot=function(e){var t=s.isPerspective?i.getPivotPlaneDistance():i.getEyeVector().length(),n=i.getVerticalFov(),o=2*t*Math.tan(THREE.Math.degToRad(.5*n)),a=i.getScreenViewport(),l=window.devicePixelRatio||1,u=r*o/(a.height*l);c.show(i.getPivotPoint(),u,e)},this.pivotActive=function(e,t){return e=e&&!i.getIs2D(),t=t||!1,!e&&c.shown()?void c.hide():void(e&&this.activatePivot(t))},this.pivotUpdate=function(){c.shown()&&c.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,n){i.setPivotPoint(e),t||i.setTarget(e),n&&i.setPivotSetFlag(!0),this.setTemporaryPivot(null),i.getIs2D()||c.shown()&&this.activatePivot(c.fading())},this.savePivot=function(e){e||(e="default"),a[e]=i.getPivotPoint(),l[e]=i.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),a[e]){var t=l[e];this.setPivotPoint(a[e],!0,t),t||i.setPivotSetFlag(!1),delete a[e],delete l[e]}},this.setTemporaryPivot=function(e){if(e){var t=i.getPivotPoint(),n=i.getPivotSetFlag();this.setPivotPoint(e,!0,n),a.TEMP=t,l.TEMP=n}else delete a.TEMP,delete l.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"});var t=i.fitBounds(e,this.viewerImpl.getFitBounds(!1));return this.activatePivot(!0),t},this.update=function(){i.getRequestFitToView()&&!i.getTransitionActive()&&(i.setRequestFitToView(!1),this.fitToView()),i.getRequestHomeView()&&!i.getTransitionActive()&&(i.setRequestHomeView(!1),this.goHome());var e=i.getRequestTransition();return e&&!i.getTransitionActive()&&(i.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.DefaultHandler=function(e,t,i){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,n){for(var o=0;o<t.length;++o)switch(t[o]){case"selectOnly":e.selector&&n&&e.selector.setSelection([n.dbId],n.model);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&n&&e.selector.toggleSelection(n.dbId,n.model);break;case"isolate":n&&e.isolate(n.dbId);break;case"showAll":e.showAll();break;case"setCOI":n&&n.intersectPoint&&(i.setPivotPoint(n.intersectPoint,!0,!0),i.pivotActive(!0,!0));break;case"hide":n&&e.hide(n.dbId);break;case"show":n&&e.show(n.dbId);break;case"toggleVisibility":n&&e.toggleVisibility(n.dbId);break;case"focus":e.selector&&(n?e.selector.setSelection([n.dbId],n.model):e.selector.setSelection([]),i.fitToView())}},this.handleSingleClick=function(t,n){var o=t.ctrlKey||t.metaKey,r=t.shiftKey,s=t.altKey;if(0===n){var a=new THREE.Vector3(t.normalizedX,t.normalizedY,1),l=e.hitTestViewport(a,!1),c="click";o&&(c+="Ctrl"),r&&(c+="Shift"),s&&(c+="Alt");var u=l?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[c]&&this.clickConfig[c][u])return this.handleAction(this.clickConfig[c][u],l),!0}else if(1===n&&r&&!s&&!o){var a=new THREE.Vector3(t.normalizedX,t.normalizedY,1),l=e.hitTestViewport(a,!1);if(l&&l.intersectPoint)return i.setPivotPoint(l.intersectPoint,!0,!0),i.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(n,o){if(e.selector&&0===o){var r=new THREE.Vector3(n.normalizedX,n.normalizedY,1),s=e.hitTestViewport(r,!1);return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),i.fitToView(),!0}return 1===o&&(t.fitBounds(!1,i.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(i){if(i.clientX=i.pointers[0].clientX,i.clientY=i.pointers[0].clientY,e.api.triggerSingleTapCallback(i),i.hasOwnProperty("pointers")&&2===i.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector){var n=new THREE.Vector3(i.normalizedX,i.normalizedY,1),o=e.hitTestViewport(n,!1);return o?(e.selector.setSelection([o.dbId],o.model),e.api.triggerSelectionChanged([o.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var n=this.handleSingleTap(t,0);return i.fitToView(),n},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.GestureHandler=function(e){var t=Autodesk.Viewing,i=e.navigation,n=["gestures"],o=this,r=!0,s=!0,a=null,l=t.isTouchDevice();i.setIsTouchDevice(l),l&&(a=new Hammer.Manager(e.canvasWrap,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}],[Hammer.Pan,{event:"drag3",pointers:3,threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Rotate,{enable:!0,threshold:7}]],inputClass:Hammer.TouchInput}),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return n},this.getName=function(){return n[0]},this.__clientToCanvasCoords=function(t){var i,n,o=e.impl.canvas.getBoundingClientRect(),r=o.width,s=o.height;t.hasOwnProperty("center")?(i=t.center.x-o.left,n=t.center.y-o.top):(i=t.pointers[0].clientX-o.left,n=t.pointers[0].clientY-o.top),t.canvasX=i,t.canvasY=n,t.normalizedX=i/r*2-1,t.normalizedY=(s-n)/s*2-1},this.distributeGesture=function(e){function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleGesture",e)&&e.preventDefault(),t(e.type,"end")&&a.stop()},this.onSingleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){o.__clientToCanvasCoords(e),"press"===e.type?r=o.controller.enableMouseButtons(!1):o.controller.enableMouseButtons(r),o.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.activate=function(e){a&&(a.on("dragstart dragmove dragend",this.distributeGesture),a.on("singletap",this.onSingleTap),a.on("singletap2",this.onSingleTap),a.on("doubletap",this.onDoubleTap),a.on("doubletap2",this.onDoubleTap),a.on("press pressup",this.onPressHold),a.on("drag3start drag3move drag3end",this.distributeGesture),s&&(a.on("panstart panmove panend",this.distributeGesture),a.on("pinchstart pinchmove pinchend",this.distributeGesture),a.on("rotatestart rotatemove rotateend",this.distributeGesture)),a.get("doubletap2").recognizeWith("doubletap"),a.get("singletap2").recognizeWith("singletap"),a.get("singletap").requireFailure("doubletap"))},this.deactivate=function(e){a&&(a.off("dragstart dragmove dragend",this.distributeGesture),a.off("singletap",this.onSingleTap),a.off("singletap2",this.onSingleTap),a.off("doubletap",this.onDoubleTap),a.off("doubletap2",this.onDoubleTap),a.off("press pressup",this.onPressHold),a.off("drag3start drag3move drag3end",this.distributeGesture),s&&(a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture)))},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){s=!1,a&&(a.remove(Hammer.Pan),a.remove(Hammer.Pinch),a.remove(Hammer.Rotate),a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.OrbitDollyPanTool=function(e,t){function i(){var e=de;return j===G&&!e.SHIFT&&!(e.ALT^e.CONTROL)||j===G&&e.SHIFT&&e.CONTROL||j===U&&!e.SHIFT&&!e.CONTROL||j===U&&e.ALT||j===U&&e.CONTROL&&!e.ALT||j===z&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===k&&j!==U&&!e.ALT&&!("pinch"===x)||e.SPACE}function n(){var e=de;return j===G&&e.SHIFT&&!e.ALT&&!e.CONTROL||j===G&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===k&&!e.ALT&&!("pinch"===x)}function o(){var e=de;return!(e.CONTROL||e.ALT||e.SHIFT||j!==G&&j!==U)}function r(){var e=T.getPivotPoint().sub(T.getPosition());return e.dot(T.getEyeVector())<=0}function s(e,t){var i={left:0,top:0,width:window.innerWidth,height:window.innerHeight};re.set((e-.5*i.width-i.left)/(.5*i.width),(.5*i.height+i.top-t)/(.5*i.height),0);var n=re.length();return le?n<Math.SQRT1_2?re.z=Math.sqrt(1-n*n):re.z=.5/n:n>1?re.normalize():re.z=Math.sqrt(1-n*n),te.copy(w.position).sub(w.pivot),ne.copy(w.up).setLength(re.y),ne.add(oe.copy(w.up).cross(te).setLength(re.x)),ne.add(te.setLength(re.z)),ne}function a(){if(T.isActionEnabled("orbit")){te.subVectors(w.position,w.pivot),ie.subVectors(w.position,w.target);var e=ie.length();ie.normalize();var t=Math.acos($.dot(ee)/$.length()/ee.length());t&&(t*=A,se.crossVectors($,ee).normalize(),ae.setFromAxisAngle(se,-t),te.applyQuaternion(ae),w.up.applyQuaternion(ae),ee.applyQuaternion(ae),ie.applyQuaternion(ae),ce?$.copy(ee):(ae.setFromAxisAngle(se,t*(ue-1)),$.applyQuaternion(ae))),w.position.addVectors(w.pivot,te),w.target.subVectors(w.position,ie.multiplyScalar(e)),w.dirty=!0}}function l(e,t){return e.indexOf(t,e.length-t.length)!==-1}function c(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+i*i)}var u,h,d=(Autodesk.Viewing.Private,this),p=.001,v=1e-5,g=1.5,m=.01,f=20,E=100,A=2,y=navigator.userAgent.search("Mac OS")!=-1,T=t.navigation,w=T.getCamera(),b=["orbit","freeorbit","dolly","pan"],C=b[0],S=[C],k=C,x=null,M=1,R=1,P=0,V=0,I=0,N=0,D=!1,L=null,O=!1,_={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},H=-5,B=-4,F=-1,z=0,U=1,G=2,W=3,j=H,Y=new THREE.Vector3,q=new THREE.Vector3,X=new THREE.Vector2,K=new THREE.Vector2,Q=new THREE.Vector2,Z=new THREE.Vector2,J=new THREE.Vector3,$=new THREE.Vector3,ee=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Vector3,ne=new THREE.Vector3,oe=new THREE.Vector3,re=new THREE.Vector3,se=new THREE.Vector3,ae=new THREE.Quaternion,le=!1,ce=!0,ue=.2,he=[!1,!1,!1,!1,!1,!1],de={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},pe=.6,ve=5,ge=.025,me=.01,fe=.6,Ee=1,Ae=ve,ye=ge;this.getNames=function(){return b},this.getName=function(){return b[0]},this.activate=function(e){S.push(e),k=e},this.deactivate=function(e){var t=S.length-1;t>0&&S[t]===e&&(S.pop(),k=S[t-1])},this.adjustDollyLookSpeed=function(e){0===e?(ye=ge,Ae=ve):(ye*=e>0?1.1:.9,Ae*=e>0?1.1:.9,ye<1e-6&&(ye=1e-6),Ae<1e-6&&(Ae=1e-6))},this.getDollySpeed=function(e){var t=T.getEyeVector(),i=T.getPosition(),n=e.clone().sub(i).dot(t.normalize()),o=n*ye;return Math.abs(o)<me?o<0?-me:me:o},this.getLookSpeed=function(){return Ae},this.coiIsActive=function(){return T.getPivotSetFlag()&&T.isPointVisible(T.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return j===U&&de.SHIFT?S[1]:n()||0!==J.z?o()?"pan":"dolly":i()?"pan":"pan"===x||"pinch"===x?"dollypan":k},this.initTracking=function(e,t){var i;if(w.isPerspective){i=.5*(w.near+w.far);var n=this.utilities.getHitPoint(e,t),o=T.getPosition();if(n&&n.sub){var r=n.sub(o),s=T.getEyeVector().normalize();i=Math.abs(s.dot(r))}else{var a=T.getPivotSetFlag()&&T.isPointVisible(T.getPivotPoint());if(a){var l=T.getPivotPlaneDistance();l>v&&(i=l)}}}else i=T.getEyeVector().length();Ee=i},this.initOrbit=function(){this.utilities.setTemporaryPivot(r()?T.getTarget():null)},this.getCursor=function(){switch(C){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var i=T&&T.getReverseZoomDirection()?-g:g;y&&(i*=-1),he[0]&&(q.x+=m,Q.x+=f),he[1]&&(q.x-=m,Q.x-=f),he[2]&&(q.y+=m,Q.y+=f),he[3]&&(q.y-=m,Q.y-=f),he[4]&&(q.z+=i),he[5]&&(q.z-=i);var n=q.x-Y.x,o=q.y-Y.y,r=q.z-Y.z;Math.abs(n)<p&&(n=0),Math.abs(o)<p&&(o=0),Math.abs(r)<p&&(r=0),e.set(n,o,r),t&&t.set(Q.x-K.x,Q.y-K.y)},this.stepMotionDelta=function(e,t){t?(Y.x+=e.x*pe,Y.y+=e.y*pe,Y.z+=e.z*pe):Y.copy(q),K.copy(Q)},this.update=function(){var e,i=!1,n=!1;this.getMotionDelta(J,Z);var o=J.x,r=J.y,s=J.z;if(D||this.checkInteractionMode(),D=j>F,D&&this.controller.setIsLocked(!0),0!==o||0!==r||0!==s){switch(C){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(Z.x=-Z.x,L&&this.utilities.autocam.orbit(Q,L,Z.multiplyScalar(A),this.utilities.autocam.startState));break;case"freeorbit":a();break;case"dolly":var l,c,d;s*=fe,j>=z?(r=-r,s=Math.abs(o)>Math.abs(r)?o:r,s*=E,o=0,r=0,c=d=.5):(e=T.getScreenViewport(),c=u/e.width,d=h/e.height),l=!T.getIs2D()&&T.getZoomTowardsPivot()?this.coiIsActive()?T.getPivotPoint():T.getWorldPoint(.5,.5):T.getWorldPoint(c,d),T.dollyFromPoint(s*this.getDollySpeed(l),l);break;case"pan":T.panRelative(-o,r,Ee);break;case"dollypan":0===o&&0===r||T.panRelative(-o,r,Ee),e=T.getScreenViewport(),c=u/e.width,d=h/e.height,l=T.getWorldPoint(c,d);var p=T.getPosition(),g=T.getIs2D()?p.sub(l).length():Ee,m=P/V-1,f=m*g;T.dollyFromPoint(f,l);var y=new THREE.Vector3,S=new THREE.Quaternion,k=T.getCameraUpVector(),N=y.copy(w.position).sub(w.target).normalize();S.setFromAxisAngle(N,1.2*I),k.applyQuaternion(S),T.getIs2D()||T.setCameraUpVector(k),P=V,R=M,Ee=g+f}n=!0}return this.stepMotionDelta(J,"pan"!==C&&"dollypan"!==C),j===F&&Math.abs(s)<v&&(this.interactionEnd(F),i=!0,n=!0),(de.SHIFT||de.ALT)&&b.indexOf(t.getActiveNavigationTool())!==-1&&(n=!0),!O&&(i||j>H)&&(j>F&&(Y.copy(q),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),j=H,D&&this.controller.setIsLocked(!1),D=!1,L=null,x=null),n?this.utilities.pivotActive(T.getPivotSetFlag(),j<=F):this.utilities.pivotUpdate(),w.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==C&&(C=e,("pan"===C&&j>F||"dollypan"===C)&&this.initTracking(Y.x,Y.y))},this.interactionStart=function(e,t){(t||e>j)&&(j=e,O=!0,e>F&&("pan"===C&&this.initTracking(Y.x,Y.y),"orbit"===C&&this.initOrbit()),this.utilities.pivotActive(T.getPivotSetFlag(),e===F),this.utilities.autocam&&(this.utilities.autocam.sync(w),this.utilities.autocam.startInteraction(K.x,K.y),L=K.clone()))},this.interactionCheck=function(){(he[0]||he[1]||he[2]||he[3]||he[4]||he[5]||de.SHIFT||de.CONTROL||de.ALT||de.SPACE)&&this.interactionStart(B,!0)},this.interactionEnd=function(e){e===j&&(e!==F&&this.utilities.pivotActive(!1),O=!1)},this.handleWheelInput=function(t){if(this.isDragging)return!1;if(T.getIs2D()){var i=T.getScreenViewport(),n=e.intersectGround(u+i.width,h+i.height);this.utilities.setPivotPoint(n,!0,!0)}return T.getReverseZoomDirection()&&(t*=-1),q.z+=t,0!=t&&this.interactionStart(F),!0},this.resetKeys=function(){this.autoMove(-1,!1),de.SHIFT=0,de.CONTROL=0,de.ALT=0,de.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?he[0]=he[1]=he[2]=he[3]=he[4]=he[5]=t:he[e]=t,t||this.interactionEnd(B),this.interactionCheck())},this.updateModifierState=function(e){de.CONTROL=y&&e.metaKey||e.ctrlKey?1:0,de.SHIFT=e.shiftKey?1:0,de.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var i=!1;switch(t){case _.EQUALS:this.adjustSpeed(1),i=!0;break;case _.DASH:this.adjustSpeed(-1),i=!0;break;case _.ZERO:this.adjustSpeed(0),i=!0;break;case _.LEFT:this.autoMove(0,!0),i=!0;break;case _.RIGHT:this.autoMove(1,!0),i=!0;break;case _.PAGEUP:this.autoMove(2,!0),i=!0;break;case _.PAGEDOWN:this.autoMove(3,!0),i=!0;break;case _.UP:this.autoMove(4,!0),i=!0;break;case _.DOWN:this.autoMove(5,!0),i=!0;break;default:return!1}return this.isDragging||this.interactionStart(B),i},this.handleKeyUp=function(e,t){this.updateModifierState(e);var i=!1;switch(t){case _.LEFT:this.autoMove(0,!1),i=!0;break;case _.RIGHT:this.autoMove(1,!1),i=!0;break;case _.PAGEUP:this.autoMove(2,!1),i=!0;break;case _.PAGEDOWN:this.autoMove(3,!1),i=!0;break;case _.UP:this.autoMove(4,!1),i=!0;break;case _.DOWN:this.autoMove(5,!1),i=!0;break;default:return!1}return i&&(this.interactionEnd(B),O||this.interactionCheck()),i},this.handleDollyPan=function(e){u=e.canvasX,h=e.canvasY;var t=T.getScreenViewport();Q.x=X.x+e.deltaX,Q.y=X.y+e.deltaY,q.x=Q.x/t.width,q.y=Q.y/t.height,V=c(e);var i=THREE.Math.degToRad(e.rotation);I=i-N,Math.abs(I)>1&&(I=0),N=i,l(e.type,"start")&&(P=V,R=1,I=0,N=i),M=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return x="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===x&&this.handleMouseMove(e);case"dragend":return"drag"===x&&(this.handleButtonUp(e,0),x=null,!0);case"panstart":return x="pan",this.isDragging=!0,Y.x=.5*(e.normalizedX+1),Y.y=1-.5*(e.normalizedY+1),X.set(e.canvasX,e.canvasY),K.set(e.canvasX,e.canvasY),this.interactionStart(W),this.handleDollyPan(e),!0;case"panmove":return"pan"===x&&this.handleDollyPan(e);case"panend":return"pan"===x&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(W),!0);case"pinchstart":return this.isDragging=!0,x="pinch",Y.x=.5*(e.normalizedX+1),Y.y=1-.5*(e.normalizedY+1),X.set(e.canvasX,e.canvasY),K.set(e.canvasX,e.canvasY),this.interactionStart(W),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===x&&this.handleDollyPan(e);case"pinchend":return"pinch"===x&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(W),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),Y.x=.5*(e.normalizedX+1),Y.y=1-.5*(e.normalizedY+1),K.set(e.canvasX,e.canvasY),q.copy(Y),Q.copy(K),$.copy(s(e.canvasX,e.canvasY)),ee.copy($),u=e.canvasX,h=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),q.x=.5*(e.normalizedX+1),q.y=1-.5*(e.normalizedY+1),Q.set(e.canvasX,e.canvasY),ee.copy(s(e.canvasX,e.canvasY)),$.copy(ee),u=e.canvasX,h=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(q.x=.5*(t.normalizedX+1),q.y=1-.5*(t.normalizedY+1),Q.set(t.canvasX,t.canvasY),ee.copy(s(t.canvasX,t.canvasY)),u=t.canvasX,h=t.canvasY,!0):(Y.x=.5*(t.normalizedX+1),Y.y=1-.5*(t.normalizedY+1),K.set(t.canvasX,t.canvasY),q.x=Y.x,q.y=Y.y,Q.copy(K),u=t.canvasX,h=t.canvasY,e.rolloverObject(u,h),!1)},this.handleBlur=function(e){this.resetKeys(),this.interactionEnd(j)},t.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(e){d.handleBlur(e)})},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.HotGestureTool=function(e){var t=(navigator.userAgent.search("Mac OS")!=-1,e.navigation),i=(t.getCamera(),["hottouch"]),n={SHIFT:0,ALT:0,CONTROL:0},o=null,r=null,s=!1,a=!1,l=null,c={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224},u="worldup",h="fov";this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(e){},this.deactivate=function(e){},this.__checkStart=function(){l&&(this.controller.distributeEvent("handleGesture",l),l=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),i=s===!1&&a===!0,n=s===!0&&a===!1;if(i||n){var l=i?u:h;if(t===l)return!1;if(t===o)return e.setActiveNavigationTool(l),o=l,this.__checkStart(),!1;r=t,e.setActiveNavigationTool(l),o=l,this.__checkStart()}else o&&(e.setActiveNavigationTool(r),o=null,r=null);return!1},this.resetKeys=function(){n.SHIFT=0,n.CONTROL=0,n.ALT=0},this.updateModifierState=function(e){n.CONTROL=e.ctrlKey?1:0,n.SHIFT=e.shiftKey?1:0,n.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===l)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(l=t,s=!0);break;case"drag3move":break;case"drag3end":s=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(l=t,a=!0);break;case"rotatemove":break;case"rotateend":a=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case c.SHIFT:n.SHIFT=1;break;case c.CONTROL:n.CONTROL=1;break;case c.ALT:n.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case c.SHIFT:n.SHIFT=0;break;case c.CONTROL:n.CONTROL=0;break;case c.ALT:n.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.HotkeyManager=function(){function e(){return g}function t(){return g[0]}function i(e,t){return e-t}function n(e,t,n){var o=u.some(function(t){return t.id===e});if(o)return!1;for(var r=0;r<t.length;r++)u.push({id:e,keys:t[r].keycodes.sort(i).join(),onPress:t[r].onPress,onRelease:t[r].onRelease,options:n||{}});return!0}function o(e){for(var t=!1,i=u.length-1;i>=0;i--)u[i].id===e&&(u.splice(i,1),t=!0);return t}function r(){var e,t,i=h.join();for(t=0;t<p.length;)e=p[t],e.keys===i?p.splice(t,1):t++;for(t=0;t<d.length;)e=d[t],e.keys!==i?d.splice(t,1):t++}function s(e,t){if(h.indexOf(t)===-1){for(var i=h.join(),n=h.slice(0),o=0;o<h.length&&h[o]<t;)o++;h.splice(o,0,t);var s=h.join(),a=h.slice(0);r();var l,c=[],v=[];for(o=u.length-1;o>=0;o--)l=u[o],l.keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&v.unshift(l);for(o=c.length-1;o>=0&&(l=c[o],!l.onRelease(n));o--)l.options.tryUntilSuccess&&p.unshift(l);for(o=v.length-1;o>=0&&(l=v[o],!l.onPress(a));o--)l.options.tryUntilSuccess&&d.unshift(l)}}function a(e,t){var i=h.join(),n=h.slice(0),o=h.indexOf(t);o>-1&&h.splice(o,1);var s=h.join(),a=h.slice(0);r();var l,c=[],v=[];for(o=u.length-1;o>=0;o--)l=u[o],l.keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&v.unshift(l);for(o=c.length-1;o>=0&&(l=c[o],!l.onRelease(n));o--)l.options.tryUntilSuccess&&p.unshift(l);for(o=v.length-1;o>=0&&(l=v[o],!l.onPress(a));o--)l.options.tryUntilSuccess&&d.unshift(l)}function l(){var e,t;for(t=0;t<p.length;)e=p[t],e.onRelease(e.keys.split())===!0?p.splice(t,1):t++;for(t=0;t<d.length;)e=d[t],e.onPress(e.keys.split())===!0?d.splice(t,1):t++;return!1}function c(){for(var e=h.length-1;e>=0;e--)a(null,h[e])}var u=[],h=[],d=[],p=[],v=Autodesk.Viewing.KeyCode,g=["hotkeys"];return{pushHotkeys:n,popHotkeys:o,handleKeyDown:s,handleKeyUp:a,handleBlur:c,getName:t,getNames:e,activate:function(){},deactivate:function(){},update:l,KEYCODES:v}},Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager,AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.FovTool=function(e){function t(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}var i=.001,n=1e-5,o=-1,r=.6,s=100,a=e.navigation,l=a.getCamera(),c=["fov"],u=!1,h=0,d=null,p=null,v=!1,g=0,m=-5,f=-1,E=0,A=2,y=m,T=new THREE.Vector3,w=new THREE.Vector3,b=new THREE.Vector3,C=null;this.getNames=function(){return c},this.getName=function(){return c[0]},this.activate=function(e){g=0},this.deactivate=function(e){y=m},this.getCursor=function(){return 0!==g&&y===m?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var t=w.x-T.x,n=w.y-T.y,o=w.z-T.z;Math.abs(t)<i&&(t=0),Math.abs(n)<i&&(n=0),Math.abs(o)<i&&(o=0),e.set(t,n,o)},this.stepMotionDelta=function(e,t){t?(T.x+=e.x*r,T.y+=e.y*r,T.z+=e.z*r):T.copy(w)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),i=0;return p&&e-p>s?(i=t(h),h=0,d=null,p=null,v=!1):d&&e-d>s&&(v?Math.abs(h)>=3&&(i=h,h=0):(i=t(h),v=!0,h=0)),i},this.update=function(){var e=!1,t=y>m;if(y>m){this.controller.setIsLocked(!0),this.getMotionDelta(b);var i=b.x,r=b.y,s=b.z;if(0!==i||0!==r||0!==s)if(t=!0,y>=E)r=-r,s=Math.abs(i)>Math.abs(r)?i:r,0!==s&&(s*=o,a.setVerticalFov(a.getVerticalFov()*(1+s),!0));else{var c=this.getAccumulatedWheelDelta()/3;0!==c&&a.setFocalLength(a.getFocalLength()+c,!0)}this.stepMotionDelta(b,!0),y===f&&Math.abs(s)<n&&(this.interactionEnd(f),e=!0)}return t?this.utilities.pivotActive(a.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!u&&(e||y>m)&&(y>f&&T.copy(w),y=m,this.controller.setIsLocked(!1)),l.dirty},this.interactionStart=function(e,t){(t||e>y)&&(y=e,u=!0),a.toPerspective()},this.interactionEnd=function(e){e===y&&(e!==f&&this.utilities.pivotActive(!1),u=!1)},this.handleWheelInput=function(e){if(y>f)return!1;a.getReverseZoomDirection()&&(e*=-1),w.z+=e,h+=e;var t=Date.now();return d||(d=t),p=t,0!=e&&this.interactionStart(f),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return C="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===C&&this.handleMouseMove(e);case"drag3end":return"drag"===C&&this.handleButtonUp(e,0),C=null,!1}return!1},this.handleButtonDown=function(e,t){return g+=1<<t,t!==A&&(T.x=.5*(e.normalizedX+1),T.y=1-.5*(e.normalizedY+1),w.copy(T),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return g-=1<<t,t!==A&&(w.x=.5*(e.normalizedX+1),w.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return w.x=.5*(e.normalizedX+1),w.y=1-.5*(e.normalizedY+1),y>f},this.handleBlur=function(e){return this.interactionEnd(y),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.WorldUpTool=function(e,t){function i(e,t){function i(e,t){var i=Math.abs(e-t);return i>d?i:Math.min(d-i,i)}function n(e,t){var i=g(e);return i.distanceToSquared(t)<v||(R.set(-t.x,-t.y,-t.z),i.distanceToSquared(R)<v)}function s(e,t){for(var o=Q+Z+2*Math.PI/180,r=0;r<6;++r)if(W[r]!==$)for(var s=r+1;s<6;++s)if(W[s]!==$){
var a=i(W[r],W[s]);if(a<o){if(e[r]<e[s]&&!n(r,t)||n(s,t)){W[r]=$;break}W[s]=$}}}function l(e){return e>d?e:e<=0?e+Math.PI:e-Math.PI}function c(e,t,i){var n=e.clone().normalize(),o=new Array(3),r=new Array(6);o[0]=h(1,0,0,n),o[1]=h(0,1,0,n),o[2]=h(0,0,1,n);var a,c=t.clone().cross(n).normalize();for(a=0;a<3;++a){var u=o[a];r[a]=u.length(),r[a]<ee?W[a]=$:(u.multiplyScalar(1/r[a]),W[a]=Math.atan2(c.dot(u),t.dot(u)))}for(W[3]=l(W[0]),W[4]=l(W[1]),W[5]=l(W[2]),r[3]=r[0],r[4]=r[1],r[5]=r[2],s(r,i),a=0;a<6;++a)if(W[a]!==$){var d=R.set(0,0,1);P.setFromAxisAngle(d,W[a]);var p=R.set(0,.54,0);p.applyQuaternion(P),U[a].position.copy(p),U[a].visible=!0}else U[a].visible=!1}function u(){F=new THREE.Object3D;var e=new THREE.RingGeometry(.5-.01*N,.5,60),t=new THREE.Mesh(e,x);O=t;var i=.007*N,n=new THREE.BoxGeometry(.93,i,i),o=new THREE.BoxGeometry(i,.93,i),r=new THREE.BoxGeometry(i,i,.93);_=new THREE.Mesh(n,x),H=new THREE.Mesh(o,x),B=new THREE.Mesh(r,x),F.add(_),F.add(H),F.add(B),z=new THREE.Mesh(new THREE.CircleGeometry(.005),x),F.add(z),U=new Array(6),G=new Array(6);for(var s=0;s<6;++s){var a=.005*N,l=.0025*N;U[s]=new THREE.Mesh(new THREE.CircleGeometry(a,16),x),G[s]=new THREE.Mesh(new THREE.CircleGeometry(l,16),x),G[s].visible=!1,U[s].add(G[s]),t.add(U[s])}return F.add(t),F}function p(e,t,i,n,o){return F||(F=u()),a.orient(O,t,V.position,n),c(i,o,n),F.scale.x=e,F.scale.y=e,F.scale.z=e,F.position.copy(t),F}function g(e){if(M.set(0,0,0),e>=0){var t=e>=3?-1:1;e%=3,0===e&&(M.x=t),1===e&&(M.y=t),2===e&&(M.z=t)}return q&&M.multiplyScalar(-1),M}function m(e,t){for(var n=i(W[0],e),o=0,r=1;r<6;++r){var s=i(W[r],e);s<n&&(n=s,o=r)}return j=n,n<t?o:-1}function f(e){a.setWorldUpVector(e,!0)}function E(e){if(0!==e){var t=30*Math.PI/180,i=R.copy(V.position).sub(L).normalize();P.setFromAxisAngle(i,e);var n=a.getWorldUpVector(),o=Math.abs(i.angleTo(n));(o<t||Math.PI-o<t)&&n.copy(a.getCameraUpVector()),n.applyQuaternion(P),f(n)}}function A(){if(!X){var e=m(Y,Q);if(e>=0)return j=0,X=!0,Y=W[e],g(e)}return!1}function y(){if(X){var e=m(Y,Z);if(e<0)return X=!1,!0;j=0}return!1}function T(e,t,i,n){var o=e<t;if(o){var r=g(i);return r.distanceToSquared(n)<v}return!1}function w(e,t){var n=e.dot(t),o=n<0;o&&(t=t.clone().multiplyScalar(-1)),a.orient(z,L,V.position,t),z.position.copy(t.multiplyScalar(.495));for(var r=!1,s=X?Z:Q,l=0;l<6;++l){var c=i(W[l],Y),u=T(c,s,l,e);u&&(r=!0);var h=u?4:3*(1-3*c/Math.PI);h<1&&(h=1),h*=N,G[l].visible=u;var d=U[l];d.scale.x=h,d.scale.y=h,d.scale.z=h}return _.visible=r,H.visible=r,B.visible=r,r}function b(e){Y+=e,Y>Math.PI?Y-=d:Y<=-Math.PI&&(Y=d+Y);var t=A();if(t)K=Y,f(t);else if(y()){var i=Y-K;E(i),K=0}else{if(X)return!1;E(e)}return!0}var C=12303291,S=30,k=2*Math.tan(THREE.Math.degToRad(.5*S)),x=new THREE.MeshPhongMaterial({color:C,ambient:C,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),M=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Quaternion,V=new THREE.PerspectiveCamera(S,t.aspect,t.near,t.far),I=t,N=1,D=1,L=null,O=null,_=null,H=null,B=null,F=null,z=null,U=null,G=null,W=new Array(6),j=0,Y=0,q=!1,X=!0,K=0,Q=5*Math.PI/180,Z=7*Math.PI/180,J=1,$=1e3,ee=.1;e.createOverlayScene("roll",null,null,V),this.updateRollCamera=function(e,t){V.position.copy(I.position),V.quaternion.copy(I.quaternion),V.up.copy(I.up),V.aspect=I.aspect,e&&t&&(V.near=t-e,V.far=t+e),V.updateProjectionMatrix()},this.isSnapped=function(){return X},this.resize=function(){var e=J*k,t=e*I.aspect,i=(I.aspect<1?t:e)*D;F.scale.x=i,F.scale.y=i,F.scale.z=i},this.start=function(t,i){this.updateHUD(t,i),e.addOverlay("roll",F)},this.updateHUD=function(e,t){L=e,t<o?t=o:t>r&&(t=r),D=t,N=r/t;var i=M.copy(e).sub(I.position);J=i.length();var n=J*k,s=n*I.aspect,l=(I.aspect<1?s:n)*t;this.updateRollCamera(l,J);var c=a.getWorldUpVector(),u=a.getCameraUpVector();p(l,e,i,c,u),Y=0,K=0;var h=c.dot(u);q=h<0,X=w(c,u)},this.handleRoll=function(e,t,i){if(this.updateRollCamera(),w(a.getWorldUpVector(),a.getCameraUpVector()),0!==e||0!==t){var n=i.x-e-.5,o=i.y-t-.5,r=i.x-.5,s=i.y-.5;return b(Math.atan2(s,r)-Math.atan2(o,n))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),w(a.getWorldUpVector(),a.getCameraUpVector());var t=e-Y;return Math.abs(t)>.001&&b(t)},this.end=function(){e.removeOverlay("roll",F)}}function n(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY,n=Math.sqrt(t*t+i*i),o=a.getScreenViewport();return n/Math.min(o.width,o.height)}var o=.35,r=.8,s=.65,a=t.navigation,l=a.getCamera(),c=["worldup"],u=this,h=function(){var e=new THREE.Vector3;return function(t,i,n,o){var r=new THREE.Vector3(t,i,n),s=o.dot(r);return e.copy(o),e.multiplyScalar(s),r.sub(e)}}(),d=2*Math.PI,p=.001,v=1e-5,g=!1,m=!1,f=!1,E=new i(e,l),A=new THREE.Vector3,y=new THREE.Vector3,T=new THREE.Vector3,w=null,b=0,C={x:.5,y:.5},S=1;this.getNames=function(){return c},this.getName=function(){return c[0]},this.activate=function(e){t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),f=!1},this.deactivate=function(e){E.end(),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),w=null,g=!1,f=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=y.x-A.x,i=y.y-A.y,n=y.z-A.z;Math.abs(t)<p&&(t=0),Math.abs(i)<p&&(i=0),Math.abs(n)<p&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(){A.copy(y)},this.update=function(){if(!f){var e=a.getEyeVector(),t=.5*(l.near+l.far);e.normalize().multiplyScalar(t);var i=e.add(l.position);this.utilities.savePivot(),this.utilities.setPivotPoint(i,!0,!0),this.utilities.pivotActive(!0);var n=s;E.start(i,n),f=!0}var o=m;this.getMotionDelta(T);var r=T.x,c=T.y,u=T.z;return(m||"roll"===w||g&&(0!==r||0!==c||0!==u))&&(m="roll"===w?E.handleRollTouch(b):E.handleRoll(r,c,y)),this.stepMotionDelta(),l.dirty&&(o=!0),o},this.handleResize=function(){E.resize(),m=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return w="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return w=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),w="roll",b=THREE.Math.degToRad(e.rotation),C={x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},S=n(e),!0;case"rotatemove":return b=THREE.Math.degToRad(e.rotation),"roll"===w;case"rotateend":return t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),b=THREE.Math.degToRad(e.rotation),w=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=a.getEyeVector(),t=.5*(l.near+l.far);e.normalize().multiplyScalar(t);var i=e.add(l.position);E.updateHUD(i,s)},this.handleButtonDown=function(e,i){return A.x=.5*(e.normalizedX+1),A.y=1-.5*(e.normalizedY+1),y.copy(A),g=!0,w=null,this.controller.setIsLocked(!0),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,u.handleCameraChange),!0},this.handleButtonUp=function(e,i){return y.x=.5*(e.normalizedX+1),y.y=1-.5*(e.normalizedY+1),g=!1,m=!0,this.controller.setIsLocked(!1),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,u.handleCameraChange),!0},this.handleMouseMove=function(e){return y.x=.5*(e.normalizedX+1),y.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return g=!1,w=null,!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ToolInterface=function(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},function(){"use strict";function e(e,t){function o(){return t.getData().instanceTree}function r(){}function s(i){var n=o();if(p[i]>0)p[i]--,0==p[i]&&e.highlightObjectNode(t,i,!1);else if(p[i]<0)throw"Selection State machine broken. Negatively selected object!";n&&n.enumNodeChildren(i,function(e){s(e)},!1)}function a(i,n){var r=o();p[i]?p[i]++:(e.highlightObjectNode(t,i,!0,n),p[i]=1),r&&r.enumNodeChildren(i,function(e){a(e,!0)},!1)}function l(e){if(void 0!==e&&d.selectedObjectIds[e])return!0}function c(e){var t=o();if(!t||(e=t.findNodeForSelection(e,d.selectionMode),t.isNodeSelectable(e))){var i=l(e);i||(d.selectedObjectIds[e]=e,d.selectionCount++,a(e))}}function u(e){var t=l(e);t&&(s(e),d.selectedObjectIds[e]=0,d.selectionCount--)}function h(e){if(d.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!l(e[t]))return!1;return!0}var d=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=i.SelectionMode.LEAF_OBJECT;var p={};this.getInstanceTree=o,this.getSelectionLength=function(){return d.selectionCount},this.getSelection=function(){var e=[],t=d.selectedObjectIds;for(var i in t)if(t[i]){var n=parseInt(i);e.push(n)}return e},this.clearSelection=function(e){if(this.selectionCount>0){var t=d.selectedObjectIds;for(var i in t){var n=parseInt(i);void 0!==n&&s(n)}d.selectedObjectIds={},d.selectionCount=0,e||r()}},this.deselectInvisible=function(){var i=!1,n=d.selectedObjectIds,s=(o(),e.visibilityManager);for(var a in n){var l=parseInt(a);l&&!s.isNodeVisible(t,l)&&(u(l),i=!0)}return i&&r(),i},this.toggleSelection=function(e){return e?(l(e)?u(e):c(e),void r()):void n.logger.error("Attempting to select node 0.")},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.setSelection=function(e){if(!h(e)&&(this.clearSelection(!0),null!=e&&0!==e.length)){for(var t=0;t<e.length;t++)c(e[t]);r()}},this.getSelectionBounds=function(){var e=new THREE.Box3,i=new THREE.Box3,n=o(),r=t.getFragmentList(),s=d.selectedObjectIds;for(var a in s){var l=parseInt(a);n.enumNodeFragments(l,function(t){r.getWorldBounds(t,i),e.union(i)},!0)}return e},this.getSelectionVisibility=function(){var e=!1,t=!1,i=d.selectedObjectIds;for(var n in i){var r=parseInt(n);if(r){var s=o();if(s&&s.isNodeHidden(r)?t=!0:e=!0,e&&t)break}}return{hasVisible:e,hasHidden:t}},this.dtor=function(){this.selectedObjectIds=null}}function t(t){function o(){a.length>1&&n.logger.warn("This selection call does not yet support multiple models.")}function r(){for(var e=[],n=0;n<a.length;n++){var o=[],r=[],s=a[n].selector.selectedObjectIds,l=a[n].selector.getInstanceTree();for(var c in s)if(s[c]){var u=parseInt(c);u&&(o.push(u),l&&l.enumNodeFragments(u,function(e){r.push(e)},!1))}o.length&&e.push({fragIdsArray:r,dbIdArray:o,nodeArray:o,model:a[n]})}var h;1===a.length&&(h={type:i.SELECTION_CHANGED_EVENT,fragIdsArray:e[0]?e[0].fragIdsArray:[],dbIdArray:e[0]?e[0].dbIdArray:[],nodeArray:e[0]?e[0].dbIdArray:[],model:a[0]},t.api.fireEvent(h)),h={type:i.AGGREGATE_SELECTION_CHANGED_EVENT,selections:e},t.api.fireEvent(h)}function s(){for(var e=!1,t=0;t<a.length;t++)e=a[t].selector.deselectInvisible()||e;e&&r()}var a=[];this.addModel=function(i){a.indexOf(i)==-1&&(i.selector=new e(t,i),a.push(i))},this.removeModel=function(e){var t=a.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,a.splice(t,1)},this.getSelectionLength=function(){for(var e=0,t=0;t<a.length;t++)e+=a[t].selector.getSelectionLength();return e},this.getSelection=function(){return o(),a.length>1&&n.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),a[0].selector.getSelection()},this.getAggregateSelection=function(){for(var e=[],t=0;t<a.length;t++){var i=a[t].selector.getSelection();i&&i.length&&e.push({model:a[t],selection:i})}return e},this.clearSelection=function(e){for(var t=0;t<a.length;t++)a[t].selector.clearSelection(e);e||r()},this.toggleSelection=function(e,t){t||(o(),t=a[0]),t.selector.toggleSelection(e),r()},this.setSelectionMode=function(e){for(var t=0;t<a.length;t++)a[t].selector.setSelectionMode(e)},this.setSelection=function(e,t){if(e&&0!==e.length){if(t)for(var i=0;i<a.length;i++)a[i]!==t&&a[i].selector.clearSelection();else o(),t=a[0];t.selector.setSelection(e)}else this.clearSelection();r()},this.getSelectionBounds=function(){if(1==a.length)return a[0].selector.getSelectionBounds();for(var e=new THREE.Box3,t=0;t<a.length;t++){var i=a[t].selector.getSelectionBounds();e.union(i)}return e},this.getSelectionVisibility=function(){return o(),a[0].selector.getSelectionVisibility()},this.dtor=function(){for(var e=0;e<a.length;e++)a[e].selector.dtor()},t.api.addEventListener(i.ISOLATE_EVENT,function(e){s()}),t.api.addEventListener(i.HIDE_EVENT,function(e){s()})}var i=Autodesk.Viewing,n=i.Private;n.Selector=e,n.MultiModelSelector=t}(),function(){"use strict";function e(e){this.viewer=e,this.models=[]}var t=Autodesk.Viewing,i=t.Private,n=function(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]};n.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},n.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},n.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},n.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e);var i=this.model.getData().is2d;i&&this.model.setAllVisibility(e)},n.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):this.hiddenNodes.indexOf(e)==-1&&(0==this.isolatedNodes.length||this.isolatedNodes.indexOf(e)!=-1)},n.prototype.isolate=function(e){var t=this.getInstanceTree(),i=t?t.getRootId():null,n="number"==typeof e&&e===i||"object"==typeof e&&e.dbId===i;e&&!n?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},n.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0);var e={type:t.ISOLATE_EVENT,nodeIdArray:[],model:this.model};this.viewerImpl.api.fireEvent(e)},n.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];for(var i=0;i<e.length;i++)this.setVisibilityOnNode(e[i],!0);var n={type:t.ISOLATE_EVENT,nodeIdArray:e,model:this.model};this.viewerImpl.api.fireEvent(n)}else this.isolateNone();this.viewerImpl.invalidate(!0)},n.prototype.hide=function(e){var i;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!1);e.length>0&&(i={type:t.HIDE_EVENT,nodeIdArray:e})}else this.setVisibilityOnNode(e,!1),i={type:t.HIDE_EVENT,nodeIdArray:[e]};i&&this.viewerImpl.api.fireEvent(i)},n.prototype.show=function(e){var i;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!0);e.length>0&&(i={type:t.SHOW_EVENT,nodeIdArray:e})}else this.setVisibilityOnNode(e,!0),i={type:t.SHOW_EVENT,nodeIdArray:[e]};i&&this.viewerImpl.api.fireEvent(i)},n.prototype.toggleVisibility=function(e){var i=this.getInstanceTree().isNodeHidden(e);this.setVisibilityOnNode(e,i);var n={type:i?t.SHOW_EVENT:t.HIDE_EVENT,nodeIdArray:[e]};this.viewerImpl.api.fireEvent(n)},n.prototype.setVisibilityOnNode=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getInstanceTree(),r=!t,s=n.getData().is2d;this.viewerImpl.matman();o?o.enumNodeChildren(e,function(e){o.setNodeHidden(e,r),s?n.getFragmentList().setObject2DGhosted(e,!t):o.enumNodeFragments(e,function(e){n.setVisibility(e,t)},!1)},!0):s?n.getFragmentList().setObject2DGhosted(e,!t):n.setVisibility(e,t),i.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t)},n.prototype.updateNodeVisibilityTracking=function(e,t){var i=t;if(this.isolatedNodes.length>0){var n=this.isolatedNodes.indexOf(e);i&&n===-1?this.isolatedNodes.push(e):i||n===-1||this.isolatedNodes.splice(n,1)}else{var o=this.hiddenNodes.indexOf(e);i||o!==-1?i&&o!==-1&&this.hiddenNodes.splice(o,1):this.hiddenNodes.push(e)}var r=this.getInstanceTree();r&&r.root&&r.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},n.prototype.setNodeOff=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getInstanceTree(),r=n.getData().is2d;o?o.enumNodeChildren(e,function(e){o.setNodeOff(e,t),r?n.getFragmentList().setObject2DVisible(e,!t):o.enumNodeFragments(e,function(e){n.getFragmentList().setFragOff(e,t)},!1)},!0):r?n.getFragmentList().setObject2DVisible(e,!t):n.getFragmentList().setFragOff(e,t),i.sceneUpdated(!0)},t.Private.VisibilityManager=n,e.prototype.addModel=function(e){this.models.indexOf(e)==-1&&(e.visibilityManager=new n(this.viewer,e),this.models.push(e))},e.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},e.prototype.warn=function(){this.models.length>1&&i.logger.warn("This selection call does not yet support multiple models.")},e.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},e.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},e.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},e.prototype.isolate=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.isolate(e)},e.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},e.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},e.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},e.prototype.setVisibilityOnNode=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t)},e.prototype.setNodeOff=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t)},t.Private.MultiModelVisibilityManager=e}(),function(){"use strict";function e(){}var t=AutodeskNamespace("Autodesk.Viewing.Private"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");i.DomDispatcher=e,e.prototype={constructor:e,apply:function(t){t.hookEvent=e.prototype.hookEvent,t.unhookEvents=e.prototype.unhookEvents,t.eventsHooked=[]},hookEvent:function(e,i,n,o){var r=function(e){var i=t.DomUtils.seekSelectorUp(e.target,n);i&&o(e,i)};e.addEventListener(i,r),this.eventsHooked.push({domElem:e,eventStr:i,callback:r})},unhookEvents:function(){this.eventsHooked.forEach(function(e){e.domElem.removeEventListener(e.eventStr,e.callback)}),this.eventsHooked.length=0}},i.seekSelectorUp=function(e,i){for(;e;){if(t.DomUtils.matchesSelector(e,i))return e;e=e.parentNode}return e},i.matchesSelector=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)},i.removeChildren=function(e){e.innerHTML=""},i.remove=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,LMV_WORKER_URL=avp.LMV_WORKER_URL||"src/workers/MainWorker-web.js",ENABLE_INLINE_WORKER=avp.ENABLE_INLINE_WORKER||!1;!function(){"use strict";var e=null,t=!1,i=[];avp.initWorkerScript=function(n,o){if(ENABLE_INLINE_WORKER&&!e){if(i.push({successCB:n}),t)return;var r=new XMLHttpRequest,s=LMV_WORKER_URL,a=avp.getResourceUrl(LMV_WORKER_URL);a&&(s=a),r.open("GET",s,!0),r.withCredentials=!1,r.onload=function(){t=!1;var n;window.URL=window.URL||window.webkitURL;try{n=new Blob([r.responseText],{type:"application/javascript"})}catch(e){n=new BlobBuilder,n.append(r.responseText),n=n.getBlob()}e=URL.createObjectURL(n);var o=i.concat();i=[];for(var s=0;s<o.length;++s)o[s].successCB&&o[s].successCB()},t=!0,r.send()}else n&&n()},avp.createWorker=function(){var t;return t=ENABLE_INLINE_WORKER?new Worker(e):new Worker(avp.getResourceUrl(LMV_WORKER_URL)),t.doOperation=t.postMessage,t},avp.createWorkerWithIntercept=function(){function e(e){if(!i)return null;for(var t=0;t<i.length;++t)if(i[t].arg===e){var n=i[t].callback;return i.splice(t,1),0===i.length&&(i=null),n}return null}var t=avp.createWorker();t.checkEvent=function(e){return!(!e.data||!e.data.assetRequest)&&(avp.assets&&avp.assets.push(e.data.assetRequest),!0)};var i=[];return t.addEventListenerWithIntercept=function(e){var n=function(i){t.checkEvent(i)||e(i)};return i||(i=[]),i.push({arg:e,callback:n}),t.addEventListener("message",n,!1),n},t.removeEventListenerWithIntercept=function(i){var n=e(i);n&&t.removeEventListener("message",n,!1)},t.clearAllEventListenerWithIntercept=function(){if(i)for(var e=i.concat(),n=0;n<e.length;++n)t.removeEventListenerWithIntercept(e[n].arg)},t}}(),function(){"use strict";function e(e){var t=e.data;if(t&&t.debug)return void n.logger.debug(t.message);if(t.cbId){var i=h[t.cbId];t&&t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete h[t.cbId]}}function t(e,t){var i=u++;return h[i]=[e,t],i}var i=Autodesk.Viewing,n=i.Private,o="GET_PROPERTIES",r="SEARCH_PROPERTIES",s="BUILD_EXTERNAL_ID_MAPPING",a="GET_OBJECT_TREE",l=function(e,t,n){this.sharedDbPath=e,this.propWorker=null,this.eventTarget=n||new i.EventDispatcher,this.model=t,this.svf=t&&t.getData();var o=i.getUseCredentials()&&!i.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"";this.queryParam=o,this.svf&&this.svf.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.svf.acmSessionId)};l.prototype.dtor=function(){this.propWorker&&!this.sharedDbPath&&(this.propWorker.clearAllEventListenerWithIntercept(),this.propWorker.terminate(),this.propWorker=null)};var c={},u=1,h={};l.prototype.processLoadResult=function(e){var t=this;if(e.instanceTreeStorage){var o=new n.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);t.instanceTree=new n.InstanceTree(o,e.objectCount,e.maxTreeDepth),t.svf&&(t.svf.instanceTree=t.instanceTree)}else e.instanceTree?(n.logger.warn("glTF instance tree not supported"),t.hasObjectProperties=e.objectCount):e.objectCount&&(t.hasObjectProperties=e.objectCount,t.svf&&(t.svf.hasObjectProperties=e.objectCount));t.eventTarget.fireEvent({type:i.OBJECT_TREE_CREATED_EVENT,svf:t.svf,model:t.model,target:t})},l.prototype.processLoadError=function(e){var t=this;t.propertyDbError=e,t.eventTarget.fireEvent({type:i.OBJECT_TREE_UNAVAILABLE_EVENT,svf:t.svf,model:t.model,target:t})},l.prototype.load=function(){var i=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)return void setTimeout(function(){i.processLoadResult(i.svf)},0);var o=function(e){i.processLoadResult(e);var t=!!i.sharedDbPath,n=t&&c[i.sharedDbPath];if(n&&n.waitingLoaders){for(var o=0;o<n.waitingLoaders.length;o++)n.waitingLoaders[o].processLoadResult(e);n.waitingLoaders=null,n.workerResult=e}},r=function(e){i.processLoadError(e);var t=!!i.sharedDbPath,n=t&&c[i.sharedDbPath];if(n&&n.waitingLoaders){for(var o=0;o<n.waitingLoaders.length;o++)n.waitingLoaders[o].processLoadError(e);n.waitingLoaders=null,n.workerError=e}},s=!!this.sharedDbPath,l=s&&c[this.sharedDbPath];l?(n.logger.log("Using cached property worker for ",this.sharedDbPath),this.propWorker=l):(this.propWorker=n.createWorkerWithIntercept(),this.propWorker.addEventListenerWithIntercept(e),s&&(c[this.sharedDbPath]=this.propWorker));var u,h=t(o,r);this.svf&&this.svf.propertydb.values.length?u=n.pathToURL(this.svf.basePath):(u=this.sharedDbPath,n.logger.log("Using shared property db: "+u));var d={operation:a,url:u,propertydb:this.svf&&this.svf.propertydb||{attrs:[],avs:[],ids:[],values:[],offsets:[]},fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:this.svf&&this.svf.fragments.boxes,cbId:h,queryParams:this.queryParam};this.propWorker.doOperation(n.initLoadContext(d))},l.prototype.asyncPropertyOperation=function(e,n,o){var r=this;if(r.instanceTree||r.hasObjectProperties)e.cbId=t(n,o),this.propWorker.doOperation(e);else if(r.propertyDbError)o&&o(r.propertyDbError);else{var s=function(t){r.eventTarget.removeEventListener(i.OBJECT_TREE_CREATED_EVENT,s),r.eventTarget.removeEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,s),r.instanceTree||r.hasObjectProperties||r.propertyDbError?r.asyncPropertyOperation(e,n,o):o&&o({code:i.UNKNOWN_FAILURE,msg:"Failed to load properties"})};r.eventTarget.addEventListener(i.OBJECT_TREE_CREATED_EVENT,s),r.eventTarget.addEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,s)}},l.prototype.getProperties=function(e,t,i){this.asyncPropertyOperation({operation:o,dbId:e},t,i)},l.prototype.getBulkProperties=function(e,t,i,n){this.asyncPropertyOperation({operation:o,dbIds:e,propFilter:t},i,n)},l.prototype.searchProperties=function(e,t,i,n,o){this.asyncPropertyOperation({operation:r,searchText:e,attributeNames:t,completeInfo:o},i,n)},l.prototype.getExternalIdMapping=function(e,t){this.asyncPropertyOperation({operation:s},e,t)},l.prototype.getObjectTree=function(e,t){var n=this;if(n.instanceTree)e(n.instanceTree);else if(n.propertyDbError||"hasObjectProperties"in n)t&&t(n.propertyDbError);else{var o=function(){n.eventTarget.removeEventListener(i.OBJECT_TREE_CREATED_EVENT,o),n.eventTarget.removeEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,o),n.getObjectTree(e,t)};n.eventTarget.addEventListener(i.OBJECT_TREE_CREATED_EVENT,o),n.eventTarget.addEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,o)}},n.PropDbLoader=l}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=e.isNodeJS?10:e.isMobileDevice()?2:6,n="LOAD_GEOMETRY",o="LOAD_SVF",r="LOAD_SVF_CONTD",s=function(i){this.viewer3DImpl=i,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.tmpMatrix=new THREE.Matrix4,this.tmpBox=new THREE.Box3,this.logger=t.logger,this.loadTime=0,this.domainParam=e.getUseCredentials()&&!e.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""};s.prototype.dtor=function(){if(this.svf=null,this.options=null,this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null}},t.pathToURL=function(e){if(e.indexOf("://")!==-1||0===e.indexOf("urn:"))return e;if("undefined"==typeof window)return e;var t=window.location.pathname,i=t.lastIndexOf("/");t=t.substr(0,i+1);var n=window.location.protocol+"//"+window.location.host+t+e;return n},s.prototype.loadFile=function(e,i,n,o,r){if(this.loading)return t.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.dtor();var s=e.indexOf("urn:");if(s!=-1){e=decodeURIComponent(e);var a=e.substr(s,e.substr(s).indexOf("/"));t.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=i.sharedPropertyDbPath,this.currentLoadPath=e;var c=this.currentLoadPath.lastIndexOf("/");c!=-1&&(this.basePath=this.currentLoadPath.substr(0,c+1)),this.acmSessionId=i.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=i;var u=this;return t.initWorkerScript(function(){u.loadSvfCB(e,i,n,o,r)}),!0},s.prototype.interceptManifest=void 0,s.prototype.loadSvfCB=function(n,s,a,l,c){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null;var u=!0,h=this,d={url:t.pathToURL(n),basePath:this.currentLoadPath,objectIds:s.ids,globalOffset:s.globalOffset,placementTransform:s.placementTransform,applyRefPoint:s.applyRefPoint,queryParams:this.queryParam,bvhOptions:s.bvhOptions||{isWeakDevice:e.isMobileDevice()},applyScaling:s.applyScaling};t.memoryOptimizedSvfLoading&&(d.perfOpt={memoryOptimizedSvfLoading:t.memoryOptimizedSvfLoading,forceMemoryOptimizedMode:t.forceMemoryOptimizedModeOnSvfLoading}),s.useConsolidation&&!s.bvhOptions&&(d.bvhOptions.frags_per_leaf_node=256,d.bvhOptions.max_polys_per_node=5e4);var p=this.svfWorker=t.createWorkerWithIntercept(),v=function(n){var o=function(){p.clearAllEventListenerWithIntercept(),p.terminate(),h.svfWorker=null,p=null};if(u&&c&&(u=!1,c()),n.data&&n.data.manifest)h.interceptManifest(n.data.manifest),d.operation=r,d.manifest=n.data.manifest,p.doOperation(d);else if(n.data&&n.data.svf){var s=h.svf=n.data.svf;h.failedToLoadSomeGeometryPacks&&(l&&l(h.failedToLoadSomeGeometryPacks.code,h.failedToLoadSomeGeometryPacks.msg),h.failedToLoadSomeGeometryPacks=null),h.onModelRootLoadDone(s),a&&a(h.model),h.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:s,model:h.model}),h.svf.loadDone=!1;var v=!1;if(h.svf.metadata&&h.svf.metadata.gltf&&(v=!0),!v){var g=s.geompacks.length;if(0==g)h.onGeomLoadDone();else if(h.model.getFragmentList().onDemandLoadingEnabled())t.logger.debug("[On Demand Loading]: Enabled."),h.loadedPacksCount=0;else if(g)for(var m=Math.min(g,i),f=0;f<m;f++){var E=s.geompacks[h.next_pack++];E.loading=!0,e.isNodeJS?h.loadGeometryPack(E.id,E.uri):!function(e){setTimeout(function(){h.loadGeometryPack(e.id,e.uri)},200*f)}(E)}}1==n.data.progress&&(h.loading=!1,o()),s.fragments.polygonCounts||(s.fragments.polygonCounts=new Int32Array(s.fragments.length)),n.data.bvh&&(h.svf.bvh=n.data.bvh,h.model.setBVH(new t.NodeArray(h.svf.bvh.nodes,h.svf.bvh.useLeanNodes),h.svf.bvh.primitives,h.options.bvhOptions),h.viewer3DImpl.invalidate(!1,!0))}else n.data&&n.data.bvh?(h.svf.bvh||(h.svf.bvh=n.data.bvh,h.model.setBVH(new t.NodeArray(h.svf.bvh.nodes,h.svf.bvh.useLeanNodes),h.svf.bvh.primitives,h.options.bvhOptions),h.viewer3DImpl.invalidate(!1,!0)),h.loading=!1,o()):n.data&&n.data.mesh?(h.processReceivedMesh(n.data),1===n.data.progress&&(h.onGeomLoadDone(),h.loading=!1,o())):n.data&&n.data.progress?1==n.data.progress&&(h.loading=!1,o()):n.data&&n.data.error?(h.loading=!1,o(),l&&l(n.data.error.code,n.data.error.msg,n.data.error.args.httpStatus,n.data.error.args.httpStatusText)):n.data&&n.data.debug?t.logger.debug(n.data.message):(t.logger.error("SVF download failed."),h.loading=!1,o())};return p.addEventListenerWithIntercept(v),d.operation=o,d.interceptManifest=!!this.interceptManifest,p.doOperation(t.initLoadContext(d)),!0},s.prototype.loadGeometryPackOnDemand=function(e){var o=this,r=o.svf.geompacks[e];if(!r.loading){this.t0||(this.t0=(new Date).getTime());var s,a=function(e){if(e.data&&e.data.meshes){for(var i=e.data.meshes,n={packId:e.data.packId,meshIndex:0,mesh:null},r=0;r<i.length;r++){var s=i[r];s&&(n.meshIndex=r,n.mesh=s,o.processReceivedMesh(n))}if(e.data.progress>=1){o.pack_workers[e.data.workerId].queued-=1,o.svf.geompacks[e.data.packId].loading=!1;var a=o.model.geomPacksMissingLastFrame(),l=a.indexOf(e.data.packId);l>=0&&a.splice(l,1);for(var c=!0,u=0;u<o.pack_workers.length;u++)if(0!=o.pack_workers[u].queued){c=!1;break}o.loadedPacks.indexOf(e.data.packId)==-1&&o.loadedPacks.push(e.data.packId),c&&0==o.model.geomPacksMissingLastFrame().length&&o.onDemandGeomLoadDone()}}else if(e.data&&e.data.progress){o.pack_workers[e.data.workerId].queued-=1,o.loadedPacksCount++;var h,d=null,a=o.model.geomPacksMissingLastFrame();for(r=0;r<a.length&&(h=a[r],d=o.svf.geompacks[h],d.loading);++r);d&&!d.loading&&o.loadGeometryPackOnDemand(h),o.viewer3DImpl.signalProgress(100*o.loadedPacks.length/o.svf.geompacks.length)}else e.data&&e.data.debug?t.logger.debug(e.data.message):e.data&&e.data.error?o.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}:(o.pack_workers[e.data.workerId].queued-=2,o.svf.geompacks[e.data.packId].loading=!1)};if(!this.pack_workers)for(this.pack_workers=[],
s=0;s<i;s++){var l=t.createWorkerWithIntercept();l.addEventListenerWithIntercept(a),l.queued=0,this.pack_workers.push(l)}var c=0,u=this.pack_workers[0].queued;for(s=1;s<i;s++)this.pack_workers[s].queued<u&&(c=s,u=this.pack_workers[s].queued);if(u>2)return void(this.model.addGeomPackMissingLastFrame(e)||this.viewer3DImpl.invalidate(!1,!0));var h,d,p=r.uri;h=this.pack_workers[c],h.queued+=2,d=c,r.loading=!0,o.svf.partPacksLoadDone=!1,t.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+e);var v=t.pathToURL(this.svf.basePath+p),g={operation:n,url:v,packId:parseInt(e),workerId:d,skipAssetCallback:!0,queryParams:this.queryParam};h.doOperation(t.initLoadContext(g))}},s.prototype.loadGeometryPack=function(e,o){var r,s,a,l,c=this;if(this.svf){var u=function(e){if(e.data&&e.data.meshes){for(var i=e.data.meshes,n={packId:e.data.packId,meshIndex:0,mesh:null},o=0;o<i.length;o++){var r=i[o];r&&(n.meshIndex=o,n.mesh=r,c.processReceivedMesh(n))}if(e.data.progress>=1){c.pack_workers[e.data.workerId].queued-=1,c.loadedPacksCount++,c.viewer3DImpl.signalProgress(100*c.loadedPacksCount/c.svf.geompacks.length);var s=!0;for(l=0;l<c.pack_workers.length;l++)if(0!=c.pack_workers[l].queued){s=!1;break}if(s){for(l=0;l<c.pack_workers.length;l++)c.pack_workers[l].clearAllEventListenerWithIntercept(),c.pack_workers[l].terminate();c.pack_workers=null}c.svf.fragments.numLoaded==c.svf.fragments.length&&c.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(c.pack_workers[e.data.workerId].queued-=1,c.next_pack<c.svf.geompacks.length){var a=null,u=c.model.geomPacksMissingLastFrame();for(o=0;o<u.length&&(a=c.svf.geompacks[u[o]],!a||a.loading);++o);if(!a||a.loading)for(;c.next_pack<c.svf.geompacks.length&&(a=c.svf.geompacks[c.next_pack++],a.loading););a&&!a.loading?(a.loading=!0,c.loadGeometryPack(a.id,a.uri)):(c.viewer3DImpl.modelQueue().enforceBvh=!1,c.svf.fragments.packIds=null)}}else e.data&&e.data.debug?t.logger.debug(e.data.message):e.data&&e.data.error?c.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}:c.pack_workers[e.data.workerId].queued-=2},h=this.pack_workers;if(h||(h=this.pack_workers=[]),h.length<i){for(var d=!0,a=0;a<h.length;a++)if(0===h.queued){d=!1;break}if(d){var p=t.createWorkerWithIntercept();p.addEventListenerWithIntercept(u),p.queued=0,h.push(p)}}var v=0,g=h[0].queued;for(a=1;a<h.length;a++)h[a].queued<g&&(v=a,g=h[a].queued);r=h[v],r.queued+=2,s=v;var m=t.pathToURL(this.svf.basePath+o),f={operation:n,url:m,packId:parseInt(e),workerId:s,queryParams:this.queryParam};r.doOperation(t.initLoadContext(f))}},s.prototype.checkCull=function(e,t,i){var n=this.tmpBox;if(e.getWorldBounds(t,n),!i.intersectsBox(n))return!0;var o=i.projectedArea(n);return o*=i.areaConv,o<i.areaCullThreshold},s.prototype.processReceivedMesh=function(e){var i=e.packId+":"+e.meshIndex,n=this.svf,o=n.fragments,r=this.model,s=o.mesh2frag[i];if(void 0===s)return void t.logger.warn("Mesh "+i+" was not referenced by any fragments.");Array.isArray(s)||(s=[s]),t.BufferGeometryUtils.meshToGeometry(e);var a=s.length,l=r.getFragmentList().getGeometryId(s[0]),c=r.getGeometryList().addGeometry(e.geometry,a,l);r.getFragmentList().onDemandLoadingEnabled()&&a>1&&null==r.getFragmentList().geomidsmap[c]&&(r.getFragmentList().geomidsmap[c]={n:a,t:0});for(var u=e.geometry.attributes.index.array||e.geometry.ib,h=u.length/3,d=0;d<s.length;d++){var p=0|s[d];r.getFragmentList().getOriginalWorldMatrix(p,this.tmpMatrix);var v=o.materials[p].toString();o.polygonCounts&&(o.polygonCounts[p]=h);var g=this.viewer3DImpl.setupMesh(this.model,e.geometry,v,this.tmpMatrix);r.activateFragment(p,g,!!n.placementTransform)}this.model.getFragmentList().onDemandLoadingEnabled()||(o.mesh2frag[i]=null),o.numLoaded+=s.length,n.geomPolyCount>n.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0))},s.prototype.onModelRootLoadDone=function(i){i.geomPolyCount=0,i.instancePolyCount=0,i.geomMemory=0,i.fragments.numLoaded=0,i.meshCount=0,i.gpuNumMeshes=0,i.gpuMeshMemory=0,i.nextRepaintPolys=0,i.numRepaints=0,i.urn=this.svfUrn,i.acmSessionId=this.acmSessionId,i.basePath=this.basePath,i.loadOptions=this.options;var n=Date.now();this.loadTime+=n-this.t0,t.logger.log("SVF load: "+(n-this.t0));var o=this.model=new e.Model(i);o.loader=this;var r=this.viewer3DImpl.api.config?this.viewer3DImpl.api.config.memPerfOpts||{}:{};this.viewer3DImpl.modelQueue().getModels().length>0&&(r.pageOutGeometryEnabled=!1),o.initialize({fragsPersistentCont:r.fragsPersistentCont>0?r.fragsPersistentCont:t.FRAGS_PERSISTENT_COUNT,fragsPersistentMaxCount:r.fragsPersistentMaxCount>0?r.fragsPersistentMaxCount:t.FRAGS_PERSISTENT_MAX_COUNT,geomCountLimit:r.geomCountLimit>0?r.geomCountLimit:t.GEOMS_COUNT_LIMIT,pageOutPercentage:r.pageOutPercentage>0&&r.pageOutPercentage<1?r.pageOutPercentage:t.PAGEOUT_PERCENTAGE,maxQueuedGeomPFForLoading:r.maxQueuedGeomPFForLoading>0?r.maxQueuedGeomPFForLoading:WGS.MAX_QUEUED_GEOM_PF_FOR_LOADING,pixelCullingEnable:void 0!==r.pixelCullingEnable?r.pixelCullingEnable:WGS.pixelCullingEnable,pixelCullingThreshold:r.pixelCullingThreshold>0?r.pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,onDemandLoading:void 0!==r.onDemandLoading?r.onDemandLoading:t.onDemandLoading,pageOutGeometryEnabled:void 0!==r.pageOutGeometryEnabled?r.pageOutGeometryEnabled:t.pageOutGeometryEnabled,forceOnDemandLoading:void 0!==r.forceOnDemandLoading?r.forceOnDemandLoading:WGS.forceOnDemandLoading,requestGeometryCallback:this.loadGeometryPackOnDemand.bind(this)});var s=!(this.model.getFragmentList().onDemandLoadingEnabled()&&e.isMobileDevice());s&&!this.options.skipPropertyDb&&this.loadPropertyDb();var a=this.viewer3DImpl.matman().convertMaterials(i);if(this.t0=n,i.bbox=(new THREE.Box3).copy(i.bbox),i.modelBox&&(i.modelBox=(new THREE.Box3).copy(i.modelBox)),i.refPointTransform&&(i.refPointTransform=new LmvMatrix4(!0).copy(i.refPointTransform)),i.placementTransform&&(i.placementTransform=new LmvMatrix4(!0).copy(i.placementTransform)),i.cameras)for(var l=0;l<i.cameras.length;l++){var c=i.cameras[l];c.position=(new THREE.Vector3).copy(c.position),c.target=(new THREE.Vector3).copy(c.target),c.up=(new THREE.Vector3).copy(c.up)}i.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(i),t.logger.log("scene bounds: "+JSON.stringify(i.bbox));var u={category:"metadata_load_stats",urn:i.urn,has_topology:!!i.topology,has_animations:!!i.animations,cameras:i.cameras?i.cameras.length:0,lights:i.lights?i.lights.length:0,materials:a};t.logger.track(u),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!1)},s.prototype.addTransparencyFlagsToMaterials=function(e){for(var t in e){var i=e[t],n=i.userassets;if(n){var o=i.materials,r=o[n[0]];i.transparent=r.transparent}}},s.prototype.makeBVH=function(i){var n=performance.now(),o=i.materials?i.materials.materials:null;o&&this.addTransparencyFlagsToMaterials(o),i.bvh=new t.BVHBuilder(i.fragments,o),i.bvh.build(this.options.bvhOptions||{isWeakDevice:e.isMobileDevice()});var r=performance.now();t.logger.log("BVH build time: "+(r-n))},s.prototype.onDemandGeomLoadDone=function(){!this.svf.proteinMaterials||!PROTEIN_ROOT||!PRISM_ROOT;var e=Date.now(),i="[On Demand Loading]: On demand requested geometries load time: "+(e-this.t0);this.t0=null,t.logger.log(i);var n={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:e-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};t.logger.track(n,!0),this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.onDemandLoadComplete(this.model)},s.prototype.onGeomLoadDone=function(){function i(t){var i={command:"assets",data:t};e.isBrowser&&window.webkit.messageHandlers.callbackHandler.postMessage(i)}this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||this.viewer3DImpl.matman().loadTextures(this.svf),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var n=Date.now(),o="Fragments load time: "+(n-this.t0);this.loadTime+=n-this.t0;var r=this.firstPixelTimestamp-this.t0;if(o+=" (first pixel time: "+r+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),t.logger.log(o),this.options.useConsolidation){var s=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,s)}var a={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};r>0&&(a.first_pixel_time=r),t.logger.track(a,!0),t.assets&&e.isBrowser&&window.webkit&&(i(t.assets),t.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},s.prototype.loadPropertyDb=function(){this.svf.propWorker=new t.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propWorker.load()},t.SvfLoader=s,e.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],t.SvfLoader)}(),function(){"use strict";function e(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=i.logger,this.loadTime=0,this.domainParam=t.getUseCredentials()&&!t.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""}var t=Autodesk.Viewing,i=t.Private,n="PARSE_F2D",o="STREAM_F2D",r="PARSE_F2D_FRAME";e.prototype.dtor=function(){this.svf=null,this.options=null,this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null)},e.prototype.loadFile=function(e,t,n,o,r){if(this.loading)return i.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.dtor();var s=e.indexOf("urn:");if(s!=-1){e=decodeURIComponent(e);var a=e.substr(s,e.substr(s).indexOf("/"));i.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var c=this;return i.initWorkerScript(function(){c.loadFydoCB(e,t,n,o,r)}),!0},e.prototype.loadFydoCB=function(e,s,a,l,c){this.t0=Date.now();var u=i.pathToURL(e),h=this.streamingWorker=i.createWorker(),d=this.parsingWorker=i.createWorker(),p=this,v=!0,g=function(e){if(v&&c&&(v=!1,c()),e.data&&"F2DBLOB"==e.data.type){var o={operation:n,data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:s.modelSpace,bgColor:s.bgColor,isMobile:t.isMobileDevice()},url:u};d.doOperation(o,[o.data]),h.terminate()}else if(e.data&&"F2DSTREAM"==e.data.type){var o={operation:r,data:e.data.frames,url:u,f2dLoadOptions:{modelSpace:s.modelSpace,bgColor:s.bgColor,isMobile:t.isMobileDevice()}};e.data.metadata&&(o.metadata=e.data.metadata,o.manifest=e.data.manifest),e.data.finalFrame&&(o.finalFrame=!0),e.data.progress&&p.viewer3DImpl.signalProgress(100*e.data.progress),d.doOperation(o,o.data?[o.data]:void 0),e.data.finalFrame&&h.terminate()}else e.data&&"F2DAssetURL"==e.data.type?i.assets=i.assets.concat(e.data.urls):e.data&&e.data.assetRequest?i.assets.push(e.data.assetRequest):e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(p.loading=!1,h.terminate(),l&&l.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed."),p.loading=!1,h.terminate()))},m=function(e){if(v&&c&&(v=!1,c()),e.data&&e.data.f2d){var n=p.svf=e.data.f2d;d.terminate(),i.logger.info("Num polylines: "+n.numPolylines),i.logger.info("Line segments: "+n.numLineSegs),i.logger.info("Circular arcs: "+n.numCircles),i.logger.info("Ellipitcal arcs:"+n.numEllipses),i.logger.info("Plain triangles:"+n.numTriangles),i.logger.info("Total # of op codes generated by fydo.parse: "+n.opCount),p.onModelRootLoadDone(p.svf),a&&a(p.model),p.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:p.svf,model:p.model});for(var o=0;o<n.meshes.length;o++)p.processReceivedMesh2D(n.meshes[o],o);n.meshes=null,p.onGeomLoadDone(),p.loading=!1}else if(e.data&&e.data.f2dframe){var r=0;if(e.data.meshes){var s=e.data.bbox;p.svf.bbox=new THREE.Box3(s.min,s.max),r=e.data.baseIndex}else p.svf=e.data.f2dframe,r=e.data.baseIndex;var n=p.svf;if(n.fragments&&n.fragments.initialized||(p.onModelRootLoadDone(n),a&&a(p.model),p.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:n,model:p.model})),e.data.meshes&&e.data.meshes.length)for(var o=0;o<e.data.meshes.length;o++)p.processReceivedMesh2D(e.data.meshes[o],r+o);if(e.data.finalFrame){var u=e.data.cumulativeProps;for(var h in u)n[h]=u[h];p.onGeomLoadDone(),p.loading=!1,d.terminate()}}else e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(p.loading=!1,d.terminate(),i.logger.error("Error while parsing F2d: "+JSON.stringify(e.data.error.args)),l&&l.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed."),p.loading=!1,d.terminate()))};h.addEventListener("message",g,!1),d.addEventListener("message",m,!1);var f={operation:o,url:u,objectIds:s.ids,queryParams:this.queryParam};return h.doOperation(i.initLoadContext(f)),!0},e.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf,o=n.fragments,r=o.mesh2frag[t];if(void 0===r)return void i.logger.warn("Mesh "+t+" was not referenced by any fragments.");Array.isArray(r)||(r=[r]),i.BufferGeometryUtils.meshToGeometry(e);for(var s=r.length,a=this.model,l=(a.getGeometryList().addGeometry(e.geometry,s),e.geometry.attributes.index.array||e.geometry.ib),c=l.length/3,u=0;u<r.length;u++){var h=0|r[u];a.getFragmentList().getOriginalWorldMatrix(h,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var d=o.materials[h].toString();o.polygonCounts&&(o.polygonCounts[h]=c);var p=this.viewer3DImpl.setupMesh(this.model,e.geometry,d,this.tmpMatrix);a.activateFragment(h,p)}o.mesh2frag[t]=null,o.numLoaded+=r.length;o.numLoaded},e.prototype.processReceivedMesh2D=function(e,t){var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},n="0:"+t,o=this.svf.fragments,r=Object.keys(i.mesh.dbIds).map(function(e){return parseInt(e)});o.fragId2dbId[t]=r;for(var s=0;s<r.length;s++){var a=r[s],l=o.dbId2fragId[a];Array.isArray(l)?l.push(t):"undefined"!=typeof l?o.dbId2fragId[a]=[l,t]:o.dbId2fragId[a]=t}o.mesh2frag[n]=t,e.material.modelScale=this.modelScale,o.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.svf,e.material),o.length++,this.processReceivedMesh(i)},e.prototype.onModelRootLoadDone=function(e){e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId=[],e.fragments.length=0,e.fragments.initialized=!0,e.geomPolyCount=0,e.instancePolyCount=0,e.geomMemory=0,e.fragments.numLoaded=0,e.meshCount=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var n=this.currentLoadPath.lastIndexOf("/");n!=-1&&(e.basePath=this.currentLoadPath.substr(0,n+1)),e.loadOptions=this.options;var o=Date.now();this.loadTime+=o-this.t0,i.logger.log("SVF load: "+(o-this.t0)),this.t0=o,e.bbox=(new THREE.Box3).copy(e.bbox);var r=this.model=new t.Model(e);r.initialize(this),r.loader=this,this.svf.propWorker=new i.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),i.logger.log("scene bounds: "+JSON.stringify(e.bbox));var s={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};i.logger.track(s),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!1)},e.prototype.onGeomLoadDone=function(){function e(e){if(t.isBrowser){var i=window.webkit.messageHandlers.callbackHandler,n=i.doOperation||i.postMessage;n&&n({command:"assets",data:e})}}this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var n=Date.now(),o="Fragments load time: "+(n-this.t0);this.loadTime+=n-this.t0,this.options.skipPropertyDb||this.loadPropertyDb(),i.logger.log(o);var r={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};i.logger.track(r,!0),i.assets&&t.isBrowser&&window.webkit&&(e(i.assets),i.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},e.prototype.loadPropertyDb=function(){this.svf.propWorker.load()},i.F2DLoader=e,t.FileLoaderManager.registerFileLoader("f2d",["f2d"],i.F2DLoader)}(),function(){"use strict";function e(e){var n=e;this.loadFile=function(e,o,r,s,a){function l(){function n(t){this.bbox=new THREE.Box3,this.basePath=e,this.is2d=!0;var i=t&&t.paperWidth>=0?t.paperWidth:u.texWidth,n=t&&t.paperHeight>=0?t.paperHeight:u.texHeight;this.pageToModelTransform=u.getPageToModelTransform(i,n),this.metadata=new Object,this.metadata.page_dimensions=new Object;var o=this.metadata.page_dimensions;o.page_width=i,o.page_height=n,o.page_units=t.paperUnits,this.loadDone=!0,this.isLeaflet=!0,u.texWidth>0&&(this.maxPixelPerUnit=u.texWidth/u.getQuadWidth())}var s=new n(o.loadOptions);s.loadOptions=o,h.getVisibleBounds(s.bbox);var a=new t.Model(s);a.initFromCustomIterator(h),h.callWhenRefined(function(){var e=Date.now();s.loadTime=e-c,i.logger.log("SVF load: "+s.loadTime)}.bind(this)),r(a)}var c=Date.now(),u=new i.TexQuadConfig;u.initFromLoadOptions(e,o.loadOptions,function(e,t,n){i.loadTextureWithSecurity(e,THREE.UVMapping,t,o.acmSessionId)});var h=null;a&&a();var d=!u.valid();d&&u.initForSimpleImage(e,l),h=new i.ModelIteratorTexQuad(u,n.getMaterials()),d||l()}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private;e.computeLevelOffset=function(e){for(var t=20,n=1,o=0,r=0;r<t;r++){if(n*=2,n>e)return o;o++}return i.logger.log("unexpected leaflet tileSize"),0},Autodesk.Viewing.Private.LeafletLoader=e,Autodesk.Viewing.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],i.LeafletLoader)}(),function(){"use strict";function e(e,t){var i=t||65536;this.FULL_COUNT=i/2-1|0,this.useInstancing=e,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?i/4:i)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vcount=0,this.ib=this.useInstancing?null:new Uint16Array(i),this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-(1/0),this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0}var t=Autodesk.Viewing,i=t.Private,n=2*Math.PI,o=0,r=1,s=2,a=3,l=4,c=5,u=0,h=1,d=2,p=3,v=6,g=7,m=8,f=9,E=[0,1,3,0,3,2];e.prototype.expandStride=function(){},e.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},e.prototype.setCommonVertexAttribs=function(e,t,i,n,o,r,s,a){t&=255,i&=255,a&=255,r&=65535,s&=65535,this.vbi[e+m]=t|i<<8|a<<16,this.vbi[e+v]=n,this.vbi[e+g]=o,this.vbi[e+f]=r|s<<16,this.dbIds[o]=1},e.prototype.addVertexTriangleGeom=function(e,t,i,n,o,r,s,a,l,h){for(var d=this.vcount,p=this.vbf,v=this.useInstancing?1:4,g=0;g<v;g++){var m=(d+g)*this.stride;p[m]=e,p[m+1]=t,p[m+2]=i,p[m+3]=n,p[m+4]=o,p[m+5]=r,this.setCommonVertexAttribs(m,u+g,c,s,a,l,h,0),this.vcount++}return d},e.prototype.addVertexLine=function(e,t,i,n,o,s,a,l,c,h,d){for(var p=this.vcount,v=this.vbf,g=this.useInstancing?1:4,m=0;m<g;m++){var f=(p+m)*this.stride;v[f]=e,v[f+1]=t,v[f+2]=i,v[f+3]=n,v[f+4]=.5*s,v[f+5]=o,this.setCommonVertexAttribs(f,u+m,r,a,l,c,h,d),this.vcount++}return p},e.prototype.addVertexTexQuad=function(e,t,i,n,o,r,s,a,c){for(var h=this.vcount,d=this.vbf,p=this.useInstancing?1:4,v=0;v<p;v++){var g=(h+v)*this.stride;d[g]=e,d[g+1]=t,d[g+2]=o,d[g+3]=i,d[g+4]=n,this.setCommonVertexAttribs(g,u+v,l,r,s,a,c,0),this.vcount++}return h},e.prototype.addVertexArc=function(e,t,i,n,o,r,l,c,h,d,p,v){for(var g=this.vcount,m=this.vbf,f=o==r?s:a,E=this.useInstancing?1:4,A=0;A<E;A++){var y=(g+A)*this.stride;m[y]=e,m[y+1]=t,m[y+2]=i,m[y+3]=n,m[y+4]=.5*c,m[y+5]=o,f===a&&(m[y+10]=r,m[y+11]=l),this.setCommonVertexAttribs(y,u+A,f,h,d,p,v,0),this.vcount++}return g},e.prototype.addVertex=function(e,t,i,n,r,s){if(!this.useInstancing){var a=this.vcount,l=this.stride*a,c=this.vbf;return c[l]=e,c[l+1]=t,this.setCommonVertexAttribs(l,0,o,i,n,r,s,0),this.vcount++,a}},e.prototype.addVertexPolytriangle=function(e,t,i,n,o,r){this.useInstancing||(this.addVertex(e,t,i,n,o,r),this.addToBounds(e,t))},e.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,n=this.icount;if(n+e.length>=i.length){for(var o=new Uint16Array(2*i.length),r=0;r<n;++r)o[r]=i[r];this.ib=i=o}for(var r=0;r<e.length;++r)i[n+r]=t+e[r];this.icount+=e.length}},e.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(E,e)},e.prototype.addSegment=function(e,t,i,n,o,r,s,a,l,c,u){var h=i-e,d=n-t,p=h||d?Math.atan2(d,h):0,v=h||d?Math.sqrt(h*h+d*d):0,g=this.addVertexLine(e,t,p,v,o,r,s,a,l,c,u);this.finalizeQuad(g),this.addToBounds(e,t),this.addToBounds(i,n)},e.prototype.addTriangleGeom=function(e,t,i,n,o,r,s,a,l,c){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,i,n,o,r,s,a,l,c);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(i,n),this.addToBounds(o,r)},e.prototype.addArc=function(e,t,i,o,r,s,a,l,c,u,h,d){r==s?this.numCirculars++:this.numEllipticals++;var p=A(i,o);i=p.start,o=p.end,0==i&&0==o&&(o=n);var v=Math.abs(i-o);if(v>1e-4&&Math.abs(v-n)>1e-4){var g=e+r*Math.cos(i),m=t+s*Math.sin(i);this.addSegment(g,m,g,m,0,l,c,u,h,d);var f=e+r*Math.cos(o),E=t+s*Math.sin(o);this.addSegment(f,E,f,E,0,l,c,u,h,d)}else this.addToBounds(e-r,t-s),this.addToBounds(e+r,t+s);var y=this.addVertexArc(e,t,i,o,r,s,a,l,c,u,h,d);this.finalizeQuad(y);var v,g,m,f,E},e.prototype.addTexturedQuad=function(e,t,i,n,o,r,s,a,l){var c=this.addVertexTexQuad(e,t,i,n,o,r,s,a,l);this.finalizeQuad(c);var u=.5*Math.cos(o),h=.5*Math.sin(o),d=Math.abs(i*u)+Math.abs(n*h),p=Math.abs(i*h)+Math.abs(n*u);this.addToBounds(e-d,t-p),this.addToBounds(e+d,t+p)},e.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},e.prototype.toMesh=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;if(e.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:v,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:g,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:m,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:f,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},this.stride>10&&(e.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1}),this.useInstancing){e.numInstances=this.vcount;var i=new Int32Array([u,h,d,p]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=i.buffer;e.indices=new Uint16Array(E)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var n=this.maxx-this.minx,o=this.maxy-this.miny,r=Math.max(n,o);e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-r},max:{x:this.maxx,y:this.maxy,z:.001*r}};e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(n*n+o*o)};return e};var A=function(e,t){function i(){function i(e,t){return Math.abs(e-t)<.001}i(e,0)&&(e=0),i(t,0)&&(t=0),i(e,n)&&(e=n),i(t,n)&&(t=n)}if(i(),e>t)for(;e>n;)e-=n,t-=n;else for(;t>n;)e-=n,t-=n;return i(),e<0&&t>0&&(e+=n),{start:e,end:t}};i.VertexBufferBuilder=e}(),function(){"use strict";var e=(Autodesk.Viewing,Autodesk.Viewing.Private),t=(2*Math.PI,0),i=1,n=2,o=3,r=4,s=5,a=7,l=8,c=9;e.VertexBufferReader=function(e){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!1},e.VertexBufferReader.prototype.getDbIdAt=function(e){return this.vbi[e*this.stride+a]},e.VertexBufferReader.prototype.getVertexFlagsAt=function(e){return this.vbi[e*this.stride+l]},e.VertexBufferReader.prototype.getLayerIndexAt=function(e){return 65535&this.vbi[e*this.stride+c]},e.VertexBufferReader.prototype.getViewportIndexAt=function(e){return this.vbi[e*this.stride+c]>>16&65535},e.VertexBufferReader.prototype.decodeLineAt=function(e,t,i,n){if(n.onLineSegment){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=r+l*Math.cos(a),u=s+l*Math.sin(a);n.onLineSegment(r,s,c,u,i)}},e.VertexBufferReader.prototype.decodeCircularArcAt=function(e,t,i,n){if(n.onCircularArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5];n.onCircularArc(r,s,a,l,c,i)}},e.VertexBufferReader.prototype.decodeEllipticalArcAt=function(e,t,i,n){if(n.onEllipticalArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5],u=this.vbf[o+10],h=this.vbf[o+11];n.onEllipticalArc(r,s,a,l,c,u,h,i)}},e.VertexBufferReader.prototype.decodeTriangleVertex=function(e,t,i,n){if(n.onTriangleVertex){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1];n.onTriangleVertex(r,s,i)}},e.VertexBufferReader.prototype.enumGeomsForObject=function(e,a){for(var l=0;l<this.vcount;){var c=this.getVertexFlagsAt(l),u=c>>8&255,h=this.getLayerIndexAt(l),d=this.getViewportIndexAt(l);if(this.getDbIdAt(l)===e)switch(u){case t:this.decodeTriangleVertex(l,h,d,a);break;case i:this.decodeLineAt(l,h,d,a);break;case n:this.decodeCircularArcAt(l,h,d,a);break;case o:this.decodeEllipticalArcAt(l,h,d,a);break;case r:break;case s:}l+=this.useInstancing||u==t?1:4}}}(),function(){"use strict";function e(){function e(){var e=ne.NormalsShader;a=ne.createShaderMaterial(e),a.blending=THREE.NoBlending,a.packedNormals=!0;var t={NoCutPlanes:1,Instancing:2,Count:4},i=[];i[0]=null;for(var n=1;n<t.Count;n++){var o=a.clone();n&t.NoCutPlanes&&(o.cutPlanes=null,o.blending=THREE.NoBlending,o.packedNormals=!0,o.doNotCut=!0),n&t.Instancing&&(o.useInstancing=!0),i[n]=o}a.variants=i,a.getCustomOverrideMaterial=function(e){var i=!e.cutplanes||0==e.cutplanes.length,n=e.useInstancing,o=(i?t.NoCutPlanes:0)|(n?t.Instancing:0);return this.variants[o]}}function n(e){e(a);for(var t=1;t<a.variants.length;t++)e(a.variants[t])}function o(){function t(e){e.material.blending=THREE.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}e(),v=new ne.LmvShaderPass(ne.SAOShader),t(v),p=new ne.LmvShaderPass(ne.SAOBlurShader),t(p),m=new ne.LmvShaderPass(ne.SAOMinifyFirstShader),t(m),g=new ne.LmvShaderPass(ne.SAOMinifyShader),t(g),f=new ne.LmvShaderPass(ne.FXAAShader),t(f),E=new ne.LmvShaderPass(ne.CelShader),t(E),A=new ne.LmvShaderPass(ne.BlendShader),t(A),d=new ne.LmvShaderPass(ne.BackgroundShader),t(d),y=new ne.LmvShaderPass(ne.CopyShader),t(y)}function r(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i,o=1-i-n;return((o*t+n)*t+i)*t}var s,a,l,c,u,h,d,p,v,g,m,f,E,A,y,T,w,b,C,S,k,x,M,R=!1,P=!1,V=null,I=null,N=null,D=null,L=null,O=[],_=0,H=0,B=0,F=1,z=!1,U=new Uint8Array(4),G=(new THREE.Color).setRGB(1,1,1),W=(new THREE.Color).setRGB(0,0,0),j=null,Y=!1,q=!1,X=!1,K=!1,Q=0,Z=0,J=0,$=[.42,0,1,1],ee=.004,te={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1},ie={},ne=Autodesk.Viewing.Shaders;this.settings=te,this.init=function(e,n,r){if(o(),!e)return void i.logger.error("You need a gl context to make a renderer. Things will go downhill from here.");Y=window.navigator.userAgent.indexOf("Firefox")!=-1&&window.navigator.userAgent.indexOf("Mac OS")!=-1;var a=window.navigator.userAgent.indexOf("Firefox")!=-1;M=a?THREE.RGBAFormat:THREE.RGBFormat,q=t.isMobileDevice(),te.idbuffer=!q,k=n,x=r,s=e},this.overlayUpdate=function(e){if(0===Z||Z===-1)return!1;var t=A.uniforms.highlightIntensity.value,i=(performance.now()-Q)*ee;i=Math.min(i,1);var n=r($,i);return t!=n&&(A.uniforms.highlightIntensity.value=n,!0)},this.beginScene=function(e,t,n,o){if(c=t,h=e.fog,u=n,R=!1,P=!1,!I&&k)this.initPostPipeline(te.sao,te.antialias);else if(!I&&!k)return void(z||(i.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance."),z=!0));if(o)if(j&&!te.envMapBg){if(te.swapBlackAndWhite){var r=new THREE.Color(1,1,1),a=new THREE.Color(0,0,0);j.equals(r)?s.setClearColor(a,1):j.equals(a)?s.setClearColor(r,1):s.setClearColor(j,1)}else s.setClearColor(j,1);s.clearTarget(I,!0,!0,!1)}else d.uniforms.uCamDir.value=c.worldUpTransform?c.getWorldDirection().clone().applyMatrix4(c.worldUpTransform):c.getWorldDirection(),d.uniforms.uCamUp.value=c.worldUpTransform?c.up.clone().applyMatrix4(c.worldUpTransform):c.up,d.uniforms.uResolution.value.set(k,x),d.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*c.fov)),s.clearTarget(I,!1,!0,!1),d.render(s,I,null);for(var l=0;l<O.length;l++)s.setClearColor(G,1),s.clearTarget(O[l],!0,!1,!1);if(te.sao||te.toonShaded){o&&(s.setClearColor(W,0),s.clearTarget(S,!0,!1,!1));var p=t.near,g=t.far;v.uniforms.cameraNear.value=p,v.uniforms.cameraFar.value=g,E.uniforms.cameraNear.value=p,E.uniforms.cameraFar.value=g,m.uniforms.cameraNear.value=p,m.uniforms.cameraInvNearFar.value=1/(p-g);var f=t.projectionMatrix.elements;t.isPerspective?(v.uniforms.projInfo.value.set(-2/(I.width*f[0]),-2/(I.height*f[5]),(1-f[8])/f[0],(1+f[9])/f[5]),E.uniforms.projInfo.value.copy(v.uniforms.projInfo.value),v.uniforms.isOrtho.value=0,E.uniforms.isOrtho.value=0):(v.uniforms.projInfo.value.set(-2/(I.width*f[0]),-2/(I.height*f[5]),(1-f[12])/f[0],(1-f[13])/f[5]),E.uniforms.projInfo.value.copy(v.uniforms.projInfo.value),v.uniforms.isOrtho.value=1,E.uniforms.isOrtho.value=1);var y=.25;v.uniforms.projScale.value=.5*y*(I.height*f[5])}te.sao||(A.uniforms.useAO.value=0),this.renderScenePart(e,!0,!0,!1,!0)},this.renderScenePart=function(e,t,i,n,o){R=!1,P=!1;var r=o?u:void 0;e.fog=h;var d;X&&K?te.idbuffer&&n&&(te.sao||te.toonShaded)?s.render(e,c,[I,S].concat(O),!1,r):te.sao||te.toonShaded?s.render(e,c,[I,S],!1,r):te.idbuffer&&n?s.render(e,c,[I].concat(O)):s.render(e,c,I,!1,r):K?(te.idbuffer&&n?s.render(e,c,[I].concat(O),!1,r):s.render(e,c,I,!1,r),(te.sao||te.toonShaded)&&i&&(d=e.overrideMaterial,e.overrideMaterial=a,s.render(e,c,S,!1,void 0),e.overrideMaterial=d)):(t&&s.render(e,c,I,!1,r),te.idbuffer&&n&&l&&(d=e.overrideMaterial,e.overrideMaterial=l,s.render(e,c,O[0],!1,void 0),e.overrideMaterial=d),(te.sao||te.toonShaded)&&i&&(d=e.overrideMaterial,e.overrideMaterial=a,s.render(e,c,S,!1,void 0),e.overrideMaterial=d))},this.clearAllOverlays=function(){s.clearTarget(N,!0,!1,!1)},this.renderOverlays=function(e,t){var i=0;for(var n in e){var o=e[n],r=o.scene,a=o.camera?o.camera:c;r.children.length&&(i||(i=1,s.setClearColor(W,0),s.clearTarget(N,!0,!1,!1)),o.materialPre&&(r.overrideMaterial=o.materialPre),s.render(r,a,N,!1,t),o.materialPost&&(r.overrideMaterial=o.materialPost,s.context.depthFunc(s.context.GREATER),
s.render(r,a,N,!1,t),s.context.depthFunc(s.context.LEQUAL)),r.overrideMaterial=null)}A.uniforms.useOverlay.value=i},this.computeSSAO=function(e){if(e||!te.sao||te.toonShaded)A.uniforms.useAO.value=0;else{if(!R){if(V){var t=V[0];m.uniforms.resolution.value.set(1/t.width,1/t.height),m.render(s,t,S);for(var i=1;i<V.length;i++){var n=V[i];g.uniforms.resolution.value.set(1/n.width,1/n.height),g.render(s,n,t),t=n}}v.render(s,L,I),p.uniforms.axis.value.set(1,0),p.render(s,D,L),p.uniforms.axis.value.set(0,1),p.render(s,L,D),R=!0}A.uniforms.useAO.value=1}},this.presentBuffer=function(e){if(s){var t=!(te.sao||A.uniforms.useOverlay.value||0!==Z&&Z!==-1||0!==J&&J!==-1);t?te.antialias?e?(f.render(s,D,I),e.render(s,null,D)):te.toonShaded?(E.render(s,D,I),f.render(s,null,D)):f.render(s,null,I):e?e.render(s,null,I):te.toonShaded?(E.render(s,D,I),y.render(s,null,D)):y.render(s,null,I):te.antialias?(A.render(s,D,I),e?(f.render(s,L,D),e.render(s,null,L)):te.toonShaded?(E.render(s,L,D),f.render(s,null,L)):f.render(s,null,D)):e?(A.render(s,D,I),e.render(s,null,D)):te.toonShaded?(A.render(s,D,I),E.render(s,L,D),y.render(s,null,L)):A.render(s,null,I)}},this.composeFinalFrame=function(e,t){te.sao&&!te.toonShaded&&this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(I&&(I.dispose(),I=null),S&&(S.dispose(),S=null),N&&(N.dispose(),N=null),D&&(D.dispose(),D=null),L&&(L.dispose(),L=null),V){for(var e=0;e<V.length;e++)V[e].dispose();V=[]}},this.setSize=function(e,n,o){if(k=e,x=n,te.logicalWidth=e,te.logicalHeight=n,0===e&&0===n||!s)return void this.cleanup();var r=0|e*s.getPixelRatio(),a=0|n*s.getPixelRatio();te.deviceWidth=r,te.deviceHeight=a,s.setSize(e,n),i.logger.log("width: "+r+" height: "+a);var l=1/r,c=1/a;if((te.useSSAA||te.toonShaded&&s.getPixelRatio()<=1)&&(r*=2,a*=2,o=!0),!o&&I&&I.width==r&&I.height==a||(i.logger.log("Reallocating render targets."),this.cleanup(),I=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:te.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1}),I.generateMipmaps=!1,N=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),N.generateMipmaps=!1,N.shareDepthFrom=I,S=null,D=null,L=null,V=[]),(te.antialias||te.sao||te.customPresentPass||te.toonShaded)&&(!o&&D&&D.width==r&&D.height==a||(D=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),D.generateMipmaps=!1)),te.sao||te.toonShaded){if(o||!S||S.width!=r||S.height!=a){var u=THREE.FloatType;t.isMobileDevice()&&(u=THREE.HalfFloatType),S=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:M,type:u,stencilBuffer:!1}),S.shareDepthFrom=I,V=[];for(var h=0;h<5;h++){var d=new THREE.WebGLRenderTarget(0|r/(2<<h),0|a/(2<<h),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});d.generateMipmaps=!1,V.push(d),v.uniforms["tDepth_mip"+(h+1)].value=d}X=!Y&&s.verifyMRTWorks([I,S]),L=D.clone()}!L&&te.antialias&&te.customPresentPass&&(L=D.clone()),v.uniforms.size.value.set(r,a),v.uniforms.resolution.value.set(l,c),v.uniforms.tDepth.value=S,p.uniforms.size.value.set(r,a),p.uniforms.resolution.value.set(l,c),E.uniforms.tDepth.value=S}if(te.idbuffer){if(o||!O[0]||O[0].width!=r||O[0].height!=a){O=[];for(var g=0;g<te.numIdTargets;g++)O[g]=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1}),O[g].generateMipmaps=!1,O[g].shareDepthFrom=I,O[g].canReadPixels=!0;K=!Y&&s.verifyMRTWorks([I].concat(O)),K||i.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work.")}E.uniforms.tID.value=O[0]}else if(O[0])for(var g=0;g<O.length;g++)O[g].dispose(),O[g]=null;f.uniforms.uResolution.value.set(l,c),E.uniforms.resolution.value.set(l,c),A.uniforms.tOverlay.value=N,A.uniforms.tAO.value=L,A.uniforms.useAO.value=te.sao?1:0,A.uniforms.resolution.value.set(l,c),A.uniforms.tID.value=O[0]},this.getMaxAnisotropy=function(){return s.getMaxAnisotropy()},this.hasMRT=function(){return!Y&&s&&s.supportsMRT()},this.applyMRTFlags=function(e){var t=e.mrtNormals,i=e.mrtIdBuffer;e.mrtNormals=this.hasMRT()&&X&&(te.sao||te.toonShaded),e.mrtIdBuffer=this.hasMRT()&&K&&te.idbuffer?te.numIdTargets:void 0,e.mrtNormals===t&&e.mrtIdBuffer===i||(e.needsUpdate=!0)},this.getAntialiasing=function(){return te.antialias},this.initPostPipeline=function(e,i){te.sao=e&&!t.isIE11,te.antialias=i&&!t.isIE11,te.sao&&(te.toonShaded=!1),te.haveTwoSided&&n(function(e){e.side=THREE.DoubleSide}),n(function(e){e.needsUpdate=!0}),v.material.needsUpdate=!0,p.material.needsUpdate=!0,m.material.needsUpdate=!0,g.material.needsUpdate=!0,f.material.needsUpdate=!0,E.material.needsUpdate=!0,A.material.needsUpdate=!0,d.material.needsUpdate=!0,y.material.needsUpdate=!0,this.setSize(k,x)},this.setClearColors=function(e,t){j=t?e.equals(t)||q?new THREE.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone(),j||(d.uniforms.color1.value.copy(e),d.uniforms.color2.value.copy(t))},this.setAOEnabled=function(e){te.sao=e},this.setAOOptions=function(e,i){void 0!==e&&(v.uniforms.radius.value=e,v.uniforms.bias.value=e*t.isMobileDevice()?.1:.01,p.uniforms.radius.value=e),void 0!==i&&(v.uniforms.intensity.value=i),R=!1},this.getAOEnabled=function(){return te.sao},this.getAORadius=function(){return v.uniforms.radius.value},this.getAOIntensity=function(){return v.uniforms.intensity.value},this.setCubeMap=function(e){d.material.envMap=e},this.setEnvRotation=function(e){H=e,d.material.envRotationSin=Math.sin(e),d.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return H},this.setEnvExposure=function(e){d.uniforms.envMapExposure.value=Math.pow(2,e),d.material.envMapExposure=Math.pow(2,e),d.material.needsUpdate=!0},this.setTonemapExposureBias=function(e){_=e,d.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return _},this.setTonemapMethod=function(e){B=e,0===e?s.gammaInput=!1:s.gammaInput=!0,d.material.tonemapOutput=B,d.material.needsUpdate=!0},this.getToneMapMethod=function(){return B},this.toggleTwoSided=function(e){te.haveTwoSided!=e&&a&&n(function(t){t.side=e?THREE.DoubleSide:THREE.FrontSide,t.needsUpdate=!0}),te.haveTwoSided=e},this.toggleCelShading=function(e){te.sao=!e,te.toonShaded=e,te.idbuffer=e,this.initPostPipeline(te.sao,te.antialias)},this.toggleEnvMapBackground=function(e){te.envMapBg=e,d.uniforms.envMapBackground.value=e},this.toggleSwapBlackAndWhite=function(e){te.swapBlackAndWhite=e},this.enter2DMode=function(e){l=e,ie.sao=te.sao,ie.toonShaded=te.toonShaded,ie.antialias=te.antialias,ie.idbuffer=te.idbuffer,te.idbuffer=!0,te.toonShaded=!1,A.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){l=null,te.idbuffer=ie.idbuffer,te.toonShaded=ie.toonShaded,delete A.material.defines.IS_2D,this.initPostPipeline(ie.sao,ie.antialias)},this.idAtPixel=function(e,t,i){if(!O[0])return 0;var n=0|.5*(e+1)*O[0].width,o=0|.5*(t+1)*O[0].height;if(P&&n===T&&o===w)return i&&(i[0]=b,i[1]=C),b;s.readRenderTargetPixels(O[0],n,o,1,1,U);var r=U[2]<<16|U[1]<<8|U[0],a=0;return O[1]?(s.readRenderTargetPixels(O[1],n,o,1,1,U),a=U[1]<<8|U[0],a=a<<16>>16,r=r<<8>>8):r=r<<8>>8,T=n,w=o,b=r,C=a,P=!0,i&&(i[0]=r,i[1]=a),r},this.idAtPixels=function(e,t,i,n){function o(){for(var e,t=0,o=0,r=0,s=-1,a=0;a<i*i;a++){var u=t+(i-1)/2,h=o+(i-1)/2;if(u>=0&&u<=i&&h>=0&&h<=i){var d=u+h*i;if(e=l[4*d+2]<<16|l[4*d+1]<<8|l[4*d],e=e<<8>>8,e>=0){if(c){var p=c[4*d+1]<<8|c[4*d];p=p<<16>>16,n[0]=e,n[1]=p}break}}if(t==o||t<0&&t==-o||t>0&&t==1-o){var v=r;r=-s,s=v}t+=r,o+=s}return e}if(!O[0])return 0;var r=.5*(e+1)*O[0].width-.5*(i-1),a=.5*(t+1)*O[0].height-.5*(i-1),l=new Uint8Array(4*i*i);s.readRenderTargetPixels(O[0],r,a,i,i,l);var c=void 0;return n&&O[1]&&(c=new Uint8Array(4*i*i),s.readRenderTargetPixels(O[1],r,a,i,i,c)),o()},this.readbackTargetId=function(){if(!O[0])return null;var e=new Uint8Array(4*O[0].width*O[0].height);return s.readRenderTargetPixels(O[0],0,0,O[0].width,O[0].height,e),{buffer:e,width:O[0].width,height:O[0].height}},this.rolloverObjectViewport=function(e,t,i){var n=i?i[0]:this.idAtPixel(e,t);return this.rolloverObjectId(n,i)},this.rolloverObjectId=function(e,t,i){return i=i||0,(e!==Z||i!==J)&&(A.uniforms.highlightIntensity.value=0,A.uniforms.objID.value=e,Q=performance.now(),Z=e,J=i,t?(t.length>1&&t.shift(),A.uniforms.highlightRange.value=1,A.uniforms.objIDStart.value=t[0],A.uniforms.objIDEnd.value=t[t.length-1]):(A.uniforms.highlightRange.value=0,e<=0&&(e=0),A.uniforms.objIDv3.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255)),!0)},this.setUnitScale=function(e){F=e},this.getUnitScale=function(){return F},this.getBlendPass=function(){return A},this.getClearPass=function(){return d},this.getColorTarget=function(){return I},this.getDepthMaterial=function(){return a}}var t=Autodesk.Viewing,i=t.Private;i.RenderContext=e}(),function(){"use strict";function e(e,t){var i=255*t[2]+t[3],n=Math.pow(2,(i-127)/2),o=n/t[1],r=t[0]*o,s=a[0]*r+a[3]*n+a[6]*o,l=a[1]*r+a[4]*n+a[7]*o,c=a[2]*r+a[5]*n+a[8]*o;s<0&&(s=0),l<0&&(l=0),c<0&&(c=0),e[0]=s,e[1]=l,e[2]=c}function t(e,t,i){var n=.0625*Math.sqrt(t[0]*i),o=.0625*Math.sqrt(t[1]*i),r=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(n,o),Math.max(r,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;n>1&&(n=1),o>1&&(o=1),r>1&&(r=1),e[3]=a;var l=1/a;e[0]=n*l,e[1]=o*l,e[2]=r*l}function i(e,t,i){var n=Math.sqrt(t[0]*i),o=Math.sqrt(t[1]*i),r=Math.sqrt(t[2]*i),s=65504;n>s&&(n=s),o>s&&(o=s),r>s&&(r=s),e[0]=n,e[1]=o,e[2]=r}function n(e){for(var t=[],i=Array.isArray(e.image)?e.image:[e.image],n=0;n<i.length;n++)for(var o=i[n],r=0;r<o.mipmaps.length;r++){var s=o.mipmaps[r];t.push(s.data.buffer)}return t}var o=(Autodesk.Viewing,Autodesk.Viewing.Private),r=Autodesk.LMVTK;o.DefaultLightPreset=1,o.DefaultLightPreset2d=0,o.ModelSettingsEnvironment=null,o.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var s=o.BackgroundPresets;o.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:s["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:s["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:s.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:s.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:s.Snow,darkerFade:!1,rotation:0}],o.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["RaaS SBS"],darkerFade:!1,rotation:0}],o.ENABLE_DEBUG&&(o.LightPresets=o.LightPresets.concat(o.DebugEnvironments)),o.copyLightPreset=function(e,t){t.name=e.name+" (copy)",t.path=e.path,t.type=e.type,t.tonemap=e.tonemap,t.E_bias=e.E_bias,t.directLightColor=e.directLightColor,t.ambientColor=e.ambientColor,t.lightMultiplier=e.lightMultiplier,t.bgColorGradient=e.bgColorGradient,t.darkerFade=e.darkerFade,t.rotation=e.rotation},o.CreateCubeMapFromColors=function(e,t){for(var i=255*e.x,n=255*e.y,o=255*e.z,r=255*t.x,s=255*t.y,a=255*t.z,l=new Uint8Array(16),c=new Uint8Array(16),u=new Uint8Array(16),h=0;h<4;h++)l[4*h]=i,l[4*h+1]=n,l[4*h+2]=o,l[4*h+3]=255,c[4*h]=r,c[4*h+1]=s,c[4*h+2]=a,c[4*h+3]=255,h>1?(u[4*h]=i,u[4*h+1]=n,u[4*h+2]=o,u[4*h+3]=255):(u[4*h]=r,u[4*h+1]=s,u[4*h+2]=a,u[4*h+3]=255);var d=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),v=new THREE.DataTexture(c,2,2,THREE.RGBAFormat),g=new THREE.DataTexture(l,2,2,THREE.RGBAFormat),m=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),f=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),E=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);return E.image=[p,d,g,v,f,m],E.needsUpdate=!0,E};var a=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],l=new Float32Array(4),c=new Float32Array(4);o.DecodeEnvMap=function(n,r,s,a){if(!n.LogLuv)return void o.logger.warn("Environment map expected to be in LogLuv format.");for(var u=Math.pow(2,r),h=Array.isArray(n.image)?n.image:[n.image],d=0;d<h.length;d++)for(var p=h[d],v=0;v<p.mipmaps.length;v++){var g,m=p.mipmaps[v],f=m.data;s?(g=new Uint16Array(f.length/4*3),m.data=g):g=f.buffer;for(var E=0,A=0;A<f.length;A+=4)l[0]=f[A]/255,l[1]=f[A+1]/255,l[2]=f[A+2]/255,l[3]=f[A+3]/255,e(c,l),s?(i(l,c,u),g[E++]=o.FloatToHalf(l[0]),g[E++]=o.FloatToHalf(l[1]),g[E++]=o.FloatToHalf(l[2])):(t(l,c,u),f[A]=Math.round(255*l[0]),f[A+1]=Math.round(255*l[1]),f[A+2]=Math.round(255*l[2]),f[A+3]=Math.round(255*l[3]))}n.LogLuv=!1,s?(n.type=THREE.HalfFloatType,n.format=THREE.RGBFormat,n.RGBM=!1,n.GammaEncoded=!0):n.RGBM=!0,a&&a(n)},o.imageWorker=null;var u=1;o.DecodeEnvMapAsync=function(e,t,i,r){if(!e.LogLuv)return void o.logger.warn("Environment map expected to be in LogLuv format.");o.imageWorker||(o.imageWorker=o.createWorker());var s=u++,a=function(t){if(t.data.id===s){o.imageWorker.removeEventListener("message",a);var n=t.data.map;e.image=n.image,e.LogLuv=!1,i?(e.type=THREE.HalfFloatType,e.format=THREE.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,r(e)}};o.imageWorker.addEventListener("message",a),o.imageWorker.postMessage({operation:"DECODE_ENVMAP",map:e,exposure:t,useHalfFloat:i,id:s},n(e))},r.doDecodeEnvmap=function(e){o.DecodeEnvMap(e.map,e.exposure,e.useHalfFloat),self.postMessage({map:e.map,id:e.id},n(e.map))}}(),function(){"use strict";function e(e,i,n,o){if(s.getUseCredentials()){var r=e.indexOf("://")===-1||e.indexOf(window.location.host)!==-1||a.urlIsApiViewingOrDev(e);r?THREE.ImageUtils.crossOrigin="use-credentials":THREE.ImageUtils.crossOrigin="anonymous"}var l=e.indexOf("urn:");if(l!==-1){var c=s.getUseCredentials()&&!s.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",u=c;o&&(u&&(u+="&"),u+="acmsession="+o),u&&(e+="?"+u)}var h=a.ViewingService.getDirectOSSUrl({endpoint:s.getApiEndpoint()},e);if(h&&(e=h),".dds"===e.slice(e.length-4).toLocaleLowerCase()){if(s.isIOSDevice()){var d=e.slice(0,e.length-4)+".pvr";return(new THREE.PVRLoader).load(d,n)}return(new THREE.DDSLoader).load(e,n)}return!LMV_THIRD_PARTY_COOKIE&&r?t(e,i,n):THREE.ImageUtils.loadTexture(e,i,n)}function t(e,t,n){function o(e){return i(e,s,n)}function r(e,t,i){var n="Error: "+e+" ("+t+")";a.logger.error(n)}var s=new THREE.Texture(void 0,t);return a.ViewingService.getItem(a.initLoadContext(),e,o,r),s}function i(e,t,i){function n(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,o=0;o<n;o++)t+=String.fromCharCode(i[o]);var r="data:image/jpeg;base64,"+window.btoa(t);return r}var o=new Image;t.image=o,o.onload=function(){t.needsUpdate=!0,i&&i(t)},o.onerror=function(e){a.logger.error(e)},o.src=n(e)}function n(e){var t=e.width,i=e.height;if(0===(t&t-1)&&0===(i&i-1))return e;for(var n=1;2*n<t;)n*=2;for(var o=1;2*o<i;)o*=2;var r=document.createElement("canvas"),s=r.getContext("2d");return r.width=n,r.height=o,s.drawImage(e,0,0,n,o),r}function o(t){function i(e){return e.indexOf("__lineMaterial__")!=-1}function o(e,t){return i(t)?t:e.basePath+"|mat|"+t}this.viewer=t;var r=this,l=this.materials={},c=this.materialsNonHDR={};this.textures={},this.layerMaskTex=null,this.reflectionCube=null,this.irradianceMap=null;var u=1,h=0,d=1,p=[];this.hasPrism=!1,this.renderPrism=!0;var v=1,g=0,m=[];this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0}),this.dtor=function(){this.cleanup(),THREE.Cache.clear(),this.viewer=null,r=null},this.findMaterial=function(e,t){var i=l[o(e,t)];return i||(a.logger.warn("Unknown material "+t+". Using default."),i=this.defaultMaterial),i},this.setRenderPrism=function(e){this.renderPrism=e},this.convertMaterials=function(e){if(!e.materials)return 0;{if(!e.gltfMaterials){var t=e.materials.materials,i=e.proteinMaterials?e.proteinMaterials.materials:null,n=this.renderPrism,r=0;for(var l in t){var c=!1;i&&(c=n&&a.MaterialConverter.isPrismMaterial(i[l]));var u=c?i[l]:t[l],h=a.MaterialConverter.convertMaterial(u,c);!s.isIE11&&e.doubleSided&&(h.side=THREE.DoubleSide),c&&h.transparent&&h.side===THREE.FrontSide&&(h.side=THREE.DoubleSide),c&&h.transparent&&h.side===THREE.DoubleSide&&h.depthTest&&(h.twoPassTransparency=!0);var d=o(e,l);if(this.addMaterial(d,h,c),r++,u.decals){h.decals=[];for(var p=0,v=u.decals.length;p<v;p++){var g=u.decals[p];c=n&&a.MaterialConverter.isPrismMaterial(g.material);var m=a.MaterialConverter.convertMaterial(g.material,c);h.decals.push({uv:g.uv||0,material:m}),this.addMaterial(d+"|decal|"+p,m,c)}}}return r}var f=e.materials.materials;for(var l in f){var E=f[l],A=a.MaterialConverter.convertMaterialGltf(E,e),d=o(e,l);this.addMaterial(d,A,!1)}}},this.updateMaterials=function(){for(;p.length;)for(var e=p.pop(),t=0;t<e.mats.length;t++)e.mats[t][e.slot]=e.tex,e.mats[t].needsUpdate=!0,this.viewer.invalidate(!0,!1,!1)},this.loadTexture=function(t,i){if(t.textureMaps&&!t.texturesLoaded&&(t.texturesLoaded=!0,!s.isNodeJS)){var o=t.textureMaps;for(var l in o){var c=o[l],u=i.basePath+c.uri+c.mapName,h=r.textures[u];if(h)h.tex?(t[c.mapName]=h.tex,t.needsUpdate=!0):(r.textures[u].mats.push(t),r.textures[u].slots.push(c.mapName));else{var d=null,v=t.proteinType&&t.proteinType.length,g=v&&0===t.proteinType.indexOf("Prism"),m=(g&&PRISM_ROOT||v&&PROTEIN_ROOT)&&(0===c.uri.indexOf("1/Mats")||0===c.uri.indexOf("2/Mats")||0===c.uri.indexOf("3/Mats"));if(m)d=g?PRISM_ROOT+c.uri:PROTEIN_ROOT+c.uri;else{for(var f=0;f<i.manifest.assets.length;++f){var E=i.manifest.assets[f];if(E.id==c.uri){d=a.pathToURL(i.basePath+E.URI);break}}d||(d=a.pathToURL(i.basePath+c.uri))}r.textures[u]={mats:[t],slots:[c.mapName],tex:null};var A=function(t,o){return e(o,THREE.UVMapping,function(e){if(r){e.image=n(e.image);var i=r.textures[t];if(i){i.tex||(i.tex=e);for(var o=0;o<i.mats.length;o++)i.mats[o][i.slots[o]]=e;p.push(i)}}},i.acmSessionId)}(u,d);"bumpMap"==c.mapName||"normalMap"==c.mapName?A.anisotropy=0:A.anisotropy=this.viewer.renderer().getMaxAnisotropy(),A.flipY=void 0===c.flipY||c.flipY,A.invert=!1,A.wrapS=THREE.RepeatWrapping,A.wrapT=THREE.RepeatWrapping,a.MaterialConverter.convertTexture(c.textureObj,A,i.materials.scene.SceneUnit,c.isPrism)}}}},this.loadTextures=function(e){for(var t in l)if(t.indexOf(e.basePath)!=-1){var i=l[t];this.loadTexture(i,e)}},this.create2DMaterial=function(t,i,r,a){var c="__lineMaterial__";if(i.image&&(c+="|image:"+i.image.name),i.clip&&(c+="|clip:"+JSON.stringify(i.clip)),r&&(c+="|id"),a&&(c+="|selection"),i.skipEllipticals&&(c+="|skipEllipticals"),i.skipCircles&&(c+="|skipCircles"),i.skipTriangleGeoms&&(c+="|skipTriangleGeoms"),i.useInstancing&&(c+="|useInstancing"),t&&(c+=t.basePath),c=o(null,c),!l.hasOwnProperty(c)){var u=s.Shaders,h=u.createShaderMaterial(u.LineShader);if(h.transparent=!0,h.depthWrite=!1,h.depthTest=!1,h.side=THREE.DoubleSide,h.blending=THREE.NormalBlending,r?(h.defines.ID_COLOR=1,h.blending=THREE.NoBlending):a?(this.setSelectionTexture(h),h.defines.SELECTION_RENDERER=1,h.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):this.viewer.renderer().hasMRT()&&(h.mrtIdBuffer=this.viewer.renderer().settings.numIdTargets),i.skipEllipticals||(h.defines.HAS_ELLIPTICALS=1),i.skipCircles||(h.defines.HAS_CIRCLES=1),i.skipTriangleGeoms||(h.defines.HAS_TRIANGLE_GEOMS=1),i.useInstancing&&(h.defines.USE_INSTANCING=1),i.image&&!s.isNodeJS){var d=this,p=function(e){d.viewer&&(e.image=n(e.image),e.wrapS=THREE.ClampToEdgeWrapping,e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.LinearMipMapLinearFilter,e.magFilter=THREE.LinearFilter,e.anisotropy=1,e.flipY=!0,e.generateMipmaps=!0,e.needsUpdate=!0,h.defines.HAS_RASTER_QUADS=1,h.uniforms.tRaster.value=e,i.image.dataURI.indexOf("png")!=-1&&(h.transparent=!0),h.needsUpdate=!0,d.viewer.invalidate(!1,!0,!1))};e(i.image.dataURI,THREE.UVMapping,p,t.acmSessionId)}h.modelScale=i.modelScale||1,this.add2DMaterial(c,h)}return c},this.add2DMaterial=function(e,t){this.layerMaskTex&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=r.layerMaskTex),this.lineStyleTex&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=r.lineStyleTex.image.width,t.uniforms.tLineStyle.value=r.lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(r.lineStyleTex.image.width,r.lineStyleTex.image.height)),t.uniforms.aaRange.value=.5/(v*t.modelScale),t.uniforms.pixelsPerUnit.value=v*t.modelScale,t.uniforms.swap.value=g,l[e]=t},this.addMaterial=function(e,t,i){function n(e){return.299*e.r+.587*e.g+.114*e.b}var o=t.proteinMat?t.proteinMat:null,s=t.proteinType&&t.proteinType.indexOf("Prism")!=-1;if(this.hasPrism=s||this.hasPrism,!i){if(t.metal)t.reflectivity||(t.reflectivity=n(t.specular)),o&&(1===t.reflectivity&&(t.reflectivity=n(t.specular)),0===t.color.r&&0===t.color.g&&0===t.color.b||(t.color.r*=.1,t.color.g*=.1,t.color.b*=.1));else if(s){var a=!1;if("PrismLayered"==t.proteinType&&(t.clearcoat=!0,t.reflectivity=.06,o)){var c=o.materials[o.userassets[0]],p=c.categories;p&&p.length&&p[0].indexOf("Metal")!=-1&&(a=!0)}t.reflectivity=Math.sqrt(t.reflectivity),a?t.specular.copy(t.color):(t.specular.r=t.reflectivity,t.specular.g=t.reflectivity,t.specular.b=t.reflectivity)}else t.reflectivity?t.reflectivity>.3?(t.metal=!0,t.specular.r=t.color.r,t.specular.g=t.color.g,t.specular.b=t.color.b,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1):(t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):1!==t.color.r||1!==t.color.g||1!==t.color.b||1!==t.specular.r||1!==t.specular.g||1!==t.specular.b||t.textureMaps&&(t.textureMaps.map||t.textureMaps.specularMap)?(t.reflectivity=.01+.06*n(t.specular),t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):(t.metal=!0,t.reflectivity=.7,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1),t.opacity<1&&(t.reflectivity=1);(t.transparent||t.textureMaps&&(t.textureMaps.map&&t.textureMaps.map.uri.toLowerCase().indexOf(".png")!=-1||t.textureMaps.opacityMap))&&(t.alphaTest=.01)}if(t.textureMaps&&t.textureMaps.normalMap){var v=t.bumpScale;(void 0===v||v>=1)&&(v=1),t.normalScale=new THREE.Vector2(v,v)}else void 0===t.bumpScale&&t.textureMaps&&(t.textureMaps.map||t.textureMaps.bumpMap)?t.bumpScale=.03:t.bumpScale>=1&&(t.bumpScale=.03);void 0!==t.shininess&&(t.shininess*=.25),r.reflectionCube&&!t.disableEnvMap&&(t.envMap=r.reflectionCube),r.irradianceMap&&(t.irradianceMap=r.irradianceMap),t.exposureBias=Math.pow(2,this.viewer.renderer().getExposureBias()),t.tonemapOutput=this.viewer.renderer().getToneMapMethod(),t.envMapExposure=u,t.envRotationSin=h,t.envRotationCos=d,this.viewer.renderer().applyMRTFlags(t),t.side==THREE.DoubleSide&&this.viewer.renderer().toggleTwoSided(!0),t.doNotCut||(t.cutplanes=m),l[e]=t},this.addMaterialNonHDR=function(e,t){t.doNotCut||(t.cutplanes=m),c[e]=t},this.addOverrideMaterial=function(e,t){if(this.addMaterialNonHDR(e,t),t.variants)for(var i=0;i<t.variants.length;i++){var n=t.variants[i];if(n){var o=e+"_variant_"+i;this.addMaterialNonHDR(o,n)}}},this.togglePolygonOffset=function(e){for(var t in l){var i=l[t];i instanceof THREE.MeshPhongMaterial&&(i.polygonOffset=!0,i.polygonOffsetFactor=e?1:0,i.polygonOffsetUnits=e?.1:0,i.needsUpdate=!0)}},this.applyGeometryFlagsToMaterial=function(e,t){t.attributes.color&&(e.vertexColors=THREE.VertexColors,e.needsUpdate=!0),!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern&&(e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0))},this.toggleMRTSetting=function(){for(var e in l){var t=l[e];i(e)||this.viewer.renderer().applyMRTFlags(t)}},this.updatePixelScale=function(e){v=e;var t=l;for(var n in t)if(i(n)){var o=t[n];o.uniforms.aaRange.value=.5/(v*o.modelScale),o.uniforms.pixelsPerUnit.value=v*o.modelScale}},this.updateSwapBlackAndWhite=function(e){g=e?1:0;var t=l;for(var n in t)if(i(n)){var o=t[n];o.uniforms.swap.value=g}},this.updateViewportId=function(e){var t=l;for(var n in t)if(i(n)){var o=t[n];o.uniforms.viewportId.value=e,o.needsUpdate=!0}this.viewer.invalidate(!0)},this.setCubeMapFromColors=function(e,t){var i=a.CreateCubeMapFromColors(e,t);r.reflectionCube=i,r.reflectionCube.isBgColor=!0;for(var n in l){var o=l[n];o.disableEnvMap||(o.envMap=i,o.needsUpdate=!0)}return this.viewer.invalidate(!0),r.reflectionCube},this.setCubeMap=function(e,t){var i=this,n=function(e){if(i.reflectionCube=e,i.reflectionCube)for(var t in l){var n=l[t];n.disableEnvMap||(n.envMap=r.reflectionCube,n.needsUpdate=!0)}else i.setCubeMapFromColors(i.viewer.clearColorTop,i.viewer.clearColorBottom);i.viewer.invalidate(!0)},o=function(i){i?(i.mapping=THREE.CubeReflectionMapping,i.LogLuv=e.indexOf("logluv")!=-1,i.RGBM=e.indexOf("rgbm")!=-1,a.DecodeEnvMap(i,t,!1,n)):n(i)};return Array.isArray(e)?(this.reflectionCube=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,o),this.reflectionCube.format=THREE.RGBFormat):"string"==typeof e?e.toLowerCase().indexOf(".dds")!=-1?this.reflectionCube=(new THREE.DDSLoader).load(e,o):(this.reflectionCube=THREE.ImageUtils.loadTexture(e,THREE.SphericalReflectionMapping,n),this.reflectionCube.format=THREE.RGBFormat):n(e?e:null),i.reflectionCube},this.setIrradianceMap=function(e,t){var i=this,n=function(e){for(var t in l){var n=l[t];n.irradianceMap=e,n.needsUpdate=!0}i.irradianceMap=e,i.viewer.invalidate(!0)},o=function(o){o?(o.mapping=THREE.CubeReflectionMapping,o.LogLuv=e.indexOf("logluv")!=-1,o.RGBM=e.indexOf("rgbm")!=-1,a.DecodeEnvMap(o,t,!1,n)):i.irradianceMap&&n(null)};return THREE.ImageUtils.crossOrigin="",Array.isArray(e)?(r.irradianceMap=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,n),r.irradianceMap.format=THREE.RGBFormat):"string"==typeof e?e.toLowerCase().indexOf(".dds")!=-1&&(this.irradianceMap=(new THREE.DDSLoader).load(e,o)):n(e?e:null),i.irradianceMap},this.setTonemapMethod=function(e){for(var t in l){var i=l[t];i.tonemapOutput=e,i.needsUpdate=!0}},this.setEnvExposure=function(e){var t=Math.pow(2,e);u=t;for(var i in l){var n=l[i];n.envMapExposure=t,n.needsUpdate=!0}},this.setEnvRotation=function(e){h=Math.sin(e),d=Math.cos(e);for(var t in l){var i=l[t];i.envRotationSin=h,i.envRotationCos=d,i.needsUpdate=!0}},this.setTonemapExposureBias=function(e){var t=Math.pow(2,e);for(var i in l){var n=l[i];n.exposureBias=t,n.needsUpdate=!0}},this.initLayersTexture=function(e){for(var t=e.getData().layerCount,i=256,n=256,o=new Uint8Array(i*n),r=0,s=t;r<s;r++)o[r]=255;var a=new THREE.DataTexture(o,i,n,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,this.layerMaskTex=a,this.layersMap=e.getData().layersMap},this.initLineStyleTexture=function(){this.lineStyleTex=a.CreateLinePatternTexture()},this.initSelectionTexture=function(e){for(var t=e||1,i=4096,n=0|Math.ceil(t/i),o=1;o<n;)o*=2;n=o;for(var r=new Uint8Array(i*n),s=0;s<t;s++)r[s]=0;var a=new THREE.DataTexture(r,i,n,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);
a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,this.selectionTex=a},this.setSelectionTexture=function(e){if(this.selectionTex){var t=this.selectionTex.image;e.uniforms.tSelectionTexture.value=this.selectionTex,e.uniforms.vSelTexSize.value.set(t.width,t.height),e.needsUpdate=!0}},this.init2DSelectionMaterial=function(e){this.selectionTex||this.initSelectionTexture(e.myData.maxObjectNumber);var t=this.create2DMaterial(e.getData(),{},!1,!0),i=l[t];return i},this.setLayerVisible=function(e,t){for(var n=this.layerMaskTex,o=n.image.data,r=this.layersMap,s=t?255:0,a=0;a<e.length;++a){var c=e[a];o[r[c]]=s}n.needsUpdate=!0;for(var u in l)i(u)&&(l[u].needsUpdate=!0);this.viewer.invalidate(!0)},this.isLayerVisible=function(e){return!!this.layerMaskTex.image.data[this.layersMap[e]]},this.highlightObject2D=function(e,t){var i=this.selectionTex.image.data;i[e]=t?255:0,this.selectionTex.needsUpdate=!0,this.viewer.invalidate(!1,!1,!0)},this.cloneMaterial=function(e){var t=e.isPrismMaterial?a.clonePrismMaterial(e):e.clone();return(t instanceof THREE.MeshPhongMaterial||t.isPrismMaterial)&&(t.packedNormals=e.packedNormals,t.exposureBias=e.exposureBias,t.irradianceMap=e.irradianceMap,t.envMapExposure=e.envMapExposure,t.envRotationSin=e.envRotationSin,t.envRotationCos=e.envRotationCos,t.proteinType=e.proteinType,t.proteinMat=e.proteinMat,t.tonemapOutput=e.tonemapOutput,t.cutplanes=e.cutplanes),this.viewer.renderer().applyMRTFlags(t),t},this.getCutPlanes=function(){return m.slice()},this.getCutPlanesRaw=function(){return m},this.setCutPlanes=function(e){if(m.length!==(e?e.length||0:0)){var t;for(t in l){var i=l[t];i.doNotCut||(i.needsUpdate=!0,e&&e.length>0&&(i.side=THREE.DoubleSide))}for(t in c)c[t].doNotCut||(c[t].needsUpdate=!0)}for(;m.length>0;)m.pop();if(e)for(var n=0;n<e.length;n++)m.push(e[n].clone())},this.cleanup=function(e){var t={};for(var n in this.textures){var o=this.textures[n];n.indexOf(e.basePath)===-1?t[n]=o:o.tex&&(o.tex.dispose(),o.tex.needsUpdate=!0)}this.textures=t;var r={},s={type:"dispose"};for(var a in l)if(e&&a.indexOf(e.basePath)===-1)r[a]=l[a];else{var u=l[a];if(u.dispatchEvent(s),u.needsUpdate=!0,u.envMap=null,i(a)){u.uniforms.tLayerMask.value=null,u.uniforms.tLineStyle.value=null;var h=u.uniforms.tRaster;h&&h.value instanceof THREE.Texture&&(h.value.dispose(),h.value.needsUpdate=!0)}}l=this.materials=r;var d={};for(var a in c)if(e&&a.indexOf(e.basePath)===-1)d[a]=c[a];else{var u=c[a];u.dispatchEvent(s),u.needsUpdate=!0}c=d},this.addSimpleMaterial=function(e,t,i){var n=a.MaterialConverter.convertMaterial(t),r=o(i,e);this.addMaterial(r,n),this.loadTexture(n,i)},this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.removeMaterial=function(e){delete l[e]},this.exportModelMaterials=function(e,t){var i=e.getData(),n={};for(var o in l)if(o.indexOf(i.basePath)!==-1){var r=l[o],s=r.defines&&r.defines.hasOwnProperty("SELECTION_RENDERER");s||(n[o]=r)}var a={};for(var o in c)o.indexOf(i.basePath)!==-1&&(a[o]=c[o]);var u={};for(var h in this.textures)h.indexOf(i.basePath)!==-1&&(u[h]=this.textures[h]);return this.cleanup(i),{mats:n,matsNonHDR:a,textures:u}},this.importModelMaterials=function(e){for(var t in e.mats)i(t)?this.add2DMaterial(t,e.mats[t]):this.addMaterial(t,e.mats[t],!0);for(var t in e.matsNonHDR)this.addMaterialNonHDR(t,e.matsNonHDR[t]);for(var n in e.textures)this.textures[n]=e.textures[n]},this.setShadowParams=function(e){for(var t in l){var i=l[t];e.apply(i)}},this.getMaterialVariant=function(e,t,i){var n=i+"|"+e.id+"|"+t,o=l[n];return o||(o=this.cloneMaterial(e),t===a.MATERIAL_VARIANT.INSTANCED?(o.useInstancing=!0,o.vertexIds=!0):t===a.MATERIAL_VARIANT.VERTEX_IDS&&(o.vertexIds=!0),this.addMaterial(n,o,!0)),o}}function r(e){var t=e.clone();t.useInstancing=!0,e.variants=[t],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:null}}var s=Autodesk.Viewing,a=s.Private;Autodesk.Viewing.Private.MATERIAL_VARIANT={INSTANCED:0,VERTEX_IDS:1},Autodesk.Viewing.Private.MaterialManager=o,Autodesk.Viewing.Private.loadTextureWithSecurity=e,Autodesk.Viewing.Private.addInstancingSupport=r}(),function(){"use strict";function e(e,t){function i(e,t,i,n,o,r,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*r+a*o+t}var n,o,r,s,a,l,c,u,h,d=[],p=[];return n=(e.length-1)*t,o=Math.floor(n),r=n-o,d[0]=0===o?o:o-1,d[1]=o,d[2]=o>e.length-2?o:o+1,d[3]=o>e.length-3?o:o+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],s=r*r,a=r*s,p[0]=i(l[0],c[0],u[0],h[0],r,s,a),p[1]=i(l[1],c[1],u[1],h[1],r,s,a),p[2]=i(l[2],c[2],u[2],h[2],r,s,a),p}var t=Autodesk.Viewing.Private,i={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2},n=function(){this.animations=[]};n.prototype.init=function(e){if(e.initialized===!0)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var n=e.hierarchy[t].keys[i].rot;Array.isArray(n)||(n=[n._x,n._y,n._z,n._w]),e.hierarchy[t].keys[i].rot=(new THREE.Quaternion).fromArray(n)}for(var i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(var i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},n.prototype.parse=function(e){function t(e,i){if(i.push(e),e.children&&!(e instanceof THREE.Camera))for(var n=0;n<e.children.length;n++)t(e.children[n],i)}var i=[];return t(e,i),i},n.prototype.play=function(e){this.animations.indexOf(e)===-1&&this.animations.push(e)},n.prototype.stop=function(e){var t=this.animations.indexOf(e);t!==-1&&this.animations.splice(t,1)},n.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)};var o=function(e,t,n){this.root=e,this.handler=n.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=n.viewer,this.animator=n,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=i.LINEAR,this.setStartAndEndKeyTime()};o.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},o.prototype.keyTypes=[],o.prototype.defaultKey={},o.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},o.prototype.pause=function(){this.isPaused===!0?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},o.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},o.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},o.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={}),void 0===i.animationCache[this.data.name]&&(i.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:i.matrix});for(var n=i.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){for(var r=this.keyTypes[o],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(r,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(r,e,a.index+1);n.prevKey[r]=s,n.nextKey[r]=a}}this.setStartAndEndKeyTime()},o.prototype.getNextKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys;for(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n=n<o.length-1?n:o.length-1:n%=o.length;n<o.length;n++)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[0]},o.prototype.getPrevKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys;for(n=this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+o.length;n>=0;n--)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[o.length-1]},o.prototype.isPlayingOutOfRange=function(){return this.isPaused===!1&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},o.prototype.resetIfLooped=function(){this.loop===!0&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};var r=function(e,t,i){o.call(this,e,t,i),this.localMatrix=new THREE.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform};r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.keyTypes=["pos","rot","scl"],r.prototype.defaultKey={pos:0,rot:0,scl:0},r.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Quaternion,s=new THREE.Matrix4,a=new THREE.Matrix4)}var n,o,r,s,a,l=[];return function(c){if(this.isPlaying!==!1&&(this.currentTime+=c*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var u=0,h=this.hierarchy.length;u<h;u++){for(var d=this.hierarchy[u],p=d.animationCache[this.data.name],v=0;v<this.keyTypes.length;v++){var g=this.keyTypes[v],m=p.prevKey[g],f=p.nextKey[g];if(f.time<=this.currentTime||m.time>=this.currentTime){for(m=this.data.hierarchy[u].keys[0],f=this.getNextKeyWith(g,u,1);f.time<this.currentTime&&f.index>m.index;)m=f,f=this.getNextKeyWith(g,u,f.index+1);p.prevKey[g]=m,p.nextKey[g]=f}var E=m[g],A=f[g];if(f.time!==m.time&&void 0!==E&&void 0!==A){var y=(this.currentTime-m.time)/(f.time-m.time);if(y<0&&(y=0),y>1&&(y=1),"pos"===g)if(this.interpolationType===i.LINEAR)o.x=E[0]+(A[0]-E[0])*y,o.y=E[1]+(A[1]-E[1])*y,o.z=E[2]+(A[2]-E[2])*y,d.position.copy(o);else{l[0]=this.getPrevKeyWith("pos",u,m.index-1).pos,l[1]=E,l[2]=A,l[3]=this.getNextKeyWith("pos",u,f.index+1).pos,y=.33*y+.33;var T=e(l,y);if(o.x=T[0],o.y=T[1],o.z=T[2],d.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var w=e(l,1.01*y);n.set(w[0],w[1],w[2]),n.sub(vector),n.y=0,n.normalize();var b=Math.atan2(n.x,n.z);d.rotation.set(0,b,0)}}else"rot"===g?(THREE.Quaternion.slerp(E,A,r,y),d.quaternion.copy(r)):"scl"===g&&(o.x=E[0]+(A[0]-E[0])*y,o.y=E[1]+(A[1]-E[1])*y,o.z=E[2]+(A[2]-E[2])*y,d.scale.copy(o))}}if(!this.relativeTransform){var C=s.compose(d.position,d.quaternion,d.scale),S=a;d.getOriginalWorldMatrix(S),S.getInverse(S);var k=s.multiplyMatrices(C,S);k.decompose(d.position,d.quaternion,d.scale)}d.updateAnimTransform()}}}();var s=function(e,t,i){o.call(this,e,t,i)};s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.keyTypes=["pos","up","target","fov","perspective"],s.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},s.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[];return function(s){if(this.isPlaying!==!1&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var a=0,l=this.hierarchy.length;a<l;a++){for(var c=this.hierarchy[a],u=c.animationCache[this.data.name],h=0;h<this.keyTypes.length;h++){var d=this.keyTypes[h],p=u.prevKey[d],v=u.nextKey[d];if(v.time<=this.currentTime||p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],v=this.getNextKeyWith(d,a,1);v.time<this.currentTime&&v.index>p.index;)p=v,v=this.getNextKeyWith(d,a,v.index+1);u.prevKey[d]=p,u.nextKey[d]=v}var g=p[d],m=v[d];if(v.time!==p.time&&void 0!==g&&void 0!==m){var f=(this.currentTime-p.time)/(v.time-p.time);f<0&&(f=0),f>1&&(f=1);var E;if("pos"===d)E=c.position;else if("up"===d)E=c.up;else if("target"===d)E=c.target;else{if("fov"===d){c.setFov(g+(m-g)*f);continue}if("perspective"===d){var A=f>.5?m:g;A?c.toPerspective():c.toOrthographic();continue}}if(this.interpolationType===i.LINEAR)o.x=g[0]+(m[0]-g[0])*f,o.y=g[1]+(m[1]-g[1])*f,o.z=g[2]+(m[2]-g[2])*f,E.copy(o);else{r[0]=this.getPrevKeyWith(d,a,p.index-1)[d],r[1]=g,r[2]=m,r[3]=this.getNextKeyWith(d,a,v.index+1)[d],f=.33*f+.33;var y=e(r,f);if(o.x=y[0],o.y=y[1],o.z=y[2],E.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var T=e(r,1.01*f);n.set(T[0],T[1],T[2]),n.sub(E),n.y=0,n.normalize();var w=Math.atan2(n.x,n.z);c.rotation.set(0,w,0)}}}}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0}c.lookAt(c.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();var a=function(e,t,i,n){o.call(this,e,t,n),this.nodeId=i,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(e.getMaterial()))};a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.keyTypes=["vis","opa"],a.prototype.defaultKey={viz:1,opa:1},a.prototype.update=function(){return function(e){if(this.isPlaying!==!1&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++)for(var n=this.hierarchy[t],o=n.animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){var s=this.keyTypes[r],a=o.prevKey[s],l=o.nextKey[s];if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[t].keys[0],l=this.getNextKeyWith(s,t,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,t,l.index+1);o.prevKey[s]=a,o.nextKey[s]=l}var c=a[s],u=l[s];if(l.time!==a.time&&void 0!==c&&void 0!==u){var h=n.getMaterial();if("vis"===s){var d=Math.abs(this.currentTime-l.time)<this.epsilon,p=d?u:c;this.viewer.visibilityManager.setNodeOff(this.nodeId,!p)}else if("opa"===s){var v=(this.currentTime-a.time)/(l.time-a.time);v<0&&(v=0),v>1&&(v=1);var g=c+(u-c)*v;h.transparent=1!==g,h.opacity=g,g>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}();var l=function(e,t,i){function n(e,t,i){var n=r.container=document.createElement("div"),o=e.name;n.id=o,n.style.cursor="pointer",n.style.visibility=i;var s=document.createElement("div");s.id=o+"-txt",s.style.cssText="display: none;position: absolute;z-index: 1;",n.appendChild(s);var a=document.createElement("img"),l=e.custom&&e.custom.att&&1===e.custom.att;a.src=l?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",a.id=o+"-img",a.style.cssText="display: block;position: absolute;z-index: 1;",n.appendChild(a),t.api.container.appendChild(n),n.addEventListener("click",function(){s.style.display="none"===s.style.display?"block":"none"});var c=32512,u=.6,h=new THREE.SphereGeometry(.01),d=new THREE.MeshPhongMaterial({color:c,ambient:c,opacity:u,transparent:!0}),p=new THREE.Mesh(h,d);return p.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",p),p}var r=this;null===e&&(e=n(t,i.viewer,"hidden")),o.call(this,e,t,i),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(t){r.updateText(e.position,r.text)})};l.prototype=Object.create(o.prototype),l.prototype.constructor=l,l.prototype.keyTypes=["pos","text","vis"],l.prototype.defaultKey={pos:0,text:"",vis:1},l.prototype.stop=function(){o.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},l.prototype.updateText=function(e,t){function i(e,t,i){var n=e.clone(),o=new THREE.Matrix4;return t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),n.applyProjection(o),{x:(n.x+1)*i.width/2+i.offsetLeft,y:(-n.y+1)*i.height/2+i.offsetTop}}var n=i(e,this.viewer.camera,this.viewer.canvas),o=document.getElementById(this.id+"-txt");o&&(o.innerHTML=t,o.style.left=n.x+"px",o.style.top=n.y+"px",this.text=t),o=document.getElementById(this.id+"-img"),o&&(o.style.left=n.x+"px",o.style.top=n.y-24+"px")},l.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[];return function(s){if(this.isPlaying!==!1&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime){var a=document.getElementById(this.id);return void(a&&(a.style.visibility=this.state))}for(var l=0,c=this.hierarchy.length;l<c;l++){for(var u=this.hierarchy[l],h=u.animationCache[this.data.name],d=0;d<this.keyTypes.length;d++){var p=this.keyTypes[d],v=h.prevKey[p],g=h.nextKey[p];if(g.time<=this.currentTime||v.time>=this.currentTime){for(v=this.data.hierarchy[l].keys[0],g=this.getNextKeyWith(p,l,1);g.time<this.currentTime&&g.index>v.index;)v=g,g=this.getNextKeyWith(p,l,g.index+1);h.prevKey[p]=v,h.nextKey[p]=g}var m=v[p],f=g[p];if(g.time!==v.time&&void 0!==m&&void 0!==f){var E=(this.currentTime-v.time)/(g.time-v.time);if(E<0&&(E=0),E>1&&(E=1),"pos"===p){if(this.interpolationType===i.LINEAR)o.x=m[0]+(f[0]-m[0])*E,o.y=m[1]+(f[1]-m[1])*E,o.z=m[2]+(f[2]-m[2])*E,u.position.copy(o);else if(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD){r[0]=this.getPrevKeyWith("pos",l,v.index-1).pos,r[1]=m,r[2]=f,r[3]=this.getNextKeyWith("pos",l,g.index+1).pos,E=.33*E+.33;var A=e(r,E);if(o.x=A[0],o.y=A[1],o.z=A[2],u.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var y=e(r,1.01*E);n.set(y[0],y[1],y[2]),n.sub(vector),n.y=0,n.normalize();var T=Math.atan2(n.x,n.z);u.rotation.set(0,T,0)}}}else if("text"===p){var w=Math.abs(this.currentTime-g.time)<this.epsilon?f:m;this.updateText(u.position,w)}else if("vis"===p){var a=document.getElementById(this.id);if(a){var b=Math.abs(this.currentTime-g.time)<this.epsilon?f:m;a.style.visibility=b?"visible":"hidden"}}}}u.matrixAutoUpdate=!0,u.matrixWorldNeedsUpdate=!0}}}}();var c=function(e,t,i){this.viewer=i.viewer,null===e&&(e=this.createPolyline([])),o.call(this,e,t,i),this.epsilon=.1};c.prototype=Object.create(o.prototype),c.prototype.constructor=c,c.prototype.keyTypes=["points","vis"],c.prototype.defaultKey={points:[],vis:1},c.prototype.stop=function(){o.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},c.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(this.isPlaying!==!1&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime)return void e(this);for(var i=0,n=this.hierarchy.length;i<n;i++)for(var o=this.hierarchy[i],r=o.animationCache[this.data.name],s=0;s<this.keyTypes.length;s++){var a=this.keyTypes[s],l=r.prevKey[a],c=r.nextKey[a];if(c.time<=this.currentTime||l.time>=this.currentTime){for(l=this.data.hierarchy[i].keys[0],c=this.getNextKeyWith(a,i,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(a,i,c.index+1);r.prevKey[a]=l,r.nextKey[a]=c}var u=l[a],h=c[a];if(c.time!==l.time&&void 0!==u&&void 0!==h){var d=(this.currentTime-l.time)/(c.time-l.time);if(d<0&&(d=0),d>1&&(d=1),"points"===a){var p=d<.5?u:h;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var v=[],g=0;g<p.length;g++){var m=p[g].slice();if(0===g)m[0]=u[g][0]+(h[g][0]-u[g][0])*d,m[1]=u[g][1]+(h[g][1]-u[g][1])*d,m[2]=u[g][2]+(h[g][2]-u[g][2])*d;else if(g===p.length-1){var f=u.length-1,E=h.length-1;m[0]=u[f][0]+(h[E][0]-u[f][0])*d,m[1]=u[f][1]+(h[E][1]-u[f][1])*d,m[2]=u[f][2]+(h[E][2]-u[f][2])*d}var A=new THREE.Vector3(m[0],m[1],m[2]);v.push(A)}this.root=this.createPolyline(v)}else if("vis"===a){var y=Math.abs(this.currentTime-c.time)<this.epsilon?h:u;this.root.visible=y,y||e(this)}}}}}}(),c.prototype.createPolyline=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(e[i]);t.computeLineDistances();var n=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),o=new THREE.Line(t,n,THREE.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",o),o},t.Animation=o,t.AnimationHandler=n,t.MeshAnimation=r,t.CameraAnimation=s,t.PolylineAnimation=c,t.VisibilityAnimation=a,t.AnnotationAnimation=l}(),function(){"use strict";var e=Autodesk.Viewing.Private,t=function(e,t){this.animations=[],this.viewer=e,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2};t.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},t.prototype.add=function(t){function i(e){function t(e,t,i){for(t=e.length;i=--t;)for(;i--;)e[t]!==e[i]||e.splice(i,1)}e.sort(function(e,t){return e-t}),t(e)}if(!(!t.hierarchy||t.hierarchy.length<1||!t.hierarchy[0].keys||t.hierarchy[0].keys.length<2)){var n=null,o=this;if("camera"===t.type?(n=new e.CameraAnimation(o.viewer.camera,t,o),o.animations.push(n)):"annotation"===t.type?(n=new e.AnnotationAnimation(null,t,o),o.animations.push(n)):"polyline"===t.type?(n=new e.PolylineAnimation(null,t,o),o.animations.push(n)):"mesh"!==t.type&&"visibility"!==t.type||o.viewer.model.getData().instanceTree.enumNodeFragments(t.id,function(i){var r=o.viewer.getFragmentProxy(o.viewer.model,i);r&&(n="mesh"===t.type?new e.MeshAnimation(r,t,o):new e.VisibilityAnimation(r,t,t.id,o),o.animations.push(n))},!0),n){for(var r=0,s=t.hierarchy.length;r<s;r++)for(var a=t.hierarchy[r].keys,l=0;l<a.length;l++)void 0===a[l].xk&&o.keys.push(a[l].time);i(o.keys)}this.updateFlag|=this.UPDATE_SCENE}},t.prototype.update=function(e){this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),t|=this.UPDATE_SCENE),this.updateFlag=0,t},t.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)return void this.pause();for(var i=0;i<this.animations.length;i++){var n=this.animations[i];n.play(e)}this.isPlaying=!0,this.isPaused=!1},t.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},t.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof Autodesk.Viewing.Private.CameraAnimation&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},t.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.stop()}this.isPlaying=!1,this.isPaused=!1},t.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];i.goto(e)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},t.prototype.next=function(){function e(e,t){for(var i=-1,n=0;n<t.length;n++)if(t[n]>e){i=t[n];break}return i<0?t[t.length-1]:i}var t=e(this.currentTime,this.keys);this.goto(t)},t.prototype.prev=function(){function e(e,t){for(var i=-1,n=t.length-1;n>-1;n--)if(t[n]<e){i=t[n];break}return i<0?t[0]:i}var t=e(this.currentTime,this.keys);this.goto(t)},e.KeyFrameAnimator=t}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,ENABLE_DEBUG=avp.ENABLE_DEBUG||!0,ENABLE_TRACE=avp.ENABLE_TRACE||!0;!function(){"use strict";function e(e,t){function i(e){if(!e)return null;var t=window.devicePixelRatio;t||(t=1);var i=av.InitParametersSetting;i.canvas=e,i.devicePixelRatio=t;var n=new avp.FireflyWebGLRenderer(i);return n.context?(n.autoClear=!1,n.sortObjects=!1,n):null}function n(e){var t=L,i=!0,n=t==avp.RENDER_NORMAL,o=S.settings.idbuffer&&t!=avp.RENDER_HIDDEN;t==avp.RENDER_HIDDEN?e.overrideMaterial=V.fadeMaterial:t==avp.RENDER_HIGHLIGHTED&&(e.overrideMaterial=V.highlightMaterial),S.renderScenePart(e,i,n,o),e.overrideMaterial=null}function o(e){J++,Q>0&&(Z=.8*Z+.2*(e-Q)),V.fpsCallback&&V.fpsCallback(V.fps())}function r(e){if(V.keyFrameAnimator){var t=Q>0?(e-Q)/1e3:0,i=V.keyFrameAnimator.update(t);if(i&&(V.sceneUpdated(!0),i&V.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function s(){y&&(V.camera.aspect=T/w,V.camera.clientWidth=T,V.camera.clientHeight=w,S.setSize(T,w),V.controls.handleResize(),R&&R.setSize(T,w),V.invalidate(!0,!0,!0),y=!1,V.api.fireEvent({type:av.VIEWER_RESIZE_EVENT,width:T,height:w}))}function a(){if((M.enabled||R)&&!V.is2d){var e;if(e=V.model&&!V.model.isLoadDone()?V.model.getData().bbox:V.getVisibleBounds(!0,!1)){M.needClear=!0;var t=V.camera,i=e.clone(),n=new THREE.Vector3(1,0,0),o=z.clone();t.worldUpTransform&&(i.applyMatrix4(t.worldUpTransform),n.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),i.min.y-=.005*(i.max.y-i.min.y),k&&k.expandByGroundShadow(i,o);var r=i.size(),s=i.center();if(k||(r.x*=1.25,r.z*=1.25,r.x=r.z=Math.max(r.x,r.z)),t.worldUpTransform){var a=(new THREE.Matrix4).getInverse(t.worldUpTransform);s.applyMatrix4(a)}if(M.setTransform(s,r,t.worldup,n),R){var l=(new THREE.Vector3).subVectors(s,t.worldup.clone().multiplyScalar(r.y/2));R.setTransform(l,t.worldup,r)}k&&k.setGroundShadowTransform(s,r,t.worldup,n)}}}function l(e){Y&&(a(),Y=!1)}function c(e){for(var t in V.selectionMeshes){var i=V.selectionMeshes[t],n=i.model.getFragmentList();i.geometry===n.getGeometry(i.fragId)&&n.getWorldMatrix(i.fragId,i.matrix)}}function u(){k&&(k.state=avp.SHADOWMAP_NEEDS_UPDATE)}function h(e){if(!k||!V)return e;var t=G||U;if(L==avp.RENDER_SHADOWMAP){if(t)return L=avp.RENDER_FINISHED,e;e=k.continueUpdate(P,e,b),k.state==avp.SHADOWMAP_VALID&&(L=avp.RENDER_FINISHED,U=!0,G=!0)}return k.state==avp.SHADOWMAP_NEEDS_UPDATE?e=k.startUpdate(P,e,V.camera,z,b):t||L==avp.RENDER_FINISHED&&k.state==avp.SHADOWMAP_INCOMPLETE&&(e=k.startUpdate(P,e,V.camera,z,b),L=avp.RENDER_SHADOWMAP),e}function d(e){b.updateMaterials();var t=r(e),i=V.controls.update(e),a=P&&P.update(e),u=i||t||x||a,d=y;y&&s(),U=U||u,W=W||u,W&&c(e),W=W||S.overlayUpdate(e);var p=V.model&&(V.model.isLoadDone()||V.model.myData.partPacksLoadDone===!0),v=V.progressiveRender?V.targetFrameBudget:1e10,g=v,m=P;if(Y&&l(e),g=h(g),!k||L!=avp.RENDER_SHADOWMAP){var f=!1;if(!M||V.is2d||$||(f=M.prepareGroundShadow(V)),U||G){if(u&&V.skipAOWhenMoving&&S.settings.sao&&!te&&(S.setAOEnabled(!1),te=!0),p&&V.signalProgress(0),X>0){var E=e-X;K=.75*K+.25*E}X=e,K<N&&v<I?V.targetFrameBudget+=1:K>N&&v>D&&(V.targetFrameBudget-=1),V.updateCameraMatrices(),S.beginScene(V.scene,V.camera,V.lightsOn?V.lights:V.no_lights,U),(u||d)&&V.api.fireEvent(V.cameraChangedEvent),f&&!R&&V.renderGroundShadow(),m&&(m.hasHighlighted()?(L=avp.RENDER_HIGHLIGHTED,m.reset(V.camera,L,u|U)):(L=avp.RENDER_NORMAL,m.reset(V.camera,L,u|U)))}else X=-1;if(R&&!V.is2d&&!$){var A=R.prepareGroundReflection(V,M,U);A&&P.isDone()&&V.showGhosting&&!P.areAllVisible()&&(L=avp.RENDER_HIDDEN,P.reset(V.camera,L))}var T=!1;m.isEmpty()||m.isDone()||(T=!0,g=m.renderSome(n,g),m.isDone()&&L===avp.RENDER_HIGHLIGHTED&&(L=avp.RENDER_NORMAL,m.reset(V.camera,L),g=m.renderSome(n,g)),m.isDone()?(L===avp.RENDER_NORMAL&&!m.areAllVisible()&&V.showGhosting?R&&!R.finished||(L=avp.RENDER_HIDDEN,m.reset(V.camera,L),g=m.renderSome(n,g)):(L=avp.RENDER_FINISHED,S.renderScenePart(V.sceneAfter,!0,!0,!0)),p&&V.signalProgress(100)):p&&V.signalProgress(100*m.getRenderProgress()),o(e)),W&&(T=!0,S.renderScenePart(V.sceneAfter,!0,!0,!0),!m.isEmpty()&&m.isDone()||V.showOverlaysWhileMoving?(V.renderOverlays(),m.isEmpty()||m.isDone()||(W=!0)):S.clearAllOverlays());var w=!0;V.skipAOWhenMoving&&(u||!m.isDone()?w=!1:H&&(T=!0,te&&(ie=!0))),T&&S.composeFinalFrame(!w),H=u,Q=e,m&&m.needsRender()?(G=!0,m.resetNeedsRender()):G=!1,U=!1,x=!1,ie&&(ie=!1,S.setAOEnabled(!0),te=!1,V.invalidate(!0,!0))}}function p(){for(var e in V.selectionMeshes){var t=V.selectionMeshes[e];t.model&&t.model.isConsolidated()&&t.model.updateRenderProxy(t,t.fragId)}}function v(e){function t(){if(i.animations){V.keyFrameAnimator=new avp.KeyFrameAnimator(V,i.animations.duration);for(var e in i.animations.animations)V.keyFrameAnimator.add(i.animations.animations[e]);V.keyFrameAnimator.goto(0),V.api.fireEvent({type:av.ANIMATION_READY_EVENT})}V.api.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}var i=e.getData();e.isObjectTreeCreated()?t():V.api.addEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}function g(e,t){le=le||new THREE.Box3,t.updateMatrixWorld(!0),t.traverse(function(t){var i=t.geometry;void 0!==i&&i.visible&&(i.boundingBox||i.computeBoundingBox(),le.copy(i.boundingBox),le.applyMatrix4(t.matrixWorld),e.union(le))})}function m(){var e=new THREE.Box3,t=V.overlayScenes;for(var i in t)t.hasOwnProperty(i)&&g(e,t[i].scene);return g(e,V.scene),e}function f(e){var t,i,n,o=";base64,";if(e.indexOf(o)==-1)return t=e.split(","),i=t[0].split(":")[1],n=decodeURIComponent(t[1]),new Blob([n],{type:i});t=e.split(o),i=t[0].split(":")[1],n=window.atob(t[1]);for(var r=n.length,s=new Uint8Array(r),a=0;a<r;++a)s[a]=n.charCodeAt(a);return new Blob([s],{type:i})}var E,A,y,T,w,b,C,S,k,x,M,R,P,V=this,I=1e3/15,N=1e3/30,D=1e3/120,L=avp.RENDER_NORMAL,O=-1,_=-1,H=!1,B="y",F=null,z=null,U=!1,G=!1,W=!1,j={
type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,percent:0},Y=!1,q=0,X=0,K=0,Q=0,Z=1e3/60,J=0,$=!0,ee=!1,te=!1,ie=!1,ne=!1,oe=1,re=null,se=null;e&&setInterval(function(){$||J<60||V.track({name:"fps",value:Number(V.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=t,this.canvas=e,this.loader=null,this.initialize=function(){if(E=new THREE.Vector3(0,1,0),P=new avp.RenderScene,C=i(e),C||av.isNodeJS){S=new avp.RenderContext,S.init(C,e?e.clientWidth:0,e?e.clientHeight:0),b=new avp.MaterialManager(this),avp.init_UnifiedCamera(THREE),this.camera=new av.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],re=(new THREE.Color).setRGB(1,1,1),se=(new THREE.Color).setRGB(1,1,1),this.cameraChangedEvent=this.camera.getCameraChangedEvent(),F=new THREE.Vector3(1,1,1),z=(new THREE.Vector3).copy(F),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,ae("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,b.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,b.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=N,av.isMobileDevice()&&(I*=2,D/=2,N*=2,this.targetFrameBudget/=2),this.controls={update:function(e){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){}},this.selector=new avp.MultiModelSelector(this),this.visibilityManager=new avp.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null;var t=avp.LightPresets[avp.DefaultLightPreset].bgColorGradient;this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),M=new av.Shaders.GroundShadow(C),M.enabled=!0,b.addMaterialNonHDR("groundShadowDepthMaterial",M.getDepthMaterial()),b.addOverrideMaterial("normalsMaterial",S.getDepthMaterial()),S.beginScene(this.scene,this.camera,this.noLights,!0),S.composeFinalFrame(!0)}},this.renderGroundShadow=function(e){k?k.state==avp.SHADOWMAP_VALID&&k.renderGroundShadow(V.camera,e||S.getColorTarget()):(M.renderShadow(V.camera,e||S.getColorTarget()),M.rendered=!0)},this.run=function(){A=0,setTimeout(function(){!function e(t){A=window.requestAnimationFrame(e),d(t)}()},1)},this.toggleProgressive=function(e){this.progressiveRender=e,U=!0},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,S.toggleSwapBlackAndWhite(e),U=!0},this.toggleGhosting=function(e){this.showGhosting=e,U=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){S.initPostPipeline(e,t),this.fireRenderOptionChanged(),U=!0},this.toggleCelShading=function(e){S.toggleCelShading(e),this.fireRenderOptionChanged(),U=!0},this.toggleGroundShadow=function(e){M.enabled!==e&&(M.enabled=e,M.clear(),a(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(e){M.enabled&&(M.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){M.enabled&&(M.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&R||!e&&!R||(e?(R=new av.Shaders.GroundReflection(C,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:S.getClearPass()}),R.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),R.toggleEnvMapBackground(ee),R.setEnvRotation(S.getEnvRotation()),a()):(R.cleanup(),R=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){R&&(R.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){R&&(R.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){ee=e,S.toggleEnvMapBackground(e),R&&R.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return ee},this.toggleRenderPrism=function(e){b.setRenderPrism(e)},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){p();var e=this.lightsOn;e||this.toggleLights(!0,!0);var t;this.dir_light1&&(t=this.dir_light1.intensity,this.dir_light1.intensity=1),S.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),e||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=t),W=!1},this.setLayerVisible=function(e,t){this.matman().setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.matman().isLayerVisible(e)},this.updateCameraMatrices=function(){function e(){t=new THREE.Matrix4,i=new THREE.Matrix4,n=new THREE.Box3}var t,i,n;return function(){n||e();var o=this.camera;if(t.compose(o.position,o.quaternion,o.scale),i.getInverse(t),o.worldup&&this.setWorldUp(o.worldup),this.model){var r=this.getVisibleBounds(!0,W);if(n.copy(r),R){var s=new THREE.Vector3;s.multiplyVectors(n.max,o.worldup);var a=new THREE.Vector3;a.multiplyVectors(n.min,o.worldup),s.sub(a),s.x>=0?n.min.x-=s.x:n.max.x-=s.x,s.y>=0?n.min.y-=s.y:n.max.y-=s.y,s.z>=0?n.min.z-=s.z:n.max.z-=s.z}k&&k.groundShapeBox&&n.union(k.groundShapeBox),n.applyMatrix4(i);var l=1e-5*(n.max.z-n.min.z),c=.5*(n.max.y-n.min.y),u=-(n.max.z+l)-c,h=-(n.min.z-l)+c;o.isPerspective&&(u=Math.max(u,Math.min(1,1e-4*Math.abs(h-u)))),h=Math.max(h,u),o.near=u,o.far=h,o.updateProjectionMatrix();var d;if(this.model.is2d()){var p=this.intersectGroundViewport(new THREE.Vector3(0,0,1));d=p?o.position.distanceTo(p):o.position.distanceTo(r.center());var v=S.settings.deviceHeight/(2*d*Math.tan(THREE.Math.degToRad(.5*o.fov)));b.updatePixelScale(v),b.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var g,m=b.getCutPlanesRaw();if(m&&m.length){var f=m[0],E=o.target.clone().sub(o.position).normalize(),A=E.dot(f);if(0===A)g=r.center();else{var y=-(o.position.clone().dot(f)+f.w)/A;g=r.clampPoint(E.multiplyScalar(y).add(o.position))}}else g=r.center();d=o.position.distanceTo(g);var v=S.settings.deviceHeight/(2*d*Math.tan(THREE.Math.degToRad(.5*o.fov)));b.updatePixelScale(v)}}}}(),this.initLights=function(){this.dir_light1=new THREE.DirectionalLight(re,oe),this.dir_light1.position.set(-1,0,1),this.amb_light=new THREE.AmbientLight(se),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),ne=!0},this.toggleLights=function(e,t){if(this.amb_light){this.lightsOn=e;var i=avp.LightPresets[O],n=i.ambientColor,o=i.directLightColor;n=n||se.toArray(),o=o||re.toArray(),this.lightsOn?(t&&this.amb_light?this.amb_light.color.setRGB(.5*o[0],.5*o[1],.5*o[2]):this.amb_light&&this.amb_light.color.setRGB(n[0],n[1],n[2]),this.dir_light1&&this.dir_light1.color.setRGB(o[0],o[1],o[2])):this.amb_light&&t&&this.amb_light.color.setRGB(n[0],n[1],n[2])}},this.syncCamera=function(e){this.camera.updateProjectionMatrix(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),x=!0},this.setViewFromFile=function(e,t){var i,n=e.getDefaultCamera();if(n)i=n;else{i={};var o=e.getBoundingBox(),r=o.size();if(i.target=o.center(),e.is2d()){i.isPerspective=!1;var s=r.x/r.y,a=this.camera.aspect;a>s?i.orthoScale=r.y:i.orthoScale=r.x/a,i.up=new THREE.Vector3(0,0,1),i.position=i.target.clone(),i.position.z+=i.orthoScale,i.target.y+=1e-6*r.y}else i.isPerspective=!0,i.fov=this.camera.fov,i.up=this.camera.up.clone(),i.position=i.target.clone(),i.position.z+=1.5*Math.max(r.x,r.y,r.z)}this.setViewFromCamera(i,t)},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),i=t.size(),n=e.target.clone().sub(e.position);if(n.length()>1e3*i.length()){var o=e.position.distanceTo(t.center());e.target.copy(e.position).add(n.normalize().multiplyScalar(o))}else e.position.copy(e.target).add(n.normalize().multiplyScalar(-e.orthoScale))}},this.setViewFromCamera=function(e,t){this.adjustOrthoCamera(e);var i=!1,n=this.model?this.model.getUpVector():null;this.model&&this.model.getData().basePath.indexOf("SaRang")!=-1&&(n=[0,0,1]);var o;o=n?(new THREE.Vector3).fromArray(n):i?e.up.clone():av.Navigation.snapToAxis(e.up.clone()),i?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",o.equals(e.up)):e.up=o;var r=this.api.navigation;if(r)if(t){var s=this.camera;s.up.copy(e.up),s.position.copy(e.position),s.target.copy(e.target),e.isPerspective?s.fov=e.fov:(s.saveFov=e.fov,s.fov=av.UnifiedCamera.ORTHO_FOV),s.isPerspective=e.isPerspective,s.orthoScale=e.orthoScale,s.dirty=!0,r.setWorldUpVector(i?o:s.up),r.setView(s.position,s.target),r.setPivotPoint(s.target),this.syncCamera(!0)}else if(this.camera.isPerspective=e.isPerspective,i)r.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,o);else{var a=r.computeOrthogonalUp(e.position,e.target);r.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,a,o)}x=!0},this.setViewFromViewBox=function(e,t,i,n){if(e.is2d()){var o={},r=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;a>s.aspect?o.orthoScale=s.height:o.orthoScale=s.width/a,o.isPerspective=!1,o.position=new THREE.Vector3(s.centerX,s.centerY,r.center().z+o.orthoScale),o.target=new THREE.Vector3(s.centerX,s.centerY,r.center().z),o.target.y+=1e-6*s.height,o.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(o,n)}},this.setWorldUp=function(e){if(!E.equals(e)){E.copy(e);var t=Math.abs(e.x);B="x",Math.abs(e.y)>t&&(B="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(B="z");var i=function(e,t){var i=(new THREE.Vector3).crossVectors(t,e).normalize(),n=Math.acos(e.dot(t));return(new THREE.Matrix4).makeRotationAxis(i,n)},n=new THREE.Vector3(0,1,0);V.camera.worldUpTransform=i(n,e),this.sceneUpdated(!1)}},this.addModel=function(e){if(e){var t=!!this.model,i=e.is2d(),n=0;if(!this.model){this.model=e,S.setUnitScale(e.getUnitScale());var o=e.getData().bbox;n=o.size().length()}if(P.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),i){b.initLayersTexture(e);var r=b.create2DMaterial(e.getData(),{},!0),s=b.findMaterial(e.getData(),r);if(S.enter2DMode(s),!t){this.is2d=!0,_=O,this.setLightPreset(avp.DefaultLightPreset2d);var a=e.getData();if(a.hidePaper){var l=a.bgColor,c=l>>16&255,u=l>>8&255,h=255&l;this.setClearColors(c,u,h,c,u,h)}}}if(this.api.navigation){this.api.navigation.setIs2D(i&&!t),this.api.setActiveNavigationTool();var d=e.getData();d.isLeaflet?this.api.navigation.setConstraints2D(d.bbox,d.maxPixelPerUnit):this.api.navigation.setConstraints2D()}t||(this.setViewFromFile(e,!0),this.controls.recordHomeView()),i||this.setLightPresetFromFile(e)||(_>=0?(this.setLightPreset(_,!0),_=-1):this.setLightPreset(O,!1)),n>0&&S.setAOOptions(Math.min(10,.05*n)),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return b},this.setupMesh=function(e,t,i,n){var o=e.getData(),r={geometry:t,matrix:n,isLine:t.isLines,is2d:t.is2d};if(t.isLines){var s=!!t.attributes.color,a=new THREE.LineBasicMaterial({vertexColors:s});if(!s){var l=b.findMaterial(o,i);a.color=l.color}b.addMaterialNonHDR(o.basePath+i+"_line_"+a.id,a),r.material=a,o.hasLines=!0}else{var a=b.findMaterial(o,i);a&&(a.svfMatId=i),b.applyGeometryFlagsToMaterial(a,t),r.material=a}return r},this.onDemandLoadComplete=function(e){$=!1,this.signalProgress(100),this.invalidate(!1,!0);var t=e.getData();t.hasLines&&b.togglePolygonOffset(!0),v(e),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e,onDemandLoad:!0})},this.onLoadComplete=function(e){$=!1,this.signalProgress(100),this.sceneUpdated(!1),this.is2d&&(this.selectionMaterial2d=b.init2DSelectionMaterial(e),this.createOverlayScene("selection2d",this.selectionMaterial2d));var t=e.getData(),i=P.getGeometryList();i&&P.getGeometryList().printStats(),t.hasLines&&b.togglePolygonOffset(!0),v(e),e.hasGeometry()||avp.logger.warn("Loaded model has not geometry."),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e})},this.signalProgress=function(e){j.percent!==e&&(j.percent=e,this.api.fireEvent(j))},this.resize=function(e,t){y=!0,T=e,w=t},this.unloadModel=function(e){if(this.removeModel(e)){if(e.isLoadDone()){var t=e.getData().propWorker;t&&t.dtor()}e.loader&&e.loader.dtor()}},this.removeModel=function(e){return!!P.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),e.dtor(this.glrenderer()),b.cleanup(e.getData()),this.selector.removeModel(e),this.visibilityManager.removeModel(e),e===this.model&&(this.model=null,P.isEmpty()||(this.model=P.getModels()[0])),this.api.fireEvent({type:av.MODEL_UNLOADED_EVENT,model:e}),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),S.exit2DMode(),O=_),S.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),S.composeFinalFrame(!0);for(var e=P.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t])};var ae=function(e,t,i){t.depthWrite=!1,t.depthTest=!0,t.side=THREE.DoubleSide,i.depthWrite=!1,i.depthTest=!0,i.side=THREE.DoubleSide,avp.addInstancingSupport(t),avp.addInstancingSupport(i),V.createOverlayScene(e,t,i)};this.createOverlayScene=function(e,t,i,n){t&&b.addOverrideMaterial(e+"_pre",t),i&&b.addOverrideMaterial(e+"_post",i);var o=new THREE.Scene;o.__lights=this.scene.__lights,this.overlayScenes[e]={scene:o,camera:n,materialPre:t,materialPost:i}},this.removeOverlayScene=function(e){var t=this.overlayScenes[e];t&&(delete this.overlayScenes[e],this.invalidate(!1,!1,!0))},this.addOverlay=function(e,t){this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.removeOverlay(e,t[i])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,i,n=this.overlayScenes[e].scene;for(i=n.children.length-1;i>=0;--i)t=n.children[i],t&&n.remove(t);this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,n,o,r){if(this.clearColorTop=new THREE.Vector3(e/255,t/255,i/255),this.clearColorBottom=new THREE.Vector3(n/255,o/255,r/255),!b.reflectionCube||b.reflectionCube.isBgColor){var s=b.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);S.setCubeMap(s)}S.setClearColors(this.clearColorTop,this.clearColorBottom),R&&R.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),U=!0,this.fireRenderOptionChanged()};var le;this.getVisibleBounds=function(e,t){var i=new THREE.Box3;return P.isEmpty()||(g(i,this.scene),i=P.getVisibleBounds(e).union(i),t&&(i=m().union(i))),i},this.getFitBounds=function(e){var t;return this.is2d&&(e=!0),e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.empty()||(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.getFragmentProxy=function(e,t){return new avp.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(e){return!P||P.areAllVisible()},this.highlightObjectNode=function(e,t,i,n){e.is2d()&&b.highlightObject2D(t,i);var o=this,r=e.getData().instanceTree;if(r&&!e.is2d())r.enumNodeFragments(t,function(t){o.highlightFragment(e,t,i,n)},!1);else{var s=t;if(e.is2d()&&(s=e.getData().fragments.dbId2fragId[t]),Array.isArray(s))for(var a=0;a<s.length;a++)o.highlightFragment(e,s[a],i,n);else o.highlightFragment(e,s,i,n)}},this.highlightFragment=function(e,t,i,n){var o=this.getRenderProxy(e,t);if(o){var r=!n||o.is2d,s=e.id+":"+t;if(r){var a=e.is2d()?"selection2d":"selection";if(i){var l=new THREE.Mesh(o.geometry,o.material);l.matrix.copy(o.matrixWorld),l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0,l.frustumCulled=!1,l.model=e,l.fragId=t,this.addOverlay(a,l),this.selectionMeshes[s]=l}else this.selectionMeshes[s]&&(this.removeOverlay(a,this.selectionMeshes[s]),delete this.selectionMeshes[s])}r&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){e!=q&&(q=e,P.explode(e),this.sceneUpdated(!0),this.api.fireEvent({type:av.EXPLODE_CHANGE_EVENT,scale:e}))},this.getExplodeScale=function(){return q},this.setGhostingBrightness=function(e){e?this.fadeMaterial.color=new THREE.Color(1052688):this.fadeMaterial.color=new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.setLightPreset=function(e,t){if(ne||this.initLights(),O!=e||t){(e<0||avp.LightPresets.length<=e)&&(e=avp.DefaultLightPreset),O=e;var i=avp.LightPresets[e];if(i&&i.path){var n="res/environments/"+i.path,o=avp.getResourceUrl(n+"_mipdrop."+(i.type||"")+".dds"),r=avp.getResourceUrl(n+"_irr."+(i.type||"")+".dds"),s=(b.setIrradianceMap(r,i.E_bias),b.setCubeMap(o,i.E_bias));S.setCubeMap(s),b.setEnvExposure(-i.E_bias),S.setEnvExposure(-i.E_bias),this.setTonemapExposureBias(i.E_bias),this.setTonemapMethod(i.tonemap),this.setGhostingBrightness(i.darkerFade)}else{b.setIrradianceMap(null);var s=b.setCubeMap(null);S.setCubeMap(s),b.setEnvExposure(0),S.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1)}var a=av.Shaders.SAOShader.uniforms.radius.value,l=av.Shaders.SAOShader.uniforms.intensity.value;i.hasOwnProperty("saoRadius")&&(a=i.saoRadius),i.hasOwnProperty("saoIntensity")&&(l=i.saoIntensity),S.setAOOptions(a,l);var c=i.bgColorGradient;c||(c=avp.BackgroundPresets.Custom),this.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5]);var h=oe;null!==i.lightMultiplier&&void 0!==i.lightMultiplier&&(h=i.lightMultiplier),z.copy(F),i.lightDirection&&z.fromArray(i.lightDirection).negate(),k&&u(),this.dir_light1&&(this.dir_light1.intensity=h,i.lightDirection&&this.dir_light1.position.set(-i.lightDirection[0],-i.lightDirection[1],-i.lightDirection[2])),b.setEnvRotation(i.rotation||0),S.setEnvRotation(i.rotation||0),R&&R.setEnvRotation(i.rotation||0),this.toggleLights(0!==h),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;var t=e.getMetadata("renderEnvironmentStyle","value",null);if(null===t||""===t)return!1;var i=e.getMetadata("renderEnvironmentGroundReflection","value",null);null!==i&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(i)));var n=e.getMetadata("renderEnvironmentGroundShadow","value",null);null!==n&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(n)));var o=e.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==o&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(o,S.getAntialiasing())));var r=e.getMetadata("renderEnvironmentDisplayLines","value",null);null!==r&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!r)));var s=avp.LightPresets.filter(function(e){return e.name===t});if(s=s[0]||null)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))avp.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var a=avp.ModelSettingsEnvironment;a||(a=avp.ModelSettingsEnvironment={},avp.LightPresets.push(a)),avp.copyLightPreset(s,a),a.name="(Custom: Model defined)";var l=e.getMetadata("renderEnvironmentExposureBias","value",null),c=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==l&&null!==c&&(a.E_bias=l+c);var u=e.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):u&&(a.bgColorGradient=[255*u[0],255*u[1],255*u[2],255*u[0],255*u[1],255*u[2]]);var h=e.getMetadata("renderEnvironmentRotation","value",null);null!==h&&(a.rotation=h);var d=avp.LightPresets.indexOf(a);this.api.setLightPreset(d)}var p=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==p&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(p))),s},this.setTonemapMethod=function(e){e!=S.getToneMapMethod()&&(S.setTonemapMethod(e),b.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=S.getExposureBias()&&(S.setTonemapExposureBias(e),b.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(A),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,P=null,S=null,b.dtor(),b=null},this.hideLines=function(e){return!(!P||P.isEmpty())&&(P.hideLines(e),this.sceneUpdated(!0),!0)},this.getCutPlanes=function(){return b.getCutPlanes()},this.setCutPlanes=function(e){b.setCutPlanes(e),this.sceneUpdated(),this.api.fireEvent({type:av.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){b.toggleMRTSetting(),this.api.fireEvent({type:av.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){var i=this.camera;e.z=-1;var n=new THREE.Vector3(e.x,e.y,1);return e=e.unproject(i),n=n.unproject(i),n.sub(e).normalize(),t||(t=new THREE.Ray),t.set(i.isPerspective?i.position:e,n),t},this.rayIntersect=function(e,t,i,n){var o=P.rayIntersect(e.origin,e.direction,t,i,n);if(this.sceneAfter.children.length){var r=new THREE.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far),s=[];avp.VBIntersector.intersectObject(this.sceneAfter,r,s,!0),s.length&&(!o||s[0].distance<o.distance)&&(o=s[0])}if(!o)return null;var a=o.fragId,l=o.point,c=o.face,u=o.model,h=o.dbId;if(void 0===h&&void 0!==a){h=u.getFragmentList().getDbIds(a);var d=u.getData().instanceTree;d||(h=a)}return{dbId:h,fragId:a,intersectPoint:l,face:c,model:u}},this.castRayViewport=function(){var e;return function(t,i,n,o){return e=e||new THREE.Ray,P?(this.viewportToRay(t,e),this.rayIntersect(e,i,n,o)):{}}}(),this.clientToViewport=function(e,t){var i=V.canvas.getBoundingClientRect();return new THREE.Vector3((e+.5)/i.width*2-1,2*-((t+.5)/i.height)+1,1)},this.viewportToClient=function(e,t){var i=V.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(e+1)*i.width-.5,(t-1)*-.5*i.height-.5,0)},this.castRay=function(e,t,i){return this.castRayViewport(this.clientToViewport(e,t),i)},this.intersectGroundViewport=function(e){var t=this.camera,i="z";this.is2d||(i=B);var n=e;n.z=-1;var o=new THREE.Vector3(n.x,n.y,1);n=n.unproject(t),o=o.unproject(t),o.sub(n).normalize();var r=o;if(Math.abs(r[i])<1e-6)return null;var s;s=t.isPerspective?t.position:n;var a=this.model?this.model.getBoundingBox().min[i]:0,l=(a-s[i])/r[i];return r.multiplyScalar(l),r.add(s),r},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this.hitTestViewport=function(e,t){var i;if(V.is2d){var n,o=[];if(n=av.isMobileDevice()?S.idAtPixels(e.x,e.y,45,o):S.idAtPixels(e.x,e.y,5,o),n<=0)return null;var r=this.intersectGroundViewport(e),s=P.findModel(o[1])||V.model;i={intersectPoint:r,dbId:n,fragId:s.getData().fragments.dbId2fragId[n],model:s}}else i=this.castRayViewport(e,t);return i},this.hitTest=function(e,t,i){return V.hitTestViewport(this.clientToViewport(e,t),i)},this.snappingHitTestViewport=function(e,t){var i;if(V.is2d){var n;if(n=av.isMobileDevice()?S.idAtPixels(e.x,e.y,45):S.idAtPixels(e.x,e.y,17),n<0)return null;var o=this.intersectGroundViewport(e),r=V.model.getData().fragments,s=r?r.dbId2fragId[n]:-1;i={intersectPoint:o,dbId:n,fragId:s}}else{var n=S.idAtPixel(e.x,e.y);i=this.castRayViewport(e,t,n>0?[n]:null)}return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.rolloverObjectViewport=function(e){S.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(e,t){this.rolloverDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.disableRollover=function(e){this.rolloverDisabled=e},this.rolloverObjectNode=function(e){var t=[],i=V.model.getData().instanceTree;if(i){if(i.enumNodeChildren(e,function(e){t.push(e)},!0),t.length>1){var n=t.shift();t.sort(function(e,t){return e-t}),t.unshift(n)}}else t.push(e);S.rolloverObjectViewport(null,null,t)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(e,t,i){S.presentBuffer();var n=V.canvas.toDataURL("image/png"),o=av.isSafari();if(o&&(e=e?e:T,t=t?t:w),!e||!t)return n;var r,s,a=0,l=0;e>t||T/w<e/t?(r=e,s=w/T*e,l=t/2-s/2):(s=t,r=T/w*t,a=e/2-r/2);var c=window.URL.createObjectURL(f(V.canvas.toDataURL("image/png"))),u=new Image;u.src=c;var h=document.createElement("canvas"),d=h.getContext("2d");h.width=e,h.height=t,u.onload=function(){o&&(d.translate(0,s),d.scale(1,-1)),d.drawImage(u,a,l,r,s);var e=h.toDataURL("image/png"),t=window.URL.createObjectURL(f(h.toDataURL("image/png")));i?i(e):window.open(t)}},this.getScreenShot=function(e,t,i){function n(e,t,i,n,o){if(n||t&&i){var r,s,a=0,l=0;t>i||T/w<t/i?(r=t,s=w/T*t,l=i/2-s/2):(s=i,r=T/w*i,a=t/2-r/2);var c=new Image;c.src=e;var u=document.createElement("canvas"),h=u.getContext("2d");u.width=t,u.height=i,c.onload=function(){n&&(h.translate(0,s),h.scale(1,-1)),h.drawImage(c,a,l,r,s);var e=window.URL.createObjectURL(f(u.toDataURL("image/png")));o?o(e):window.open(e)}}else o&&o(e)}S.presentBuffer();var o=window.URL.createObjectURL(f(V.canvas.toDataURL("image/png"))),r=av.isSafari();r&&(e=e?e:T,t=t?t:w),n(o,e,t,r,i)},this.modelQueue=function(){return P},this.glrenderer=function(){return C},this.renderer=function(){return S},this.shadowMaps=function(){return k},this.worldUp=function(){return E},this.worldUpName=function(){return B},this.setUserRenderContext=function(e){S=e?e:new RenderContext,S.init(C,this.canvas.clientWidth,this.canvas.clientHeight),S.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(e,t,i){U=U||e,G=G||t,W=W||i},this.sceneUpdated=function(e){this.invalidate(!0,!1,!0),P&&e&&P.invalidateVisibleBounds(),Y=!0,u()},this.currentLightPreset=function(){return O},this.matman=function(){return b},this.fps=function(){return 1e3/Z},this.setFPSTargets=function(e,t,i){I=1e3/i,D=1e3/e,N=1e3/t,this.targetFrameBudget=av.isMobileDevice()?N/4:N},this.track=function(e){avp.logger.track(e)},this.worldToClient=function(e){var t=new THREE.Vector4(e.x,e.y,e.z,1);return t.applyMatrix4(this.camera.matrixWorldInverse),t.applyMatrix4(this.camera.projectionMatrix),t.w>0&&(t.x/=t.w,t.y/=t.w,t.z/=t.w),this.viewportToClient(t.x,t.y)},this.clientToWorld=function(e,t,i){var n=null,o=this.model,r=o.getData();if(o.is2d()){var s=this.intersectGround(e,t);if(s){s.z=0;var a=r.bbox;(r.hidePaper||a.containsPoint(s))&&(n={point:s,model:o})}}else n=this.hitTest(e,t,i),n&&(n.point=n.intersectPoint);return n},this.setSelectionColor=function(e){this.selectionMaterialBase.color.set(e),this.selectionMaterialTop.color.set(e),this.invalidate(!1,!1,!0)},this.updateViewportId=function(e){b.updateViewportId(e)},this.findModel=function(e){return P.findModel(e)},this.setShadowLightDirection=function(e){z.copy(e),u(),this.invalidate(!0,!1,!1),a()},this.getShadowLightDirection=function(e){var t=e?e:new THREE.Vector3;return t.copy(z),t},this.toggleShadows=function(e){!!k!=!!e&&(e?k=new avp.ShadowMaps(C):(k.cleanup(b),k=null),a(),this.invalidate(!0,!0,!1))}}av.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1,depth:!1,devicePixelRatio:null},e.prototype.constructor=e,avp.Viewer3DImpl=e}(),Autodesk.Viewing.Private.ViewerState=function(e){var t=Autodesk.Viewing.Private,i=!0;this.getState=function(n){var o=e.navigation,r={};r.seedURN=this.getSeedUrn();var s=r.objectSet;Array.isArray(s)||(r.objectSet=s=[]),e.model&&!e.model.is2d()&&(s[0]={id:this.getSelectedNodes(),isolated:e.getIsolatedNodes(),hidden:e.getHiddenNodes(),explodeScale:e.getExplodeScale(),idType:"lmv"}),e.model&&e.model.is2d()&&(s[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),hidden:[],idType:"lmv"});var a=r.viewport;a||(a=r.viewport={});var l=o.getCamera().isPerspective;a.name="",a.eye=o.getPosition().toArray(),a.target=o.getTarget().toArray(),a.up=o.getCamera().up.toArray(),a.worldUpVector=o.getWorldUpVector().toArray(),a.pivotPoint=o.getPivotPoint().toArray(),a.distanceToOrbit=o.getPivotPlaneDistance(),a.aspectRatio=this.getAspectRatio(),a.projection=l?"perspective":"orthographic",a.isOrthographic=!l,l?a.fieldOfView=o.getVerticalFov():a.orthographicHeight=this.getOrthographicHeight();var c=r.renderOptions;if(c||(c=r.renderOptions={}),c.environment=t.LightPresets[e.impl.currentLightPreset()].name,c.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},c.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},c.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.ambientShadows,antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.progressiveRendering,swapBlackAndWhite:e.prefs.swapBlackAndWhite,displayLines:e.prefs.lineRendering},e.model&&!e.model.is2d())for(var u=r.cutplanes=[],h=e.getCutPlanes(),d=0;d<h.length;d++)u.push(h[d].toArray());for(var p in e.loadedExtensions){var v=e.loadedExtensions[p];v.getState&&v.getState(r)}return n&&n!==i&&this.applyFilter(r,n),r},this.restoreState=function(n,o,r){if(!n)return t.logger.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return t.logger.warn("restoreState has no viewer or model to restore."),!1;o&&o!==i&&(n=JSON.parse(JSON.stringify(n)),this.applyFilter(n,o));var s=e.navigation,a=e.model.is2d(),l=!a;if(Array.isArray(n.objectSet)&&n.objectSet.length>0){var c=n.objectSet[0],u=c.id;if(u&&(u=this.toIntArray(u),e.select(u)),a){var h=c.isolated;Array.isArray(h)&&h.length>0?(e.setLayerVisible(null,!1),e.impl.setLayerVisible(h,!0)):e.setLayerVisible(null,!0)}else{var d=c.isolated||[];if(d=this.toIntArray(d),e.isolate(d),0===d.length){var p=c.hidden||null;p&&p.length>0&&(p=this.toIntArray(p),e.hide(p))}}if("explodeScale"in c){var v=parseFloat(c.explodeScale);e.explode&&e.explode(v)}}var g=n.viewport;if(g){var m=this.getVector3FromArray(g.eye,s.getPosition()),f=this.getVector3FromArray(g.up,s.getCamera().up),E=this.getVector3FromArray(g.target,s.getTarget()),A="fieldOfView"in g?parseFloat(g.fieldOfView):s.getVerticalFov(),y=this.getVector3FromArray(g.worldUpVector,null);
if(!y){var T=e.model?e.model.getUpVector():null;y=T?(new THREE.Vector3).fromArray(T):new THREE.Vector3(0,1,0)}var w=this.getVector3FromArray(g.pivotPoint,s.getPivotPoint()),b=s.getCamera().isPerspective;"isOrthographic"in g&&(b=!g.isOrthographic);var C=this.getOrthographicHeight();"orthographicHeight"in g&&(C=Number(g.orthographicHeight));var S={position:m,target:E,up:f,worldup:y,aspect:e.impl.camera.aspect,fov:A,orthoScale:C,isPerspective:b,pivot:w};this.restoreCameraState(S,r)}var k=n.renderOptions;if(k){var x=e.impl.renderer(),M=e.prefs,R=M.ambientShadows,P=M.antialiasing,V=k.ambientOcclusion;if(V){"enabled"in V&&(R=V.enabled);var I="radius"in V?V.radius:null,N="intensity"in V?V.intensity:null;null!==I&&null!==N&&(I===x.getAORadius()&&N===x.getAOIntensity()||(x.setAOOptions(I,N),x.composeFinalFrame()))}if("environment"in k){var D=this.getLightPresetIndex(k.environment);D!==-1&&D!==M.get("lightPreset")&&l&&e.setLightPreset(D)}var L=k.toneMap;if(L){var O=!1,_="exposure"in L?L.exposure:null,H="lightMultiplier"in L?L.lightMultiplier:null;null!==_&&_!==x.getExposureBias()&&(x.setTonemapExposureBias(_),O=!0),null!==H&&e.impl.dir_light1&&H!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,H),O=!0),O&&e.impl.invalidate(!0)}var B=k.appearance;B&&("antiAliasing"in B&&(P=B.antiAliasing),"progressiveDisplay"in B&&B.progressiveDisplay!==M.get("progressiveRendering")&&e.setProgressiveRendering(B.progressiveDisplay),"swapBlackAndWhite"in B&&B.swapBlackAndWhite!==M.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(B.swapBlackAndWhite),"ghostHidden"in B&&B.ghostHidden!==M.get("ghosting")&&l&&e.setGhosting(B.ghostHidden),"displayLines"in B&&B.displayLines!==M.get("lineRendering")&&e.hideLines(!B.displayLines)),l&&R!==M.ambientShadows&&P!==M.antialiasing&&e.setQualityLevel(R,P)}if(Array.isArray(n.cutplanes)&&e.model&&l){for(var F=[],z=0;z<n.cutplanes.length;z++){var U=n.cutplanes[z];Array.isArray(U)&&U.length>=4&&F.push(new THREE.Vector4(U[0],U[1],U[2],U[3]))}e.setCutPlanes(F)}for(var G in e.loadedExtensions){var W=e.loadedExtensions[G];W.restoreState&&W.restoreState(n,r)}return!0},this.restoreCameraState=function(t,i){e.impl.adjustOrthoCamera(t);var n=e.navigation;i?(t.isPerspective?n.toPerspective():n.toOrthographic(),n.setCameraUpVector(t.up),n.setWorldUpVector(t.worldup),n.setView(t.position,t.target),n.setPivotPoint(t.pivot),n.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,n.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,i){function n(e,t){if(e=e||[],t=t||[],e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function o(e,t,i){return e=e||[],t=t||[],e.length===t.length&&(0!==e.length&&(r(e[0],t[0],i)||r(e[1],t[1],i)||r(e[2],t[2],i)))}function r(e,t,i){var n=e?parseFloat(e):null,o=e?parseFloat(t):null,r=typeof n,s=typeof o;return"number"===r&&"number"===s?Math.abs(e-t)<i:(e=e?e:null,t=t?t:null,e===t)}var s=e,a=t,l=1e-9;if(i&&i!==!0&&(s=this.applyFilter(s,i),a=this.applyFilter(a,i)),s.seedURN!==a.seedURN)return!1;var c=s.objectSet||[],u=a.objectSet||[];if(c.length!==u.length)return!1;var h=c[0]||{},d=u[0]||{};if(!(h.idType===d.idType&&r(h.explodeScale,d.explodeScale,l)&&n(h.id,d.id)&&n(h.isolated,d.isolated)&&n(h.hidden,d.hidden)))return!1;var p=s.viewport||{},v=a.viewport||{};return!!(p.name===v.name&&p.projection===v.projection&&p.isOrthographic===v.isOrthographic&&r(p.distanceToOrbit,v.distanceToOrbit,l)&&r(p.aspectRatio,v.aspectRatio,l)&&r(p.fieldOfView,v.fieldOfView,l)&&r(p.orthographicHeight,v.orthographicHeight,l)&&o(p.eye,v.eye,l)&&o(p.target,v.target,l)&&o(p.up,v.up,l)&&o(p.worldUpVector,v.worldUpVector,l)&&o(p.pivotPoint,v.pivotPoint,l))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var i=0,n=e.length;i<n;++i)t.push(parseInt(e[i]));return t},this.extractSelectedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.id)}return[]},this.extractIsolatedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.isolated)}return[]},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(){return e.impl&&e.impl.selector?e.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var t=[],i=e.impl.matman(),n=i.layersMap;for(var o in n)n.hasOwnProperty(o)&&i.isLayerVisible(o)&&t.push(o);return t},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport(),i=t.width/t.height;return i},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(){return e.model&&e.model.loader?e.model.loader.svfUrn||"":""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var i=0;i<t.LightPresets.length;i++)if(t.LightPresets[i].name===e)return i;return-1},this.applyFilter=function(e,i){if(i!==!0)for(var n in e)if(e.hasOwnProperty(n)){var o=i[n];void 0===o?(delete e[n],t.logger.log("[applyFilter] C - skipping key ["+n+"] from viewerState; unspecified in filter.")):"boolean"==typeof o?o===!1&&(delete e[n],t.logger.log("[applyFilter] D - skipping key ["+n+"] from viewerState; explicit filtering.")):o instanceof Object?e[n]instanceof Object?this.applyFilter(e[n],i[n]):t.logger.warn("[applyFilter] A - Invalid filter Object for key ["+n+"]"):t.logger.warn("[applyFilter] B - Invalid filter value for key ["+n+"]")}}},Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState,AutodeskNamespace("Autodesk.Viewing.i18n"),function(){function e(){k="aaaa",q()}function t(){k=null,q()}function i(e,t){if(!t||"function"==typeof t)return e;for(var i in t)e[i]=t[i];return e}function n(e,t,i){var n,o=0,r=e.length,s=void 0===r||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e;if(i)if(s){for(n in e)if(t.apply(e[n],i)===!1)break}else for(;o<r&&t.apply(e[o++],i)!==!1;);else if(s){for(n in e)if(t.call(e[n],n,e[n])===!1)break}else for(;o<r&&t.call(e[o],o,e[o++])!==!1;);return e}function o(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return O[e]}):e}function r(e){var t=function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest);if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}return e(new Error)},i=function(e){if("string"==typeof e)return e;var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=n(e);var i,o,r,s,a,l,c,u="",h=0;do i=e.charCodeAt(h++),o=e.charCodeAt(h++),r=e.charCodeAt(h++),s=i>>2,a=(3&i)<<4|o>>4,l=(15&o)<<2|r>>6,c=63&r,isNaN(o)?l=c=64:isNaN(r)&&(c=64),u+=t.charAt(s)+t.charAt(a)+t.charAt(l)+t.charAt(c),i=o=r="",s=a=l=c="";while(h<e.length);return u},r=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}return e},s=function(e,n,o,a){"function"==typeof o&&(a=o,o={}),o.doNotCache=o.doNotCache||!1,o.data=o.data||{},o.headers=o.headers||{},o.jsonp=o.jsonp||!1,o.async=void 0===o.async||o.async;var l,c=r({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},s.headers,o.headers);if(l="application/json"===c["content-type"]?JSON.stringify(o.data):i(o.data),"GET"===e){var u=[];if(l&&(u.push(l),l=null),o.doNotCache&&u.push("_="+(new Date).getTime()),o.jsonp&&(u.push("callback="+o.jsonp),u.push("jsonp="+o.jsonp)),u=u.join("&"),u.length>1&&(n+=n.indexOf("?")>-1?"&"+u:"?"+u),o.jsonp){var h=document.getElementsByTagName("head")[0],d=document.createElement("script");return d.type="text/javascript",d.src=n,void h.appendChild(d)}}t(function(t,i){if(t)return a(t);i.open(e,n,o.async);for(var r in c)c.hasOwnProperty(r)&&i.setRequestHeader(r,c[r]);i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText||"";if(!a)return;a(i.status,e)}},i.send(l)})},a={authBasic:function(e,t){s.headers.Authorization="Basic "+o(e+":"+t)},connect:function(e,t,i){return s("CONNECT",e,t,i)},del:function(e,t,i){return s("DELETE",e,t,i)},get:function(e,t,i){return s("GET",e,t,i)},head:function(e,t,i){return s("HEAD",e,t,i)},headers:function(e){s.headers=e||{}},isAllowed:function(e,t,i){this.options(e,function(e,n){i(n.text().indexOf(t)!==-1)})},options:function(e,t,i){return s("OPTIONS",e,t,i)},patch:function(e,t,i){return s("PATCH",e,t,i)},post:function(e,t,i){return s("POST",e,t,i)},put:function(e,t,i){return s("PUT",e,t,i)},trace:function(e,t,i){return s("TRACE",e,t,i)}},l=e.type?e.type.toLowerCase():"get";a[l](e.url,e,function(t,i){200===t?e.success(i,t,null):e.error(i,t,null)})}function s(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},F.extend(L,e),delete L.fixLng,"string"==typeof L.ns&&(L.ns={namespaces:[L.ns],defaultNs:L.ns}),"string"==typeof L.fallbackNS&&(L.fallbackNS=[L.fallbackNS]),"string"!=typeof L.fallbackLng&&"boolean"!=typeof L.fallbackLng||(L.fallbackLng=[L.fallbackLng]),L.interpolationPrefixEscaped=F.regexEscape(L.interpolationPrefix),L.interpolationSuffixEscaped=F.regexEscape(L.interpolationSuffix),L.lng||(L.lng=F.detectLanguage()),L.lng?L.useCookie&&F.cookie.create(L.cookieName,L.lng,L.cookieExpirationTime,L.cookieDomain):(L.lng=L.fallbackLng[0],L.useCookie&&F.cookie.remove(L.cookieName)),N=F.toLanguages(L.lng),x=N[0],F.log("currentLng set to: "+x);var i=y;if(e.fixLng&&(i=function(e,t){return t=t||{},t.lng=t.lng||i.lng,y(e,t)},i.lng=x),U.setCurrentLng(x),L.resStore)return V=L.resStore,D=!0,void(t&&t(i));var n=F.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var o=0,r=L.preload.length;o<r;o++)for(var s=F.toLanguages(L.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a]);Autodesk.Viewing.i18n.sync.load(n,L,function(e,n){V=n,D=!0,t&&t(i)})}function a(e,t){"string"==typeof e&&(e=[e]);for(var i=0,n=e.length;i<n;i++)L.preload.indexOf(e[i])<0&&L.preload.push(e[i]);return s(t)}function l(e,t,i){"string"!=typeof t?(i=t,t=L.ns.defaultNs):L.ns.namespaces.indexOf(t)<0&&L.ns.namespaces.push(t),V[e]=V[e]||{},V[e][t]=V[e][t]||{},F.extend(V[e][t],i)}function c(e,t){"string"!=typeof t&&(t=L.ns.defaultNs),V[e]=V[e]||{},V[e][t]={}}function u(e){L.ns.defaultNs=e}function h(e,t){d([e],t)}function d(e,t){var i={dynamicLoad:L.dynamicLoad,resGetPath:L.resGetPath,getAsync:L.getAsync,customLoad:L.customLoad,ns:{namespaces:e,defaultNs:""}},n=F.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var o=0,r=L.preload.length;o<r;o++)for(var s=F.toLanguages(L.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a]);for(var c=[],u=0,h=n.length;u<h;u++){var d=!1,p=V[n[u]];if(p)for(var v=0,g=e.length;v<g;v++)p[e[v]]||(d=!0);else d=!0;d&&c.push(n[u])}c.length?Autodesk.Viewing.i18n.sync._fetch(c,i,function(i,n){var o=e.length*c.length;F.each(e,function(e,i){L.ns.namespaces.indexOf(i)<0&&L.ns.namespaces.push(i),F.each(c,function(e,r){V[r]=V[r]||{},V[r][i]=n[r][i],o--,0===o&&t&&(L.useLocalStorage&&Autodesk.Viewing.i18n.sync._storeLocal(V),t())})})}):t&&t()}function p(e,t,i){return"function"==typeof t?(i=t,t={}):t||(t={}),t.lng=e,s(t,i)}function v(){return x}function g(e,t,i,n){if(!e)return e;if(n=n||t,e.indexOf(n.interpolationPrefix||L.interpolationPrefix)<0)return e;var o=n.interpolationPrefix?F.regexEscape(n.interpolationPrefix):L.interpolationPrefixEscaped,r=n.interpolationSuffix?F.regexEscape(n.interpolationSuffix):L.interpolationSuffixEscaped,s="HTML"+r;return F.each(t,function(t,a){var l=i?i+L.keyseparator+t:t;"object"==typeof a&&null!==a?e=g(e,a,l,n):n.escapeInterpolation||L.escapeInterpolation?(e=e.replace(new RegExp([o,l,s].join(""),"g"),a),e=e.replace(new RegExp([o,l,r].join(""),"g"),F.escape(a))):e=e.replace(new RegExp([o,l,r].join(""),"g"),a)}),e}function m(e,t){var i=",",n="{",o="}",r=F.extend({},t);for(delete r.postProcess;e.indexOf(L.reusePrefix)!=-1&&(I++,!(I>L.maxRecursion));){var s=e.lastIndexOf(L.reusePrefix),a=e.indexOf(L.reuseSuffix,s)+L.reuseSuffix.length,l=e.substring(s,a),c=l.replace(L.reusePrefix,"").replace(L.reuseSuffix,"");if(c.indexOf(i)!=-1){var u=c.indexOf(i);if(c.indexOf(n,u)!=-1&&c.indexOf(o,u)!=-1){var h=c.indexOf(n,u),d=c.indexOf(o,h)+o.length;try{r=F.extend(r,JSON.parse(c.substring(h,d))),c=c.substring(0,u)}catch(e){}}}var p=b(c,r);e=e.replace(l,p)}return e}function f(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}function E(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}function A(e,t){t=t||{};var i=T(e,t),n=C(e,t);return void 0!==n||n===i}function y(e,t){if(t=t||{},!D){F.log("i18next not finished initialization. you might have called t function before loading resources finished.");var i=e.indexOf(":");i<0?i=0:i++;var n=t.defaultValue||e.substr(i);return n&&(n=g(n,t)),n}return I=0,b.apply(null,arguments)}function T(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function w(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);return{postProcess:"sprintf",sprintf:e}}function b(e,t){if(t&&"object"!=typeof t?"sprintf"===L.shortcutFunction?t=w.apply(null,arguments):"defaultValue"===L.shortcutFunction&&(t={defaultValue:t}):t=t||{},void 0===e||null===e)return"";"string"==typeof e&&(e=[e]);var i=e[0];if(e.length>1)for(var n=0;n<e.length&&(i=e[n],!A(i,t));n++);var o,r=T(i,t),s=C(i,t),a=t.lng?F.toLanguages(t.lng):N,l=t.ns||L.ns.defaultNs;i.indexOf(L.nsseparator)>-1&&(o=i.split(L.nsseparator),l=o[0],i=o[1]),void 0===s&&L.sendMissing&&(t.lng?z.postMissing(a[0],l,i,r,a):z.postMissing(L.lng,l,i,r,a));var c=t.postProcess||L.postProcess;if(void 0!==s&&c&&G[c]&&(s=G[c](s,i,t)),k&&void 0!==s)return k;var u=r;if(r.indexOf(L.nsseparator)>-1&&(o=r.split(L.nsseparator),u=o[1]),u===i&&L.parseMissingKey&&(r=L.parseMissingKey(r)),void 0===s&&(r=g(r,t),r=m(r,t),c&&G[c])){var h=T(i,t);s=G[c](h,i,t)}return void 0!==s?s:r}function C(e,t){t=t||{};var i,n,o=T(e,t),r=N;if(!V)return o;if("cimode"===r[0].toLowerCase())return o;if(t.lng&&(r=F.toLanguages(t.lng),!V[r[0]])){var s=L.getAsync;L.getAsync=!1,Autodesk.Viewing.i18n.sync.load(r,L,function(e,t){F.extend(V,t),L.getAsync=s})}var a=t.ns||L.ns.defaultNs;if(e.indexOf(L.nsseparator)>-1){var l=e.split(L.nsseparator);a=l[0],e=l[1]}if(f(t)){i=F.extend({},t),delete i.context,i.defaultValue=L.contextNotFound;var c=a+L.nsseparator+e+"_"+t.context;if(n=y(c,i),n!=L.contextNotFound)return g(n,{context:t.context})}if(E(t)){i=F.extend({},t),delete i.count,i.defaultValue=L.pluralNotFound;var u=a+L.nsseparator+e+L.pluralSuffix,h=U.get(r[0],t.count);if(h>=0?u=u+"_"+h:1===h&&(u=a+L.nsseparator+e),n=y(u,i),n!=L.pluralNotFound)return g(n,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var d,p=e.split(L.keyseparator),v=0,A=r.length;v<A&&void 0===d;v++){for(var w=r[v],S=0,k=V[w]&&V[w][a];p[S];)k=k&&k[p[S]],S++;if(void 0!==k){var x=Object.prototype.toString.apply(k);if("string"==typeof k)k=g(k,t),k=m(k,t);else if("[object Array]"!==x||L.returnObjectTrees||t.returnObjectTrees){if(null===k&&L.fallbackOnNull===!0)k=void 0;else if(null!==k)if(L.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==x&&"[object Function]"!==x&&"[object RegExp]"!==x){var M="[object Array]"===x?[]:{};F.each(k,function(i){M[i]=b(a+L.nsseparator+e+L.keyseparator+i,t)}),k=M}}else L.objectTreeKeyHandler&&"function"==typeof L.objectTreeKeyHandler?k=L.objectTreeKeyHandler(e,k,w,a,t):(k="key '"+a+":"+e+" ("+w+")' returned an object instead of string.",F.log(k))}else k=k.join("\n"),k=g(k,t),k=m(k,t);"string"==typeof k&&""===k.trim()&&L.fallbackOnEmpty===!0&&(k=void 0),d=k}}if(void 0===d&&!t.isFallbackLookup&&(L.fallbackToDefaultNS===!0||L.fallbackNS&&L.fallbackNS.length>0))if(t.isFallbackLookup=!0,L.fallbackNS.length){for(var R=0,P=L.fallbackNS.length;R<P;R++)if(d=C(L.fallbackNS[R]+L.nsseparator+e,t)){var I=d.indexOf(L.nsseparator)>-1?d.split(L.nsseparator)[1]:d,D=o.indexOf(L.nsseparator)>-1?o.split(L.nsseparator)[1]:o;if(I!==D)break}}else d=C(e,t);return d}function S(){var e,t=[];if("undefined"!=typeof window&&(!function(){for(var e=window.location.search.substring(1),i=e.split("&"),n=0;n<i.length;n++){var o=i[n].indexOf("=");if(o>0){var r=i[n].substring(0,o),s=i[n].substring(o+1);t[r]=s}}}(),t[L.detectLngQS]&&(e=t[L.detectLngQS])),!e&&"undefined"!=typeof document&&L.useCookie){var i=F.cookie.read(L.cookieName);i&&(e=i)}return e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage),e}var k=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var o=n>=0?n:Math.max(i-Math.abs(n),0);o<i;o++)if(o in t&&t[o]===e)return o;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var n=i;arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))));for(var o=n>=0?Math.min(n,i-1):i-Math.abs(n);o>=0;o--)if(o in t&&t[o]===e)return o;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var x,M=this,R=M.jQuery||M.Zepto,P={},V={},I=0,N=[],D=!1;"undefined"!=typeof module&&module.exports?module.exports=P:(R&&(R.i18n=R.i18n||P),M.i18n=M.i18n||P);var L={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},_=function(e){for(var t,i,n=!1,o=!1,r="",s=0;s<e.length;s++)if(t=e[s],i=e[s+1],o||"\\"===e[s-1]||'"'!==t||(n=!n),n)r+=t;else{if(o||t+i!=="//")if("single"===o&&t+i==="\r\n")o=!1,s++;else if("single"===o&&"\n"===t)o=!1;else{if(!o&&t+i==="/*"){o="multi",s++;continue}if("multi"===o&&t+i==="*/"){o=!1,s++;continue}}else o="single",s++;o||(r+=t)}return r},H={create:function(e,t,i,n){var o;if(i){var r=new Date;r.setTime(r.getTime()+60*i*1e3),o="; expires="+r.toGMTString()}else o="";n=n?"domain="+n+";":"",document.cookie=e+"="+t+o+";"+n+"path=/"},read:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},remove:function(e){this.create(e,"",-1)}},B={create:function(e,t,i,n){},read:function(e){return null},remove:function(e){}},F={extend:R?R.extend:i,each:R?R.each:n,ajax:R?R.ajax:"undefined"!=typeof document?r:function(){},cookie:"undefined"!=typeof document?H:B,detectLanguage:S,escape:o,log:function(e){L.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[];if("string"==typeof e&&e.indexOf("-")>-1){var i=e.split("-");e=L.lowerCaseLng?i[0].toLowerCase()+"-"+i[1].toLowerCase():i[0].toLowerCase()+"-"+i[1].toUpperCase(),"unspecific"!==L.load&&t.push(e),"current"!==L.load&&t.push(i[0])}else t.push(e);for(var n=0;n<L.fallbackLng.length;n++)t.indexOf(L.fallbackLng[n])===-1&&L.fallbackLng[n]&&t.push(L.fallbackLng[n]);return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};F.applyReplacement=g;var z={load:function(e,t,i){t.useLocalStorage?z._loadLocal(e,t,function(n,o){for(var r=[],s=0,a=e.length;s<a;s++)o[e[s]]||r.push(e[s]);r.length>0?z._fetch(r,t,function(e,t){F.extend(o,t),z._storeLocal(t),i(null,o)}):i(null,o)}):z._fetch(e,t,function(e,t){i(null,t)})},_loadLocal:function(e,t,i){var n={},o=(new Date).getTime();if(window.localStorage){var r=e.length;F.each(e,function(e,s){var a=window.localStorage.getItem("res_"+s);a&&(a=JSON.parse(a),a.i18nStamp&&a.i18nStamp+t.localStorageExpirationTime>o&&(n[s]=a)),r--,0===r&&i(null,n)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,i){var n=t.ns,o={};if(t.dynamicLoad){var r=function(e,t){i(null,t)};if("function"==typeof t.customLoad)t.customLoad(e,n.namespaces,t,r);else{var s=g(t.resGetPath,{lng:e.join("+"),ns:n.namespaces.join("+")});s=Autodesk.Viewing.Private.getResourceUrl(s),F.ajax({url:s,success:function(e,t,i){F.log("loaded: "+s),r(null,e.json())},error:function(e,t,i){F.log("failed loading: "+s),r("failed loading resource.json error: "+i)},dataType:"text",async:t.getAsync})}}else{var a,l=n.namespaces.length*e.length;F.each(n.namespaces,function(n,r){F.each(e,function(e,n){var s=function(e,t){e&&(a=a||[],a.push(e)),o[n]=o[n]||{},o[n][r]=t,l--,0===l&&i(a,o)};"function"==typeof t.customLoad?t.customLoad(n,r,t,s):z._fetchOne(n,r,t,s)})})}},_fetchOne:function(e,t,i,n){var o=g(i.resGetPath,{lng:e,ns:t});o=Autodesk.Viewing.Private.getResourceUrl(o),F.ajax({url:o,success:function(e,t,i){F.log("loaded: "+o);var r=_(e);n(null,JSON.parse(r))},error:function(e,t,i){if(t&&200==t||e&&e.status&&200==e.status)F.log("There is a typo in: "+o);else if(t&&404==t||e&&e.status&&404==e.status)F.log("Does not exist: "+o);else{var r=t?t:e&&e.status?e.status:null;F.log(r+" when loading "+o)}n(i,{})},dataType:"text",async:i.getAsync})},postMissing:function(e,t,i,n,o){var r={};r[i]=n;var s=[];if("fallback"===L.sendMissingTo&&L.fallbackLng[0]!==!1)for(var a=0;a<L.fallbackLng.length;a++)s.push({lng:L.fallbackLng[a],url:g(L.resPostPath,{lng:L.fallbackLng[a],ns:t})});else if("current"===L.sendMissingTo||"fallback"===L.sendMissingTo&&L.fallbackLng[0]===!1)s.push({lng:e,url:g(L.resPostPath,{lng:e,ns:t})});else if("all"===L.sendMissingTo)for(var a=0,l=o.length;a<l;a++)s.push({lng:o[a],url:g(L.resPostPath,{lng:o[a],ns:t})});for(var c=0,u=s.length;c<u;c++){var h=s[c];F.ajax({url:h.url,type:L.sendType,data:r,success:function(e,o,r){F.log("posted missing key '"+i+"' to: "+h.url);for(var s=i.split("."),a=0,l=V[h.lng][t];s[a];)l=a===s.length-1?l[s[a]]=n:l[s[a]]=l[s[a]]||{},a++},error:function(e,t,n){F.log("failed posting missing key '"+i+"' to: "+h.url)},dataType:"json",async:L.postAsync})}}},U={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymará",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},
sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){U.rules[e]=t},setCurrentLng:function(e){if(!U.currentRule||U.currentRule.lng!==e){var t=e.split("-");U.currentRule={lng:e,rule:U.rules[t[0]]}}},get:function(e,t){function i(t,i){var n;if(n=U.currentRule&&U.currentRule.lng===e?U.currentRule.rule:U.rules[t]){var o=n.plurals(i),r=n.numbers[o];return 2===n.numbers.length&&1===n.numbers[0]&&(2===r?r=-1:1===r&&(r=1)),r}return 1===i?"1":"-1"}var n=e.split("-");return i(n[0],t)}},G={},W=function(e,t){G[e]=t},j=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var i=[];t>0;i[--t]=e);return i.join("")}var i=function(){return i.cache.hasOwnProperty(arguments[0])||(i.cache[arguments[0]]=i.parse(arguments[0])),i.format.call(null,i.cache[arguments[0]],arguments)};return i.format=function(i,n){var o,r,s,a,l,c,u,h=1,d=i.length,p="",v=[];for(r=0;r<d;r++)if(p=e(i[r]),"string"===p)v.push(i[r]);else if("array"===p){if(a=i[r],a[2])for(o=n[h],s=0;s<a[2].length;s++){if(!o.hasOwnProperty(a[2][s]))throw j('[sprintf] property "%s" does not exist',a[2][s]);o=o[a[2][s]]}else o=a[1]?n[a[1]]:n[h++];if(/[^s]/.test(a[8])&&"number"!=e(o))throw j("[sprintf] expecting number but found %s",e(o));switch(a[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=a[7]?o.toExponential(a[7]):o.toExponential();break;case"f":o=a[7]?parseFloat(o).toFixed(a[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&a[7]?o.substring(0,a[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(a[8])&&a[3]&&o>=0?"+"+o:o,c=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(o).length,l=a[6]?t(c,u):"",v.push(a[5]?o+l:l+o)}return v.join("")},i.cache={},i.parse=function(e){for(var t=e,i=[],n=[],o=0;t;){if(null!==(i=/^[^\x25]+/.exec(t)))n.push(i[0]);else if(null!==(i=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(i[2]){o|=1;var r=[],s=i[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw"[sprintf] huh?";r.push(a[1])}i[2]=r}else o|=2;if(3===o)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(i)}t=t.substring(i[0].length)}return n},i}(),Y=function(e,t){return t.unshift(e),j.apply(null,t)};W("sprintf",function(e,t,i){return i.sprintf?"[object Array]"===Object.prototype.toString.apply(i.sprintf)?Y(e,i.sprintf):"object"==typeof i.sprintf?j(e,i.sprintf):e:e});var q=function(){function e(e){return[null,e]}Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),function(t){var i=t.getAttribute("data-i18n"),n=e(i),o=n[0],r=n[1],s=Autodesk.Viewing.i18n.translate(r);s?o?t.setAttribute(o,s):t.textContent=s:o?t.setAttribute(o,r):t.textContent=r})};Autodesk.Viewing.i18n.init=s,Autodesk.Viewing.i18n.setLng=p,Autodesk.Viewing.i18n.preload=a,Autodesk.Viewing.i18n.addResourceBundle=l,Autodesk.Viewing.i18n.removeResourceBundle=c,Autodesk.Viewing.i18n.loadNamespace=h,Autodesk.Viewing.i18n.loadNamespaces=d,Autodesk.Viewing.i18n.localize=q,Autodesk.Viewing.i18n.setDefaultNamespace=u,Autodesk.Viewing.i18n.t=y,Autodesk.Viewing.i18n.translate=y,Autodesk.Viewing.i18n.exists=A,Autodesk.Viewing.i18n.detectLanguage=F.detectLanguage,Autodesk.Viewing.i18n.pluralExtensions=U,Autodesk.Viewing.i18n.sync=z,Autodesk.Viewing.i18n.functions=F,Autodesk.Viewing.i18n.lng=v,Autodesk.Viewing.i18n.addPostProcessor=W,Autodesk.Viewing.i18n.options=L,Autodesk.Viewing.i18n.setDebugLocString=e,Autodesk.Viewing.i18n.clearDebugLocString=t}(),function(){"use strict";var e=(Autodesk.Viewing.UI,function(e,t,i,n){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.parentContainer=e,this.container=document.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=i,n=n||{},n.hasOwnProperty("localizeTitle")||(n.localizeTitle=!0),this.options=n,this.container.classList.add("dockingPanel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)});e.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer)},e.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},e.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},e.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var i=t.width,n=300,o=this.container.lastWidth||this.container.style.width;o||(o=this.container.getBoundingClientRect().width),o&&(n=parseInt(o)),this.container.style.left=i-n+"px"}if(this.container.dockBottom){var r=t.height,s=300,a=this.container.lastHeight||this.container.style.height;a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a));var l=r-s;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},e.prototype.isVisible=function(){return"block"===this.container.style.display},e.prototype.visibilityChanged=function(){},e.prototype.initializeMoveHandlers=function(e){function t(e){var t=d.style.minWidth?parseInt(d.style.minWidth):p.kMinWdth,i=d.style.minHeight?parseInt(d.style.minHeight):p.kMinHeight,n=p.getContainerBoundingRect();d.style.maxWidth&&parseInt(d.style.width)>parseInt(d.style.maxWidth)&&(d.style.width=d.style.maxWidth),d.style.maxHeight&&parseInt(d.style.height)>parseInt(d.style.maxHeight)&&(d.style.height=d.style.maxHeight),parseInt(d.style.width)<t&&(d.style.width=t+"px"),parseInt(d.style.height)<i&&(d.style.height=i+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),u+=e.screenX-s,h+=e.screenY-a,o=l+u,r=c+h;var v=parseInt(d.style.width),g=parseInt(d.style.height);isNaN(v)&&(v=p.container.getBoundingClientRect().width),isNaN(g)&&(g=p.container.getBoundingClientRect().height),o<5&&(o=0),r<5&&(r=0),d.dockRight=!1,d.dockBottom=!1,n.width-5<o+v&&(o=n.width-v,d.dockRight=!0),n.height-5<r+g&&(r=n.height-g,d.dockBottom=!0),d.style.left=o+"px",d.style.top=r+"px",d.style.maxWidth=n.width-o+"px",d.style.maxHeight=n.height-r+"px",s=e.screenX,a=e.screenY,p.onMove(e,o,r)}function i(e){window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",i),p.onEndMove(e,o,r)}function n(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),s=e.screenX,a=e.screenY,u=0,h=0,l=p.container.offsetLeft,c=p.container.offsetTop,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",i,!1),window.addEventListener("touchmove",t,!1),window.addEventListener("touchend",i,!1),e.preventDefault(),p.onStartMove(e,l,c)}var o,r,s,a,l,c,u,h,d=this.container,p=this;p.addEventListener(e,"mousedown",n),p.addEventListener(e,"touchstart",n)},e.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",function(e){t.setVisible(!1)},!1)},e.prototype.createScrollContainer=function(e){var t=document.createElement("div"),i=t.classList;return i.add("dockingPanelScroll"),i.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,t},e.prototype.createTitleBar=function(e){var t=document.createElement("div");t.className="dockingPanelTitle",t.textContent=e;var i=this;return i.addEventListener(t,"click",function(e){i.movedSinceLastClick||i.onTitleClick(e),i.movedSinceLastClick=!1}),i.addEventListener(t,"dblclick",function(e){i.onTitleDoubleClick(e)}),t},e.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},e.prototype.createCloseButton=function(){var e=document.createElement("div");return e.className="dockingPanelClose",e.innerHTML="&times;",this.initializeCloseHandler(e),e},e.prototype.onStartMove=function(e,t,i){},e.prototype.onEndMove=function(e,t,i){},e.prototype.onMove=function(e,t,i){this.movedSinceLastClick=!0},e.prototype.onTitleClick=function(e){},e.prototype.onTitleDoubleClick=function(e){},e.prototype.addEventListener=function(e,t,i){e.addEventListener(t,i),this.listeners.push({target:e,eventId:t,callback:i})},e.prototype.removeEventListener=function(e,t,i){for(var n=0;n<this.listeners.length;++n){var o=this.listeners[n];if(o.target===e&&o.eventId===t&&o.callback===i)return e.removeEventListener(t,i),this.listeners.splice(n,1),!0}return!1},e.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},e.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize(),i=t.height,n=this.container.getBoundingClientRect(),o=this.getContainerBoundingRect(),r=75,s=e&&e.maxHeight?e.maxHeight:o.height;s-=r,i>s&&(i=s);var a=n.top;a>0&&a+i+r>o.height&&(a=Math.max(0,o.height-(i+r))),this.container.style.height=i.toString()+"px",this.container.style.top=a+"px"}},e.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},Autodesk.Viewing.UI.DockingPanel=e}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=Autodesk.Viewing.Private,i=function(t,i,n,o){e.DockingPanel.call(this,t,i,n,o),this.container.classList.add("modelStructurePanel"),o=o||{},o.heightAdjustment||(o.heightAdjustment=40),o.marginTop||(o.marginTop=0),o.left=!0,this.createScrollContainer(o),this.options=o,this.instanceTree=null,this.tree=null,this.selectedNodes=[],this.uiCreated=!1;var r=this;this.addVisibilityListener(function(e){e&&(r.uiCreated||r.createUI(),r.resizeToContent())})};i.prototype=Object.create(e.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.setModel=function(e,t){this.instanceTree=e,this.modelTitle=t,this.isVisible()?this.createUI():this.uiCreated=!1},i.prototype.createUI=function(){var i=this,n=i.instanceTree;if(n){var o=function(){var n=new e.TreeDelegate;return n.getTreeNodeId=function(e){return"object"==typeof e?(t.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},n.getTreeNodeLabel=function(e){var t=this.getTreeNodeId(e),n=i.instanceTree.getNodeName(t);return n||"Object "+t},n.getTreeNodeClass=function(e){return i.getNodeClass(e)},n.isTreeNodeGroup=function(e){return i.isGroupNode(e)},n.shouldCreateTreeNode=function(e){return i.shouldInclude(e)},n.onTreeNodeClick=function(e,t,n){i.onClick(t,n)},n.onTreeNodeRightClick=function(e,t,n){i.onRightClick(t,n)},n.onTreeNodeDoubleClick=function(e,t,n){i.onDoubleClick(t,n)},n.onTreeNodeIconClick=function(e,t,n){i.onIconClick(t,n)},n.forEachChild=function(e,t){var n=this.getTreeNodeId(e);i.instanceTree.enumNodeChildren(n,t)},n.onTreeNodeHover=function(e,t,n){i.onHover(t,n)},n};i.selectedNodes=[];var r=i.modelTitle;r||i.options&&i.options.defaultTitle&&(r=i.options.defaultTitle);var s={};if(r||(r="Browser",s.localizeTitle=!0),i.setTitle(r,s),i.tree){for(;i.scrollContainer.hasChildNodes();)i.scrollContainer.removeChild(i.scrollContainer.lastChild);i.title.removeEventListener("click",i.onTitleClick),i.title.removeEventListener("dblclick",i.onTitleDoubleClick)}var a,l=this.rootId=n.getRootId(),c=n.getNodeName(l),u=0,h=0;n.enumNodeChildren(l,function(e){h||(a=n.getNodeName(e),u=e),h++});var d=o();this.myDelegate=d;var p=1===h&&c===a,v={excludeRoot:p,localize:!0};i.tree=new e.Tree(d,l,i.scrollContainer,v),i.options&&i.options.hasOwnProperty("startCollapsed")&&!i.options.startCollapsed||(i.tree.setAllCollapsed(!0),i.tree.setCollapsed(l,!1),p&&i.tree.setCollapsed(u,!1)),this.uiCreated=!0}},i.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){var t=this.myDelegate.getTreeNodeId(e);return this.instanceTree.getChildCount(t)},i.prototype.shouldInclude=function(e){return!0},i.prototype.onClick=function(e,t){this.setSelection([e])},i.prototype.onDoubleClick=function(e,t){},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){var i=this.tree.delegate();i.isTreeNodeGroup(e)&&(this.tree.setCollapsed(e,t),this.resizeToContent())},i.prototype.isGroupCollapsed=function(e){var t=this.tree.delegate();return!!t.isTreeNodeGroup(e)&&this.tree.isCollapsed(e)},i.prototype.onRightClick=function(e,t){},i.prototype.onTitleClick=function(e){},i.prototype.onTitleDoubleClick=function(e){},i.prototype.onHover=function(e,t){},i.prototype.setSelection=function(e){if(this.tree){var t,i;for(t=0;t<this.selectedNodes.length;++t)for(i=this.instanceTree.getNodeParentId(this.selectedNodes[t]);i;)this.tree.removeClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i);var n=[];for(t=0;t<e.length;++t)for(n.push(e[t]),i=this.instanceTree.getNodeParentId(e[t]);i;)this.tree.addClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i);this.selectedNodes=e,this.tree.setSelection(n)}},i.prototype.getContentSize=function(){var e=this.tree;if(e){var t=e.getRootContainer();if(t)return{height:t.clientHeight+this.options.heightAdjustment+35,width:t.clientWidth}}return{height:0,width:0}},i.prototype.addClass=function(e,t){return null!==this.tree&&this.tree.addClass(e,t)},i.prototype.removeClass=function(e,t){return null!==this.tree&&this.tree.removeClass(e,t)},Autodesk.Viewing.UI.ModelStructurePanel=i}(),function(){"use strict";function e(e){e=String(e);var t=' target="blank" class="propertyLink" ',i=[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}];return i.reduce(function(e,t){return e.replace(t.pattern,t.value)},e)}var t=Autodesk.Viewing.UI,i=function(e,i,n,o){function r(){function e(e){return"category"===e.type}var i=new t.TreeDelegate;return i.getTreeNodeId=function(e){return e.name+(e.hasOwnProperty("value")?e.value:"")+(e.hasOwnProperty("category")?e.category:"")},i.getTreeNodeClass=function(t){return e(t)?s.getCategoryClass(t):s.getPropertyClass(t)},i.isTreeNodeGroup=function(t){return e(t)},i.onTreeNodeClick=function(t,i,n){e(i)?s.onCategoryClick(i,n):s.onPropertyClick(i,n)},i.onTreeNodeRightClick=function(t,i,n){e(i)?s.onCategoryRightClick(i,n):s.onPropertyRightClick(i,n)},i.onTreeNodeDoubleClick=function(t,i,n){e(i)?s.onCategoryDoubleClick(i,n):s.onPropertyDoubleClick(i,n)},i.onTreeNodeIconClick=function(t,i,n){e(i)?s.onCategoryIconClick(i,n):s.onPropertyIconClick(i,n)},i.createTreeNode=function(t,i,n){var o=null;o=e(t)?s.displayCategory(t,i,n):s.displayProperty(t,i,n),o&&(s.highlightableElements[this.getTreeNodeId(t)]=o)},i}t.DockingPanel.call(this,e,i,n,o),this.container.classList.add("propertyPanel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0}),this.highlightableElements={};var s=this,a=r();this.tree=new t.Tree(a,null,this.scrollContainer,{})};i.prototype=Object.create(t.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.setProperties=function(e,t){this.removeAllProperties();for(var i=[],n=[],o=0;o<e.length;o++){var r=e[o];if(!r.hidden){var s=e[o].displayCategory;s&&"string"==typeof s&&""!==s?i.push(r):n.push(r)}}if(i.length+n.length===0)return void this.showNoProperties();for(var o=0;o<i.length;o++){var r=i[o],a=Autodesk.Viewing.Private.formatValueWithUnits(r.displayValue,r.units,r.type);this.addProperty(r.displayName,a,r.displayCategory)}for(var l=i.length>0,o=0;o<n.length;o++){var r=n[o],a=Autodesk.Viewing.Private.formatValueWithUnits(r.displayValue,r.units,r.type);this.addProperty(r.displayName,a,l?"Other":"",l?{localizeCategory:!0}:{})}},i.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=document.createElement("div");t.className="noProperties";var i="No properties to display";t.setAttribute("data-i18n",i),t.textContent=Autodesk.Viewing.i18n.translate(i),e.appendChild(t)},i.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},i.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},i.prototype.addProperty=function(e,t,i,n){var o=this.tree.getElementForNode({name:e,value:t,category:i});if(o)return!1;var r=null,s={name:e,value:t,type:"property"};return i?(r=this.tree.getElementForNode({name:i}),r||(r=this.tree.createElement_({name:i,type:"category"},this.tree.myRootContainer,n&&n.localizeCategory?{localize:!0}:null)),s.category=i):r=this.tree.myRootContainer,this.tree.createElement_(s,r,n&&n.localizeProperty?{localize:!0}:null),!0},i.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},i.prototype.removeProperty=function(e,t,i,n){var o={name:e,value:t,category:i},r=this.tree.getElementForNode(o);return!!r&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(o)],r.parentNode.removeChild(r),!0)},i.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},i.prototype.setCategoryCollapsed=function(e,t){var i=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(i,t)},i.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},i.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},i.prototype.highlight=function(e,t){function i(t){var i=t.innerHTML,n=i.replace(/(<highlight>|<\/highlight>)/gim,"");if(i!==n&&(t.innerHTML=n),e&&""!==e){var o=new RegExp("(\\b"+e+"\\b)","gim"),r=n.replace(o,"<highlight>$1</highlight>");t.innerHTML=r}}for(var n in this.highlightableElements)for(var o=this.highlightableElements[n],r=0;r<o.length;++r)i(o[r])},i.prototype.displayCategory=function(e,t,i){var n=document.createElement("div"),o=e.name;return i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o,n.title=o,n.className="categoryName",t.appendChild(n),[n]},i.prototype.displayProperty=function(t,i,n){var o=document.createElement("div"),r=t.name;n&&n.localize&&(o.setAttribute("data-i18n",r),r=Autodesk.Viewing.i18n.translate(r)),o.textContent=r,o.title=r,o.className="propertyName";var s=document.createElement("div");s.className="separator";var a=document.createElement("div");a.textContent=t.value;var l=t.value;return a.title=l,l=e(l),a.innerHTML=l,a.className="propertyValue",i.appendChild(o),i.appendChild(s),i.appendChild(a),[o,a]},i.prototype.getCategoryClass=function(e){return"category"},i.prototype.getPropertyClass=function(e){return"property"},i.prototype.onCategoryClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyClick=function(e,t){},i.prototype.onCategoryIconClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyIconClick=function(e,t){},i.prototype.onCategoryDoubleClick=function(e,t){},i.prototype.onPropertyDoubleClick=function(e,t){},i.prototype.onCategoryRightClick=function(e,t){},i.prototype.onPropertyRightClick=function(e,t){},Autodesk.Viewing.UI.PropertyPanel=i}(),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private,i=function(e){this.viewer=e,this.menus=[],this.open=!1};i.prototype.constructor=i,i.prototype.show=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var n=e.clientX-i.left,o=e.clientY-i.top;if(!this.open){var r=this;this.showMenu(t,n,o),this.open=!0,this.hideEventListener=function(e){"menuItem"!==e.target.className&&r.hide(e)},this.isTouch="press"===e.type,document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}},i.prototype.showMenu=function(i,n,o){var r,s=document.createElement("div"),a=[];s.className="menu",this.viewer.container.appendChild(s),this.menus.push(s);for(var l=0;l<i.length;++l){var c=i[l],u=c.title,h=c.target;r=this.createMenuItem(s,u),"function"==typeof h?this.addCallbackToMenuItem(r,h):Array.isArray(h)?a.push({menuItem:r,target:h}):t.logger.warn("Invalid context menu option:",u,h)}var d=s.getBoundingClientRect(),p=d.width,v=d.height,g=this.viewer.container.getBoundingClientRect(),m=g.width,f=g.height,E=e.isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput();for(E&&(n-=p),n<0&&(n=0),m<n+p&&(n=m-p,n<0&&(n=0)),o<0&&(o=0),f<o+v&&(o=f-v,o<0&&(o=0)),s.style.top=Math.round(o)+"px",s.style.left=Math.round(n)+"px",l=0;l<a.length;++l){var A=a[l];r=A.menuItem,d=r.getBoundingClientRect(),n=Math.round((E?d.left:d.right)-g.left),o=Math.round(d.top-g.top),this.addSubmenuCallbackToMenuItem(r,A.target,n,o)}},i.prototype.createMenuItem=function(e,t){var i=document.createElement("div");return i.className="menuItem",i.setAttribute("data-i18n",t),i.textContent=Autodesk.Viewing.i18n.translate(t),e.appendChild(i),i},i.prototype.addCallbackToMenuItem=function(e,t){var i=this;e.addEventListener("click",function(e){return i.hide(),t(),e.preventDefault(),!1},!1)},i.prototype.addSubmenuCallbackToMenuItem=function(e,t,i,n){var o=this;e.addEventListener("click",function(){o.showMenu(t,i,n)},!1)},i.prototype.hide=function(){if(this.open){for(var e=0;e<this.menus.length;++e)this.menus[e]&&this.menus[e].parentNode.removeChild(this.menus[e]);return this.menus=[],this.open=!1,document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener),this.isTouch=!1,!0}return!1},Autodesk.Viewing.Private.ContextMenu=i}(),function(){"use strict";var e=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),t=function(t){this.viewer=t,this.contextMenu=new e.ContextMenu(t)};t.prototype.constructor=t,t.prototype.show=function(e){var t=this.viewer.getSelectionCount(),i=this.viewer.getSelectionVisibility(),n={numSelected:t,hasSelected:0<t,hasVisible:i.hasVisible,hasHidden:i.hasHidden},o=this.buildMenu(e,n);this.viewer.runContextMenuCallbacks(o,n),o&&0<o.length&&this.contextMenu.show(e,o)},t.prototype.hide=function(){return this.contextMenu.hide()},t.prototype.buildMenu=function(e,t){return null},Autodesk.Viewing.UI.ObjectContextMenu=t}(),Autodesk.Viewing.Private.Preferences=function(e,t){function i(){var e=t.prefix+"test";try{var i=window.localStorage;return i.setItem(e,"1"),i.removeItem(e),!0}catch(e){return!1}}function n(e,i){if(h){if(d.hasTag(e,"no-storage"))return;var n=t.prefix+e;return"undefined"!=typeof i?localStorage[n]=i:i=localStorage[n],i}}function o(e,t){if("string"!=typeof e||"function"==typeof d[e])return void a.logger.log("Preferences: invalid name="+e);var i=n(e),o=!1;if(void 0!==i)try{i=JSON.parse(i),o=!0}catch(e){}d[e]=o?i:t,u[e]={}}function r(e){h&&(e=t.prefix+e,delete localStorage[e])}"string"==typeof t&&(t={prefix:t}),t||(t={}),t.prefix||(t.prefix="Autodesk.Viewing.Preferences."),t.hasOwnProperty("localStorage")||(t.localStorage=!0);var s=Autodesk.Viewing,a=Autodesk.Viewing.Private,l={},c={},u={},h=t.localStorage&&i(),d=this;e.addEventListener(s.PREF_CHANGED_EVENT,function(e){var t=c[e.name];if(t){var i=t.changed;i&&i(e.value)}}),e.addEventListener(s.PREF_RESET_EVENT,function(e){var t=c[e.name];if(t){var i=t.reset;i&&i(e.value)}}),this.load=function(e){l=e;for(var t in l)l.hasOwnProperty(t)&&o(t,l[t])},this.tag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(l);for(var i=0;i<t.length;++i)u[t[i]][e]=!0}},this.untag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(l);for(var i=0;i<t.length;++i)u[t[i]][e]=!1}},this.hasTag=function(e,t){var i=u[e];return!!i&&i[t]===!0},this.add=function(e,t,i){if(!l.hasOwnProperty(e)){if(l[e]=t,o(e,t),i){Array.isArray(i)||(i=[i]);for(var n=0;n<i.length;++n)this.tag(i[n],e)}return!0}return a.logger.log("Preferences: "+e+" already exists"),!1},this.remove=function(e,t){return!!l.hasOwnProperty(e)&&(delete l[e],delete u[e],delete this[e],t&&r(e),!0)},this.reset=function(t,i){t&&void 0===i&&(i=!0);for(var n in l)if(l.hasOwnProperty(n)){if(t){var o=!!u[n][t];if(i&&!o||!i&&o)continue}this.set(n,l[n],!1)&&e.fireEvent({type:s.PREF_RESET_EVENT,name:n,value:this[n]}),r(n)}},this.get=function(e){return this[e]},this.set=function(t,i,o){return this[t]!==i&&(this[t]=i,n(t,i),(void 0===o||o)&&e.fireEvent({type:s.PREF_CHANGED_EVENT,name:t,value:i}),a.logger.track({category:"pref_changed",name:t,value:i}),!0)},this.addListeners=function(e,t,i){c[e]={changed:t,reset:i}},this.removeListeners=function(e){void 0!==c[e]&&delete c[e]}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(e,t,i,n){function o(e){var t=0<=e?Math.floor(e):Math.ceil(e),i=e-t;return{intPart:t,fracPart:i}}function r(e,t,i){var n="";return i&&0===e&&(n+="-"),n+=0<t?e.toFixed(t):e.toFixed(0)}function s(e,t,i){for(var n="",s=12,a=1,l=e<0,c=0;c<t;++c)a*=2;e>0?e+=.5/a:e-=.5/a;var u,h;i?h=e:(u=o(e/s).intPart,n+=r(u,0,l)+"' ",h=e-u*s,h<0&&(h=-h));var d=o(h).intPart,p=o((h-d)*a).intPart;if(0!==p&&0===d||(n+=r(d,0)),0!==p){for(d<0&&p<0&&(p=-p);p%2===0;)p/=2,a/=2;0!==d&&(n+="-"),n+=r(p,0)+"/"+r(a,0)}return n+='"'}function a(e,t){var i="";e<0&&(i="-",e=Math.abs(e));var n=o(e),s=n.intPart,a=100*n.fracPart;return i+r(s,0)+" m "+r(a,t)+" cm"}function l(e,t){var i="";e<0&&(i="-",e=Math.abs(e));var n=o(e),s=n.intPart,a=12*n.fracPart;return i+r(s,0)+"' "+r(a,t)+'"'}var c;void 0===n&&(n=3);try{if(1===i)c=Autodesk.Viewing.i18n.translate(e?"Yes":"No");else if(24===i){var u=e.split(" ");c=[];for(var h=0;h<u.length;++h)c.push(Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(u[h]),t,3,n));c=c.join(", ")}else 2!==i&&3!==i||!isNaN(e)?"ft-and-fractional-in"===t?c=s(12*e,n):"ft-and-fractional-in^2"===t?c=s(12*e,n)+" "+String.fromCharCode(178):"ft-and-decimal-in"===t?c=l(e,n):"ft-and-decimal-in^2"===t?c=l(e,n)+" "+String.fromCharCode(178):"decimal-in"===t||"in"===t||"inch"===t?c=r(e,n)+'"':"decimal-in^2"===t||"in^2"===t||"inch^2"===t?c=r(e,n)+'" '+String.fromCharCode(178):"decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t?c=r(e,n)+"'":"decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t?c=r(e,n)+"' "+String.fromCharCode(178):"fractional-in"===t?c=s(e,n,!0):"fractional-in^2"===t?c=s(e,n,!0)+" "+String.fromCharCode(178):"m-and-cm"===t?c=a(e,n):"m-and-cm^2"===t?c=a(e,n)+" "+String.fromCharCode(178):3===i&&t?(t=t.replace("^2",String.fromCharCode(178)),t=t.replace("^3",String.fromCharCode(179)),c=r(e,n)+" "+t):c=t?e+" "+t:3===i?r(e,n):e:c="NaN"}catch(i){c=t?e+" "+t:e}return c},Autodesk.Viewing.Private.convertUnits=function(e,t,i,n){if(e===t)return i;var o=1;switch(t){case"mm":o=1e3;break;case"cm":o=100;break;case"m":o=1;break;case"in":o=39.37007874;break;case"ft":o=3.280839895;break;case"ft-and-fractional-in":o=3.280839895;break;case"ft-and-decimal-in":o=3.280839895;break;case"decimal-in":o=39.37007874;break;case"decimal-ft":o=3.280839895;break;case"fractional-in":o=39.37007874;break;case"m-and-cm":o=1}var r=1;switch(e){case"mm":r=.001;break;case"cm":r=.01;break;case"m":r=1;break;case"in":r=.0254;break;case"ft":r=.3048;break;case"ft-and-fractional-in":r=.3048;break;case"ft-and-decimal-in":r=.3048;break;case"decimal-in":r=.0254;break;case"decimal-ft":r=.3048;break;case"fractional-in":r=.0254;break;case"m-and-cm":r=1}return"square"===n?i*Math.pow(o*r,2):i*o*r},AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private;t.OptionSlider=function(t,i,n,o,r){function s(e){e.target!=a.stepperElement&&(a.stepperElement.value=a.sliderElement.value),a.fireChangeEvent()}var a=this;this.tbody=o;var l=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l);var c=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=t+"_slider",this.sliderElement.min=i,this.sliderElement.max=n,c.appendChild(this.caption),c.appendChild(this.sliderElement),c=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=t+"_stepper",this.stepperElement.min=i,this.stepperElement.max=n,this.stepperElement.step=1,this.stepperElement.style.width="64px",c.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(e){e.target!=a.sliderElement&&(a.sliderElement.value=a.stepperElement.value),
a.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",s,!1),this.sliderElement.addEventListener("input",s,!1)},t.OptionSlider.prototype.constructor=t.OptionSlider,e.EventDispatcher.prototype.apply(t.OptionSlider.prototype),t.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},t.OptionSlider.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},t.OptionSlider.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox=function(t,i,n,o){var r=this;this.tbody=i;var s=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(s);var a=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),a.appendChild(this.caption),a=this.sliderRow.insertCell(1),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=t+"_check",this.checkElement.checked=n,a.appendChild(this.checkElement),this.blockEvent=!1,this.checked=n,this.checkElement.addEventListener("change",function(e){r.fireChangeEvent()},!1),e.isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(e){e.preventDefault(),e.target.click()})),this.checkElement.addEventListener("click",function(e){e.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(e){r.checkElement.disabled||(r.checkElement.checked=!r.checkElement.checked,r.fireChangeEvent())},!1)},t.OptionCheckbox.prototype.constructor=t.OptionCheckbox,e.EventDispatcher.prototype.apply(t.OptionCheckbox.prototype),t.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},t.OptionCheckbox.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},t.OptionCheckbox.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},t.OptionCheckbox.prototype.getValue=function(){var e=this.checkElement.checked;return e},t.OptionCheckbox.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox.prototype.setVisibility=function(e){e?this.sliderRow.style.display="table-row":this.sliderRow.style.display="none"},t.OptionLabel=function(t,i,n){this.tbody=i;var o=n&&n.insertAtIndex?n.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o);var r=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),r.appendChild(this.caption),r.colSpan="2",r.style.paddingLeft="10px",r.style.paddingRight="10px",this.blockEvent=!1},t.OptionDropDown=function(t,i,n,o,r,s){var a=this;this.tbody=i;var l=s&&s.insertAtIndex?s.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=t+"_dropdown",this.dropdownElement.className="optionDropDown";for(var c=0;c<n.length;c++){var u=document.createElement("option");u.value=c,u.setAttribute("data-i18n",n[c]),u.textContent=e.i18n.translate(n[c]),this.dropdownElement.add(u)}this.selectedIndex=this.dropdownElement.selectedIndex=o;var h=this.sliderRow.insertCell(0);if(this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),h.appendChild(this.caption),r){h.colSpan="2",h.style.paddingLeft="10px",h.style.paddingRight="10px",this.sliderRow=this.tbody.insertRow(l);var h=this.sliderRow.insertCell(0);h.appendChild(this.dropdownElement),h.colSpan="2",this.dropdownElement.style.width="100%"}else{var h=this.sliderRow.insertCell(1);h.appendChild(this.dropdownElement)}h.style.paddingLeft="5px",h.style.paddingRight="5px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(e){a.fireChangeEvent()},!1)},t.OptionDropDown.prototype.constructor=t.OptionDropDown,e.EventDispatcher.prototype.apply(t.OptionDropDown.prototype),t.OptionDropDown.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},t.OptionDropDown.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},t.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},t.OptionDropDown.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e}}(),function(){"use strict";var e=function(e){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,e.appendChild(this.bg),this.widthScale=this.fg.clientWidth};e.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*e*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(e){var t=this,i=Autodesk.Viewing,n=Autodesk.Viewing.Private;this.viewer=e,Autodesk.Viewing.UI.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70,marginTop:20}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.celToggle=new n.OptionCheckbox("Cel Shaded",this.tbody,!1),this.addEventListener(this.celToggle,"change",function(i){var n=t.celToggle.checked;e.prefs.set("celShaded",n),e.impl.toggleCelShading(n)}),this.saoToggle=new n.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(i){var n=t.saoToggle.checked;e.prefs.set("ambientShadows",n),e.setQualityLevel(n,e.impl.renderer().settings.antialias)}),this.saoRadius=new n.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.saoIntensity=new n.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new n.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(i){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))}),this.groundShadowColor=new n.OptionCheckbox("Shadow Color",this.tbody),i.isIE11||(this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(i){var n=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(n.substr(1,7),16)))}),this.groundReflectionAlpha=new n.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(i){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))}),this.groundReflectionColor=new n.OptionCheckbox("Reflection Color",this.tbody),i.isIE11||(this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(i){var n=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(n.substr(1,7),16)))});for(var o=[],r=0;r<n.LightPresets.length;r++)o.push(n.LightPresets[r].name);this.envSelect=new n.OptionDropDown("Environment",this.tbody,o,e.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(i){var n=t.envSelect.selectedIndex;e.setLightPreset(n)});var s=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new n.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],s),this.addEventListener(this.toneMapMethod,"change",function(){var i=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(i)}),this.exposureBias=new n.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(i){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.exposureBias.setDisabled(0==s),this.whiteScale=new n.OptionSlider("Light Intensity",-5,20,this.tbody);var a=0;e.impl.dir_light1&&(a=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(a),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(i){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.fovAngle=new n.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",function(i){e.setFOV(parseFloat(t.fovAngle.value))}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(i){var n=parseFloat(t.fovAngle.value),o=e.getFOV();n!=o&&t.fovAngle.setValue(o)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(e){t.syncUI()}),this.addVisibilityListener(function(){t.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var i=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(i),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==i),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV()),this.celToggle.setValue(e.renderer().settings.toonShaded)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.bgSelect=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict";var e=Autodesk.Viewing,t=Autodesk.Viewing.UI,i=function(i,n,o){this.viewer=i,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=navigator.userAgent.search("Mac OS")!==-1;var r="Layer Manager",s=i.config.viewableName,a=!0;s&&"W2D"!==s&&(r=e.i18n.translate(r)+": "+s,a=!1),this.filterImageId=o+"-layerFilterImageId",t.DockingPanel.call(this,i.container,o,r,{localizeTitle:a}),this.container.classList.add("layersPanel"),this.filterContainer=document.createElement("div"),this.filterContainer.className="filterBox",this.filterContainer.id=this.container.id+"-search-container",this.container.appendChild(this.filterContainer),this.createScrollContainer({heightAdjustment:105,marginTop:5});var l=this;i.model?l.build():l.addEventListener(i,e.GEOMETRY_LOADED_EVENT,function(){l.build()}),this.addVisibilityListener(function(){l.resizeToContent()})};i.prototype=Object.create(t.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.uninitialize=function(){t.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.visibilityImages=null,this.scrollContainer=null,this.filterContainer=null},i.prototype.build=function(){function i(){var e=new t.TreeDelegate;return e.getTreeNodeId=function(e){return e.id},e.getTreeNodeLabel=function(e){return r.getNodeLabel(e)},e.getTreeNodeClass=function(e){return r.getNodeClass(e)},e.isTreeNodeGroup=function(e){return r.isGroupNode(e)},e.shouldCreateTreeNode=function(e){return r.shouldInclude(e)},e.onTreeNodeClick=function(e,t,i){r.onClick(t,i)},e.onTreeNodeRightClick=function(e,t,i){r.onRightClick(t,i)},e.onTreeNodeDoubleClick=function(e,t,i){r.onDoubleClick(t,i)},e.onTreeNodeIconClick=function(e,t,i){r.onIconClick(t,i)},e.createTreeNode=function(e,t){r.createNode(e,t)},e}function n(){c&&clearTimeout(c),c=setTimeout(o,500)}function o(){function e(i){var n=[];if(i.name.toLowerCase().indexOf(t)!==-1)n.push(i);else if(!i.isLayer)for(var o=i.children,r=0;r<o.length;++r)n=n.concat(e(o[r]));return n}if(l.value){var t=l.value.toLowerCase();d&&0<d.childCount&&u.setLayerVisible(e(d),!0,!0)}else u.setLayerVisible(null,!0);c=null}var r=this,s=document.createElement("div");s.className="filterSearch",r.filterContainer.appendChild(s);var a=document.createElement("div");a.className="filterImage",a.id=r.filterImageId,a.title=e.i18n.translate("Show/hide all layers"),s.appendChild(a),r.visibilityImages[r.filterImageId]=a,r.addEventListener(a,"click",function(e){r.onImageClick(null,e),e.stopPropagation()});var l=this.filterField=document.createElement("input");l.className="filterInput",l.placeholder=e.i18n.translate("Enter filter term"),l.setAttribute("data-i18n","[placeholder]Enter filter term"),l.type="search",l.incremental="incremental",s.appendChild(l);var c=null,u=r.viewer;l.addEventListener("keyup",function(e){n()}),l.addEventListener("click",function(e){return""===l.value?void u.setLayerVisible(null,!0):void setTimeout(function(){""===l.value&&(u.setLayerVisible(null,!0),e.preventDefault())},1)});var h=i(),d=r.layersRoot=r.viewer.model.getLayersRoot();d&&(r.tree=new t.Tree(h,d,r.scrollContainer,{excludeRoot:!0}),r.resizeToContent(),r.update(),r.addEventListener(r.viewer,e.LAYER_VISIBILITY_CHANGED_EVENT,function(){r.update()}))},i.prototype.update=function(){function e(e,t){var i;i=1===t?"layerVisible":0===t?"layerHidden":"layerMixed",e.classList.remove("layerVisible"),e.classList.remove("layerHidden"),e.classList.remove("layerMixed"),e.classList.add(i)}function t(e,t){0===t?o.tree.addClass(e.id,"dim"):o.tree.removeClass(e.id,"dim")}function i(e){var t;if(0<e.length)for(var i=0;i<e.length;++i){var n=e[i];if(void 0===t?t=n:0===n&&1===t?t=-1:1===n&&0===t&&(t=-1),t===-1)break}else t=0;return t}function n(r){var s=r.id,a=o.visibilityImages[s];if(!r.isLayer){for(var l=r.children,c=[],u=0;u<l.length;++u)c=c.concat(n(l[u]));var h=i(c);return e(a,h),t(r,h),c}var d=o.viewer.isLayerVisible(r)?1:0;return e(a,d),t(r,d),[d]}var o=this,r=this.layersRoot&&0<this.layersRoot.childCount?n(o.layersRoot):[],s=o.visibilityImages[o.filterImageId];e(s,i(r))},i.prototype.setLayerVisible=function(e,t){var i=e?e.id:this.filterImageId,n=this.visibilityImages[i].className,o="layerVisible"!==n;this.viewer.setLayerVisible(e,o,t),this.filterField.value=""},i.prototype.getNodeLabel=function(e){return e.isLayer||0===e.childCount?e.name:e.name+" ("+e.childCount+")"},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){return!e.isLayer},i.prototype.shouldInclude=function(e){return!0},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){var i=this.tree.delegate();if(i.isTreeNodeGroup(e)){var n=i.getTreeNodeId(e);this.tree.setCollapsed(n,t),this.resizeToContent()}},i.prototype.isGroupCollapsed=function(e){var t=this.tree.delegate();if(t.isTreeNodeGroup(e)){var i=t.getTreeNodeId(e);return this.tree.isCollapsed(i)}return!1},i.prototype.onClick=function(e,t){},i.prototype.onDoubleClick=function(e,t){},i.prototype.onRightClick=function(e,t){},i.prototype.onImageClick=function(e,t){},i.prototype.getContentSize=function(){var e=this.filterContainer,t=e.clientHeight+80,i=e.clientWidth,n=this.tree;if(n){var o=n.getRootContainer();if(o)return{height:o.clientHeight+t,width:Math.max(o.clientWidth,i)}}return{height:t,width:i}},i.prototype.createNode=function(t,i){var n=document.createElement("div");i.children&&i.children.length>0?i.insertBefore(n,i.children[0]):i.appendChild(n),n.title=e.i18n.translate("Show/hide this layer"),this.visibilityImages[t.id]=n;var o=document.createElement("label");o.textContent=this.getNodeLabel(t),i.appendChild(o);var r=this;this.addEventListener(n,"click",function(e){r.onImageClick(t,e),e.stopPropagation()})},Autodesk.Viewing.UI.LayersPanel=i}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(e,t,i,n){Autodesk.Viewing;Autodesk.Viewing.UI.DockingPanel.call(this,e,t,i,n),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0;var o=this,r=n&&void 0!==n.width?n.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=r+"px",this.container.style.top="100px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.className="settings-tabs",this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=n&&n.heightAdjustment?n.heightAdjustment:110,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver)return!0;for(var i=0;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0;for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.remove("selectedmouseout");return!0}t=t.parentNode}}),this.addEventListener(this.container,"mouseout",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver){for(;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}o.mouseOver=!1;for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.contains("tabselected")&&o.panelTabs[i].classList.add("selectedmouseout")}}),this.expandID=function(e){return t+"-"+e}},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(e){e&&(this.container.style.display="block"),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,e)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(e,t,i){function n(t){o.selectTab(e)}var o=this;if(void 0!==this.tabIdToIndex[e])return!1;var r=i&&void 0!==i.className?i.className:null,s=i&&void 0!==i.width?i.width:200,a=i&&void 0!==i.index?i.index:this.panelTabs.length,l=document.createElement("li");l._id=e,l.id=this.expandID(l._id);var c=document.createElement("a"),u=document.createElement("span");u.setAttribute("data-i18n",t),u.textContent=Autodesk.Viewing.i18n.translate(t),c.appendChild(u),l.appendChild(c),this.tabs.appendChild(l);var h=document.createElement("table");h._id=e+"-table",h.id=this.expandID(h._id),h.className="settings-table adsk-lmv-tftable "+r;var d=document.createElement("tbody");h.appendChild(d),this.scrollContainer.appendChild(h),this.addEventListener(l,"touchstart",av.touchStartToClick),this.addEventListener(l,"click",n),this.panelTabs.push(l),this.tabIdToIndex[e]=a;var p=this.container.style.minWidth?parseInt(this.container.style.minWidth):0;return s>p&&(this.container.style.minWidth=s+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={};for(var i=this.panelTabs.length,n=0;n<i;n++){var o=this.panelTabs[n];this.tabIdToIndex[o._id]=n}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t];return void 0!==i},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.panelTabs.length,i=0;i<t;i++){var n=this.panelTabs[i],o=document.getElementById(this.expandID(n._id+"-table"));e===n._id?(n.classList.add("tabselected"),o.style.display="table",this.mouseOver||n.classList.add("selectedmouseout")):(n.classList.remove("tabselected"),o.style.display="none",this.mouseOver||this.panelTabs[i].classList.remove("selectedmouseout"))}return this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t];return i&&i.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(e,t,i,n,o){var r=this.tabIdToIndex[e];if(void 0===r)return null;var s=document.getElementById(this.expandID(e+"-table")),a=new Autodesk.Viewing.Private.OptionCheckbox(t,s.tBodies[0],i,o);return a.changeListener=function(e){var t=e.detail.target.checked;n(t)},this.addEventListener(a,"change",a.changeListener),this.addControl(e,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(e,t,i,n,o,r,s){var a=this.tabIdToIndex[e];if(void 0===a)return null;var l=document.getElementById(this.expandID(e+"-table")),c=new Autodesk.Viewing.Private.OptionSlider(t,i,n,l.tBodies[0],s);return c.setValue(o),c.sliderElement.step=c.stepperElement.step=1,this.addEventListener(c,"change",function(e){r(e)}),this.addControl(e,c)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(e,t,i,n,o,r){var s=this.tabIdToIndex[e];if(void 0===s)return null;var a=document.getElementById(this.expandID(e+"-table")),l=new Autodesk.Viewing.Private.OptionDropDown(t,a.tBodies[0],i,n,r);return this.addEventListener(l,"change",function(e){o(e)}),this.addControl(e,l)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(e,t,i){var n=this.tabIdToIndex[e];if(void 0===n)return null;if(!t.hasOwnProperty("sliderRow")){var o=i&&i.insertAtIndex?i.insertAtIndex:-1,r=i&&i.caption?i.caption:null,s=document.getElementById(this.expandID(e+"-table"));o>s.length&&(o=-1);var a=s.tBodies[0].insertRow(o),l=a.insertCell(0);if(r){var c=document.createElement("div");c.setAttribute("data-i18n",r),c.textContent=Autodesk.Viewing.i18n.translate(r),l.appendChild(c),l=a.insertCell(1)}else l.colSpan=2;l.appendChild(t),t.sliderRow=a,t.tbody=s.tBodies[0]}var u=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[u]=t,this.resizeToContent(),u},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(e){var t;if(t="object"==typeof e&&e.tbody?e:this.controls[e],void 0===t)return!1;var i=t.tbody,n=t.sliderRow,o=n.rowIndex;return i.deleteRow(o),delete this.controls[e],this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(e){return this.controls[e]||null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=this.panelTabs.length>this.panelTabs[0]?0:null,i=0;i<this.panelTabs.length;i++){var n=this.panelTabs[i];if(this.isTabSelected(n._id)){t=n;break}}if(t){var o=document.getElementById(this.expandID(n._id+"-table"));e+=o.clientHeight}return{height:e,width:this.container.clientWidth}},function(){"use strict";var e=function(){};e.instances=[],e.displayError=function(t,i,n,o,r){var s=document.createElement("div");s.className="alertBox error",t.appendChild(s);var a=o;a||(a="img-item-not-found");var l=document.createElement("div");l.className="alertBoxImage "+a,s.appendChild(l);var c=document.createElement("div");c.className="alertBoxMsg",s.appendChild(c);var u=n;u||(u=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var h=document.createElement("div");h.className="alertBoxTitle",h.textContent=u,c.appendChild(h);var d=document.createElement("div");if(d.className="alertBoxText",d.textContent=i,c.appendChild(d),r){var p=document.createElement("div");p.className="alertBoxContent",c.appendChild(p);var v=document.createElement("ul");v.className="alertBoxContent";for(var g=0;g<r.length;g++){var m=r[g];if(m){var f=document.createElement("li");v.appendChild(f);var E=this.extractList(m);if(E.list.length){var A=this.generateListElement(list);v.appendChild(A)}f.innerHTML=E.msg}}p.appendChild(v)}var y=document.createElement("div");y.className="alertBoxOK",y.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var T={alertBox:s,container:t};y.addEventListener("click",function(i){s.style.visibility="hidden",t.removeChild(s),e.instances.splice(e.instances.indexOf(T),1)}),s.appendChild(y),s.style.visibility="visible",e.instances.push(T)},e.displayErrors=function(t,i,n){var o=document.createElement("div");o.className="alertBox errors",t.appendChild(o);var r=i;r||(r="img-item-not-found");var s=document.createElement("div");s.className="alertBoxImage "+r,o.appendChild(s);var a=document.createElement("div");a.className="alertBoxMsg errors",o.appendChild(a);for(var l=0;l<n.length;l++){var c=n[l].header;c||(c=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var u=document.createElement("div");u.className="alertBoxTitle errors",u.textContent=c,a.appendChild(u);var h=document.createElement("div");h.className="alertBoxText errors";var d=n[l].msg,p=this.extractList(d);if(p.list.length){var v=document.createElement("div"),g=this.generateListElement(p.list);v.appendChild(g),h.textContent=p.msg,h.appendChild(v)}else h.textContent=d;if(a.appendChild(h),n[l].hints){var m=document.createElement("ul");m.className="alertBoxContent";for(var f=n[l].hints,E=0;E<f.length;E++){var A=f[E];if(A){var y=document.createElement("li");m.appendChild(y);var p=this.extractList(A);if(p.list.length){var g=this.generateListElement(p.list);m.appendChild(g)}y.innerHTML=p.msg}}a.appendChild(m)}}var T=document.createElement("div");T.className="alertBoxOK",T.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:o,container:t};T.addEventListener("click",function(i){o.style.visibility="hidden",t.removeChild(o),e.instances.splice(e.instances.indexOf(w),1)}),o.appendChild(T),o.style.visibility="visible",e.instances.push(w)},e.extractList=function(e){var t={msg:e,list:[]};if(e&&e.indexOf("<ul>")!=-1){var i=e.split("<ul>");t.msg=i[0],i=i[1].split("</ul>"),t.list=i[0].split(", "),1===t.list.length&&(t.list=i[0].split(","))}return t},e.generateListElement=function(e){for(var t=document.createElement("ul"),i=0;i<e.length;i++){var n=document.createElement("li");n.textContent=e[i],t.appendChild(n)}return t},e.dismiss=function(){if(e.instances.length>0){var t=e.instances.pop();return t.alertBox.style.visibility="hidden",t.container.removeChild(t.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=e}(),function(){"use strict";var e=Autodesk.Viewing,t=function(){};t.instances=[],t.displayMessage=function(i,n,o,r,s){if(!(t.instances.length>0)){var a=n.msgTitleKey,l=n.msgTitleDefaultValue||a,c=n.messageKey,u=n.messageDefaultValue||c,h=n.buttonText,d=n.checkboxChecked||!1,p=document.createElement("div");p.className="hud",i.appendChild(p);var v=document.createElement("div");if(v.className="hudTitle",v.textContent=e.i18n.translate(a,{defaultValue:l}),v.setAttribute("data-i18n",a),p.appendChild(v),o){var g=document.createElement("div");g.className="hudClose",g.innerHTML="&times;",g.addEventListener("click",function(e){t.dismiss(),o&&o(e)}),p.appendChild(g)}var m=document.createElement("div");if(m.className="hudMessage",m.textContent=e.i18n.translate(c,{defaultValue:u}),m.setAttribute("data-i18n",u),p.appendChild(m),r){var f=document.createElement("div");f.className="hudButton",f.textContent=e.i18n.translate(h,{defaultValue:h}),f.setAttribute("data-i18n",h),f.addEventListener("click",r),p.appendChild(f)}if(s){var E=document.createElement("div"),A=document.createElement("input");A.className="hudCheckbox",A.type="checkbox",A.checked=d,E.appendChild(A);var y="Do not show this message again",T=document.createElement("label");T.setAttribute("for",y),T.setAttribute("data-i18n",y),T.textContent=e.i18n.translate(y,{defaultValue:y}),E.appendChild(T),A.addEventListener("change",s),p.appendChild(E)}var w={hudMessage:p,container:i};t.instances.push(w)}},t.dismiss=function(){if(t.instances.length>0){var e=t.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=t}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(){};n.prototype.constructor=n,n.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},n.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},n.prototype.getTreeNodeLabel=function(e){return e.name},n.prototype.shouldCreateTreeNode=function(e){return!0},n.prototype.forEachChild=function(e,t){for(var i=e.children?e.children.length:0,n=0;n<i;++n){var o=e.children[n];t(o)}},n.prototype.createTreeNode=function(e,t,i){var n=document.createElement("label");t.appendChild(n);var o=this.getTreeNodeLabel(e);i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o},n.prototype.onTreeNodeClick=function(e,t,i){},n.prototype.onTreeNodeIconClick=function(e,t,i){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},n.prototype.onTreeNodeDoubleClick=function(e,t,i){},n.prototype.onTreeNodeRightClick=function(e,t,i){},n.prototype.getTreeNodeClass=function(e){
return""},n.prototype.onTreeNodeHover=function(e,t,i){};var o=function(e,t,i,n){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=n||{};var o="treeview";this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var r=this.myRootContainer=this.createHtmlElement_(i,"div",o),s=this.rootElem=this.createElement_(t,r,n,0);this.setInputHandlers_(),n&&n.excludeRoot&&s.classList.add("exclude")};o.prototype.constructor=o,o.prototype.show=function(e){var t=this.myRootContainer;e?t.style.display="block":t.style.display="none"},o.prototype.getRootContainer=function(){return this.myRootContainer},o.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},o.prototype.delegate=function(){return this.myDelegate},o.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},o.prototype.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},o.prototype.setAllCollapsed=function(e){var t,i;e?(t=function(e){return e.classList.contains("expanded")},i=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},i=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var n=0;n<this.myGroupNodes.length;++n){var o=this.myGroupNodes[n];t(o)&&i(o)}},o.prototype.addToSelection=function(e){function t(e){var t=i.mySelectedNodes.indexOf(e);return t===-1&&(i.mySelectedNodes.push(e),!0)}for(var i=this,n=e.length,o=0;o<n;++o){var r=e[o];t(r)&&this.addClass(r,"selected")}},o.prototype.removeFromSelection=function(e){function t(e){var t=i.mySelectedNodes.indexOf(e);return t!==-1&&(i.mySelectedNodes.splice(t,1),!0)}for(var i=this,n=e.length-1;n>=0;--n){var o=e[n];t(o)&&this.removeClass(o,"selected")}},o.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},o.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},o.prototype.isSelected=function(e){return this.hasClass(e,"selected")},o.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var i=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)i+=t.offsetTop,t=t.parentNode;this.myRootContainer.parentNode.scrollTop=i}},o.prototype.addClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.add(t),n=n.parentNode}else n.classList.add(t);return!0}return!1},o.prototype.removeClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.remove(t),n=n.parentNode}else n.classList.remove(t);return!0}return!1},o.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},o.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},o.prototype.createElement_=function(e,t,i,n){function o(t,n,o,r){var a=s.createHtmlElement_(t,n,o),l=s.myDelegate.getTreeNodeId(r);a.setAttribute("lmv-nodeId",l);var c=s.createHtmlElement_(a,"header"),u=s.createHtmlElement_(c,"icon");return u.addEventListener("click",function(t){s.myDelegate.onTreeNodeIconClick(s,e,t),t.stopPropagation(),t.preventDefault()},!1),s.myDelegate.createTreeNode(e,c,i),a}if(void 0===e||null===e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var r,s=this,a=this.myDelegate.getTreeNodeId(e);if(s.myDelegate.isTreeNodeGroup(e)){r=o(t,"group","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e;var l=s.myOptions.excludeRoot?1:0;n==l&&(r.style.left="0px"),s.myGroupNodes.push(r),s.myDelegate.forEachChild(e,function(e){s.createElement_(e,r,i,n+1)})}else{r=o(t,"leaf","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e;var l=s.myOptions.excludeRoot?1:0;n==l&&(r.style.marginLeft="0px")}var c=s.myDelegate.getTreeNodeClass(e);return c&&r.classList.add(c),r},o.prototype.setInputHandlers_=function(){var e=this,i=this.myRootContainer,n=null,o=function(t){var o=null,r=!1;do t&&t!==i?t.hasAttribute("lmv-nodeId")?(o=t,r=!0):t=t.parentElement:(o=null,r=!0);while(!r);if(o){var s=o.getAttribute("lmv-nodeId");return e.nodeIdToNode[s]||n}return n};t.isTouchDevice()&&(this.hammer=new Hammer.Manager(i,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.on("doubletap",function(t){var i=o(t.target);i!==n&&e.myDelegate.onTreeNodeDoubleClick(e,i,t)}),this.hammer.on("press",function(t){var i=o(t.target);i!==n&&e.myDelegate.onTreeNodeRightClick(e,i,t)})),i.addEventListener("click",function(t){var i=o(t.target);i!==n&&(e.myDelegate.onTreeNodeClick(e,i,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())},!1),i.addEventListener("dblclick",function(t){var i=o(t.target);i!==n&&(e.myDelegate.onTreeNodeDoubleClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("contextmenu",function(t){var i=o(t.target);i!==n&&(e.myDelegate.onTreeNodeRightClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseover",function(t){var i=o(t.target);i!==n&&(e.myDelegate.onTreeNodeHover(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseout",function(t){var i=-1;e.myDelegate.onTreeNodeHover(e,i,t),t.stopPropagation(),t.preventDefault()},!1)},o.prototype.createHtmlElement_=function(e,t,i){var n=document.createElement(t);return e.appendChild(n),i&&(n.className=i),n},o.prototype.iterate=function(e,t){if(void 0!==e&&null!==e&&this.myDelegate.shouldCreateTreeNode(e)){var i=this.getElementForNode(e);if(i){t(e,i);var n=this;this.myDelegate.forEachChild(e,function(e){n.iterate(e,t)})}}},i.TreeDelegate=e.TreeDelegate=n,i.Tree=e.Tree=o}(),function(){"use strict";var e=function(){},t=Autodesk.Viewing.Private;e.prototype.constructor=e,e.prototype.getNodeId=function(e){throw"getId is not implemented."},e.prototype.getNodeLabel=function(e){return e.name},e.prototype.getNodeClass=function(e){return""},e.prototype.hasThumbnail=function(e){return!1},e.prototype.getThumbnailOptions=function(e){return null},e.prototype.getThumbnail=function(e){return null},e.prototype.onNodeClick=function(e,t,i){},e.prototype.onNodeHover=function(e,t,i){},e.prototype.selectItem=function(e){},e.prototype.deselectItem=function(e){},e.prototype.hasContent=function(e){return!1},e.prototype.addContent=function(e,t){};var i=function(e,t,i){this.myDelegate=e,this.mySelectedIds=[];var n="browserview";this.myRootContainerId=i+"-"+n,this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add(n);var o=document.getElementById(i);o.appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)};i.prototype.constructor=i,i.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},i.prototype.getRootContainer=function(){return this.myRootContainer},i.prototype.delegate=function(){return this.myDelegate},i.prototype.addToSelection=function(e){function t(e){var t=i.mySelectedIds.indexOf(e);return t==-1&&(i.mySelectedIds.push(e),!0)}for(var i=this,n=0,o=e.length;n<o;++n){var r=e[n];if(t(r)){var s=i.idToElement[r];void 0===s?i.myDelegate.selectItem(r):s.classList.add("selected")}}},i.prototype.removeFromSelection=function(e){function t(e){var t=i.mySelectedIds.indexOf(e);return t!=-1&&(i.mySelectedIds.splice(t,1),!0)}for(var i=this,n=e.length-1;n>=0;--n){var o=e[n];if(t(o)){var r=this.idToElement[o];void 0===r?i.myDelegate.deselectItem(o):r.classList.remove("selected")}}},i.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},i.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},i.prototype.createElements=function(e,t){if(e)for(var i=this,n=0;n<e.length;n++){var o=e[n];i.createElement(o,t)}},i.prototype.createElement=function(e,i){var n=this,o=n.myDelegate.getNodeId(e),r=document.createElement("item");i.appendChild(r),this.idToElement[o]=r,r.onmouseover=function(){n.myDelegate.onNodeHover(n,e)},r.onclick=function(t){n.myRootContainer.querySelector(".flipped").removeClass("flipped"),n.myDelegate.onNodeClick(n,e,t)};var s=document.createElement("div");s.classList.add("card"),r.appendChild(s);var a=document.createElement("div");a.classList.add("browserElement"),s.appendChild(a);var l=n.myDelegate.getNodeLabel(e),c=document.createElement("label");c.innerHTML=l,a.appendChild(c),c.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)};var u=n.myDelegate.getThumbnail(e);if(u){var h=document.createElement("img");if(h.classList.add("thumb"),LMV_THIRD_PARTY_COOKIE===!1){var d=n.myDelegate.getThumbnailOptions(e);av.Document.requestThumbnailWithSecurity(d,function(e,i){return e?void t.logger.error("Failed to load thumbnail: "+u):(h.src=window.URL.createObjectURL(i),void(h.onload=function(){window.URL.revokeObjectURL(h.src)}))})}else h.src=u;a.appendChild(h),h.onclick=function(t){n.myDelegate.onNodeClick(n,e,t)}}n.myDelegate.hasContent(e)&&n.myDelegate.addContent(e,s),r.classList.add(n.myDelegate.getNodeClass(e))},Autodesk.Viewing.Private.BrowserDelegate=e,Autodesk.Viewing.Private.Browser=i}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing.Private;e.WEBGL_HELP_LINK=null,e.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message> <hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don’t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can’t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There’s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn’t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"}},e.currentError=null,e.currentErrors=null,e.ErrorHandler=function(){},e.ErrorHandler.prototype.constructor=e.ErrorHandler,e.ErrorHandler.getErrorCode=function(e){return 403===e||401===e?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===e?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:e>=500?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE},e.ErrorHandler.reportError=function(t,i,n,o,r,s){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){var a={category:"error",code:i,message:n,httpStatusCode:o,httpStatusText:r};e.logger.track(a,!0),e.ErrorHandler.currentError=[t,i,n,s];var l=e.ErrorInfoData[i];if(l){var c={defaultValue:""};c.defaultValue=l["default-msg"];var u=l.img,h=l["globalized-msg"],d=this.parseErrorString(h,c);if(i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var p=e.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",v=0;v<d.hints.length;v++){var g=d.hints[v].indexOf('href="WEBGL_HELP"');g!==-1&&(d.hints[v]=d.hints[v].replace('href="WEBGL_HELP"','href="'+p+'"'))}e.AlertBox.displayError(t,d.msg,d.header,u,d.hints)}else{var u="img-unsupported",c={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(n,c);var d=this.parseErrorString(i,c);d.header||(d.header="warning"===s?Autodesk.Viewing.i18n.translate("header-warning"):""),e.AlertBox.displayError(t,d.msg,d.header,u,d.hints)}}},e.ErrorHandler.reportErrors=function(t,i){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){e.ErrorHandler.currentErrors=[t,i];for(var n={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},o=[],r=0;r<i.length;r++)if(i[r].code){this.parseArguments(i[r].message,n);var s=this.parseErrorString(i[r].code,n);s.header||(s.header="warning"===i[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),o.push(s);var a={category:"error",code:i[r].code,message:i[r].message};e.logger.track(a,!0)}if(o.length){var l="img-unsupported";e.AlertBox.displayErrors(t,l,o)}}},e.ErrorHandler.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var i=1;i<e.length;i++){var n=i-1,o=n.toString();t[o]=e[i]}}},e.ErrorHandler.parseErrorString=function(e,t){var i={msg:null,msgList:null,header:null,hints:null};if(!e)return i;var n=Autodesk.Viewing.i18n.translate(e,t);if(!n)return i;if(n.indexOf("<title>")!=-1){var o=n.split("<title>")[1].split("</title>");i.header=o[0],n=o[1]}if(n&&n.indexOf("<message>")!=-1){var o=n.split("<message>")[1].split("</message>");i.msg=o[0],n=o[1]}else i.msg=n;if(n&&n.indexOf("<hint>")!=-1){i.hints=[];for(var r=n.split("<hint>"),s=0;s<r.length;s++){var a=r[s].split("</hint")[0];i.hints.push(a)}}return i},e.ErrorHandler.localize=function(){if(e.AlertBox.instances.length>0)if(e.AlertBox.dismiss(),e.ErrorHandler.currentError){var t=e.ErrorHandler.currentError.shift(),i=e.ErrorHandler.currentError;e.ErrorHandler.reportError(t,i[0],i[1],i[2])}else{var t=e.ErrorHandler.currentErrors.shift(),n=e.ErrorHandler.currentErrors[0];e.ErrorHandler.reportErrors(t,n)}}}(),function(){"use strict";var e=function(e,t){this.viewer=e,this.options=t,this.id=""};e.prototype.load=function(){return!0},e.prototype.unload=function(){return!0},e.prototype.getState=function(e){},e.prototype.restoreState=function(e,t){return!0},e.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={},Autodesk.Viewing.Private.logger.warn("Extension cache runtime creation; missing ViewingApplication context."));var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},Autodesk.Viewing.Extension=e}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=function(){function e(e,t){return!n.hasOwnProperty(e)&&(n[e]=t,!0)}function t(e){return n.hasOwnProperty(e)?n[e]:null}function i(e){return!!n.hasOwnProperty(e)&&(delete n[e],!0)}var n={};return{registerExtension:e,getExtension:t,unregisterExtension:i}},n=new i,o=function(){};o.prototype={loadExtension:function(i,o){this.loadedExtensions||(this.loadedExtensions={});var r=!1;if(this.getExtension(i))t.logger.info("Extension already loaded: "+i);else{var s=n.getExtension(i);if(s){var a=new s(this,o);a.id=i,r=a.load(),r&&(this.loadedExtensions[i]=a,t.logger.info("Extension loaded: "+i),this.fireEvent({type:e.EXTENSION_LOADED_EVENT,extensionId:i}))}else t.logger.warn("Extension not found: "+i)}return r},getExtension:function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null},unloadExtension:function(i){var n=!1,o=this.getExtension(i);return o?(n=o.unload(),t.logger.info("Extension unloaded: "+i),delete this.loadedExtensions[i],this.fireEvent({type:e.EXTENSION_UNLOADED_EVENT,extensionId:i})):t.logger.warn("Extension not found: "+i),n},apply:function(e){var t=o.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension}},Autodesk.Viewing.theExtensionManager=n,Autodesk.Viewing.ExtensionMixin=o}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private;t.init_UnifiedCamera=function(t){if("undefined"==typeof e.UnifiedCamera){var i=function(e,i){t.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/i,this.left=-e/2,this.right=e/2,this.top=i/2,this.bottom=-i/2,this.clientWidth=e,this.clientHeight=i,this.target=new t.Vector3(0,0,-1),this.worldup=new t.Vector3(0,1,0),this.orthographicCamera=new t.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new t.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()};i.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,i.prototype=Object.create(t.Camera.prototype),i.prototype.clone=function(){var e=new i(2*this.right,2*this.top);return t.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},i.prototype.__computeFovPosition=function(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var i=this.target.clone().sub(this.position),n=t.Math.degToRad(this.fov),o=t.Math.degToRad(e),r=i.length()*Math.tan(.5*n)/Math.tan(.5*o),s=i.normalize().multiplyScalar(-r);return this.target.clone().add(s)},i.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},i.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var e=i.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,n=t*this.aspect;this.left=this.orthographicCamera.left=-n,this.right=this.orthographicCamera.right=n,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},i.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},i.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},i.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},i.prototype.setLens=function(e,i){void 0===i&&(i=24);var n=2*t.Math.radToDeg(Math.atan(i/(2*e)));return this.setFov(n),n},i.prototype.getCameraChangedEvent=function(){return{type:e.CAMERA_CHANGE_EVENT,camera:this}},e.UnifiedCamera=i}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private;e.ESCAPE_EVENT="escape",e.PROGRESS_UPDATE_EVENT="progress",e.FULLSCREEN_MODE_EVENT="fullScreenMode",e.NAVIGATION_MODE_CHANGED_EVENT="navmode",e.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",e.VIEWER_RESIZE_EVENT="viewerResize",e.VIEWER_INITIALIZED="viewerInitialized",e.VIEWER_UNINITIALIZED="viewerUninitialized",e.MODEL_ROOT_LOADED_EVENT="svfLoaded",e.GEOMETRY_LOADED_EVENT="geometryLoaded",e.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",e.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",e.MODEL_UNLOADED_EVENT="modelUnloaded",e.EXTENSION_LOADED_EVENT="extensionLoaded",e.EXTENSION_UNLOADED_EVENT="extensionUnloaded",e.SELECTION_CHANGED_EVENT="selection",e.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",e.ISOLATE_EVENT="isolate",e.HIDE_EVENT="hide",e.SHOW_EVENT="show",e.CAMERA_CHANGE_EVENT="cameraChanged",e.EXPLODE_CHANGE_EVENT="explodeChanged",e.CUTPLANES_CHANGE_EVENT="cutplanesChanged",e.TOOL_CHANGE_EVENT="toolChanged",e.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",e.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",e.RESET_EVENT="reset",e.PREF_CHANGED_EVENT="PrefChanged",e.PREF_RESET_EVENT="PrefReset",e.ANIMATION_READY_EVENT="animationReady",e.HYPERLINK_EVENT="hyperlink",e.LOAD_GEOMETRY_EVENT="load_geometry",e.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};var i=e.isMobileDevice(),n=0;e.DefaultSettings={ambientShadows:!0,antialiasing:!i,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!i,lineRendering:!0,lightPreset:t.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:i,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNavigation:!0,envMapBackground:!1,renderPrism:!0,firstPersonToolPopup:!0};var o=function(i,o){if("undefined"==typeof THREE&&t.logger.warn("Initializing LMV without the THREE.js dependency is not supported.","Call Autodesk.Viewing.Initializer() first or preload the dependencies manually."),i){if(this.clientContainer=i,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(e.isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=o,this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this;var r={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!0};this.prefs=new t.Preferences(this,r)}this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=n++,this.impl=new t.Viewer3DImpl(this.canvas,this)};o.prototype.constructor=o,e.EventDispatcher.prototype.apply(o.prototype),e.ScreenModeMixin.prototype.apply(o.prototype),e.ExtensionMixin.prototype.apply(o.prototype),o.ScreenMode=e.ScreenMode,o.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"],offObject:["deselectAll"]},clickShift:{onObject:["selectToggle"],offObject:["deselectAll"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},o.prototype.start=function(e,t,i,n){if(this.started)return 0;this.started=!0;var o=this,r=o.initialize();return 0!==r?(n&&setTimeout(function(){n(r)},1),r):(setTimeout(function(){o.setUp(o.config)},1),e&&this.loadModel(e,t,i,n),0)},o.prototype.registerUniversalHotkeys=function(){var t,i,n,o=this,r=e.theHotkeyManager.KEYCODES;t=function(){return o.navigation.setRequestFitToView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[r.f],onPress:t}]),t=function(){return o.navigation.setRequestHomeView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[r.h],onPress:t},{keycodes:[r.HOME],onPress:t}]),i=function(){return!(!o.objectContextMenu||!o.objectContextMenu.hide())||(o.fireEvent({type:e.ESCAPE_EVENT}),!0)},e.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[r.ESCAPE],onRelease:i}]),t=function(){return n=o.getActiveNavigationTool(),o.setActiveNavigationTool("pan")},i=function(){return o.setActiveNavigationTool(n)};var s=[{keycodes:[r.SHIFT],onPress:t,onRelease:i},{keycodes:[r.SPACE],onPress:t,onRelease:i}];e.theHotkeyManager.pushHotkeys("Autodesk.Pan",s,{tryUntilSuccess:!0})},o.prototype.createControls=function(){var t=this,i=t.impl;return t.navigation=new e.Navigation(i.camera),t.__initAutoCam(i),t.utilities=new e.ViewingUtilities(i,t.autocam,t.navigation),t.clickHandler=new e.DefaultHandler(i,t.navigation,t.utilities),t.toolController=new e.ToolController(i,t,t.autocam,t.utilities,t.clickHandler),t.toolController.registerTool(new e.GestureHandler(t)),t.toolController.registerTool(e.theHotkeyManager),t.toolController.activateTool(e.theHotkeyManager.getName()),t.registerUniversalHotkeys(),t.toolController.registerTool(new e.OrbitDollyPanTool(i,t)),t.toolController.activateTool("gestures"),t.toolController},o.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var i=this.getDimensions();if(this.canvas.width=i.width,this.canvas.height=i.height,e.isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var n=e.detectWebGL();if(n<=0)return n===-1?e.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:e.ErrorCodes.BROWSER_WEBGL_DISABLED}var r=this;this.onResizeCallback=function(e){r.resize()},window.addEventListener("resize",this.onResizeCallback,!1),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var s=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(s),!s.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner);for(var a=1;a<=3;a++){var l=document.createElement("div");l.className="bounce"+a,this.loadSpinner.appendChild(l)}}return this.initSettings(),this.viewerState=new t.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.fireEvent(e.VIEWER_INITIALIZED),0},o.prototype.setUp=function(e){if(this.config=e,this.config&&this.config.hasOwnProperty("extensions"))for(var t=this.config.extensions,i=0;i<t.length;++i)this.loadExtension(t[i],this.config);var n=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig;this.setCanvasClickBehavior(n)},o.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var e in this.loadedExtensions)try{this.unloadExtension(e)}catch(i){t.logger.error("Failed to unload extension: "+e,i),t.logger.track({category:"error_unload_extension",extensionId:e,error_message:i.message,call_stack:i.stack})}this.loadedExtensions=null}t.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.model=null,this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null),this.impl.unloadCurrentModel()},o.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},o.prototype.localize=function(){e.i18n.localize()},o.prototype.__initAutoCam=function(e){function i(e){o.autocamCamera.isPerspective!==r.isPerspective&&(o.autocamCamera.isPerspective?o.navigation.toPerspective():o.navigation.toOrthographic()),o.navigation.setVerticalFov(o.autocamCamera.fov,!1),o.navigation.setView(o.autocamCamera.position,o.autocamCamera.target),o.navigation.setPivotPoint(o.autocamCamera.pivot),o.navigation.setCameraUpVector(o.autocamCamera.up),e&&o.navigation.setWorldUpVector(o.autocamCamera.worldup),o.impl.syncCamera(e)}function n(e){o.utilities?o.utilities.pivotActive(e,!1):o.impl.controls.pivotActive(e,!1)}var o=this,r=e.camera;r.pivot||(r.pivot=new THREE.Vector3(0,0,0)),r.target||(r.target=new THREE.Vector3(0,0,0)),r.worldup||(r.worldup=r.up.clone()),o.autocamCamera=r.clone(),o.autocamCamera.target=r.target.clone(),o.autocamCamera.pivot=r.pivot.clone(),o.autocamCamera.worldup=r.worldup.clone(),o.autocam=new t.Autocam(o.autocamCamera,o.navigation),o.autocam.cameraChangedCallback=i,o.autocam.pivotDisplayCallback=n,o.autocam.canvas=o.canvas,o.addEventListener("cameraChanged",function(e){var t=e.camera;o.autocam.sync(t)}),o.autocam.sync(r)},o.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,t.logger.reportRuntimeStats(),t.logger.track({category:"viewer_destroy"},!0),
this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,e.theHotkeyManager.popHotkeys("Autodesk.FitToView"),e.theHotkeyManager.popHotkeys("Autodesk.Home"),e.theHotkeyManager.popHotkeys("Autodesk.Escape"),e.theHotkeyManager.popHotkeys("Autodesk.Pan"),e.theHotkeyManager.popHotkeys("Autodesk.Orbit"),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.fireEvent(e.VIEWER_UNINITIALIZED),this.listeners={},t.logger.log("viewer destroy")},o.prototype.finish=function(){this.tearDown(),this.uninitialize()},o.prototype.load=function(e,t,i,n,o,r){var s={ids:null,sharedPropertyDbPath:t,acmSessionId:o,loadOptions:r};return this.loadModel(e,s,i,n)},o.prototype.loadModel=function(t,i,n,o,r){function s(){if(e.theHotkeyManager)if(u.model.is2d())e.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,i=function(){return t=u.getActiveNavigationTool(),u.setActiveNavigationTool("orbit")},n=function(){return u.setActiveNavigationTool(t)},o=[{keycodes:[e.theHotkeyManager.KEYCODES.ALT],onPress:i,onRelease:n}];e.theHotkeyManager.pushHotkeys("Autodesk.Orbit",o,{tryUntilSuccess:!0})}}function a(e){u.model=e,u.impl.addModel(u.model),u.loadSpinner&&(u.loadSpinner.style.display="None"),u.model.is2d()&&u.activateLayerState("Initial"),s(),n&&n(u.model)}function l(e,t,i,n){u.loadSpinner&&(u.loadSpinner.style.display="None"),o&&o(e,t,i,n)}function c(){u.impl.needsRender=!0,u.removeEventListener(e.GEOMETRY_LOADED_EVENT,c)}var u=this;i=i||{},this.addEventListener(e.GEOMETRY_LOADED_EVENT,c);var h,d=t.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),p=d?d[1]:null;return h=i&&i.fileLoader?i.fileLoader:e.FileLoaderManager.getFileLoaderForExtension(p),new h(this.impl).loadFile(t,i,a,l,r)},o.prototype.getDimensions=function(){if(this.container){var t={};return this.getScreenMode()===e.ScreenMode.kFullScreen?(t.width=screen.width,t.height=screen.height):t=this.container.getBoundingClientRect(),{width:t.width,height:t.height}}return null},o.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},o.prototype.getCamera=function(){return this.impl.camera},o.prototype.getState=function(e){return this.viewerState.getState(e)},o.prototype.restoreState=function(t,i,n){var o=this.viewerState.restoreState(t,i,n);return o&&this.fireEvent({type:e.VIEWER_STATE_RESTORED_EVENT,value:o}),o},o.prototype.setViewFromArray=function(e,t){this.setActiveNavigationTool("orbit");var i=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},n={position:new THREE.Vector3(e[0]-i.x,e[1]-i.y,e[2]-i.z),target:new THREE.Vector3(e[3]-i.x,e[4]-i.y,e[5]-i.z),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};this.impl.setViewFromCamera(n)},o.prototype.setViewFromViewBox=function(e,i){var n=this.model;if(n&&!n.is2d())return void t.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D");if(i&&i.length){var o,r=n.getData().metadata,s=r.views;for(o=0;o<s.length&&s[o].name!=i;o++);if(o<s.length){var a=s[o].layer_state;a&&this.activateLayerState(a)}}this.impl.setViewFromViewBox(this.model,e,i,!1)},o.prototype.activateLayerState=function(t){if(t&&t.length){var i=this.model.getData().metadata,n=i?i.layer_states:null;if(!n)return;var o;for(o=0;o<n.length&&n[o].name!=t;o++);if(o<n.length){var r=n[o],s=r.visible_layers,a={};if(s&&0<s.length)for(var l=0;l<s.length;l++)a[s[l]]=1;var c=[],u=[];for(var h in i.layers){var d=i.layers[h].name;1===a[d]?c.push(h):u.push(h)}this.impl.setLayerVisible(c,!0),this.impl.setLayerVisible(u,!1),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}}},o.prototype.getLayerStates=function(){function e(e,t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(i.length!==n.length)return!1;for(var o=0;o<i.length;++o){var r=i[o];if(e[r]!==t[r])return!1}return!0}var t=this.model,i=t?t.getData().metadata:null,n=i?i.layers:null,o=i?i.layer_states:null;if(!n||!o)return null;var r,s={},a={};for(var l in n)if(n.hasOwnProperty(l)){var c=parseInt(l),u=n[l];r="string"==typeof u?u:u.name,s[r]=!0,this.impl.isLayerVisible(c)&&(a[r]=!0)}var h,d,p=[];for(h=0;h<o.length;++h){var v=o[h],g=v.visible_layers,m={};if(!v.hidden){if(g&&0<g.length)for(d=0;d<g.length;++d)r=g[d],s.hasOwnProperty(r)&&(m[r]=!0);p.push({name:v.name,description:v.description,active:e(a,m)})}}return 0<p.length?p:null},o.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},o.prototype.getProperties=function(i,n,o){t.logger.track({name:"get_props_count",aggregate:"count"}),this.model?this.model.getProperties(i,n,o):o&&o(e.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},o.prototype.getObjectTree=function(t,i){this.model?this.model.getObjectTree(t,i):i&&i(e.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},o.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},o.prototype.search=function(t,i,n,o,r){this.searchText=t,this.model?this.model.search(t,i,n,o,r):n&&n(e.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},o.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},o.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},o.prototype.isolate=function(e){if(this.model){var i=this.model.getData();if(i&&i.is2d&&i.loadDone&&"hasObjectProperties"in i)this.impl.visibilityManager.isolate(e);else{var n=this;this.model.getObjectTree(function(){t.logger.track({name:"isolate_count",aggregate:"count"}),n.impl.visibilityManager.isolate(e)})}}},o.prototype.isolateById=function(e){return t.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(e)},o.prototype.setBackgroundColor=function(e,t,i,n,o,r){this.impl.setClearColors(e,t,i,n,o,r)},o.prototype.toggleSelect=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):void this.impl.selector.toggleSelection(e)},o.prototype.select=function(e){"number"==typeof e&&(e=[e]),this.impl.selector.setSelection(e)},o.prototype.clearSelection=function(){this.impl.selector.clearSelection(),t.logger.track({name:"clearselection",aggregate:"count"})},o.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},o.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},o.prototype.setSelectionMode=function(e){this.impl.selector.setSelectionMode(e)},o.prototype.getSelection=function(){return this.impl.selector.getSelection()},o.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var i=0;i<t.length;i++)for(var n=0;n<t[i].selection.length;n++)e(t[i].model,t[i].selection[n]);return t},o.prototype.hide=function(e){t.logger.track({name:"hide",aggregate:"count"}),this.impl.visibilityManager.hide(e)},o.prototype.hideById=function(e){this.hide(e)},o.prototype.show=function(e){this.impl.visibilityManager.show(e)},o.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0),t.logger.track({name:"showall",aggregate:"count"})},o.prototype.toggleVisibility=function(e){this.impl.visibilityManager.toggleVisibility(e)},o.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},o.prototype.explode=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.explode is not applicable to 2D"):(t.logger.track({name:"explode_count",aggregate:"count"}),void this.impl.explode(e))},o.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},o.prototype.setQualityLevel=function(e,i){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set("ambientShadows",e),this.prefs.set("antialiasing",i),void this.impl.togglePostProcess(e,i))},o.prototype.setGhosting=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",e),void this.impl.toggleGhosting(e))},o.prototype.setGroundShadow=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):(this.prefs.set("groundShadow",e),void this.impl.toggleGroundShadow(e))},o.prototype.setGroundReflection=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):(this.prefs.set("groundReflection",e),void this.impl.toggleGroundReflection(e))},o.prototype.setEnvMapBackground=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):(this.prefs.set("envMapBackground",e),void this.impl.toggleEnvMapBackground(e))},o.prototype.setRenderPrism=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setRenderPrism is not applicable to 2D"):(this.prefs.set("renderPrism",e),void this.impl.toggleRenderPrism(e))},o.prototype.setFirstPersonToolPopup=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):void this.prefs.set("firstPersonToolPopup",e)},o.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"):this.prefs.firstPersonToolPopup},o.prototype.setProgressiveRendering=function(e){this.prefs.set("progressiveRendering",e),this.impl.toggleProgressive(e)},o.prototype.setSwapBlackAndWhite=function(e){this.prefs.set("swapBlackAndWhite",e),this.impl.toggleSwapBlackAndWhite(e)},o.prototype.setOptimizeNavigation=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):(this.prefs.set("optimizeNavigation",e),void this.impl.setOptimizeNavigation(e))},o.prototype.setNavigationLock=function(t){this.navigation.getIsLocked()!==t&&(this.navigation.setIsLocked(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},o.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},o.prototype.setNavigationLockSettings=function(t){this.navigation.setLockSettings(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},o.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},o.prototype.setActiveNavigationTool=function(t){if(t===this._pushedTool||!t&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}var i=!t||t===this.getDefaultNavigationToolName();return i&&null===this._pushedTool?(this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(t)&&(this._pushedTool=t,this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0)},o.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},o.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},o.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},o.prototype.getFOV=function(){return this.navigation.getVerticalFov()},o.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},o.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},o.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},o.prototype.hideLines=function(t){function i(){n.impl.hideLines(t),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("lineRendering",!t);var n=this;this.impl.hideLines(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},o.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},o.prototype.fitToView=function(i){var n=this,o=!0,r=n.model,s=function(){var t=null;if(Array.isArray(i)&&i.length>0){for(var l=new THREE.Box3,c=new THREE.Box3,u=r.getData().instanceTree,h=r.getFragmentList(),d=0;d<i.length;d++)u.enumNodeFragments(i[d],function(e){h.getWorldBounds(e,c),l.union(c)},!0);l.empty()||(t=l)}return t&&!t.empty()||(t=n.impl.getFitBounds()),n.navigation.fitBounds(!1,t),n.removeEventListener(e.OBJECT_TREE_CREATED_EVENT,a),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,s),o},a=function(){r&&r.isLoadDone()?s():(o=!1,n.addEventListener(e.GEOMETRY_LOADED_EVENT,s))},l=r.getData().propertydb,c=l&&l.attrs.length>0;t.logger.track({name:"fittoview",aggregate:"count"}),!r.is2d()&&c&&null!==i&&void 0!==i?r&&r.isObjectTreeCreated()?a():(o=!1,this.addEventListener(e.OBJECT_TREE_CREATED_EVENT,a)):this.navigation.fitBounds(!1,this.impl.getFitBounds(!0))},o.prototype.setClickConfig=function(e,t,i){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in n){var o=n[e];if(t in o)return o[t]=i,!0}return!1},o.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var n=i[e];if(t in n)return n[t]}return null},o.prototype.setClickToSetCOI=function(e,t){t!==!1&&this.prefs.set("clickToSetCOI",e);var i=this.getClickConfig("click","onObject");e?i.indexOf("setCOI")===-1&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},o.prototype.initSettings=function(){this.prefs.load(e.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","lightPreset","envMapBackground","renderPrism","firstPersonToolPopup"]),this.prefs.untag("3d",["swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setRenderPrism(this.prefs.renderPrism),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);var t=this.prefs.backgroundColorPreset;if(t)try{var i=JSON.parse(t);this.impl.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5])}catch(e){this.prefs.set("backgroundColorPreset",null)}var n=this.prefs.lightPreset;this.impl.setLightPreset(n)},o.prototype.setLightPreset=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"):(this.prefs.set("lightPreset",e),void this.impl.setLightPreset(e))},o.prototype.setUsePivotAlways=function(e){this.prefs.set("alwaysUsePivot",e),this.navigation.setUsePivotAlways(e)},o.prototype.setReverseZoomDirection=function(e){this.prefs.set("reverseMouseZoomDir",e),this.navigation.setReverseZoomDirection(e)},o.prototype.setReverseHorizontalLookDirection=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):(this.prefs.set("reverseHorizontalLookDirection",e),void this.navigation.setReverseHorizontalLookDirection(e))},o.prototype.setReverseVerticalLookDirection=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",e),void this.navigation.setReverseVerticalLookDirection(e))},o.prototype.setZoomTowardsPivot=function(e){this.prefs.set("zoomTowardsPivot",e),this.navigation.setZoomTowardsPivot(e)},o.prototype.setOrbitPastWorldPoles=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",e),void this.navigation.setOrbitPastWorldPoles(e))},o.prototype.setUseLeftHandedInput=function(e){this.prefs.set("leftHandedMouseSetup",e),this.navigation.setUseLeftHandedInput(e)},o.prototype.setLayerVisible=function(i,n,o){function r(e,t){var i=[];if(e.isLayer)i.push(e.index);else if(e.children)for(var n=e.children,o=0;o<n.length;++o)i=i.concat(r(n[o]));return i}if(this.model&&!this.model.is2d())return void t.logger.warn("Viewer3D.setLayerVisible is not yet implemented for 3D");var s=this,a=s.model.getLayersRoot();if(a&&0!==a.childCount){null===i&&(i=[a]),Array.isArray(i)||(i=[i]),o&&(s.impl.setLayerVisible(r(a),!1),n=!0);for(var l=[],c=0;c<i.length;++c)l=l.concat(r(i[c]));s.impl.setLayerVisible(l,n),s.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}},o.prototype.isLayerVisible=function(e){return this.model&&!this.model.is2d()?(t.logger.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(e&&e.isLayer&&this.impl.isLayerVisible(e.index))},o.prototype.anyLayerHidden=function(){function e(t){if(t.isLayer)return!i.impl.isLayerVisible(t.index);for(var n=t.children,o=0;o<n.length;++o)if(e(n[o]))return!0;return!1}if(this.model&&!this.model.is2d())return t.logger.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1;var i=this,n=i.model.getLayersRoot();return!(!n||!e(n))},o.prototype.setGroundShadowColor=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):void this.impl.setGroundShadowColor(e)},o.prototype.setGroundShadowAlpha=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):void this.impl.setGroundShadowAlpha(e)},o.prototype.setGroundReflectionColor=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):void this.impl.setGroundReflectionColor(e)},o.prototype.setGroundReflectionAlpha=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):void this.impl.setGroundReflectionAlpha(e)},o.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},o.prototype.setCutPlanes=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"):void this.impl.setCutPlanes(e)},o.prototype.getScreenShot=function(e,t,i){return this.impl.getScreenShot(e,t,i)},o.prototype.getScreenShotBuffer=function(e,t,i){return this.impl.getScreenShotBuffer(e,t,i)},o.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},o.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},o.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},o.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},o.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},o.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},o.prototype.initContextMenu=function(){function e(e){var t=e.button;"buttons"in e&&(!i.__firefoxLMBfix||1&e.buttons?2===t&&1&e.buttons&&(t=0,i.__firefoxLMBfix=!0):(i.__firefoxLMBfix=!1,t=0));var n=!!i.navigation&&i.navigation.getUseLeftHandedInput(),o=n?0:2;return t===o}var t=!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu;t&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var i=this,n=this.canvas||this.container;n.addEventListener("mousedown",function(t){e(t)&&(i.startX=t.clientX,i.startY=t.clientY)}),n.addEventListener("mouseup",function(t){return e(t)&&t.clientX===i.startX&&t.clientY===i.startY&&i.triggerContextMenu(t),!0},!1)},o.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},o.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},o.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(i)&&this.contextMenuCallbacks[i](e,t)},o.prototype.playAnimation=function(e){var t=this.impl.keyFrameAnimator;t&&t.play(0,e)},o.prototype.joinLiveReview=function(e){this.liveReviewClient||(this.liveReviewClient=new t.LiveReviewClient(this));var i=this.liveReviewClient;t.loadDependency("lmv_io","socket.io-1.3.5.js",function(){i.joinLiveReviewSession(e)})},o.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},o.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},o.prototype.worldToClient=function(e){return this.impl.worldToClient(e)},o.prototype.clientToWorld=function(e,t,i){return this.impl.clientToWorld(e,t,i)},o.prototype.modelHasTopology=function(){return!(!this.model||!this.model.getData().topology)},o.prototype.setSelectionColor=function(e){this.impl.setSelectionColor(e)},o.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new t.ViewCubeUi(this)),this.viewCubeUi.create()},o.prototype.displayViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.displayViewCube(e,!1)},o.prototype.displayViewCubeUI=function(e){this.viewCubeUi&&this.viewCubeUi.display(e)},o.prototype.setViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(e)},o.prototype.setThemingColor=function(e,t,i){i=i||this.model,i.setThemingColor(e,t),this.impl.invalidate(!0)},o.prototype.clearThemingColors=function(e){e=e||this.model,e.clearThemingColors(),this.impl.invalidate(!0)},o.prototype.transferModel=function(e,t){var i=this.impl.findModel(e);if(i){var n=[];this.getAggregateSelection(function(t,i){t.id==e&&n.push(i)});var o=this.impl.visibilityManager.getIsolatedNodes(i),r=this.impl.visibilityManager.getHiddenNodes(i),s=this.impl.matman().exportModelMaterials(i);this.impl.removeModel(i),t.model=i,t.impl.addModel(i),t.impl.matman().importModelMaterials(s),t.loadSpinner&&(t.loadSpinner.style.display="None"),i.loader&&i.loader.viewer3DImpl===this.impl&&(i.loader.viewer3DImpl=t.impl),i.getData().loadDone&&t.impl.onLoadComplete(i),t.impl.selector.setSelection(n,i),0!=o.length?t.impl.visibilityManager.isolate(o,i):0!=r.length&&t.impl.visibilityManager.hide(r,i)}},Autodesk.Viewing.Viewer3D=o}();var av=Autodesk.Viewing;av.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12},function(){"use strict";function e(e,o,r){if(e.urlPattern=r.urn,e.tileSize=r.tileSize?r.tileSize:512,e.texWidth=r.resolution[0],e.texHeight=r.resolution[1],e.paperWidth=r.paperWidth,e.paperHeight=r.paperHeight,e.paperUnits=r.paperUnits,e.levelOffset=i.LeafletLoader.computeLevelOffset(e.tileSize),i.offline&&t.isMobileDevice()){var s=n.getSubItemsWithProperties(o,{role:"leaflet-zip"},!1);s.length>0&&(e.maxLevel=s[0].max_level-e.levelOffset)}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,t,n){function o(e){if(e){var t,n=e.children?e.children.length:0;if("geometry"===e.type&&n){var r=0;for(t=0;t<n;t++){var a=e.children[t];a&&"view"===a.type&&(s.myViewGeometry[a.guid]=e,r++)}s.myNumViews[e.guid]=r}else if("application/autodesk-db"==e.mime&&e.urn)0===e.urn.indexOf(i.ViewingService.OSS_PREFIX)?s.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):s.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("/")+1);else if(0<n)for(t=0;t<n;t++)o(e.children[t])}}function r(e){if(e)for(var t=e.children?e.children.length:0,i=0;i<t;i++)e.children[i].parent=e,r(e.children[i])}this.myPath=t,this.myData=e,this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=n;var s=this;o(e),r(this.myData)};n.prototype.constructor=n,n.load=function(e,o,r,s){function a(e){if(e.indexOf("urn:")===-1){if(e.indexOf("://")!==-1)return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),window.location.protocol+"//"+window.location.host+t):t}return e}function l(e){var t=n.getSubItemsWithProperties(e.getRootItem(),{type:"folder",role:"viewable"},!0),i=t[0],o=n.getSubItemsWithProperties(i,{type:"geometry"},!0);return o.length}function c(e,t){var i=[],n=0,o=0;t=t||"children";var r=function(e){var s=e[t]||[],a=e.messages||[],l=a.filter(function(e){return"error"===e.type});l.length>0&&(n+=1),"inprogress"===e.status&&(o+=1),Array.prototype.push.apply(i,a.slice(0));for(var c=s.length;c--;r(s[c]));};r(e);var s="translated";s=n>0?"failed":s,s=o>0?"processing":s;for(var a=i.length;a--;i[a].$translation=s);return i}function u(s){function h(e){var i=/<[^>]*script/;if(i.test(e))return void(r&&r(t.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading"));var a="string"==typeof e?JSON.parse(e):e,u=new n(a,v,s),h=l(u);if(h>0)p=c(u.getRootItem()),o&&o(u,p);else if(r){p=c(u.getRootItem());var d=t.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT,g="No viewable content";r(d,g,p)}}function d(e,n,o){if(401===e&&void 0===LMV_THIRD_PARTY_COOKIE)LMV_THIRD_PARTY_COOKIE=!1,i.refreshRequestHeader(i.token.accessToken),u(s);else{var a=c(o);if(r){var l="Error: "+e+" ("+n+")",h=t.Private.ErrorHandler.getErrorCode(e);r(h,l,e,n,a)}}}var p,v=a(e),g={queryParams:s?"acmsession="+s:""};i.ViewingService.getManifest(i.initLoadContext(g),v,h,d)}"function"!=typeof arguments[1]&&(i.logger.warn("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(o=arguments[2]),"function"==typeof arguments[3]&&(r=arguments[3])),s?i.ViewingService.getACMSession(t.getApiEndpoint(),s,u,r):u()},n.requestThumbnailWithSecurity=function(e,t){var n=function(e){t(null,e)},o=function(){t("error",null)},r={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},s="urn:"+e.urn;i.ViewingService.getThumbnail(i.initLoadContext(),s,n,o,r)},n.prototype.getFullPath=function(e){if(!e)return e;var n=e;return i.offline?n=decodeURIComponent(t.Private.offlineResourcePrefix)+n.substr(n.indexOf("/")):0===e.indexOf("urn")?n=t.getItemApi()+e:0===e.indexOf("$file$")&&this.myPath.indexOf("/bubble.json")!==-1&&(n=this.myPath.replace("/bubble.json","")+e.replace("$file$","")),n},n.prototype.getThumbnailOptions=function(e,t,i){var n=t?t:200,o=i?i:200;return{urn:this.myData.urn,width:n,height:o,guid:encodeURIComponent(e.guid),acmsession:this.acmSessionId}},n.prototype.getThumbnailPath=function(e,i,n){var o=this.getThumbnailOptions(e,i,n),r=t.getThumbnailApi()+o.urn+"?guid="+o.guid+"&width="+o.width+"&height="+o.height;return o.acmsession&&(r+="&acmsession="+o.acmsession),r},n.prototype.getViewablePath=function(t,i){if("geometry"===t.type){var o=[];if("3d"===t.role?o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-svf"},!1):"2d"===t.role&&(o=n.getSubItemsWithProperties(t,{role:"leaflet"},!1),o.length>0&&i&&e(i,t,o[0]),0===o.length&&(o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-f2d"},!1)),0===o.length&&(o=n.getSubItemsWithProperties(t,{role:"tileRoot"},!0))),o.length>0)return this.getFullPath(o[0].urn)}else if("view"===t.type){var r=this.getViewGeometry(t);if(r)return this.getViewablePath(r)}return""},n.prototype.getPropertyDbPath=function(){return this.myPropertyDb},n.prototype.getRootItem=function(){return this.myData},n.prototype.getPath=function(){return this.myPath},n.prototype.getItemById=function(e){function t(i){if(!i)return null;for(var n in i){var o=i[n];if("guid"===n&&o===e)return i;if(null!==o&&"object"==typeof o&&"parent"!==n){var r=t(o);if(r)return r}}return null}return t(this.myData)},n.getSubItemsWithProperties=function(e,t,i){function o(e,t){for(var i in t)if(!(i in e)||t[i]!==e[i])return!1;return!0}var r=[];if(!e)return[];for(var s=e.children?e.children.length:0,a=0;a<s;a++){var l=e.children[a];o(l,t)&&r.push(l),i&&r.push.apply(r,n.getSubItemsWithProperties(l,t,i))}return r},n.prototype.getViewGeometry=function(e){return this.myViewGeometry[e.guid]},n.prototype.getNumViews=function(e){return this.myNumViews[e.guid]||0},n.prototype.getParentId=function(e){var t=this.getItemById(e);if(!t)return null;var i=t.parent;return i?i.guid:null},n.prototype.getMessages=function(e,t){var i=[];if(!e)return i;var n=null;t&&(n=this.getRootItem());for(var o=e;o&&(!t||parent!==n);){if(o.messages)for(var r=0;r<o.messages.length;r++)i.push(o.messages[r]);o=o.parent}return i},t.Document=n}(),function(){"use strict";function e(e){function t(){var e=s.size(),t=l.aspect,i=e.x/t,n=e.y;return Math.max(i,n)}var i=6.88,n=100,o=1e-6,r=1e-5;this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,
this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=o,this.__minDistance=r;var s=void 0,a=void 0,l=null,c={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==l&&(l=e,e&&(e.hasOwnProperty("target")||(e.target=new THREE.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new THREE.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return l},this.setScreenViewport=function(e){c=e},this.getScreenViewport=function(){return c},this.__setUp=function(e){if(e&&l){var t=e.clone().normalize(),i=t.sub(l.worldup);if(0!==i.lengthSq())return l.worldup.copy(e).normalize(),l.dirty=!0,!0}return!1},this.__getUp=function(){return l?l.worldup:new THREE.Vector3(0,1,0)},this.setView=function(e,t){l&&e&&t&&(l.position.copy(e),l.target.copy(t),l.dirty=!0)},this.orientCameraUp=function(){l&&this.isActionEnabled("roll")&&(l.up.copy(this.getAlignedUpVector()),l.dirty=!0)},this.getPivotPoint=function(){return l?l.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(e){l&&e&&(l.pivot.copy(e),l.dirty=!0)},this.getPosition=function(){return l?l.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(e){l&&e&&(l.position.copy(e),l.dirty=!0)},this.setTarget=function(e){l&&e&&(l.target.copy(e),l.dirty=!0)},this.getTarget=function(){return l?l.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return l?l.target.clone().sub(l.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return i},this.getFovMax=function(){return n},this.isPointVisible=function(e){var t=(new THREE.Frustum).setFromMatrix(l.projectionMatrix.clone().multiply(l.matrixWorldInverse));return t.containsPoint(e)},this.setVerticalFov=function(e,t){if((!l||l.isPerspective)&&(e<i?e=i:e>n&&(e=n),l&&this.isActionEnabled("fov"))){if(Math.abs(l.fov-e)<=o)return;if(t){var r=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),s=this.getPosition(),a=this.getEyeVector(),c=THREE.Math.degToRad(l.fov),u=THREE.Math.degToRad(e),h=r?this.getPivotPlaneDistance():a.length(),d=h*Math.tan(.5*c)/Math.tan(.5*u),p=a.normalize().multiplyScalar(h-d);this.setPosition(s.add(p)),r&&this.setTarget(this.getTarget().add(p))}l.setFov(e),l.dirty=!0}},this.computeFit=function(e,t,i,o){if(!o||o.empty())return{position:e,target:t};var r=o.center(),s=o.size(),a=.5*Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);if(0===a&&(a=1),!this.getIs2D()){var l=Math.max(1,.9+i/n*.5);a*=l}var c=e.clone().sub(t).normalize(),u=a/Math.tan(THREE.Math.degToRad(.5*i));c.multiplyScalar(u);var h=r.clone().add(c);return{position:h,target:r}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var o=n.clone().cross(i);return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()},this.fitBounds=function(e,t,i){var n=this.getTarget(),o=this.getPosition();if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:o,target:n};var r=this.getVerticalFov(),s=this.computeFit(o,n,r,t),a=i?this.computeOrthogonalUp(o,n):l.up;return e?(l.up.copy(a),this.setView(s.position,s.target)):this.setRequestTransitionWithUp(!0,s.position,s.target,r,a),this.setPivotPoint(s.target),this.setPivotSetFlag(!0),s},this.applyDollyConstraint2D=function(e){if(!this.__is2D||!s&&!a)return e;var i=e;if(s){var n=this.getEyeVector(),o=2*t(),r=o/-n.z;r=Math.max(r,1),i=Math.min(i,r)}if(a){var c=l.clientHeight/a,u=c/-n.z;u=Math.min(u,1),i=Math.max(i,u)}return i},this.applyPanningConstraint2D=function(e){if(this.__is2D&&s){var t=l.position.x+e.x,i=l.position.y+e.y;t=THREE.Math.clamp(t,s.min.x,s.max.x),i=THREE.Math.clamp(i,s.min.y,s.max.y);var n=t-l.position.x,o=i-l.position.y,r=Math.min(e.x,0),a=Math.min(e.y,0),c=Math.max(e.x,0),u=Math.max(e.y,0);n=THREE.Math.clamp(n,r,c),o=THREE.Math.clamp(o,a,u),e.x=n,e.y=o}},this.updateCamera=function(){l&&(l.updateProjectionMatrix(),this.orient(l,l.target,l.position,l.up),l.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,t){s=e,a=t}}var t=Autodesk.Viewing,i=t.Private;e.prototype.constructor=e,e.prototype.setIs2D=function(e){this.__is2D=!!e},e.prototype.getIs2D=function(){return this.__is2D},e.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},e.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},e.prototype.orient=function(){function e(){t||(t=new THREE.Matrix4,i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3)}var t,i,n,o;return function(r,s,a,l){e();var c=t.elements;o.subVectors(a,s).normalize(),0===o.lengthSq()&&(o.z=1),i.crossVectors(l,o).normalize(),0===i.lengthSq()&&(l.z>l.y?o.y-=1e-4:o.z+=1e-4,i.crossVectors(l,o).normalize()),n.crossVectors(o,i),c[0]=i.x,c[4]=n.x,c[8]=o.x,c[1]=i.y,c[5]=n.y,c[9]=o.y,c[2]=i.z,c[6]=n.z,c[10]=o.z,r.setRotationFromMatrix(t)}}(),e.prototype.fov2fl=function(e){var t=12,i=THREE.Math.degToRad(e);return i<=0&&(i=1e-4),Math.round(t/Math.tan(.5*i))},e.prototype.fl2fov=function(e){var t=12;e<=0&&(e=1e-4);var i=2*Math.atan(t/e);return THREE.Math.radToDeg(i)},e.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera();t.up.copy(e),t.dirty=!0}},e.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getCameraRightVector=function(e){var t=new THREE.Vector3,i=e?this.getWorldUpVector():this.getCamera().up,n=this.getEyeVector();return t.crossVectors(n,i),0===t.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z+=1e-4,t.crossVectors(n,i)),t.normalize()},e.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},e.prototype.getWorldUpVector=function(){return this.__getUp().clone()},e.prototype.getWorldRightVector=function(){var e=new THREE.Vector3;return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},e.prototype.getVerticalFov=function(){return this.getCamera().fov},e.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},e.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},e.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},e.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},e.prototype.setReverseHorizontalLookDirection=function(e){return this.getIs2D()?void i.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):void(this.__options.reverseHorizontalLookDirection=!!e)},e.prototype.setReverseVerticalLookDirection=function(e){return this.getIs2D()?void i.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):void(this.__options.reverseVerticalLookDirection=!!e)},e.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},e.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},e.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},e.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},e.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},e.prototype.setOrbitPastWorldPoles=function(e){return this.getIs2D()?void i.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):void(this.__options.orbitPastPoles=!!e)},e.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},e.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},e.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},e.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},e.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},e.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},e.prototype.getIsLocked=function(){return this.__options.lockNavigation},e.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},e.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},e.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||this.__lockSettings[e]===!0},e.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},e.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},e.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},e.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},e.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},e.prototype.getRequestHomeView=function(){return this.__homeViewRequested},e.prototype.setRequestTransition=function(e,t,i,n,o,r){e?this.__destinationView={position:t.clone(),coi:i.clone(),fov:n,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:o,pivot:r?r.clone():i.clone()}:this.__destinationView=null},e.prototype.setRequestTransitionWithUp=function(e,t,i,n,o,r,s){e?this.__destinationView={position:t.clone(),coi:i.clone(),fov:n,up:o.clone(),worldUp:r?r:this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:this.__destinationView=null},e.prototype.getRequestTransition=function(){return this.__destinationView},e.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},e.prototype.getTransitionActive=function(){return this.__transitionActive},e.prototype.getWorldSize=function(e){var t=this.getScreenViewport(),i=t.width/t.height,n=2*e*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),o=n*i;return new THREE.Vector2(o,n)},e.prototype.getWorldPoint=function(e,t){t=1-t,e=2*e-1,t=2*t-1;var i,n=this.getCamera();n.isPerspective&&(i=new THREE.Vector3(e,t,1),i=i.unproject(n));var o,r,s=this.getEyeVector(),a=this.getPosition();if(!n.isPerspective||isNaN(i.x)){var l=this.getWorldSize(s.length()),c=this.getCameraRightVector(!1).multiplyScalar(.5*e*l.x),u=this.getCameraUpVector().multiplyScalar(.5*t*l.y);o=s.clone().add(c).add(u).normalize()}else o=i.sub(a).normalize();var h=this.getPivotPoint(),d=this.__pivotIsSetFlag&&(this.getIs2D()||n.isPerspective&&this.isPointVisible(h));if(d){var p=o.dot(s);r=0!==p?Math.abs(h.sub(a).dot(s))/p:h.sub(a).length()}else r=n.isPerspective?.5*(n.near+n.far):n.orthoScale;return o.multiplyScalar(r).add(a)},e.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition();return e.sub(i).dot(t.normalize())},e.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var n=this.getWorldSize(i),o=e*n.x,r=t*n.y,s=this.getCameraRightVector(!1).multiplyScalar(o),a=this.getCameraUpVector().multiplyScalar(r),l=s.add(a);this.applyPanningConstraint2D(l),this.setView(this.getPosition().add(l),this.getTarget().add(l))}},e.prototype.dollyFromPoint=function(e,t){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var i=this.getPosition(),n=t.clone().sub(i),o=n.length(),r=o+e;r<this.__minDistance&&(r=this.__minDistance);var s=r/o;if(s=this.applyDollyConstraint2D(s),Math.abs(s-1)>this.__kEpsilon){n.multiplyScalar(s),n.set(-n.x,-n.y,-n.z);var a=n.add(t),l=this.getEyeVector();this.getCamera().isPerspective||l.multiplyScalar(s),this.setView(a,l.add(a))}}},e.prototype.toPerspective=function(){if(this.getIs2D())return void i.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)},e.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},e.snapToAxis=function(e){var t=new THREE.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},Autodesk.Viewing.Navigation=e}(),function(){"use strict";function e(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],o=Array.isArray(n),r=e[i],s=Array.isArray(r);o&&s?(n?o||(n=[n]):n=[],r?s||(r=[r]):r=[],e[i]=r.concat(n)):e[i]=n}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,t){this.appContainerId=e,this.container=document.getElementById(e),this.options=t,this.myRegisteredViewers={},this.myDocument=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.bubble=null,this.extensionCache={};var i=this;this.onHyperlinkHit=function(e){var t=e.data.href,n=i.bubble.search({viewableID:t});if(n&&n.length>0)i.selectItem(n[0].data);else{var o=new RegExp(/^https?:\/\//);t.match(o)||(t="http://"+t),window.open(t)}},this.onLoadGeometry=function(e){var t=e.data;i.selectItem(t.item,t.onSuccessCb,t.onErrorCb)}};n.prototype.k3D="3D",n.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},n.prototype.registerViewer=function(e,t,n){return e!==this.k3D?void i.logger.error("The only acceptable viewer type is k3D."):(n=n||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(n.hasOwnProperty("disableBrowserContextMenu")||(n.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[e]={},this.myRegisteredViewers[e].class=t,void(this.myRegisteredViewers[e].config=n))},n.prototype.getViewerClass=function(e){return this.myRegisteredViewers.hasOwnProperty(e)?this.myRegisteredViewers[e].class:null},n.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},n.prototype.getViewer=function(t){var i=this.myRegisteredViewers[this.k3D];if(!i)return null;var n={},o=i.config;e(n,o),e(n,t);var r=i.class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===r)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(n),this.myCurrentViewer;this.setCurrentViewer(null);for(var s=this.getViewerContainer();s.hasChildNodes();)s.removeChild(s.lastChild);var a=new r(s,n);return this.setCurrentViewer(a),a},n.prototype.setCurrentViewer=function(e){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=e,this.myCurrentViewer&&(e.addEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),e.addEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),e.extensionCache=this.extensionCache)},n.prototype.getCurrentViewer=function(){return this.myCurrentViewer},n.prototype.loadDocument=function(e,n,o,r){var s=this;i.logger.track({category:"load_document",urn:0==e.indexOf("urn:")?e.substring(4):e}),t.Document.load(e,function(e,t){s.myDocument=e,s.bubble=new Autodesk.Viewing.BubbleNode(e.myData),s.onDocumentLoaded(e,t),n&&n(e,t)},function(e,t,i,n,r){s.onDocumentFailedToLoad(t,e,r),o&&o(e,t,i,n,r)},r)},n.prototype.onDocumentLoaded=function(e,t){i.logger.log(e,t)},n.prototype.onDocumentFailedToLoad=function(e,t,n){i.logger.error(e,t,n)},n.prototype.getDefaultGeometry=function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t].useAsDefault;if(n===!0||"true"===n)return e[t]}return e[0]},n.prototype.selectItem=function(e,t,n){var o={},r=this.myDocument.getViewablePath(e,o);if(!r)return!1;var s,a,l,c,u=!1;if("geometry"===e.type&&"3d"===e.role){var h=e.properties;if(h)for(var d in h)if(h.hasOwnProperty(d)&&h[d]._UnitLinear){c=h[d]._UnitLinear;break}u=!0,a=e.name,l=e}else if("view"===e.type&&"3d"===e.role)s=e,u=!0,l=this.myDocument.getViewGeometry(e),l&&(a=l.name);else if("geometry"===e.type&&"2d"===e.role){var p=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{mime:"application/autodesk-f2d"},!1),v=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{role:"leaflet"},!1);(p.length>0||v.length>0)&&(u=!0),a=e.name,l=e}else"view"===e.type&&"2d"===e.role&&(s=e,u=!0,l=this.myDocument.getViewGeometry(e),l&&(a=l.name));if(!u)return!1;var g=r.indexOf("urn:");i.logger.track({category:"load_viewable",role:e.role,type:e.type,urn:g!==-1?r.substring(g+4):r});var m=this.myDocument.getMessages(e,!0),f=this,E=this.myCurrentViewer&&this.urn===r,A=null;A=s&&s.camera?function(){f.myCurrentViewer.setViewFromArray(s.camera,s.name),c&&f.myCurrentViewer.setModelUnits(c),t&&t(f.myCurrentViewer,e,m)}:s&&s.viewbox?function(){f.myCurrentViewer.setViewFromViewBox(s.viewbox,s.name),c&&f.myCurrentViewer.setModelUnits(c),t&&t(f.myCurrentViewer,e,m)}:E?function(){f.myCurrentViewer.setViewFromFile(),c&&f.myCurrentViewer.setModelUnits(c),t&&t(f.myCurrentViewer,e,m)}:function(){c&&f.myCurrentViewer.setModelUnits(c),t&&t(f.myCurrentViewer,e,m)};var y=function(e,t,i,o){n&&n(e,t,i,o,m)},T=!1;if(E)A&&A(),T=!0;else{this.urn=null;var w={defaultModelStructureTitle:a,viewableName:a};e.hasOwnProperty("extensions")&&(w.extensions=Array.isArray(e.extensions)?e.extensions:[e.extensions]);var b=this.getViewer(w);if(b){var C={ids:null,bubbleNode:this.bubble?this.bubble.findByGuid(e.guid):null,sharedPropertyDbPath:this.myDocument.getPropertyDbPath(),acmSessionId:this.myDocument.acmSessionId,loadOptions:o};if(b.started)b.loadModel(this.myDocument.getFullPath(r),C,A,y),T=!0;else{var S=b.start(this.myDocument.getFullPath(r),C,A,y);T=0===S}this.urn=r}}return!!T&&(this.selectedItem=e,this.onItemSelected(e,l),!0)},n.prototype.onItemSelected=function(e,t){if(i.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(e.guid)),this.itemSelectedObservers)for(var n=this.getCurrentViewer(),o=0;o<this.itemSelectedObservers.length;++o){var r=this.itemSelectedObservers[o];r.onItemSelected&&r.onItemSelected(n,e,t)}},n.prototype.addItemSelectedObserver=function(e){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(e)},n.prototype.selectItemById=function(e,t,i){var n=this.myDocument.getItemById(e);return!!n&&this.selectItem(n,t,i)},n.prototype.getSelectedItem=function(){return this.selectedItem},t.ViewingApplication=n}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.ViewCubeUi=function(e){this.viewer=e,this.container=null,this.cube=null,this.viewcube=null,this.infoButton=null,this.homeViewContainer=null};var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var e=this.viewer.config,t=!(!e||void 0===e.wantInfoButton)&&e.wantInfoButton;this.initContainer(),t&&this.initInfoButton(),this.initHomeButton()},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeUI",this.viewer.container.appendChild(this.container)},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div"),this.infoButton.className="infoButton",this.infoButton.style.cursor="pointer",this.container.appendChild(this.infoButton);var e=this;this.infoButton.addEventListener("click",function(t){var i=e.viewer.getPropertyPanel(!0),n=!i.areDefaultPropertiesShown()||!i.isVisible();n&&i.showDefaultProperties(),n!==i.isVisible()&&i.setVisible(n)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var e=document.createElement("div");e.className="homeViewWrapper",e.style.cursor="pointer",this.container.appendChild(e),this.homeViewContainer=e;var t=this;e.addEventListener("click",function(e){t.viewer.navigation.setRequestHomeView(!0)}),this._initHomeMenu(e)}},_initHomeMenu:function(e){var t=this.viewer,i=t.autocam,n=this;this.hideHomeViewMenu=function(e){a.style.display="none",document.removeEventListener("click",n.hideHomeViewMenu)};var o=document.createElement("div");o.className="homeViewMenuHandle";var r=document.createElement("img"),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";r.src=s,r.width=r.height=18,o.appendChild(r),o.addEventListener("mouseover",function(e){r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"}),o.addEventListener("mouseleave",function(e){r.src=s}),e.appendChild(o);var a=document.createElement("div");a.className="homeViewMenu",this.viewer.container.appendChild(a);var l=document.createElement("div");l.className="homeViewMenuItem",l.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home"),a.appendChild(l),l.addEventListener("click",function(e){i.setCurrentViewAsHome(!1),n.hideHomeViewMenu(e)});var c=document.createElement("div");c.className="homeViewMenuItem",c.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home"),a.appendChild(c),c.addEventListener("click",function(e){i.setCurrentViewAsHome(!0),n.hideHomeViewMenu(e)});var u=document.createElement("div");u.className="homeViewMenuItem",u.textContent=Autodesk.Viewing.i18n.translate("Reset Home"),a.appendChild(u),u.addEventListener("click",function(e){i.resetHome(),n.hideHomeViewMenu(e)}),e.addEventListener("mouseover",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(o.style.display="block")}),e.addEventListener("mouseleave",function(e){o.style.display="none"}),o.addEventListener("click",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu)),e.stopPropagation()}),e.addEventListener("contextmenu",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu))})},setVisible:function(e){this.container.style.display=e?"block":"none"},displayViewCube:function(e,t){if(t&&this.viewer.prefs.set("viewCube",e),e&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new avp.Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=e?"block":"none",this._positionHomeButton(),e&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var e,t=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,i=this.viewer.container.getBoundingClientRect(),n=this.homeViewContainer.getBoundingClientRect();if(t){var o=this.viewcube.getBoundingClientRect();e=i.left+i.width-o.left-n.width}else if(this.infoButton){var r=this.infoButton.getBoundingClientRect();e=i.left+i.width-r.left+r.width-n.width}else e=10;this.homeViewContainer.style.right=e+"px"}},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.infoButton=null,this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}};var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,avu=Autodesk.Viewing.UI,ave=Autodesk.Viewing.Extensions,stringToDOM=avp.stringToDOM=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild};!function(){"use strict";av.TOOLBAR_CREATED_EVENT="toolbarCreated",av.VIEW_CUBE_CREATED_EVENT="viewCubeCreated",av.SIDE_BAR_OPEN_EVENT="SIDE_BAR_OPEN_EVENT",av.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};var e=function(e,t){t||(t={}),t.startOnInitialize=!1,av.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null};e.prototype=Object.create(av.Viewer3D.prototype),e.prototype.constructor=e,e.prototype.initialize=function(){var e=av.Viewer3D.prototype.initialize.call(this);if(e>0)return e;var t=this;if(this.toolController){var i=new av.HotGestureTool(this);this.toolController.registerTool(i),this.toolController.activateTool(i.getName())}return this.getToolbar(!0),this.addEventListener(av.FULLSCREEN_MODE_EVENT,function(e){t.resizePanels({viewer:t}),t.updateFullscreenButton(e.mode)}),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new avp.ProgressBar(this.container),this.addEventListener(av.PROGRESS_UPDATE_EVENT,function(e){void 0!==e.percent&&t.progressbar.setPercent(e.percent)},!1),this.selectionActive=!1,this.addEventListener(av.SELECTION_CHANGED_EVENT,function(e){if(t.selectionActive=e.dbIdArray.length>0,t.prefs.openPropertiesOnSelect){var i=t.getPropertyPanel(!0);i.setVisible(t.selectionActive)}}),this.addEventListener(av.ISOLATE_EVENT,function(e){(t.prefs.openPropertiesOnSelect||e.nodeIdArray[0]===e.model.getRootId())&&t.propertygrid&&t.propertygrid.setVisible(e.nodeIdArray.length>0||t.selectionActive)}),this.addEventListener(av.VIEWER_STATE_RESTORED_EVENT,function(e){t.renderoptions&&t.renderoptions.syncUI();var i=t.getSettingsPanel(!0);i&&i.syncUI()}),this.addEventListener(av.VIEWER_RESIZE_EVENT,function(e){t.resizePanels(),t.viewCubeUi&&t.viewCubeUi.cube&&t.viewCubeUi.cube.refreshCube(),t.updateToolbarButtons(e.width,e.height),t.centerToolBar&&t.centerToolBar()}),this.addEventListener(av.NAVIGATION_MODE_CHANGED_EVENT,function(e){t.updateToolbarButtons(t.container.clientWidth,t.container.clientHeight),t.centerToolBar()}),this.initEscapeHandlers(),this.localize(),this.run(),0},e.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),av.theHotkeyManager.popHotkeys("Autodesk.ROLL"),av.theHotkeyManager.popHotkeys("Autodesk.FOV"),this.removeEventListener(av.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.onRenderOptionChanged=null,this.removeEventListener(av.VIEWER_STATE_RESTORED_EVENT,this.onRestoreState),this.onRestoreState=null,this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.centerToolBar=null,this.toolbar=null,av.Viewer3D.prototype.uninitialize.call(this)},e.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,this.getToolbar(!0),av.Viewer3D.prototype.setUp.call(this,e)},e.prototype.tearDown=function(){av.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.removeEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube)},e.prototype.loadModel=function(e,t,i,n,o){function r(e){return a.running?void a.createUI(e):void avp.logger.error("createUI expects the viewer to be running.")}function s(e){setTimeout(r.bind(r,e),1),i&&i.apply(i,arguments)}var a=this,l=av.Viewer3D.prototype.loadModel.call(this,e,t,s,n,o);return l},e.prototype.createUI=function(e){var t=this,i=this;this.initViewCube=function(){setTimeout(function(){i.displayViewCube(i.prefs.viewCube),i.removeEventListener(av.GEOMETRY_LOADED_EVENT,i.initViewCube)},1)};var n=this.config.disabledExtensions;this.initHotkeys(e),this.loadExtension("Autodesk.DefaultTools.NavTools",{mode:e.is2d()?"2d":"3d"}),this.initModelTools(e),avp.ENABLE_DEBUG&&this.initDebugTools(),this.fireEvent({type:av.TOOLBAR_CREATED_EVENT}),this.config.wantInfoButton=!0,this.createViewCube(),this.fireEvent({type:av.VIEW_CUBE_CREATED_EVENT}),this.centerToolBar=function(){t.toolbar.container.style.left="calc(50% - "+t.toolbar.getDimensions().width/2+"px)"},this.toolbar.addEventListener(avu.ToolBar.Event.SIZE_CHANGED,this.centerToolBar),this.initModality(),this.resize(),e.is2d()?(i.prefs.useFirstPersonNavigation?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){(!n||n&&!n.measure)&&i.loadExtension("Autodesk.Measure",null),(!n||n&&!n.hyperlink)&&i.loadExtension("Autodesk.Hyperlink",null)},1)):(this.getDefaultNavigationToolName().indexOf("orbit")===-1&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){i.prefs.useFirstPersonNavigation?i.loadExtension("Autodesk.FirstPerson",null):i.loadExtension("Autodesk.Beeline",null),i.loadExtension("Autodesk.Viewing.Oculus",null),i.prefs.fusionOrbit&&i.loadExtension("Autodesk.Viewing.FusionOrbit",null),(!n||n&&!n.measure)&&i.loadExtension("Autodesk.Measure",null),(!n||n&&!n.section)&&i.loadExtension("Autodesk.Section",null),(!n||n&&!n.hyperlink)&&i.loadExtension("Autodesk.Hyperlink",null),(!n||n&&!n.billboard)&&("Development"!==LMV_BUILD_TYPE&&"@build_type@"!==LMV_BUILD_TYPE||(i.loadExtension("Autodesk.Comments"),i.loadExtension("Autodesk.BillboardGui",null)))},1),this.addEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube));var o=function(){if(i.modelstructure){var e=function(e){var t=i.config.defaultModelStructureTitle?i.config.defaultModelStructureTitle:"";i.modelstructure.setModel(e,t)},t=function(e){};i.model.getObjectTree(e,t)}i.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,o)};this.addEventListener(av.OBJECT_TREE_CREATED_EVENT,o)},e.prototype.addOptionToggle=function(e,t,i,n,o){var r=o?this.prefs[o]:null;i="boolean"==typeof r?r:i;var s=document.createElement("li");s.className="toolbar-submenu-listitem";var a=document.createElement("input");a.className="toolbar-submenu-checkbox",a.type="checkbox",a.id=t,s.appendChild(a);var l=document.createElement("label");return l.setAttribute("for",t),l.setAttribute("data-i18n",t),l.textContent=av.i18n.translate(t),s.appendChild(l),e.appendChild(s),a.checked=i,a.addEventListener("touchstart",av.touchStartToClick),l.addEventListener("touchstart",av.touchStartToClick),s.addEventListener("touchstart",av.touchStartToClick),a.addEventListener("click",function(e){n(a.checked),e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),s.addEventListener("click",function(e){n(!a.checked),e.stopPropagation()}),o&&this.prefs.addListeners(o,function(e){a.checked=e},function(e){a.checked=e,n(e)}),a},e.prototype.addOptionList=function(e,t,i,n,o,r){
var s=this.prefs[r];n="number"==typeof s?s:n;var a=function(e){var t=e.target.selectedIndex;o(t),e.stopPropagation()},l=document.createElement("select");l.className="optionDropDown",l.id="selectMenu_"+t;for(var c=0;c<i.length;c++){var u=document.createElement("option");u.value=c,u.setAttribute("data-i18n",i[c]),u.textContent=Autodesk.Viewing.i18n.translate(i[c]),l.add(u)}var h=document.createElement("li");h.className="toolbar-submenu-select";var d=document.createElement("div");return d.className="toolbar-submenu-selectlabel",d.setAttribute("for",t),d.setAttribute("data-i18n",t),d.textContent=av.i18n.translate(t),h.appendChild(d),h.appendChild(l),e.appendChild(h),l.selectedIndex=n,l.onchange=a,l.addEventListener("touchstart",function(e){e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),r&&this.prefs.addListeners(r,function(e){l.selectedIndex=e},function(e){l.selectedIndex=e,o(e)}),l},e.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},e.prototype.showRenderingOptions=function(e){this.renderoptions.setVisible(e)},e.prototype.showLayerManager=function(e){this.layersPanel.setVisible(e)},e.prototype.initHotkeys=function(e){var t,i,n=this,o=av.theHotkeyManager.KEYCODES;if(!e.is2d()){var r;t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(r=n.getActiveNavigationTool(),n.setActiveNavigationTool("fov"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(n.setActiveNavigationTool(r),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[o.CONTROL,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})}var s;t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(s=n.getActiveNavigationTool(),n.setActiveNavigationTool("worldup"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(n.setActiveNavigationTool(s),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[o.ALT,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})},e.prototype.setModelStructurePanel=function(e){var t=this;return(e instanceof av.UI.ModelStructurePanel||null===e)&&(this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=e,e&&(this.addPanel(this.modelstructure),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.structurebutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)}),t.model&&t.model.getObjectTree(function(e){t.modelstructure.setModel(e)})),!0)},e.prototype.setLayersPanel=function(e){var t=this;return this.model&&!this.model.is2d()?(avp.logger.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1):(e instanceof av.UI.LayersPanel||!e)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.layerButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.setPropertyPanel=function(e){var t=this;return(e instanceof av.UI.PropertyPanel||!e)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.propertiesbutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getPropertyPanel=function(e){return!this.propertygrid&&e&&this.setPropertyPanel(new ave.ViewerPropertyPanel(this)),this.propertygrid},e.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof av.UI.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.viewerOptionButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getSettingsPanel=function(e){return!this.viewerSettingsPanel&&e&&this.setSettingsPanel(new ave.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},e.prototype.initModelTools=function(e){var t=this;if(e.is2d()){var i=new ave.ViewerLayersPanel(this);this.setLayersPanel(i);var n=new avu.Button("toolbar-layersTool");n.setToolTip("Layer Manager"),n.setIcon("adsk-icon-layers"),n.onClick=function(e){t.layersPanel||t.setLayersPanel(new ave.ViewerLayersPanel(t)),t.showLayerManager(!t.layersPanel.isVisible())},this.settingsTools.addControl(n),this.settingsTools.layerButton=n}else{if(!t.modelstructure){var o={docStructureConfig:t.config.docStructureConfig};t.setModelStructurePanel(new ave.ViewerModelStructurePanel(t,"Browser",o))}var r=new avu.Button("toolbar-modelStructureTool");r.setToolTip("Model browser"),r.setIcon("adsk-icon-structure"),r.onClick=function(e){t.showModelStructurePanel(!t.modelstructure.isVisible())},this.settingsTools.addControl(r),this.settingsTools.structurebutton=r,this.initExplodeSlider()}t.addEventListener(av.RESET_EVENT,function(){t.model&&!t.model.is2d()&&(t.explode(0),t.explodeSlider.value=0),t.showAll()});var s=new avu.Button("toolbar-propertiesTool");s.setToolTip("Properties"),s.setIcon("adsk-icon-properties"),s.onClick=function(e){var i=t.getPropertyPanel(!0);i.setVisible(!i.isVisible())},s.setVisible(!t.prefs.openPropertiesOnSelect),this.settingsTools.addControl(s),this.settingsTools.propertiesbutton=s;var a=new ave.ViewerSettingsPanel(this,e);this.setSettingsPanel(a),a.syncUI();var l=new avu.Button("toolbar-settingsTool");if(this.viewerOptionButton=l,l.setIcon("adsk-icon-settings"),l.setToolTip("Settings"),this.settingsTools.addControl(l),this.createViewerOptionsMenu(e),avp.ENABLE_DEBUG&&!e.is2d()){this.renderoptions=new avp.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var c=new avu.Button("toolbar-renderOptionsTool");c.setToolTip("Rendering options"),c.setIcon("adsk-icon-settings-render"),c.onClick=function(e){t.showRenderingOptions(!t.renderoptions.isVisible())},this.settingsTools.addControl(c)}if(this.canChangeScreenMode()){var u=new avu.Button("toolbar-fullscreenTool",{collapsible:!1});u.setToolTip("Full screen"),u.setIcon("adsk-icon-fullscreen"),u.onClick=function(e){t.nextScreenMode()},this.settingsTools.addControl(u),this.settingsTools.fullscreenbutton=u,this.updateFullscreenButton(this.getScreenMode())}},e.prototype.setPropertiesOnSelect=function(e){this.prefs.set("openPropertiesOnSelect",e),this.settingsTools.propertiesbutton.setVisible(!e)},e.prototype.addDivider=function(e){var t=document.createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},e.prototype.createViewerOptionsMenu=function(e){function t(e){var t=i.getExtension("Autodesk.SideBarUi");if(t){var n=Autodesk.SideBarUi.Content;return void i.fireEvent({type:av.SIDE_BAR_OPEN_EVENT,content:n.Settings})}var o=i.getSettingsPanel(!0);o.isVisible()?i.showViewer3dOptions(!1):(i.showViewer3dOptions(!0),o.selectTab(e))}var i=this;this.viewerOptionButton.onClick=function(){t(ave.ViewerSettingTab.Performance)}},e.prototype.initDebugTools=function(){var e=new avu.ControlGroup("debugTools");this.debugMenu=e;var t=new avu.Button("toolbar-debugTool");t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e)},e.prototype.createDebugSubmenu=function(e){function t(){i.localize()}var i=this,n=document.createElement("div");n.id="toolbar-debugToolSubmenu",n.classList.add("toolbar-submenu"),n.classList.add("toolbar-settings-sub-menu"),n.classList.add("adsk-hidden"),this.debugMenu.subMenu=n,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(n),this.initModelStats(),this.addDivider(n),this.addDivider(n);var o=["English","Chinese Simplified","Chinese Traditional","Japanese","Czech","Korean","Polish","Russian","French","German","Italian","Spanish","Portuguese Brazil","Turkish"],r=["en","zh-Hans","zh-Hant","ja","cs","ko","pl","ru","fr","de","it","es","pt-br","tr"],s=i.selectedLanguage?i.selectedLanguage:0,a=this.addOptionList(n,"Language",o,s,function(e){var n=r[e];i.selectedLanguage=e,avp.setLanguage(n,t)},null);a.parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);var l=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],c=this.addOptionList(n,"Error",l,0,function(e){var t=e+1;avp.ErrorHandler.reportError(i.container,t,"")},null);c.parentNode.style.paddingBottom="15px";var u=n.getBoundingClientRect();this.debugMenu.subMenu.style.width=u.width+"px",this.container.removeChild(n),e.container.appendChild(n);var h=u.left+u.width,d=this.container.getBoundingClientRect().right;if(h>d){var p=-(h-d+10)+"px";this.debugMenu.subMenu.style.left=p}e.onMouseOver=function(e){n.classList.remove("adsk-hidden")},e.onMouseOut=function(e){n.classList.add("adsk-hidden")},av.isTouchDevice()&&(e.onClick=function(e){n.classList.toggle("adsk-hidden")})},e.prototype.initModelStats=function(){function e(e){var t=i.impl,n="",o=i.model;o&&(n+="Geom&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().geomPolyCount+"<br>",n+="Instance&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().instancePolyCount+"<br>",n+="Fragments:&nbsp;"+t.modelQueue().getFragmentList().getCount()+"<br>",n+="Geoms:&nbsp;"+t.modelQueue().getGeometryList().geoms.length+"<br>",n+="Loading&nbsp;time:&nbsp;"+(t.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),n+="# "+(e||""),i.modelStats.innerHTML=n}function t(){i.modelStats=document.createElement("div"),i.modelStats.className="statspanel",i.container.appendChild(i.modelStats),i.addEventListener(av.PROGRESS_UPDATE_EVENT,function(t){t.message&&e(t.message)}),i.fpsDisplay=document.createElement("div"),i.fpsDisplay.className="fps",i.container.appendChild(i.fpsDisplay)}var i=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(n){n&&!i.modelStats&&(t(),e("")),i.modelStats.style.visibility=n?"visible":"hidden",i.fpsDisplay.style.visibility=n?"visible":"hidden",n?i.impl.fpsCallback=function(e){i.fpsDisplay.textContent=""+(0|e)}:i.impl.fpsCallback=null})},e.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(av.ESCAPE_EVENT,function(t){if(!e.contextMenu||!e.contextMenu.hide()){if(e.renderoptions&&e.renderoptions.isVisible())return void e.renderoptions.setVisible(!1);if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void avp.HudMessage.dismiss();if(e.selectionActive)return void e.clearSelection();if(!e.areAllVisible())return void e.showAll();if(!avp.AlertBox.dismiss()){for(var i=0;i<e.dockingPanels.length;++i){var n=e.dockingPanels[i];if("none"!==n.container.style.display&&""!==n.container.style.display)return void(n.container===e.modelstructure?e.showModelStructurePanel(!1):n.setVisible(!1))}e.escapeScreenMode()}}})},e.prototype.showViewCubeUI=function(e){this.viewCubeUi.setVisible(e)},e.prototype.displayViewCube=function(e,t){this.viewCubeUi.displayViewCube(e,t)},e.prototype.getToolbar=function(e){if(!this.toolbar&&e){var t=av.UI;this.toolbar=new t.ToolBar("guiviewer3d-toolbar"),this.navTools=new t.RadioButtonGroup(av.TOOLBAR.NAVTOOLSID),this.modelTools=new t.ControlGroup(av.TOOLBAR.MODELTOOLSID),this.settingsTools=new t.ControlGroup(av.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container)}return this.toolbar},e.prototype.showModelStructurePanel=function(e){this.modelstructure.setVisible(e),e&&this.modelstructure instanceof ave.ViewerModelStructurePanel&&(this.modelstructure.setSelection(this.getSelection()),this.modelstructure.setIsolation(this.getIsolatedNodes()))},e.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},e.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case av.ScreenMode.kNormal:this.isScreenModeSupported(av.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen");break;case av.ScreenMode.kFullBrowser:t=this.isScreenModeSupported(av.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case av.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},e.prototype.localize=function(){av.i18n.localize(),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),avp.ErrorHandler.localize()},e.prototype.addPanel=function(e){var t=this.dockingPanels.indexOf(e);return t===-1&&(this.dockingPanels.push(e),!0)},e.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},e.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar.getDimensions().height,i=this.getDimensions(),n=i.height;e.dimensions&&e.dimensions.height?n=e.dimensions.height:e.dimensions={height:i.height,width:i.width},e.dimensions.height=n-t;var o=e?e.viewer:null;o||(o=this);var r=e?e.dockingPanels:null;r||(r=o.dockingPanels);var s,a,l=o.container.getBoundingClientRect(),c=l.top,u=l.bottom,h=l.left,d=l.right;e&&e.dimensions?(s=e.dimensions.width,a=e.dimensions.height,u=e.dimensions.height):(s=l.width,a=l.height);for(var p=0;p<r.length;++p){var v=r[p].container,g=v.getBoundingClientRect(),m=g.top,f=g.bottom,E=g.left,A=g.right,y=g.width,T=g.height;y&&T&&(s<y&&(y=Math.round(s),v.style.width=y+"px"),a<T&&(T=Math.round(a),v.style.height=T+"px"),(d<A||v.dockRight)&&(E=Math.round(d-y-h),v.style.left=E+"px"),(u<f||v.dockBottom)&&(m=Math.round(u-T-c),m<0&&(m=0),v.style.top=m+"px"),v.style.maxWidth=Math.round(s)+"px",v.style.maxHeight=Math.round(a)+"px")}},e.prototype.initExplodeSlider=function(){var e=this,t=new avu.Button("toolbar-explodeTool");t.setIcon("adsk-icon-explode"),t.setToolTip("Explode model"),e.modelTools.addControl(t,{index:0});var i='<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>';this.explodeSubmenu=avp.stringToDOM(i);var n;n=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios"),n.appendChild(this.explodeSubmenu);var o=this.explodeSubmenu.querySelector(".explode-slider");e.explodeSlider=o,o.oninput=function(t){e.explode(o.value)},o.onchange=function(t){e.explode(o.value)},this.explodeSubmenu.onclick=function(e){e.stopPropagation()};var r=t.container.querySelector(".adsk-control-tooltip");t.onClick=function(i){var n=t.getState();n===avu.Button.State.INACTIVE?(t.setState(avu.Button.State.ACTIVE),r.style.display="none",e.explodeSubmenu.style.display="",avp.logger.track({category:"tool_changed",name:"explode"})):n===avu.Button.State.ACTIVE&&(t.setState(avu.Button.State.INACTIVE),r.style.display="",o.parentNode.style.display="none",e.explode(0),e.explodeSlider.value=0)}},e.prototype.initInspectTools=function(){var e=new avu.Button("toolbar-inspectTools");e.setToolTip("Inspect"),e.setIcon("measure"),e.setVisible(!1),this.modelTools.addControl(e);var t=new avu.RadioButtonGroup("toolbar-inspectSubMenu");t.addClass("toolbar-vertical-group"),t.setVisible(!1),this.modelTools.addControl(t),e.container.insertBefore(t.container,e.container.firstChild),e.onMouseOver=function(){t.setVisible(!0)},e.onMouseOut=function(){t.setVisible(!1)},av.isTouchDevice()&&(e.onClick=function(e){t.setVisible(!t.isVisible())})},e.prototype.initModality=function(){function e(t){for(var i=2,n=0;n<i&&t.parentElement;){var o=t.id;if(0===o.indexOf("toolbar-")){if(o.indexOf("arrow")===o.length-5)return;var r=e(t.parentElement);return r||t}t=t.parentElement,n++}}function t(e){return e.id.substring(8,e.id.length)}function i(e){return e.classList.contains("active")}function n(e){var t=document.createEvent("Event");t.initEvent("click",!0,!0),e.dispatchEvent(t)}function o(e,t,i){a[e]=i?t:void 0}function r(r){if(!r.target.classList.contains("clickoff")){var l=e(r.target);if(l){var c=t(l);if(s[c]&&!("sectionTool"===c&&(r.target.classList.contains("adsk-icon-section-analysis")||r.target.querySelector(".adsk-icon-section-analysis"))||a[c]&&(o(c,l,!1),i(l)))){for(var u in a){var h=a[u];if(h){var d=t(h);i(h)?s[c][d]||n(h):o(d,h,!1)}}o(c,l,!0)}}}}var s={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{},measureTool:{},explodeTool:{},billboardTool:{}},a={};this.toolbar.container.addEventListener("click",r,!0)},e.prototype.updateToolbarButtons=function(e,t){var i=this.getToolbar(!1);if(i){var n,o;o=e>310?"block":"none",n=this.modelTools.getControl("toolbar-explodeTool"),n&&n.setDisplay(o),o=e>380?"block":"none",n=this.modelTools.getControl("toolbar-collaborateTool"),n&&n.setDisplay(o),o=e>515?"block":"none";var r=this.navTools.getControl("toolbar-cameraSubmenuTool");r&&(r.setDisplay(o),n=r.subMenu.getControl("toolbar-homeTool"),n&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),n=r.subMenu.getControl("toolbar-fitToViewTool"),n&&n.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),n=r.subMenu.getControl("toolbar-focalLengthTool"),n&&n.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),n=r.subMenu.getControl("toolbar-rollTool"),n&&n.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),o=e>700?"block":"none",n=this.modelTools.getControl("toolbar-measureTool"),n&&n.setDisplay(o),n=this.modelTools.getControl("toolbar-sectionTool"),n&&n.setDisplay(o),o=e>740?"block":"none",n=this.navTools.getControl("toolbar-beelineTool"),n&&n.setDisplay(this.navigation.isActionEnabled("walk")?o:"none"),n=this.navTools.getControl("toolbar-firstPersonTool"),n&&n.setDisplay(this.navigation.isActionEnabled("walk")?o:"none"),n=this.navTools.getControl("toolbar-zoomTool"),n&&n.setDisplay(this.navigation.isActionEnabled("zoom")?o:"none"),n=this.navTools.getControl("toolbar-panTool"),n&&n.setDisplay(this.navigation.isActionEnabled("pan")?o:"none"),n=this.navTools.getControl("toolbar-orbitTools"),n&&n.setDisplay(this.navigation.isActionEnabled("orbit")?o:"none")}},avp.GuiViewer3D=e}(),function(){"use strict";function e(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control")}var t=Autodesk.Viewing;Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},t.EventDispatcher.prototype.apply(e.prototype),e.prototype.constructor=e,e.prototype.container=null,e.prototype.getId=function(){return this._id},e.prototype.setVisible=function(t){var i=!this.container.classList.contains("adsk-hidden");if(i===t)return!1;t?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var n={type:e.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:t};return this.fireEvent(n),!0},e.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},e.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},e.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},e.prototype.setCollapsed=function(t){if(!this._isCollapsible||this.isCollapsed()===t)return!1;t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var i={type:e.Event.COLLAPSED_CHANGED,isCollapsed:t};return this.fireEvent(i),!0},e.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},e.prototype.isCollapsible=function(){return this._isCollapsible},e.prototype.addClass=function(e){this.container.classList.add(e)},e.prototype.removeClass=function(e){this.container.classList.remove(e)},e.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},e.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},e.prototype.setDisplay=function(e){this.container.style.display=e},Autodesk.Viewing.UI.Control=e}(),function(){"use strict";function e(i,n){t.Control.call(this,i,n);var o=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(t){var i={type:e.Event.SIZE_CHANGED,childEvent:t};o.fireEvent(i)}}var t=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},e.prototype=Object.create(t.Control.prototype),e.prototype.constructor=e,e.prototype.addControl=function(i,n){var o=n&&void 0!==n.index?n.index:this._controls.length;if(null!==this.getControl(i.getId()))return!1;var r={type:e.Event.CONTROL_ADDED,control:i,index:o};return o<this._controls.length?(this.container.insertBefore(i.container,this._controls[o].container),this._controls.splice(o,0,i)):(this.container.appendChild(i.container),this._controls.push(i)),i.addEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),i.addEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),i instanceof e&&i.addEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var i=this._controls[t];if(i===e||"string"==typeof e&&e===i.getId())return t}return-1},e.prototype.removeControl=function(i){var n="string"==typeof i?this.getControl(i):i;if(!n)return!1;var o=this._controls.indexOf(n);if(o===-1)return!1;this._controls.splice(o,1),this.container.removeChild(n.container);var r={type:e.Event.CONTROL_REMOVED,control:n,index:o};return n.removeEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),n.removeEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),n instanceof e&&n.removeEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},e.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},e.prototype.getNumberOfControls=function(){return this._controls.length},e.prototype.setCollapsed=function(t){if(!this._isCollapsible)return!1;var i=!1;return this._controls.forEach(function(e){e.isCollapsible()&&e.setCollapsed(t)&&(i=!0)}),i&&(t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:e.Event.COLLAPSED_CHANGED,isCollapsed:t})),i},Autodesk.Viewing.UI.ControlGroup=e}(),function(){"use strict";function e(e,i){t.ControlGroup.call(this,e,i),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var t=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,Autodesk.Viewing.UI.ToolBar=e}(),function(){"use strict";function e(n,o){i.Control.call(this,n,o);var r=this;this._state=e.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(t){r.getState()!==e.State.DISABLED&&(r.fireEvent(e.Event.CLICK),r.onClick&&r.onClick(t)),t.stopPropagation()}),t.isTouchDevice()?this.container.addEventListener("touchstart",t.touchStartToClick):(this.container.addEventListener("mouseover",function(e){r.onMouseOver(e)}),this.container.addEventListener("mouseout",function(e){r.onMouseOut(e)})),this.addClass("adsk-button"),this.addClass(e.StateToClassMap[this._state])}var t=Autodesk.Viewing,i=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:i.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:i.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},e.State={ACTIVE:0,INACTIVE:1,DISABLED:2},e.StateToClassMap=function(){var t=e.State,i={};return i[t.ACTIVE]="active",i[t.INACTIVE]="inactive",i[t.DISABLED]="disabled",i}(),e.prototype=Object.create(i.Control.prototype),e.prototype.constructor=e,e.prototype.setState=function(t){if(t===this._state)return!1;this.removeClass(e.StateToClassMap[this._state]),this.addClass(e.StateToClassMap[t]),this._state=t;var i={type:e.Event.STATE_CHANGED,state:t};return this.fireEvent(i),!0},e.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},e.prototype.getState=function(){return this._state},e.prototype.onClick=function(e){},e.prototype.onMouseOver=function(e){},e.prototype.onMouseOut=function(e){},Autodesk.Viewing.UI.Button=e}(),function(){"use strict";function e(e,n){t.Button.call(this,e,n),this.arrowButton=new t.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new t.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var o=this;this.arrowButton.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.toggleFlyoutVisible=function(){o.subMenu.setVisible(!o.subMenu.isVisible())},this.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(o.setIcon(e.target.getActiveButton().iconClass),o.setToolTip(e.target.getActiveButton().getToolTip()),o.setState(t.Button.State.ACTIVE),o.onClick=e.button.onClick):o.setState(t.Button.State.INACTIVE)},this.subMenu.addEventListener(t.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var r=i.stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(r,this.subMenu.container.firstChild),r.addEventListener("click",function(e){o.subMenu.setVisible(!1),e.stopPropagation()})}var t=Autodesk.Viewing.UI,i=Autodesk.Viewing.Private;e.prototype=Object.create(t.Button.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.removeControl=function(e){e.removeEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.setState=function(e){if(e===t.Button.State.INACTIVE){var i=this.subMenu.getActiveButton();i&&i.setState(t.Button.State.INACTIVE)}t.Button.prototype.setState.call(this,e)},e.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},e.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(t.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=e}(),function(){"use strict";function e(i,n){t.ControlGroup.call(this,i,n);var o=this;this._activeButton=null,this._handleButtonStateChange=function(i){var n=t.Button.State;return i.state!==n.ACTIVE?void(i.target===o._activeButton&&(o._activeButton=null,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!1}))):(o._activeButton=i.target,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!0}),void o._controls.forEach(function(e){e!==i.target&&e.getState()!==n.DISABLED&&e.setState(n.INACTIVE)}))}}var t=Autodesk.Viewing.UI;e.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e,i){return e instanceof t.Button&&(!!t.ControlGroup.prototype.addControl.call(this,e,i)&&(e.addEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},e.prototype.removeControl=function(e){var i="string"==typeof e?this.getControl(e):e;return!(null===i||!t.ControlGroup.prototype.removeControl.call(this,i))&&(i.removeEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},e.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=e}(),function(){"use strict";function e(e,t){i.DomDispatcher.prototype.apply(this),this.viewer=e,this.container=t}var t=AutodeskNamespace("Autodesk.SideBarUi.Content"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils"),n=Autodesk.Viewing;t.Settings=e;var o=e.prototype;e.IDS={SHOW_VIEWCUBE:1,ACT_ON_PIVOT:2,ZOOM_TOWARDS_PIVOT:3,LEFT_MOUSE_PIVOT:4,FUSION_ORBIT:5,FIRST_PERSON_WALK:6,REVERSE_MOUSE_ZOOM:7,ORBIT_PAST_POLES:8,OPEN_PROPS_ON_SELECT:9,LEFT_HAND_MOUSE_SETUP:10,MAX_NAV:11,GHOSTING:11,SMOOTH_NAVIGATION:12,ANTIALIASING:13,AMBIENT_SHADOWS:14,GROUND_SHADOWS:15,GROUND_REFLECTIONS:16,ENV_MAP_BG:17,PROGRESSIVE_RENDERING:18,SWAP_BLACK_AND_WHITE:19},e.ELEMENTS=[{id:1,text:"Show ViewCube",pref:"viewCube",defaultValue:!0,mode:["3d"]},{id:2,text:"ViewCube acts on pivot",pref:"alwaysUsePivot",defaultValue:!1,mode:["3d"]},{id:3,text:"Zoom towards pivot",pref:"zoomTowardsPivot",defaultValue:!1,mode:["3d"]},{id:4,text:"Set pivot with left mouse button",pref:"clickToSetCOI",defaultValue:!1,mode:["3d"]},{id:5,text:"Fusion style orbit",pref:"fusionOrbit",defaultValue:!1,mode:["3d"]},{id:6,text:"First person walk",pref:"useFirstPersonNavigation",defaultValue:!1,mode:["3d"]},{id:7,text:"Reverse mouse zoom direction",pref:"reverseMouseZoomDir",defaultValue:!1,mode:["2d","3d"]},{id:8,text:"Orbit past world poles",pref:"orbitPastWorldPoles",defaultValue:!0,mode:["3d"]},{id:9,text:"Open properties on select",pref:"openPropertiesOnSelect",defaultValue:!0,mode:["2d","3d"]},{id:10,text:"Left handed mouse setup",pref:"leftHandedMouseSetup",defaultValue:!1,mode:["2d","3d"]},{id:11,text:"Ghost hidden objects",pref:"ghosting",defaultValue:!0,mode:["3d"]},{id:12,text:"Smooth navigation",pref:"optimizeNavigation",defaultValue:n.isMobileDevice(),
mode:["3d"]},{id:13,text:"Anti-aliasing",pref:"antialiasing",defaultValue:!0,mode:["3d"]},{id:14,text:"Ambient shadows",pref:"ambientShadows",defaultValue:!0,mode:["3d"]},{id:15,text:"Ground shadow",pref:"groundShadow",defaultValue:!0,mode:["3d"]},{id:16,text:"Ground reflection",pref:"groundReflection",defaultValue:!0,mode:["3d"]},{id:17,text:"Environment map for background",pref:"envMapBackground",defaultValue:!0,mode:["3d"]},{id:18,text:"Progressive model display",pref:"progressiveRendering",defaultValue:!0,mode:["2d","3d"]},{id:19,text:"Swap black and white",pref:"swapBlackAndWhite",defaultValue:!1,mode:["2d"]}],o.load=function(){var t=e.ELEMENTS;e.createDom(this,this.viewer,this.container,t),this.onPrefChangedBinded=this.onPrefChanged.bind(this),this.viewer.addEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefResetBinded=this.onPrefReset.bind(this),this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded)},o.unload=function(){this.viewer.removeEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefChangedBinded=null,this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded),this.onPrefResetBinded=null,this.unhookEvents()},o.getTitle=function(){return"Settings"},o.onPrefChanged=function(t){var i=t.name,n=e.getIdFromPref(i);if(n!==-1){var o='[data-value="'+n+'"]',r=this.container.querySelector(o),s=r.querySelector("input");s.checked=t.value}},o.onPrefReset=function(t){var i=t.name,n=e.getIdFromPref(i);n!==-1&&(this.onPrefChanged(t),e.setState(this.viewer,n,t.value))},e.getIdFromPref=function(t){var i=-1;return e.ELEMENTS.forEach(function(e){e.pref===t&&(i=e.id)}),i},e.setState=function(t,i,n){var o=e.IDS;switch(i){case o.SHOW_VIEWCUBE:t.displayViewCube(n);break;case o.ACT_ON_PIVOT:t.setUsePivotAlways(n);break;case o.ZOOM_TOWARDS_PIVOT:t.setZoomTowardsPivot(n);break;case o.LEFT_MOUSE_PIVOT:t.setClickToSetCOI(n);break;case o.FUSION_ORBIT:n?t.loadExtension("Autodesk.Viewing.FusionOrbit",null):t.unloadExtension("Autodesk.Viewing.FusionOrbit",null);break;case o.FIRST_PERSON_WALK:n?(t.unloadExtension("Autodesk.Beeline",null),t.loadExtension("Autodesk.FirstPerson",null)):(t.unloadExtension("Autodesk.FirstPerson",null),t.loadExtension("Autodesk.Beeline",null));case o.REVERSE_MOUSE_ZOOM:t.setReverseZoomDirection(n);break;case o.ORBIT_PAST_POLES:t.setOrbitPastWorldPoles(n);break;case o.OPEN_PROPS_ON_SELECT:t.setPropertiesOnSelect(n);break;case o.LEFT_HAND_MOUSE_SETUP:t.setUseLeftHandedInput(n);break;case o.GHOSTING:t.setGhosting(n);break;case o.SMOOTH_NAVIGATION:t.setOptimizeNavigation(n);break;case o.ANTIALIASING:t.setQualityLevel(t.prefs.ambientShadows,n);break;case o.AMBIENT_SHADOWS:t.setQualityLevel(n,t.prefs.antialiasing);break;case o.GROUND_SHADOWS:t.setGroundShadow(n);break;case o.GROUND_REFLECTIONS:t.setGroundReflection(n);break;case o.ENV_MAP_BG:t.setEnvMapBackground(n);break;case o.PROGRESSIVE_RENDERING:t.setProgressiveRendering(n);break;case o.SWAP_BLACK_AND_WHITE:t.setSwapBlackAndWhite(n);break;default:console.log(i)}},e.createDom=function(t,i,n,o){var r=i.model.is2d()?"2d":"3d",s=o.filter(function(e){return e.mode.indexOf(r)!==-1}),a=s.filter(function(t){return t.id<e.IDS.MAX_NAV}),l=s.filter(function(t){return t.id>=e.IDS.MAX_NAV}),c="Navigation and selection",u="Performance and appearance";e.createTable(n,a,c),e.createTable(n,l,u);s.forEach(function(t){var o='[data-value="'+t.id+'"]',r=n.querySelector(o),s=r.querySelector("input");s.checked=e.isChecked(i,t)}),t.hookEvent(n,"click","tr",function(t,n){var o=parseInt(n.getAttribute("data-value")),r=n.querySelector("input");t.target!==r&&(r.checked=!r.checked);var s=r.checked;e.setState(i,o,s)});var h=document.createElement("button");h.className="lmv-sidebar-menu-button",h.setAttribute("data-i18n","Restore default settings"),h.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),n.appendChild(h),t.hookEvent(h,"click","button",function(e,t){var n=r;i.prefs.reset(n)})},e.createTable=function(t,i,n){var o=document.createElement("div");o.classList.add("lmv-sidebar-menu-heading"),o.setAttribute("data-i18n",n),o.textContent=Autodesk.Viewing.i18n.translate(n),t.appendChild(o);var r=document.createElement("table");r.classList.add("adsk-lmv-tftable"),r.classList.add("adsk-lmv-settings");var s=i.map(e.renderOption);return r.innerHTML=s.join("\n"),t.appendChild(r),r},e.renderOption=function(e){var t=Autodesk.Viewing.i18n.translate(e.text);return'<tr data-value="'+e.id+'"><td><div data-i18n="'+e.text+'">'+t+'</div></td><td><input type="checkbox"></td></tr>'},e.isChecked=function(e,t){var i=t.pref?e.prefs[t.pref]:null,n="boolean"==typeof i?i:t.defaultValue;return n}}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),i.DomDispatcher.prototype.apply(this),this.currentContent=null}var t=AutodeskNamespace("Autodesk.SideBarUi"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");AutodeskNamespace("Autodesk.SideBarUi.Content");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,t.SideBarUi=e;var n=e.prototype;n.load=function(){return this.openSideMenuBinded=this.openSideMenu.bind(this),this.viewer.addEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),!0},n.unload=function(){return this.viewer.removeEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),this.openSideMenuBinded=null,this.currentContent&&(this.currentContent.unload(),this.currentContent=null),this.domNav&&(i.remove(this.domNav),this.domNav=null),this.unhookEvents(),!0},n.createSlidingSideBar=function(e){var t=this.domNav=document.createElement("div");t.className="lmv-sidebar-menu--slide-left";t.innerHTML=['<button class="lmv-sidebar-menu__title">',"</button>",'<button class="lmv-sidebar-menu-button lmv-sidebar-menu-button__cross">&times;</button>','<div class="lmv-sidebar-menu__content">',"</div>"].join(""),e.appendChild(t),this.domContent=this.domNav.querySelector(".lmv-sidebar-menu__content"),this.domCloseBtn=this.domNav.querySelector("button.lmv-sidebar-menu__title"),this.setCloseButton(),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu__title",function(e){this.toggleCollapsed()}.bind(this)),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu-button__cross",function(e){this.closeSideMenu()}.bind(this))},n.setCloseButton=function(e){var t=e||"Close";this.domCloseBtn.setAttribute("data-i18n",t),this.domCloseBtn.textContent=Autodesk.Viewing.i18n.translate(t)},n.openSideMenu=function(e){if(this.domNav||this.createSlidingSideBar(this.viewer.container),this.currentContent&&(this.currentContent.unload(),this.currentContent=null,i.removeChildren(this.domContent)),e.content){var t=e.content;this.currentContent=new t(this.viewer,this.domContent),this.currentContent.load();var n=this.currentContent.getTitle();this.setCloseButton(n)}var o=this.domNav;requestAnimationFrame(function(){o.classList.remove("is-collapsed"),o.classList.add("is-active")})},n.toggleCollapsed=function(){this.domNav.classList.toggle("is-collapsed"),this.domNav.scrollTop=0},n.closeSideMenu=function(){this.domNav.classList.remove("is-active")},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SideBarUi",e)}(),AutodeskNamespace("Autodesk.Viewing");var proto=MobileCallbacks.prototype;proto.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},proto.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},proto.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},proto.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},proto.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},proto.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},proto.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},proto.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},proto.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},proto.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},proto.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},proto.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},proto.setLoadingProgress=function(e){this.ios?this.iosSend("setLoadingProgress",e):this.android&&this.androidSend.setLoadingProgress(e)},proto.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},proto.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},proto.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},proto.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},function(){"use strict";function e(e){return"application/autodesk-db"==e.mime&&e.urn?0===e.urn.indexOf("urn:adsk.objects:os.object")?e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):e.urn.substr(0,e.urn.lastIndexOf("/")+1):null}function t(n,o){if(this.parent=o,this.id=i++,this.data=n,this.isLeaf="geometry"===n.type&&("3d"===n.role||"2d"===n.role||"lod"===n.role),Array.isArray(n.children)){this.children=[];for(var r=n.children.length,s=0;s<r;s++)this.children[s]=new t(n.children[s],this);for(var s=0;s<r;s++){var a=e(n.children[s]);a&&(this.sharedPropertyDbPath=a),"lod"===n.children[s].role&&(this.lodNode=this.children[s])}}}var i=1;t.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},t.prototype.findPropertyDbPath=function(){return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},t.prototype._raw=function(){return this.data},t.prototype.name=function(){return this.data.name},t.prototype.guid=function(){return this.data.guid},t.prototype.urn=function(e){var t=this.data.urn;if(!e)return t;for(var i=this.parent;!t&&i;)t=i.data.urn,i=i.parent;return t},t.prototype.getTag=function(e){return(this.data.tags?this.data.tags:this.data)[e]},t.prototype.setTag=function(e,t){this.data.tags?this.data.tags[e]=t:this.data[e]=t},t.prototype.isGeomLeaf=function(){return this.isLeaf},t.prototype.isViewable=function(){return"viewable"===this.data.role},t.prototype.getLodNode=function(){return this.lodNode},t.prototype.isGeometry=function(){return"geometry"===this.data.type},t.prototype.is2D=function(){return"2d"===this.data.role},t.prototype.is3D=function(){return"3d"===this.data.role},t.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},t.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},t.prototype.getPlacementTransform=function(){return this.data.placement},t.prototype.isMetadata=function(){if(this.data.role){if(this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription")!==-1)return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},t.prototype.findViewableParent=function(){for(var e=this;e&&!e.isViewable();)e=e.parent;return e},t.prototype.findParentGeom2Dor3D=function(){for(var e=this;e&&!e.is2DGeom()&&!e.is3DGeom();)e=e.parent;return e},t.prototype.getViewableRootPath=function(){if(!this.isGeomLeaf())return null;var e=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",t=this.search({mime:e});if(t&&t.length){var i=t[0].data.urn;return i}return null},t.prototype.findByGuid=function(e){var t=null;return this.traverse(function(i){if(i.data.guid===e)return t=i,!0}),t},t.prototype.search=function(e){var t=[];return this.traverse(function(i){var n=!0;for(var o in e)if(!i.data.hasOwnProperty(o)||i.data[o]!==e[o]){n=!1;break}n&&t.push(i)}),t.length?t:null},t.prototype.searchByTag=function(e){var t=[];return this.traverse(function(i){var n=!0;for(var o in e)if(i.getTag(o)!==e[o]){n=!1;break}n&&t.push(i)}),t.length?t:null},t.prototype.traverse=function(e){if(e(this))return!0;if(this.children)for(var t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1},t.prototype.getLevel=function(){var e=this.getTag("level");return Array.isArray(e)?e[0]:e},t.MODEL_NODE={role:"3d",type:"geometry"},t.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},t.SHEET_NODE={role:"2d",type:"geometry"},t.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},t.VIEWABLE_NODE={role:"viewable"},Autodesk.Viewing.BubbleNode=t}(),Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},i=document.getElementsByClassName("toolbar-menu");return i&&i.length>0&&(t=i[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}},function(){"use strict";var e=Autodesk.Viewing,t=(Autodesk.Viewing.Private,Autodesk.Viewing.UI),i=Autodesk.Viewing.Extensions,n={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};i.ViewerModelStructurePanel=function(e,i,o){this.viewer=e,o=o||{},o.heightAdjustment=75,t.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",i,o),this.clickConfig=o&&o.docStructureConfig?o.docStructureConfig:n,this.isMac=navigator.userAgent.search("Mac OS")!==-1,this.initSearchBox(),this.prevSearchResults=[],this.prevSearchString=""},i.ViewerModelStructurePanel.prototype=Object.create(t.ModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.constructor=i.ViewerModelStructurePanel,i.ViewerPanelMixin.call(i.ViewerModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.initialize=function(){t.ModelStructurePanel.prototype.initialize.call(this);var i=this;i.addEventListener(i.viewer,e.SELECTION_CHANGED_EVENT,function(e){i.setSelection(e.nodeArray.slice())}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){i.setIsolation(e.nodeIdArray.slice())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!0)}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!1)})},i.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null,t.ModelStructurePanel.prototype.uninitialize.call(this)},i.ViewerModelStructurePanel.prototype.handleAction=function(e,t){for(var i in e)switch(e[i]){case"selectOnly":this.viewer.select(t);break;case"deselectAll":this.viewer.select([]);break;case"selectToggle":this.viewer.toggleSelect(t);break;case"isolate":this.viewer.isolate(t);break;case"showAll":this.viewer.isolate(null);break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(t);break;case"show":this.viewer.show(t);break;case"toggleVisibility":this.viewer.toggleVisibility(t)}},i.ViewerModelStructurePanel.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey},i.ViewerModelStructurePanel.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=this,n="click";i.ctrlDown(t)&&(n+="Ctrl"),t.shiftKey&&(n+="Shift"),t.altKey&&(n+="Alt"),this.clickConfig&&this.clickConfig[n]?i.handleAction(this.clickConfig[n].onObject,e):this.viewer.select(e)}},i.ViewerModelStructurePanel.prototype.onDoubleClick=function(e,t){this.handleAction(["focus"],e)},i.ViewerModelStructurePanel.prototype.onHover=function(e,t){this.viewer.impl.rolloverObjectNode(e)},i.ViewerModelStructurePanel.prototype.onRightClick=function(e,t){if(this.isMac&&t.ctrlKey&&0===t.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,e):this.viewer.select(e),null;var i=[],n=!0;if(t.shiftKey||this.isMac&&t.metaKey||t.ctrlKey&&(this.isMac||2===t.button))for(var o=this.viewer.impl.selector.getSelection(),r=0;r<o.length;++r)o[r]!==e?i.push(o[r]):n=!1;return n&&i.push(e),this.viewer.select(i),this.viewer.contextMenu.show(t)},i.ViewerModelStructurePanel.prototype.setHidden=function(e,t){this.uiCreated||this.createUI();for(var i=0;i<e.length;++i)this.tree.iterate(e[i],function(e,i){i.classList.toggle("dim",t),i.classList.toggle("visible",!t)})},i.ViewerModelStructurePanel.prototype.setIsolation=function(e){if(void 0!==this.rootId&&null!==this.rootId){if(this.tree&&this.tree.iterate(this.rootId,function(e,t){t.classList.remove("dim"),t.classList.remove("visible")}),e.length>0){if(1===e.length&&e[0]===this.rootId)return;this.setHidden([this.rootId],!0),this.setHidden(e,!1)}this.searchbox&&!this.inSearchIsolate&&(this.searchbox.value="")}},i.ViewerModelStructurePanel.prototype.initSearchBox=function(){function t(){if(!r.isSearching){for(var e=0;e<r.prevSearchResults.length;e++)r.tree.setCollapsed(r.prevSearchResults[e],!0,!0);if(0===i.value.length)r.isSearching=!1,r.prevSearchString="",o.isolate();else{if(r.prevSearchString==i.value)return;r.isSearching=!0,o.search(i.value,function(e){if(r.inSearchIsolate=!0,o.isolate(e),r.inSearchIsolate=!1,e.length){for(var t=0;t<e.length;t++)r.tree.setCollapsed(e[t],!1,!0);r.resizeToContent(),r.tree.scrollTo(e[0])}r.prevSearchResults=e,r.isSearching=!1},null,["name"])}}}var i=document.createElement("input");i.className="toolbar-search-box",i.type="search",i.results=5,i.placeholder=e.i18n.translate("Filter by name"),i.incremental="incremental",i.autosave=this.container.id+"search_autosave",i.setAttribute("data-i18n","[placeholder]Filter by name"),this.scrollContainer.parentNode.insertBefore(i,this.scrollContainer),this.searchbox=i;var n,o=this.viewer,r=this,s=500;i.addEventListener("input",function(e){clearTimeout(n),n=setTimeout(t,s)}),i.addEventListener("change",function(e){clearTimeout(n),t()})}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.UI,i=function(e){this.viewer=e,this.currentNodeIds=[],this.currentModel=null,this.isSelection=!1,this.isDirty=!0,this.propertyNodeId=null,t.PropertyPanel.call(this,e.container,"ViewerPropertyPanel","Object Properties Loading...")};i.prototype=Object.create(t.PropertyPanel.prototype),i.prototype.constructor=i,e.Extensions.ViewerPanelMixin.call(i.prototype),i.prototype.initialize=function(){t.PropertyPanel.prototype.initialize.call(this);var i=this;i.addEventListener(i.viewer,e.AGGREGATE_SELECTION_CHANGED_EVENT,function(e){e.selections&&e.selections.length?(i.currentNodeIds=e.selections[0].dbIdArray,i.currentModel=e.selections[0].model,i.isSelection=e.selections[0].dbIdArray.length>0):i.isSelection=!1,i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){0==e.nodeIdArray.length&&i.isSelection||(i.currentModel=e.model,i.currentNodeIds=e.nodeIdArray,i.isDirty=!0,i.requestProperties())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),this.currentModel=i.viewer.model,this.currentNodeIds=i.viewer.getSelection(),0===this.currentNodeIds.length?this.currentNodeIds=i.viewer.getIsolatedNodes():this.isSelection=!0},i.prototype.setTitle=function(e,i){e||(e="Object Properties",i=i||{},i.localizeTitle=!0),t.PropertyPanel.prototype.setTitle.call(this,e,i)},i.prototype.setVisible=function(e){t.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},i.prototype.visibilityChanged=function(){t.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},i.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},i.prototype.setNodeProperties=function(e){var t=this;this.propertyNodeId=e,t.currentModel.getProperties(e,function(e){if(t.setTitle(e.name),t.setProperties(e.properties),t.highlight(t.viewer.searchText),t.resizeToContent(),t.isVisible()){var i=t.viewer.toolController,n=i.lastClickX,o=i.lastClickY,r=t.container.getBoundingClientRect(),s=r.left,a=r.top,l=r.width,c=r.height,u=t.viewer.canvas.getBoundingClientRect(),h=u.left,d=u.top,p=u.width,v=u.height;s<=n&&n<s+l&&a<=o&&o<a+c&&(n<s+l/2&&n+l<h+p?(t.container.style.left=Math.round(n-h)+"px",t.container.dockRight=!1):h<=n-l?(t.container.style.left=Math.round(n-h-l)+"px",t.container.dockRight=!1):n+l<h+p?(t.container.style.left=Math.round(n-h)+"px",t.container.dockRight=!1):o+c<d+v?(t.container.style.top=Math.round(o-d)+"px",t.container.dockBottom=!1):d<=o-c&&(t.container.style.top=Math.round(o-d-c)+"px",t.container.dockBottom=!1))}})},i.prototype.showDefaultProperties=function(){var e=this.currentModel.getRootId();e?this.setNodeProperties(e):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),t.PropertyPanel.prototype.showDefaultProperties.call(this))},i.prototype.areDefaultPropertiesShown=function(){var e=this.currentModel.getRootId();return this.propertyNodeId===e},i.prototype.uninitialize=function(){t.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},i.prototype.onCategoryClick=function(e,i){t.PropertyPanel.prototype.onCategoryClick.call(this,e,i),this.resizeToContent()},i.prototype.onCategoryIconClick=function(e,i){t.PropertyPanel.prototype.onCategoryIconClick.call(this,e,i),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=i}(),function(){"use strict";var e=function(e){var t=e.container;Autodesk.Viewing.UI.LayersPanel.call(this,e,t,t.id+"ViewerLayersPanel"),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)};e.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype),e.prototype.constructor=e,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(e.prototype),e.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize.call(this)},e.prototype.onRestoreState=function(){this.update()},e.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,i)}},e.prototype.onRightClick=function(e,t){var i=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,i)},e.prototype.onImageClick=function(e,t){this.isMac&&t.ctrlKey||this.setLayerVisible(e)},e.prototype.onTitleClick=function(e){this.viewer.setLayerVisible(null,!0)},e.prototype.onTitleDoubleClick=function(e){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=e}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.UI;i.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};var o=function(o,r){this.viewer=o,this.is3dMode=!r.is2d(),n.SettingsPanel.call(this,o.container,"ViewerSettingsPanel"+o.id,"Settings",{width:360,heightAdjustment:155}),this.addTab(i.ViewerSettingTab.Navigation,"Navigation and selection",{className:"navigation"}),this.addTab(i.ViewerSettingTab.Performance,"Performance and appearance",{className:"performance"}),this.restoreDiv=document.createElement("div"),this.restoreDiv.className="viewer-restore-defaults",this.restoreDiv.setAttribute("data-i18n","Restore default settings"),this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),this.addEventListener(this.restoreDiv,"touchstart",e.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){var e=r.is2d()?"2d":"3d";o.prefs.reset(e),o.impl.setLightPresetFromFile(o.model)},!1),this.container.appendChild(this.restoreDiv),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.modelPreferenceCount&&t.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI.")};o.prototype=Object.create(n.SettingsPanel.prototype),o.prototype.constructor=o,i.ViewerPanelMixin.call(o.prototype),o.prototype.uninitialize=function(){this.viewer=null,n.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},o.prototype.addCheckbox=function(e,t,i,o,r){function s(e){r&&a.prefs.set(r,e),o(e)}var a=this.viewer,l=a.prefs[r];i="boolean"==typeof l?l:i;var c=n.SettingsPanel.prototype.addCheckbox.call(this,e,t,i,s),u=this.getControl(c);return u.saveKey=r,r?a.prefs.addListeners(r,function(e){u.setValue(e)},function(e){u.setValue(e),o(e)}):u.sliderRow.classList.add("logicalgroup"),a.prefs.hasTag(r,"no-storage")&&(u.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},o.prototype.addDropdown=function(e,i,n,o,r,s,a){var l=new t.OptionDropDown(e,i,n,o,r);return this.addEventListener(l,"change",s),a&&this.viewer.prefs.addListeners(a,function(e){l.dropdownElement.selectedIndex=e},function(e){l.dropdownElement.selectedIndex=e,s(e)}),l},o.prototype.removeCheckbox=function(e){return this.viewer.prefs.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),n.SettingsPanel.prototype.removeCheckbox.call(this,e)},o.prototype.createNavigationPanel=function(){var e=this.viewer,t=i.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(t,"Show ViewCube",!0,function(t){e.displayViewCube(t)},"viewCube"),this.addCheckbox(t,"ViewCube acts on pivot",!1,function(t){e.setUsePivotAlways(t)},"alwaysUsePivot"),this.addCheckbox(t,"Zoom towards pivot",!1,function(t){e.setZoomTowardsPivot(t)},"zoomTowardsPivot"),this.addCheckbox(t,"Set pivot with left mouse button",!1,function(t){e.setClickToSetCOI(t)},"clickToSetCOI"),this.addCheckbox(t,"Fusion style orbit",!1,function(t){t?e.loadExtension("Autodesk.Viewing.FusionOrbit",null):e.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(t,"First person walk",!1,function(t){t?(e.unloadExtension("Autodesk.Beeline",null),e.loadExtension("Autodesk.FirstPerson",null)):(e.unloadExtension("Autodesk.FirstPerson",null),e.loadExtension("Autodesk.Beeline",null))},"useFirstPersonNavigation")),this.addCheckbox(t,"Reverse mouse zoom direction",!1,function(t){e.setReverseZoomDirection(t)},"reverseMouseZoomDir"),this.is3dMode&&this.addCheckbox(t,"Orbit past world poles",!0,function(t){e.setOrbitPastWorldPoles(t)},"orbitPastWorldPoles"),this.addCheckbox(t,"Open properties on select",!0,function(t){e.setPropertiesOnSelect(t)},"openPropertiesOnSelect"),this.addCheckbox(t,"Left handed mouse setup",!1,function(t){e.setUseLeftHandedInput(t)},"leftHandedMouseSetup")},o.prototype.refreshParentCheckbox=function(e,t){for(var i=this,n=0;n<e.length;n++){var o=i.getControl(e[n]).getValue();if(o===!1)return void i.getControl(t).setValue(!1)}i.getControl(t).setValue(!0)},o.prototype.createPerformancePanel=function(){function n(e,t){for(var i=0;i<e.length;i++)o.getControl(e[i]).setChecked(t)}var o=this,r=this.viewer,s=i.ViewerSettingTab.Performance,a=this.scrollContainer.childNodes[1],l={perfoptimizationGroup:[],visualoptimizationGroup:[]};if(this.is3dMode){this.perfOptimizationBoxId=this.addCheckbox(s,"Performance Optimization",!1,function(e){n(l.perfoptimizationGroup,e)}),this.optimizeNavigationhkBoxId=this.addCheckbox(s,"Smooth navigation",e.isMobileDevice(),function(e){r.setOptimizeNavigation(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"optimizeNavigation"),l.perfoptimizationGroup.push(this.optimizeNavigationhkBoxId),this.progressiveRenderChkBoxId=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"progressiveRendering"),l.perfoptimizationGroup.push(this.progressiveRenderChkBoxId),this.visualOptimizationBoxId=this.addCheckbox(s,"Visual Quality Optimization",!1,function(e){n(l.visualoptimizationGroup,e)}),this.antialiasingChkBoxId=this.addCheckbox(s,"Anti-aliasing",!0,function(e){r.setQualityLevel(r.prefs.ambientShadows,e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"antialiasing"),l.visualoptimizationGroup.push(this.antialiasingChkBoxId),this.ambientshadowsChkBoxId=this.addCheckbox(s,"Ambient shadows",!0,function(e){r.setQualityLevel(e,r.prefs.antialiasing),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"ambientShadows"),l.visualoptimizationGroup.push(this.ambientshadowsChkBoxId),this.groundShadowChkBoxId=this.addCheckbox(s,"Ground shadow",!0,function(e){r.setGroundShadow(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundShadow"),l.visualoptimizationGroup.push(this.groundShadowChkBoxId),this.groundReflectionChkBoxId=this.addCheckbox(s,"Ground reflection",!1,function(e){r.setGroundReflection(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundReflection"),l.visualoptimizationGroup.push(this.groundReflectionChkBoxId),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.ghosthiddenChkBoxId=this.addCheckbox(s,"Ghost hidden objects",!0,function(e){r.setGhosting(e)},"ghosting"),this.displayLinesId=this.addCheckbox(s,"Display Lines",!0,function(e){r.hideLines(!e)},"lineRendering"),this.environmentLabel=new t.OptionLabel("Environment",a.tBodies[0]),this.environmentLabel.sliderRow.classList.add("logicalgroup"),this.envMapBackgroundChkBoxId=this.addCheckbox(s,"Environment Image Visible",!0,function(e){r.setEnvMapBackground(e)},"envMapBackground");for(var c=[],u=0;u<t.LightPresets.length;u++)c.push(t.LightPresets[u].name);var h=!0,d=this.envSelect=this.addDropdown("Environment and Lighting Selection",a.tBodies[0],c,r.impl.currentLightPreset(),h,function(e){var t=d.dropdownElement.selectedIndex;r.setLightPreset(t)},"lightPreset")}this.is3dMode||(this.perfOptimizationLabel=new t.OptionLabel("Performance Optimization",a.tBodies[0]),this.perfOptimizationLabel.sliderRow.classList.add("logicalgroup"),this.progressiveRenderChkBoxId2d=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e)},"progressiveRendering"),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(s,"Switch sheet color white to black",!0,function(e){r.setSwapBlackAndWhite(e)},"swapBlackAndWhite"))},o.prototype.syncUI=function(){var e=this.viewer,t=this.getControl(this.perfOptimizationBoxId),i=this.getControl(this.visualOptimizationBoxId),n=this.getControl(this.optimizeNavigationhkBoxId),o=this.getControl(this.antialiasingChkBoxId);o&&o.setValue(e.prefs.antialiasing);var r=this.getControl(this.ambientshadowsChkBoxId);r&&r.setValue(e.prefs.ambientShadows);var s=this.getControl(this.groundShadowChkBoxId);s&&s.setValue(e.prefs.groundShadow);var a=this.getControl(this.groundReflectionChkBoxId);a&&a.setValue(e.prefs.groundReflection);var l=this.getControl(this.envMapBackgroundChkBoxId);l&&l.setValue(e.impl.isEnvMapBackground());var c=this.getControl(this.progressiveRenderChkBoxId);c&&c.setValue(e.prefs.progressiveRendering);var u=this.getControl(this.swapBlackAndWhiteChkBoxId);u&&u.setValue(e.prefs.swapBlackAndWhite);var h=this.getControl(this.ghosthiddenChkBoxId);if(h&&h.setValue(e.prefs.ghosting),this.is3dMode){var d=c.getValue(),p=n.getValue(),v=o.getValue(),g=r.getValue(),m=s.getValue(),f=a.getValue();d&&p?t.setValue(!0):t.setValue(!1),v&&g&&m&&f?i.setValue(!0):i.setValue(!1);
}},i.ViewerSettingsPanel=o}(),function(){"use strict";function e(e){t.ObjectContextMenu.call(this,e)}var t=Autodesk.Viewing.UI;e.prototype=Object.create(t.ObjectContextMenu.prototype),e.prototype.constructor=e,e.prototype.buildMenu=function(e,t){var i=this,n=[],o=this.viewer.navigation,r=this.viewer.model.is2d(),s=this.viewer.container.getBoundingClientRect(),a=e.clientX-s.left,l=e.clientY-s.top,c=i.viewer.impl.hitTest(a,l,!1);if(c&&c.dbId){var u=i.viewer.getSelection();u.indexOf(c.dbId)==-1&&i.viewer.select(c.dbId),t.hasSelected=!0,t.hasVisible=!0}return t.hasSelected&&(n.push({title:"Isolate",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.isolate(e)}}),t.hasVisible&&n.push({title:"Hide Selected",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.hide(e)}}),t.hasHidden&&n.push({title:"Show Selected",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.show(e)}})),r&&n.push({title:"Show All Layers",target:function(){i.viewer.setLayerVisible(null,!0)}}),n.push({title:"Show All Objects",target:function(){i.viewer.showAll()}}),!r&&t.hasSelected&&o.isActionEnabled("gotoview")&&n.push({title:"Focus",target:function(){var e=i.viewer.getSelection();i.viewer.fitToView(e)}}),t.hasSelected&&n.push({title:"Clear Selection",target:function(){i.viewer.clearSelection()}}),n},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=e}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){function e(){i.impl.setLightPreset(0,!0),i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}var i=this.viewer,n=new t.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);return i.setModelStructurePanel(n),i.hideLines(!1),i.setGhosting(!1),i.setQualityLevel(!1,!0),i.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),!0},e.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},t.CAM360Extension=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",t.CAM360Extension)}(),function(){"use strict";function e(e,t,n){i.ViewerModelStructurePanel.call(this,e,t,n),this.viewer=e}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),i=Autodesk.Viewing.Extensions;e.prototype=Object.create(i.ViewerModelStructurePanel.prototype),e.prototype.constructor=e,e.prototype.sortCamNodes=function(e,t){function i(e,t){function i(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function n(n){var r=i(n.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA");r?("CAM_Setup"==r?o.camSetupNodes.push(e):"CAM_Operation"==r?o.camOperationNodes.push(e):"CAM_Tool"===r?o.camToolNodes.push(e):"CAM_Stock"===r?o.camStockNodes.push(e):"CAM_Folder"==r&&o.camFolderNodes.push(e),o.camNodes.push(e)):o.camModelNodes.push(e),t()}function r(e,i,n){t()}o.viewer.getProperties(e,n,r)}function n(){r.length>0?i(r.shift(),n):t()}this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[];var o=this,r=[];e.enumNodeChildren(e.getRootId(),function(e){r.push(e)},!0),r.shift(),n()},e.prototype.setModel=function(e,t){var n=this;n.sortCamNodes(e,function(){i.ViewerModelStructurePanel.prototype.setModel.call(n,e,t),n.SetCAMNodeVisible(!1),n.setVisible(!0),n.ExpandSetupNodes(),n.resizeToContent()})},e.prototype.initialize=function(){function e(i){t.SetCAMNodeVisible(!1),t.removeEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}i.ViewerModelStructurePanel.prototype.initialize.call(this);var t=this;this.viewer.model&&this.viewer.model.isLoadDone()||t.addEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),t.addEventListener(t.viewer,Autodesk.Viewing.SHOW_EVENT,function(e){var i=e.nodeIdArray;if(i)for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(e){var i=e.nodeArray;if(i)for(var n=0;n<i.length;n++)t.HideHightlightCAMNode(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(e){var i=e.nodeIdArray;if(i)if(0==i.length)t.SetModelVisible(),t.SetCAMNodeVisible(!0);else for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])})},e.prototype.IsCAMNode=function(e){return this.camNodes.indexOf(e)!==-1},e.prototype.IsCAMSetupNode=function(e){return this.camSetupNodes.indexOf(e)!==-1},e.prototype.IsCAMStockNode=function(e){return this.camStockNodes.indexOf(e)!==-1},e.prototype.IsCAMToolNode=function(e){return this.camToolNodes.indexOf(e)!==-1},e.prototype.IsCAMOperationNode=function(e){return this.camOperationNodes.indexOf(e)!==-1},e.prototype.IsCAMFolderNode=function(e){return this.camFolderNodes.indexOf(e)!==-1},e.prototype.shouldInclude=function(e){return!this.IsCAMStockNode(e)},e.prototype.isGroupNode=function(e){return!this.IsCAMOperationNode(e)&&i.ViewerModelStructurePanel.prototype.isGroupNode.call(this,e)},e.prototype.setNodeVisibility=function(e,t){t?this.viewer.show(e):this.viewer.hide(e)},e.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var e=0;e<this.camModelNodes.length;e++)this.setNodeVisibility(this.camModelNodes[e],!0)},e.prototype.SetCAMNodeVisible=function(e){if(this.camNodes){for(var t=0;t<this.camNodes.length;t++)this.setNodeVisibility(this.camNodes[t],e);this.SetToolNodeVisible(!1)}},e.prototype.SetToolNodeVisible=function(e){if(this.camToolNodes)for(var t=0;t<this.camToolNodes.length;t++)this.setNodeVisibility(this.camToolNodes[t],e)},e.prototype.HideHightlightNode=function(e){var t=this.viewer.impl,i=this;i.instanceTree.enumNodeFragments(e,function(e){t.highlightFragment(i.model,e,!1,!0)},!0)},e.prototype.HideHightlightCAMNode=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this;o.instanceTree.enumNodeChildren(e,function(e){t?o.IsCAMStockNode(e)||o.HideHightlightNode(e):i?o.IsCAMToolNode(e)&&o.HideHightlightNode(e):n&&o.HideHightlightNode(e)},!1)},e.prototype.setCamNodeVisibility=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this;t?this.instanceTree.enumNodeChildren(e,function(e){var t=o.IsCAMStockNode(e);o.setNodeVisibility(e,t)}):i?this.instanceTree.enumNodeChildren(e,function(e){o.IsCAMToolNode(e)&&o.setNodeVisibility(e,!1)}):n&&this.instanceTree.enumNodeChildren(e,function(e){o.setNodeVisibility(e,!1)})},e.prototype.onClick=function(e,t){i.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.SetModelVisible(),this.setCamNodeVisibility(e),this.viewer.fitToView()},e.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var e=0;e<this.camSetupNodes.length;e++)this.tree.setCollapsed(this.camSetupNodes[e],!1)},t.CAMModelStructurePanel=e}(),function(){"use strict";function e(e){var t="";e<0&&(t="-",e=-e);var i=~~(e/3600),n=~~(e%3600/60),o=e%60,r=t;return i>0&&(r+=i+":"+(n<10?"0":"")),r+=n+":"+(o<10?"0":""),r+=o.toFixed(2)}var t=Autodesk.Viewing,i=t.UI,n=function(e,i){t.Extension.call(this,e,i),this.viewer=e,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.prevAnimationTime=-1};n.prototype=Object.create(t.Extension.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),e.model&&e.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),e.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},n.prototype.unload=function(){var e=this.viewer;if(this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),e.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var i=e.getToolbar(!1);i&&i.getControl(t.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return e.removeEventListener(t.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.removeEventListener(t.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.removeEventListener(t.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.removeEventListener(t.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(e.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},n.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var e=this.viewer,t=e.impl.keyFrameAnimator;t&&(this.prevAnimationTime>0&&(t.goto(this.prevAnimationTime),this.prevAnimationTime=-1),t.play(0,this.onPlayCallbackBinded),this.updatePlayButton(t.isPaused),e.toolbar&&e.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},n.prototype.pause=function(){if(!this.isPaused()){var e=this.viewer.impl.keyFrameAnimator;e&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.isPlaying=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&(e.isPlaying&&!e.isPaused)},n.prototype.isPaused=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&e.isPaused},n.prototype.rewind=function(){this.setTimelineValue(0)},n.prototype.setTimelineValue=function(e){var t=this.viewer.impl.keyFrameAnimator;if(t){e=Math.min(Math.max(0,e),1);var i=e*t.duration;t.goto(i),this.updateUI()}},n.prototype.prevKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.prev(),this.updateUI())},n.prototype.nextKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.next(),this.updateUI())},n.prototype.getDuration=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.duration:0},n.prototype.getDurationLabel=function(){return e(this.getDuration())},n.prototype.getCurrentTime=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.currentTime:0},n.prototype.getCurrentTimeLabel=function(){return e(this.getCurrentTime())},n.prototype.onAnimationReady=function(){var e=this.viewer;this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),e.impl.keyFrameAnimator&&(e.toolbar&&e.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),e.addEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},n.prototype.updateUI=function(){var t=this.viewer.impl.keyFrameAnimator;this.animTools&&t&&(this.animTools.input.value=t.duration>0?t.currentTime/t.duration*100:0,this.animTools.lapse.value=e(t.currentTime),this.animTools.lapseLeft.value=e(t.currentTime-t.duration),this.updatePlayButton(t.isPaused),this.updateToolbarBackground())},n.prototype.onPlayCallback=function(t){if(this.animTools){var i=this.viewer.impl.keyFrameAnimator;this.animTools.input.value=t,this.animTools.lapse.value=e(i.currentTime),this.animTools.lapseLeft.value=e(i.currentTime-i.duration),t>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},n.prototype.updatePlayButton=function(e){this.playButton&&(e?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play")):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause")))},n.prototype.resetExplode=function(e,t){var i=this.viewer;i.model.is2d()||0===i.getExplodeScale()||(t&&i.explodeSlider&&(i.explodeSlider.value=e),i.explode(e))},n.prototype.adjustToolbarPosition=function(){var e=this.viewer;if(e.toolbar){var t=e.toolbar.getDimensions().width,i=e.container.getBoundingClientRect().width;t>i&&(t=e.modelTools.getDimensions().width);var n=t-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12;this.animTools.input.style.width=n+"px",this.toolbar.container.style.left="calc(50% - "+t/2+"px)"}},n.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},n.prototype.updateToolbarBackground=function(){if(this.animTools){var e=this.animTools.input,t=e.value,i="#ffffff",n="#393939";e.style.background="-webkit-linear-gradient(left,"+i+" "+t+"%, "+n+" "+t+"%)",e.style.background="-moz-linear-gradient(left,"+i+" "+t+"%, "+n+" "+t+"%)",e.style.background="-ms-linear-gradient(left,"+i+" "+t+"%, "+n+" "+t+"%)",e.style.background="-o-linear-gradient(left,"+i+" "+t+"%, "+n+" "+t+"%)",e.style.background="linear-gradient(to right,"+i+" "+t+"%, "+n+" "+t+"%)"}},n.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var e=this.viewer.impl.keyFrameAnimator;if(!e)return;e.isPlaying&&!e.isPaused&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(t.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},n.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},n.prototype.onExplode=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(0!==e.currentTime&&(this.prevAnimationTime=e.currentTime,e.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},n.prototype.onToolbarCreated=function(){var n=this.viewer,o=this;this.onToolbarCreatedBinded&&(n.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new i.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),n.container.appendChild(this.toolbar.container),this.animTools=new i.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new i.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){o.isPaused()?o.play():o.pause()},n.modelTools.addControl(this.playButton),n.modelTools.resetModelButton&&(n.modelTools.resetModelButton.onClick=function(t){n.showAll();var i=n.impl.keyFrameAnimator;i&&(i.goto(0),s.value=0,r.value=e(0),l.value=e(-i.duration),o.updatePlayButton(!0)),o.resetExplode(0,!0),o.updateToolbarBackground()}),this.animTools.backwardButton=new i.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(e){var t=n.impl.keyFrameAnimator;void 0!==t&&t&&(t.prev(),o.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new i.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(e){var t=n.impl.keyFrameAnimator;void 0!==t&&t&&(t.next(),o.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new i.Control("toolbar-animationTimeLapse");var r=this.animTools.lapse=document.createElement("input");r.type="text",r.value="0",r.className="animationTimeLapse",r.disabled=!0,this.animTools.timeText.container.appendChild(r),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new i.Control("toolbar-animationTimeline");var s=this.animTools.input=document.createElement("input");s.type="range",s.value="0",s.className="animationTimeline",this.animTools.timeline.container.appendChild(s),s.addEventListener("input",function(t){var i=n.impl.keyFrameAnimator;if(void 0!==i&&i){var a=s.value*i.duration/100;r.value=e(a),l.value=e(a-i.duration),i.goto(a),o.updatePlayButton(i.isPaused),o.updateToolbarBackground()}});var a=document.createElement("div");a.className="adsk-control-tooltip",a.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(a),s.addEventListener("mouseover",function(e){e.target===s&&(a.style.visibility="visible")}),s.addEventListener("mouseout",function(e){e.target===s&&(a.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new i.Control("toolbar-animationRemainingTime");var l=this.animTools.lapseLeft=document.createElement("input");l.type="text",l.value="0",l.className="animationTimeLapse",l.disabled=!0,this.animTools.timeLeftText.container.appendChild(l),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new i.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){o.hideAnimateToolbar()},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=n,t.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",n)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),Autodesk.Viewing.Extensions.Oculus.StereoRenderContext=function(e){function t(e){w=e.hResolution/(2*e.vResolution);var t=-1-4*(e.hScreenSize/4-e.lensSeparationDistance/2)/e.hScreenSize;A=e.distortionK[0]+e.distortionK[1]*Math.pow(t,2)+e.distortionK[2]*Math.pow(t,4)+e.distortionK[3]*Math.pow(t,6),T=THREE.Math.radToDeg(2*Math.atan2(e.vScreenSize*A,2*e.eyeToScreenDistance)),y=4*(e.hScreenSize/4-e.interpupillaryDistance/2)/e.hScreenSize;var i=4*(e.hScreenSize/4-e.lensSeparationDistance/2)/e.hScreenSize;f.lensCenter=new THREE.Vector2(i,0),E.lensCenter=new THREE.Vector2(-i,0)}function i(e){n.aspect=o.aspect=w,n.fov=o.fov=T;var t=1/r.getUnitScale(),i=e.target.clone().sub(e.position).cross(e.up).normalize();i.multiplyScalar(1*m.interpupillaryDistance*t),o.position.add(i),o.target.add(i),n.toPerspective(),o.toPerspective(),o.projectionMatrix.elements[12]-=2*y}var n,o,r,s,a,l,c,u,h,d,p,v,g=!e||e.useWarp,m=e&&e.HMD?e.HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.0635,lensSeparationDistance:.0635,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},f={},E={},A=1,y=0,T=100,w=1;this.init=function(e,i,n){if(init_WarpShader(),a=e,l=i,c=n,u=a.getPixelRatio(),t(m),r=new RenderContext,s=new RenderContext,r.setAOEnabled(!1),s.setAOEnabled(!1),r.settings.antialias=s.settings.antialias=!1,r.settings.customPresentPass=s.settings.customPresentPass=g,r.init(a,l/2*A/u,c*A/u),s.init(a,c/2*A/u,c*A/u),this.settings=r.settings,g){h=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader),d=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader);for(var o=[h,d],p=0;p<2;p++)o[p].material.blending=THREE.NoBlending,o[p].material.depthWrite=!1,o[p].material.depthTest=!1,o[p].uniforms.hmdWarpParam.value.set(m.distortionK[0],m.distortionK[1],m.distortionK[2],m.distortionK[3]),o[p].uniforms.chromAbParam.value.set(m.chromaAbParameter[0],m.chromaAbParameter[1],m.chromaAbParameter[2],m.chromaAbParameter[3]),o[p].uniforms.scaleIn.value.set(1,1/w),o[p].uniforms.scale.value.set(1/A,1*w/A);o[0].uniforms.lensCenter.value.copy(f.lensCenter),o[1].uniforms.lensCenter.value.copy(E.lensCenter)}},this.revertCameraChanges=function(e){return console.log("REVERT Camera to normal"),n.fov=p,n.aspect=v,n},this.saveCameraState=function(e){console.log(e),p=e.fov,v=e.aspect},this.update=function(e){var t=r.update(e),i=s.update(e);return t||i},this.beginScene=function(e,t,a,l){n=t,o=t.clone(),i(t),r.beginScene(e,n,a,l),s.beginScene(e,o,a,l)},this.renderScenePart=function(e,t,i,n){r.renderScenePart(e,t,i,n),s.renderScenePart(e,t,i,n)},this.sceneDirty=function(e,t){r.sceneDirty(e,t),s.sceneDirty(e,t)},this.endScene=function(){r.endScene(),s.endScene()},this.clearAllOverlays=function(){r.clearAllOverlays(),s.clearAllOverlays()},this.renderOverlays=function(e){r.renderOverlays(e),s.renderOverlays(e)},this.composeFinalFrame=function(e){r.composeFinalFrame(e,!0),s.composeFinalFrame(e,!0),a.setViewport(0,0,l/2,c),r.presentBuffer(h),a.setViewport(l/2,0,l/2,c),s.presentBuffer(d),a.setViewport(0,0,l,c)},this.cleanup=function(){r.cleanup(),s.cleanup()},this.setSize=function(e,t,i){l=e,c=t,r.setSize(l/2*A/u,c*A/u,i),s.setSize(l/2*A/u,c*A/u,i),a.setSize(e,t)},this.getMaxAnisotropy=function(){return r.getMaxAnisotropy()},this.hasMRT=function(){return r.hasMRT()},this.initPostPipeline=function(e,t,i){e=!1,t=!1,i=!1,r.initPostPipeline(e,t,i),s.initPostPipeline(e,t,i)},this.setClearColors=function(e,t){r.setClearColors(e,t),s.setClearColors(e,t)},this.setAOOptions=function(e,t){r.setAOOptions(e,t),s.setAOOptions(e,t)},this.getAOEnabled=function(){r.getAOEnabled()},this.getAORadius=function(){return r.getAORadius()},this.getAOIntensity=function(){return r.getAOIntensity()},this.setTonemapExposureBias=function(e){r.setTonemapExposureBias(e),s.setTonemapExposureBias(e)},this.getExposureBias=function(){return r.getExposureBias()},this.setTonemapMethod=function(e){r.setTonemapMethod(e),s.setTonemapMethod(e)},this.getToneMapMethod=function(){return r.getToneMapMethod()},this.toggleTwoSided=function(e){r.toggleTwoSided(e),s.toggleTwoSided(e)},this.enter2DMode=function(e){r.enter2DMode(e),s.enter2DMode(e)},this.idAtPixel=function(e,t){return console.warn("idAtPixel not implemented in stereo context."),0},this.overlayUpdate=function(e){r.overlayUpdate(e),s.overlayUpdate(e)},this.rolloverObjectViewport=function(e,t){},this.screenCapture=function(){return console.warn("Screen capture not implemented by stereo render context"),null},this.setUnitScale=function(e){r.setUnitScale(e),s.setUnitScale(e)},this.getUnitScale=function(){return r.getUnitScale()}},AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),function(){function e(e){function t(){p.copy(n.matrixWorld),p.elements[12]=0,p.elements[13]=0,p.elements[14]=0,o&&d.set(o[1],o[2],o[3])}function i(){var e=new WebSocket("ws://localhost:8888/ws");e.onopen=function(){console.log("### Oculus Connected ####")},e.onmessage=function(e){var t=e.data;try{o=JSON.parse(t)}catch(e){console.log(t)}},e.onclose=function(){console.log("### Oculus Connection Closed ####")},r=e}var n,o,r,s=e,l=new THREE.Vector3(0,0,0),c=new THREE.Quaternion,u=new THREE.Quaternion,h=new THREE.Matrix4,d=new THREE.Vector3(0,0,0),p=new THREE.Matrix4,v=new THREE.Matrix4,g=0,m=1,f=10,E=.001,A=-1,y=0,T=0,w=0,b=0,C=0,S=0,k=0;a?o=[0,0,0,0,0,0,0,0]:i(),this.getNames=function(){return["headtracker"]},this.getName=function(){return"headtracker"};var x;this.activate=function(e){if(n=s.navigation.getCamera(),t(),s.model){m=1/s.model.getUnitScale();var i=s.model.getBoundingBox();f=1e-4*i.size().length()}(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(x=new Autodesk.Viewing.Extensions.GamepadModule(s),x.activate(this.getName()))},this.deactivate=function(e){n=null,x&&x.deactivate()},this.update=function(t){A<0&&(A=t);var i=t-A;if(n.isPerspective||e.navigation.toPerspective(),a){var s=a.getState();o[0]=g+1,s.orientation&&(o[4]=s.orientation.x,o[5]=s.orientation.y,o[6]=s.orientation.z,o[7]=s.orientation.w),s.position&&(o[1]=s.position.x,o[2]=s.position.y,o[3]=s.position.z)}if(o){var M=o[0];if(M>g){n.position.sub(l),l.set(o[1],o[2],o[3]),l.sub(d),l.multiplyScalar(m),l.applyMatrix4(p),n.position.add(l),y+=(S-k)*i*E,u.setFromAxisAngle(n.worldup,y),c.set(o[4],o[5],o[6],o[7]),u.multiply(c),v.makeRotationFromQuaternion(u),h.multiplyMatrices(p,v);var R=h.elements,P=new THREE.Vector3(-R[8],-R[9],-R[10]),V=n.target.clone().sub(n.position).length();n.up.set(R[4],R[5],R[6]);var I=new THREE.Vector3(R[0],R[1],R[2]),N=P.clone().multiplyScalar((T-b)*i*f);n.position.add(N);var D=I.multiplyScalar((C-w)*i*f);n.position.add(D),n.target.set(n.position.x,n.position.y,n.position.z),n.target.add(P.multiplyScalar(V))}g=M}return r&&1===r.readyState&&r.send("get\n"),x&&(n=x.update(n)),A=t,!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){var i=!1;switch(t){case 38:case 87:T=1,i=!0;break;case 40:case 83:b=1,i=!0;break;case 37:case 65:w=1,i=!0;break;case 39:case 68:C=1,i=!0;break;case 81:S=1,i=!0;break;case 69:k=1,i=!0}return i},this.handleKeyUp=function(e,i){var n=!1;switch(i){case 38:case 87:T=0,n=!0;break;case 40:case 83:b=0,n=!0;break;case 37:case 65:w=0,n=!0;break;case 39:case 68:C=0,n=!0;break;case 81:S=0,n=!0;break;case 69:k=0,n=!0;break;case 32:t(),n=!0}return n},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e,t){return!1},this.handleTouchChange=function(e,t){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=t.UI,r=i.Oculus,s=null,a=null;r.Oculus=function(e,i){t.Extension.call(this,e,i),this.viewer=e,this.context=null,this.initialized=!1},r.Oculus.prototype=Object.create(t.Extension.prototype),r.Oculus.prototype.constructor=i.Oculus,r.Oculus.prototype.toggleOculus=function(i){var n=this.viewer;i?this.context||(this.context=new r.StereoRenderContext({useWarp:!s}),this.context.saveCameraState(this.viewer.navigation.getCamera()),n.impl.setUserRenderContext(this.context),n.resize(n.canvas.clientWidth,n.canvas.clientHeight),n.displayViewCube(!1,!1),n.navigation.isPerspective||n.navigation.toPerspective(),s?t.launchFullscreen(n.impl.canvas,{vrDisplay:s}):t.launchFullscreen(n.impl.canvas),this.headTracker||(this.headTracker=new e(n),n.toolController.registerTool(this.headTracker)),n.toolController.activateTool("headtracker")):this.context&&(this.viewer.navigation.setCamera(this.context.revertCameraChanges()),this.context=null,n.impl.setUserRenderContext(null),n.displayViewCube(n.prefs.get("viewCube"),!1),n.toolController.deactivateTool("headtracker"),t.exitFullscreen())},r.Oculus.prototype.createUI=function(){var e=this,t=this.viewer;this.oculusButton=new o.Button("toolbar-oculusTool"),this.oculusButton.setToolTip("Oculus VR Mode"),this.oculusButton.setIcon("oculusIcon"),this.oculusButton.onClick=function(t){e.toggleOculus(!e.context)},t.modelTools.addControl(this.oculusButton)},r.Oculus.prototype.load=function(){function e(i){r.removeEventListener(t.TOOLBAR_CREATED_EVENT,e),l.createUI()}function i(){r.modelTools&&r.modelTools.getNumberOfControls()>0?l.createUI():r.addEventListener(t.TOOLBAR_CREATED_EVENT,e)}function o(e){for(var t=0;t<e.length;++t)if(e[t]instanceof HMDVRDevice){s=e[t];break}if(s){for(var t=0;t<e.length;++t)if(e[t]instanceof PositionSensorVRDevice&&e[t].hardwareUnitId==s.hardwareUnitId){a=e[t];break}s&&a?i():n.logger.warn("Didn't find a HMD and sensor!"),l.initialized=!0}}var r=this.viewer,l=this;return navigator.getVRDevices?navigator.getVRDevices().then(o):navigator.mozGetVRDevices?navigator.mozGetVRDevices(o):this.initialized=!0,!0},r.Oculus.prototype.unload=function(){return this.toggleOculus(!1),!0},t.theExtensionManager.registerExtension("Autodesk.Viewing.Oculus",r.Oculus)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Private,i=e.Extensions,n=i.Collaboration;n.InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},n.ViewTransceiver=function(i){function n(e){g=!0;var t=JSON.parse(e.data.msg);w.restoreState(t),v.impl.invalidate(!0,!1,!0),g=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg;t[1]===!0||f||(t[0]!=d&&(d=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),m=!1,v.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),v.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(m||f){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z];r(n),n.unshift(f),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),d!=n[0]&&(d=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:d}}))}}function l(e,t,i){e&&!y&&(y=document.createElement("div"),y.classList.add("collabPointer")),e&&!T?(v.container.appendChild(y),T=!0):!e&&T&&(v.container.removeChild(y),T=!1),e&&(y.style.left=t-6+"px",y.style.top=i-6+"px")}function c(e){if(!m&&!f){var t=e.data.msg;A.origin.set(t[1],t[2],t[3]),A.direction.set(t[4],t[5],t[6]);var i=A.at(v.getCamera().near);i.project(v.getCamera()),i=v.impl.viewportToClient(i.x,i.y),l(!0,i.x,i.y)}}function u(e){if(m){var t=v.impl.clientToViewport(e.canvasX,e.canvasY);v.impl.viewportToRay(t,A);var n=[A.origin.x,A.origin.y,A.origin.z,A.direction.x,A.direction.y,A.direction.z];r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function h(e){if(!g){var t=w.getState(b);i.sendMessage("state",JSON.stringify(t),p.channelId)}}var d,p=this,v=this.viewer=null,g=!1,m=!1,f=!1,E=this.client=i,A=new THREE.Ray,y=null,T=!1;this.channelId=null;var w,b={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){m=!0,l(!1)},this.updatePointer=function(e){u(e)},this.connectCamera=function(e){f=!e},this.attach=function(i){v&&this.detach(),this.viewer=v=i,w=new t.ViewerState(v),E.addEventListener("cameraChange",s),
E.addEventListener("pointerMove",c),E.addEventListener("viewerState",n),v.hasEventListener(e.CAMERA_CHANGE_EVENT,a)||v.addEventListener(e.CAMERA_CHANGE_EVENT,a),v.hasEventListener(e.SELECTION_CHANGED_EVENT,h)||(v.addEventListener(e.SELECTION_CHANGED_EVENT,h),v.addEventListener(e.ISOLATE_EVENT,h),v.addEventListener(e.HIDE_EVENT,h),v.addEventListener(e.SHOW_EVENT,h),v.addEventListener(e.EXPLODE_CHANGE_EVENT,h),v.addEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,h),v.addEventListener(e.CUTPLANES_CHANGE_EVENT,h))},this.detach=function(){E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),v&&(v.removeEventListener(e.CAMERA_CHANGE_EVENT,a),v.removeEventListener(e.SELECTION_CHANGED_EVENT,h),v.removeEventListener(e.ISOLATE_EVENT,h),v.removeEventListener(e.HIDE_EVENT,h),v.removeEventListener(e.SHOW_EVENT,h),v.removeEventListener(e.EXPLODE_CHANGE_EVENT,h),v.removeEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,h),v.removeEventListener(e.CUTPLANES_CHANGE_EVENT,h),this.viewer=v=null,w=null)}},n.ViewTransceiver.prototype.constructor=n.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(n.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Extensions,i=e.Private,n=e.UI,o=t.Collaboration;t.Collaboration.Collaboration=function(t,i){e.Extension.call(this,t,i),i&&i.rtc&&i.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},t.Collaboration.Collaboration.prototype=Object.create(e.Extension.prototype),t.Collaboration.Collaboration.prototype.constructor=t.Collaboration.Collaboration,t.Collaboration.Collaboration.prototype.initNetwork=function(e){this.p2p&&!e||(this.viewtx=new o.ViewTransceiver(this.client),this.interceptor=new o.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new i.P2PClient(this.client))},t.Collaboration.Collaboration.prototype.createUI=function(){var e=this,r=this.viewer;if(this.initNetwork(!1),this.panel=new o.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),t.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new n.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(t){var i=e.panel.isVisible();if(!document.getElementById("collabBox"))if(i||e.inviteDivInstantiated)e.panel.setVisible(!1,!0),e.panel.reset();else{var n=new o.CollabPromptBox,s=r.container;n.start(s,function(){e.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(t){if(t){if(r.model){var o=r.model.getData();e.viewtx.channelId=o.basePath,e.viewtx.attach(r),e.client.connect(e.viewtx.channelId),e.client.join(e.viewtx.channelId)}r.toolController.activateTool(e.interceptor.getName());e.collabButton.setState(n.Button.State.ACTIVE),i.logger.track({category:"viewer_rtc_start"})}else i.logger&&e.client.isConnected()&&i.logger.track({category:"viewer_rtc_stop"}),e.p2p.hangup(),e.viewtx.detach(r),e.viewtx.channelId=null,e.client.disconnect(),e.panel.reset(),r.toolController.deactivateTool(e.interceptor.getName()),e.collabButton.setState(n.Button.State.INACTIVE)}),r.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var s=new CollabPromptBox,a=r.container;s.start(a,function(){e.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},t.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},t.Collaboration.Collaboration.prototype.load=function(){function e(){function e(i){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),n.createUI()}n.client=i.MessageClient.GetInstance(n.options?n.options.messageServerURL:void 0),n.socketErrorHandler=function(e){i.ErrorHandler.reportError(t.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,e.data),n.close()},n.client.addEventListener("socketError",n.socketErrorHandler),n.presenceChannelId=window.location.host,n.client.isConnected(),t.modelTools?n.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e)}var t=this.viewer,n=this;return i.loadDependency("lmv_io","socket.io-1.3.5.js",e),!0},t.Collaboration.Collaboration.prototype.unload=function(){var e=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(e),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),e.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,e.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},e.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",t.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){function e(e,i,n,o){this.viewer=e,this.client=i,this.p2p=n,this.viewtx=o;var r="CollabPanel";t.UI.DockingPanel.call(this,e.container,r,"Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","dockingPanelScroll"),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style.float="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(t){var i=new CollabPromptBox,n=e.container;i.start(n,function(){var e=Autodesk.Viewing.i18n.translate("Please Join My Live Review");document.location.href="mailto:?subject="+e},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("dockingPanelScroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0;var s=this;this.addEventListener(i,"userListChange",function(e){if(!e.channelId||e.channelId===s.viewtx.channelId){var t=s.client.getChannelInfo(s.viewtx.channelId);t&&s.updateUsers(t.users)}}),this.addEventListener(this.viewtx,"controlChange",function(e){e.channelId===s.viewtx.channelId&&s.updateUserInControl(e.data.lastInControl)}),this.addEventListener(i,"chatReceived",function(e){e.channelId===s.viewtx.channelId&&s.updateChatHistory(e)}),this.textInput.onkeyup=function(e){s.handleChatInput(e)},this.addEventListener(this.p2p,"remoteStreamAdded",function(e){s.videoPanel||s.createVideoPanel(),s.remoteVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"localStreamAdded",function(e){s.videoPanel||s.createVideoPanel(),s.localVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"remoteHangup",function(e){s.removeVideoPanel()})}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=(t.UI,i.Collaboration);Autodesk.Viewing.startLiveReviewSession=function(){o.Panel&&o.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){o.Panel&&o.Panel.endSession()};e.prototype=Object.create(t.UI.DockingPanel.prototype),e.prototype.constructor=e,e.prototype.startSession=function(){var e=this,t=this.isVisible();if(!t){var i=new CollabPromptBox,n=this.viewer.container;i.start(n,function(){e.setVisible(!0,!0)},"Start a Live Review","Start Review")}},e.prototype.endSession=function(){var e=this.isVisible();e&&(this.setVisible(!1,!0),this.reset())},e.prototype.updateUsers=function(e){for(var t=document.createElement("tbody"),i=0;i<e.length;i++){var n=t.insertRow(-1);n.id=e[i].id;var o=n.insertCell(0);o.style.width="14px",o.style.cursor="default";var r=document.createElement("div");r.classList.add("statusBase"),r.classList.add("statusNormal"),r.innerHTML="&#9679",o.appendChild(r);var s=n.insertCell(1);s.textContent=e[i].name}this.table.replaceChild(t,this.tbody),this.tbody=t,this.fixComponentPlacement()},e.prototype.updateUserInControl=function(e){for(var t=0;t<this.tbody.rows.length;t++){var i=this.tbody.rows[t],n=i.cells[0].childNodes[0];i.id==e?(n.classList.remove("statusNormal"),n.classList.add("statusInControl"),n.innerHTML="&#9784",i.cells[1].style.color="#4CBA36"):(n.classList.remove("statusInControl"),n.classList.add("statusNormal"),n.innerHTML="&#9679",i.cells[1].style.color="#ffffff")}},e.prototype.updateChatHistory=function(e){var t=this.client.getUserById(e.data.from,e.channelId);if("/"!=e.data.msg.charAt(0)){if(this.chatHistory.lastUser!=t.name){var i=document.createElement("p"),n=document.createElement("div");n.classList.add("heading"),n.style.float="left",n.style.fontStyle="normal",n.style.color="#857E7E",n.textContent=t.name,i.appendChild(n);var o=document.createElement("div");o.classList.add("heading"),o.style.textAlign="right",o.style.fontStyle="normal",o.style.color="#857E7E",o.textContent=(new Date).toLocaleTimeString(),i.appendChild(o),this.chatHistory.appendChild(i),this.chatHistory.lastUser=t.name}else{var r=document.createElement("br");this.chatHistory.appendChild(r)}var s=document.createElement("span");s.classList.add("messageText"),s.textContent=e.data.msg,this.chatHistory.appendChild(s),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},e.prototype.handleChatInput=function(e){13==e.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},e.prototype.fixComponentPlacement=function(e){var t=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel?(t+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+t+"px)"):this.chatHistory.style.height="calc(100% - "+t+"px)"},e.prototype.createVideoPanel=function(e){this.videoPanel=document.createElement("div"),this.videoPanel.classList.add("videoPanel"),this.localVideo=document.createElement("video"),this.localVideo.autoplay=!0,this.localVideo.muted=!0,this.localVideo.classList.add("videoInset"),this.videoPanel.appendChild(this.localVideo),this.remoteVideo=document.createElement("video"),this.remoteVideo.autoplay=!0,this.remoteVideo.classList.add("videoMain"),this.videoPanel.appendChild(this.remoteVideo);var t=this,i=document.createElement("div");i.classList.add("dockingPanelClose"),i.innerHTML="&times",i.title=Autodesk.Viewing.i18n.translate("End video call"),i.onclick=function(e){t.p2p.hangup(),t.removeVideoPanel()},this.videoPanel.appendChild(i),this.content.insertBefore(this.videoPanel,this.chatHistory),this.fixComponentPlacement()},e.prototype.removeCollabPrompt=function(){var e=document.getElementById("collabBox");e&&(e.style.visibility="hidden",this.viewer.container.removeChild(e))},e.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},e.prototype.reset=function(e){if(this.tbody){var t=document.createElement("tbody");this.table.replaceChild(t,this.tbody),this.tbody=t}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(e,t,i,o,r){if(e&&!document.getElementById("collabBox")){var s=document.createElement("div");s.id="collabBox",s.className="collabBox",e.appendChild(s);var a=document.createElement("div");a.className="collabBoxTitle",a.textContent=Autodesk.Viewing.i18n.translate(i,{defaultValue:i}),s.appendChild(a);var l=document.createElement("span");l.className="collabBoxText";var c="Enter your name";r&&(c="Review URL"),l.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),s.appendChild(l);var u=document.createElement("span");u.className="collabBoxInputContainer",s.appendChild(u);var h=document.createElement("input");if(h.type="text",h.className="collabBoxInputText",r){var d=window.location.toString();d+=d.indexOf("?")==-1?"?invited=true":"&invited=true",Autodesk.Viewing.Private.docItemId&&(d+="&itemid="+Autodesk.Viewing.Private.docItemId),d+="&doNotRedirect=true",h.value=d}u.appendChild(h),h.onkeyup=function(i){13==i.keyCode&&(s.style.visibility="hidden",e.removeChild(s),n.setUserName(h.value),t())};var p=document.createElement("div");if(p.className="collabBoxClose",p.innerHTML="&times;",p.addEventListener("click",function(t){s.style.visibility="hidden",e.removeChild(s)}),s.appendChild(p),r){var l=document.createElement("span");l.className="collabBoxText",l.style.marginTop="0px";var c="Copy and send this URL to invite others";l.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),s.appendChild(l)}else{var v=document.createElement("div");v.className="collabBoxOK",v.textContent=Autodesk.Viewing.i18n.translate(o,{defaultValue:o}),v.addEventListener("click",function(i){s.style.visibility="hidden",e.removeChild(s),""!==h.value.trim()&&n.setUserName(h.value),t()}),s.appendChild(v)}s.style.visibility="visible",h.focus(),r&&h.select()}},o.DockingCollabPanel=e,o.CollabPromptBox=CollabPromptBox}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension,Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){function e(){return r=n.getActiveNavigationTool(),n.setActiveNavigationTool(i.tool.getName()),!0}function t(){return n.setActiveNavigationTool(r?r:n.defaultNavigationToolName),!0}var i=this,n=this.viewer,o=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(n.impl,n),n.toolController.registerTool(this.tool),this.createUI();var r;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";var s=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:e,onRelease:t}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,s),this.onToolChanged=function(e){if(e.toolName.indexOf("beeline")!==-1&&i.beelineButton){var t=e.active?o.Button.State.ACTIVE:o.Button.State.INACTIVE;i.beelineButton.setState(t)}},n.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(){var e=this.viewer;if(e.getToolbar&&e.getSettingsPanel){var t=e.getToolbar(!0),i=Autodesk.Viewing.UI,n=t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),o="toolbar-beelineTool",r=new i.Button(o);r.setToolTip("Walk to"),r.setIcon("adsk-icon-walk"),r.onClick=function(t){var n=r.getState();n===i.Button.State.INACTIVE?e.setActiveNavigationTool("beeline"):n===i.Button.State.ACTIVE&&e.setActiveNavigationTool()},this.beelineButton=r;var s=n.getControl("toolbar-cameraSubmenuTool");s?n.addControl(this.beelineButton,{index:n.indexOf(s.getId())}):n.addControl(this.beelineButton);var a=this,l=function(){e.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,l);var t=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,i=e.getSettingsPanel(!0);a.viewerOption_LookHorId=i.addCheckbox(t,"Reverse horizontal look direction",!1,function(t){e.setReverseHorizontalLookDirection(t)},"reverseHorizontalLookDirection"),a.viewerOption_LookVertId=i.addCheckbox(t,"Reverse vertical look direction",!1,function(t){e.setReverseVerticalLookDirection(t)},"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?l():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,l)}},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.beelineButton){var t=e.getToolbar(!1);t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId()),this.beelineButton=null}return e.getSettingsPanel&&(e.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId),e.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId)),e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(e,t){function i(){v.revertToStartState()}function n(e){var t={};t.target=e.target.clone(),t.worldup=e.worldup.clone(),t.position=e.position.clone(),t.up=e.up.clone();for(var i=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],n=0;n<i.length;n++)t[i[n]]=e[i[n]];return t}function o(e,t){var i=e.target.equals(t.target)&&e.position.equals(t.position)&&e.worldup.equals(t.worldup)&&e.up.equals(t.up);if(!i)return!1;for(var n=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],o=0;o<n.length;o++)if(e[n[o]]!==t[n[o]])return!1;return!0}function r(i){var n=new THREE.Vector3(i.x,i.y,1),o=e.hitTestViewport(n.clone(),!1);if(!o||!o.intersectPoint)return[];var r=new THREE.Raycaster,s=n.clone(),a=e.camera,l=new THREE.Vector3(s.x,s.y,1);s.z=-1,s=s.unproject(a),l=l.unproject(a),l.sub(s).normalize(),r.set(E.isPerspective?a.position:s,l);for(var c=[],u=o.fragId instanceof Array?o.fragId:[o.fragId],h=0;h<u.length;h++){var d=e.getRenderProxy(t.model,u[h]);avp.VBIntersector.meshRayCast(d,r,c)}return c.sort(function(e,t){return e.distance-t.distance}),c}function s(){E.isPerspective||(E.toPerspective(),A.activatePivot(!1)),E.getFocalLength()>u&&E.setFocalLength(u,!0)}var a={GO_TO:0,PASS_THROUGH:1,DEFAULT:0},l=1e3,c=.8,u=28,h=.7,d=0,p=1,v=this,g=t,m=t.container,f=t.autocam,E=t.navigation,A=t.utilities,y=["beeline"],T=d,w=!1,b=0,C=null,S=null,k=new THREE.Vector3,x=new THREE.Vector3,M=new THREE.Vector3,R=new THREE.Vector3,P=!1,V=new THREE.Vector3,I=new THREE.Vector3,N=null,D=null;this.getNames=function(){return y},this.getName=function(){return y[0]},this.activate=function(e){b=0,t.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,i),f.userLookSpeed=c,this.showHUDMessage(!0)},this.deactivate=function(){t.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,i),this.revertToStartState(),this.showHUDMessage(!1)},this.getCursor=function(){return w?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":b<=1?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":null},this.update=function(){var e=E.getCamera();w=!1;var i=!1;if(1===b){var o=V.clone().sub(I);if(0!==o.x||0!==o.y){w=!0,I.x+=o.x*h,I.y+=o.y*h;var r=E.getWorldUpVector().dot(E.getCameraUpVector()),s=t.prefs.reverseHorizontalLookDirection?-1:1,a=t.prefs.reverseVerticalLookDirection?-1:1;o.x*=r<0?-s:s,o.y*=a,f.sync(E.getCamera()),f.look(o),i=!0,N=n(e)}}return i},this.revertToStartState=function(){A.pivotActive(!1),T=d,P=!0},this.attemptFlight=function(e,t){if(E.isActionEnabled("walk")){var i=r(e);i.length>0&&(k=i[0].point,x=i[i.length-1].point,v.fly(l,t))}},this.fly=function(e,t){switch(A.setPivotPoint(t===a.GO_TO?k:x,!0,!0),s(),M=E.getPosition(),S=e,t){case a.GO_TO:R=M.clone().lerp(k,.8);break;case a.PASS_THROUGH:var i=2*f.camera.near,n=x.clone().sub(M).length(),o=i/n;A.setPivotPoint(M.clone().lerp(x,1+10*o),!0,!0),R=M.clone().lerp(x,1+o);break;default:return}T=p,P=!1,C=null,requestAnimationFrame(v.step)},this.step=function(e){var t=E.getCamera();if(!P){if(null===C)N=n(t),C=e;else if(!o(t,N))return void v.revertToStartState();var i=e-C,r=i<S?i/S:1,s=M.clone().lerp(R,r),a=E.getEyeVector();a.multiplyScalar(E.getPivotPoint().sub(E.getPosition()).length()/a.length()),E.setView(s,a.add(s)),N=n(t),A.activatePivot(!1),i<S?requestAnimationFrame(v.step):v.revertToStartState()}},this.handleGesture=function(e){switch(Autodesk.Viewing.Private.HudMessage.dismiss(),e.type){case"dragstart":return D="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===D&&this.handleMouseMove(e);case"dragend":return"drag"===D&&(this.handleButtonUp(e,0),D=null,!0)}return!1},this.handleButtonDown=function(e,t){return Autodesk.Viewing.Private.HudMessage.dismiss(),b+=1<<t,0===t&&(I.x=V.x=e.canvasX,I.y=V.y=e.canvasY,!0)},this.handleButtonUp=function(e,t){return b-=1<<t,0===t},this.handleSingleClick=function(e,t){if(Autodesk.Viewing.Private.HudMessage.dismiss(),0!==t)return this.revertToStartState(),!1;var i={x:e.normalizedX,y:e.normalizedY};switch(T){case d:v.attemptFlight(i,a.GO_TO);break;case p:v.revertToStartState()}return!0},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!(!e.pointers||1!==e.pointers.length)&&(v.attemptFlight({x:e.normalizedX,y:e.normalizedY},a.PASS_THROUGH),!0)},this.handleDoubleClick=function(e,t){return 0===t&&(v.attemptFlight({x:e.normalizedX,y:e.normalizedY},a.PASS_THROUGH),!0)},this.handleMouseMove=function(e){return V.x=e.canvasX,V.y=e.canvasY,1===b&&(s(),!0)},this.handleBlur=function(e){return this.revertToStartState(),!1},this.showOrthoWarningMessage=function(){var e={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."},t=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(m,e,t)},this.showFocalWarningMessage=function(){var e={msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."},t=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(m,e,t)},this.watchCamera=function(e){if(g.toolController.getActiveToolName()===y[0]||g.toolController.getActiveToolName()===y[1]){var t=E.getCamera(),i=t&&!t.isPerspective,n=E.getFocalLength()>u;i?v.showOrthoWarningMessage():n?v.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}},this.showHUDMessage=function(e){var t=E.getCamera(),i=t&&!t.isPerspective,n=E.getFocalLength()>u;e&&i?v.showOrthoWarningMessage():e&&n?v.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss(),e?g.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,v.watchCamera):g.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,v.watchCamera)}},function(){"use strict";function e(e,t,i){return function(){var o=t.getState();o===n.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(n.Button.State.ACTIVE)):o===n.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(n.Button.State.INACTIVE))}}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),i=Autodesk.Viewing,n=i.UI,o=function(e,t){i.Extension.call(this,e,t)};o.prototype=Object.create(i.Extension.prototype),o.prototype.constructor=o,o.prototype.load=function(){var e=this.viewer,t=new i.FovTool(e),n=new i.WorldUpTool(e.impl,e);return e.toolController.registerTool(t),e.toolController.registerTool(n),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},o.prototype.createUI=function(){var t=this.viewer,o=t.getToolbar(!0),r=o.getControl(i.TOOLBAR.NAVTOOLSID),s=function(e){return t.navigation.isActionEnabled(e)?"block":"none"};if(r.returnToDefault=function(){},"3d"===this.options.mode){var a=new n.ComboButton("toolbar-orbitTools");a.setToolTip("Orbit"),a.setIcon("adsk-icon-orbit-constrained"),a.setDisplay(s("orbit")),this.createOrbitSubmenu(a),r.addControl(a),r.orbittoolsbutton=a,a.setState(n.Button.State.ACTIVE),r.returnToDefault=function(){a.setState(n.Button.State.ACTIVE)}}var l=new n.Button("toolbar-panTool");l.setToolTip("Pan"),l.setIcon("adsk-icon-pan"),l.onClick=e(t,l,"pan"),l.setDisplay(s("pan")),r.addControl(l),r.panbutton=l;var c=new n.Button("toolbar-zoomTool");c.setToolTip("Zoom"),c.setIcon("adsk-icon-zoom"),c.onClick=e(t,c,"dolly"),c.setDisplay(s("zoom")),r.addControl(c),r.dollybutton=c;var u=new n.ComboButton("toolbar-cameraSubmenuTool");u.setToolTip("Camera interactions"),u.setIcon("adsk-icon-camera"),u.saveAsDefault(),this.createCameraSubmenu(u),r.addControl(u),r.camerabutton=u},o.prototype.createOrbitSubmenu=function(t){var o=this.viewer,r=o.getToolbar(!0),s=r.getControl(i.TOOLBAR.NAVTOOLSID),a=new n.Button("toolbar-freeOrbitTool");a.setToolTip("Free orbit"),a.setIcon("adsk-icon-orbit-free"),a.onClick=e(o,a,"freeorbit"),t.addControl(a),s.freeorbitbutton=a;var l=new n.Button("toolbar-orbitTool");l.setToolTip("Orbit"),l.setIcon("adsk-icon-orbit-constrained"),l.onClick=e(o,l,"orbit"),t.addControl(l),s.orbitbutton=l,t.onClick=l.onClick},o.prototype.createCameraSubmenu=function(t){var o=this,r=this.viewer,s=r.getToolbar(!0),a=s.getControl(i.TOOLBAR.NAVTOOLSID),l=function(e){return r.navigation.isActionEnabled(e)?"block":"none"};if(i.isTouchDevice()){var c=new n.Button("toolbar-homeTool");c.setToolTip("Home"),c.setIcon("adsk-icon-home"),c.onClick=function(){r.navigation.setRequestHomeView(!0);var e=r.getDefaultNavigationToolName();r.setActiveNavigationTool(e),t.restoreDefault()},c.setDisplay(l("gotoview")),t.addControl(c),a.homebutton=c}var u=new n.Button("toolbar-fitToViewTool");if(u.setToolTip("Fit to view"),u.setIcon("adsk-icon-fit-to-view"),u.onClick=function(e){r.fitToView("3d"===o.options.mode?r.getSelection():void 0);
var i=r.getDefaultNavigationToolName();r.setActiveNavigationTool(i),t.restoreDefault()},u.setDisplay(l("gotoview")),t.addControl(u),a.fovbutton=u,"3d"===this.options.mode){var h=new n.Button("toolbar-focalLengthTool");h.setToolTip("Focal length"),h.setIcon("adsk-icon-fov"),h.onClick=e(r,h,"fov"),h.setDisplay(l("fov")),t.addControl(h),a.fovbutton=h}var d=new n.Button("toolbar-rollTool");d.setToolTip("Roll"),d.setIcon("adsk-icon-roll"),d.onClick=e(r,d,"worldup"),d.setDisplay(l("roll")),t.addControl(d),a.rollbutton=d},o.prototype.initCameraStateMachine=function(e){var t=this,n=this.viewer,o=n.getToolbar(!0),r=o.getControl(i.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(e){"fov"===e.toolName&&t.showFocalLengthOverlay(e.active)},n.addEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(e){n.getDefaultNavigationToolName()===e.id&&r.returnToDefault()},n.addEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},o.prototype.initFocalLengthOverlay=function(){var e=this.focallength=document.createElement("div");e.className="focallength";var t=document.createElement("table"),i=document.createElement("tbody");t.appendChild(i),e.appendChild(t),this.viewer.container.appendChild(e);var n=i.insertRow(-1),o=n.insertCell(0);o.setAttribute("data-i18n","Focal Length"),o.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),o=n.insertCell(1),o.textContent="",o.style.width="4em",o.style.textAlign="right",this.fovCell=o,e.style.visibility="hidden"},o.prototype.showFocalLengthOverlay=function(e){function t(e){if(e){var t={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};i.Private.HudMessage.displayMessage(a.container,t)}else i.Private.HudMessage.dismiss()}function n(e){e&&o(),s.focallength&&(s.focallength.style.visibility=e?"visible":"hidden")}function o(){var e=a.getFocalLength();l!==e&&(l=e,s.fovCell.textContent=e.toString()+" mm")}function r(e){if(o(),"fov"===a.toolController.getActiveToolName()){var i=a.navigation.getCamera(),r=i&&!i.isPerspective;n(!r),t(r)}}var s=this,a=this.viewer,l=0,c=a.navigation.getCamera(),u=c&&!c.isPerspective;n(e&&!u),t(e&&u),e?a.addEventListener(i.CAMERA_CHANGE_EVENT,r):a.removeEventListener(i.CAMERA_CHANGE_EVENT,r)},o.prototype.unload=function(){return this.destroyUI(),!0},o.prototype.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1);if(!t)return!0;var o=t.getControl(i.TOOLBAR.NAVTOOLSID);return!o||("3d"===this.options.mode&&(o.orbittoolsbutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.orbittoolsbutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.orbittoolsbutton.getId()),o.orbittoolsbutton=null,o.orbitbutton.onClick=null,o.orbitbutton=null,o.freeorbitbutton.onClick=null,o.freeorbitbutton=null),o.removeControl(o.panbutton.getId()),o.panbutton.onClick=null,o.panbutton=null,o.removeControl(o.dollybutton.getId()),o.dollybutton.onClick=null,o.dollybutton=null,o.camerabutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.camerabutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.camerabutton.getId()),o.camerabutton.onClick=null,o.camerabutton=null,o.rollbutton.onClick=null,o.rollbutton=null,o.fovbutton.onClick=null,o.fovbutton=null,this.focallength=null,e.removeEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,e.removeEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},t.NavToolsExtension=o,i.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",o)}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=t.UI,n=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)};n.prototype=Object.create(Autodesk.Viewing.Extension.prototype),n.prototype.constructor=n,n.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},n.prototype.load=function(){var i=this,n=this.viewer;return this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!!n.toolController&&(this.tool=new e.MeasureTool(n,{onCloseCallback:function(e){i.enableMeasureTool(!1)}}),n.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0)},n.prototype.unload=function(){var e=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},n.prototype.isActive=function(){return this.tool.isActive()},n.prototype.setActive=function(e){return this.enableMeasureTool(e)},n.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},n.prototype.getMeasurement=function(e,t){var i=null;return this.isActive()&&(i=this.tool.getMeasurement(e,t)),i},n.prototype.getUnitOptions=function(){var e=[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}];return e},n.prototype.getPrecisionOptions=function(e){if(e)var t=["1","1/2","1/4","1/8","1/16","1/32","1/64"];else var t=["0","0.1","0.01","0.001","0.0001","0.00001"];return t},n.prototype.getDefaultUnit=function(){var e=this.viewer.model.getDisplayUnit();return e},n.prototype.enableMeasureTool=function(e){var t=this.viewer.toolController,i=this.tool.isActive();return this.viewer.impl.disableRollover(e),e&&!i?(t.activateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},n.prototype.createUI=function(){var e=this,n=this.viewer;this.measureToolButton=null;var o=n.getToolbar(!0);this.measureToolButton=new i.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(t){e.enableMeasureTool(!e.tool.isActive())},this.onMeasureButtonStateChange=function(t){t.state===i.Button.State.ACTIVE?e.enableMeasureTool(!0):t.state===i.Button.State.INACTIVE&&e.enableMeasureTool(!1)},this.measureToolButton.addEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);var r=o.getControl(t.TOOLBAR.MODELTOOLSID);r&&r.addControl(this.measureToolButton,{index:0});var s=[{keycodes:[t.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return e.enableMeasureTool(!1)}}];t.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,s)},n.prototype.destroyUI=function(){var e=this.viewer;this.measureToolButton&&this.measureToolButton.removeEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);var n=e.getToolbar(!1);if(n){var o=n.getControl(t.TOOLBAR.MODELTOOLSID);if(o){if(this.measureToolButton){var r=o.getControl("toolbar-inspectSubMenu");r?r.removeControl(this.measureToolButton.getId()):o.removeControl(this.measureToolButton.getId())}this.measureToolButton=null}}t.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},e.MeasureExtension=n,t.theExtensionManager.registerExtension("Autodesk.Measure",n)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(e,t){function i(){C.updateLabelPositions()}function n(){a.clearMeasurement()}function o(){C||(C=new s(l)),C.hide(),S&&(S.setVisible(!0),S.updatePanel(),l.model&&l.model.is2d()&&S.isolate.setVisibility(!1),A?S.disableUnitOption(0):S.disableUnitOption())}function r(){C&&(C.hide(),C.destroy()),T={},S&&(S.setVisible(!1),S.updatePanel())}function s(e){var t=this,i=!1,n=2002943,o=.7,r="MeasureTool-endPoint",s="MeasureTool-edge",c="MeasureTool-face",u="MeasureTool-angle",p="MeasureTool-angle-outline",v="MeasureTool-extensionLine",g="MeasureTool-extensionFace",T="MeasureTool-greyOutPlane",w=null,C=null,S=null,k=null,M=null,R=null,P=null,V=null,I={first:{},second:{}},N={first:{},second:{}},D={first:{},second:{}},L={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},_={},H=[];this.showFirstVertex=function(e){var t=this.setScale(e);this.showEndPoint("first",e,t)},this.showSecondVertex=function(e){var t=this.setScale(e);this.showEndPoint("second",e,t)},this.showEndPoint=function(e,t,i){w||(w=new THREE.MeshPhongMaterial({color:n,ambient:n,opacity:o,transparent:!0,depthTest:!1,depthWrite:!1}),l.impl.createOverlayScene(r));var s=I[e],a=s.mesh;if(a||(s.geometry=new THREE.SphereGeometry(1),a=s.mesh=new THREE.Mesh(s.geometry,w),l.impl.addOverlay(r,a)),a.scale.x=i,a.scale.y=i,a.scale.z=i,a.position.set(t.x,t.y,t.z),a.visible=!0,l.impl.invalidate(!1,!1,!0),m||b){var c=s.label;if(!c){c=s.label=document.createElement("div"),c.className="measure-label",l.container.appendChild(c),c.style.pointerEvents="none";var u=document.createElement("div");u.className="adsk-icon-"+e+" measure-label-icon",c.appendChild(u)}c.classList.toggle("visible",!0),s.position=t.clone(),this.updateLabelPositions()}},this.setScale=function(e){var t=5,i=l.navigation,n=i.getCamera(),o=i.getEyeVector(),r=i.getPosition(),s=e.clone(),a=n.isPerspective?s.sub(r).dot(o.normalize()):i.getEyeVector().length(),c=i.getVerticalFov(),u=2*a*Math.tan(THREE.Math.degToRad(.5*c)),h=i.getScreenViewport(),d=window.devicePixelRatio||1,p=t*u/(h.height*d);return p},this.updateScale=function(){var e=l.impl.overlayScenes[r];if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var n=t.children[i];if(n){var o=this.setScale(n.position);n.scale.x=o,n.scale.y=o,n.scale.z=o}}if(e=l.impl.overlayScenes[v])for(var t=e.scene,i=0;i<t.children.length;i++){var a=t.children[i];if(a){var c=this.setScale(a.geometry.vertices[0]);a.material.dashSize=4*c,a.material.gapSize=2*c}}if(e=l.impl.overlayScenes[s])for(var t=e.scene,i=0;i<t.children.length;i++){var u=t.children[i];u&&this.setCylinderScale(u)}if(e=l.impl.overlayScenes[p])for(var t=e.scene,i=0;i<t.children.length;i++){var u=t.children[i];u&&this.setCylinderScale(u)}for(var h in L)if(L.hasOwnProperty(h)){var d=L[h];d.line&&this.setCylinderScale(d.line)}},this.showFirstEdge=function(e,t){this.showEdge("first",e,t)},this.showSecondEdge=function(e,t){this.showEdge("second",e,t)},this.showEdge=function(e,t,i){C||(C=new THREE.MeshPhongMaterial({color:n,ambient:n,opacity:o,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),l.impl.createOverlayScene(s));var r=N[e];if(r.line&&l.impl.removeMultipleOverlays(s,r.line),r.line=this.drawEdgeAsCylinder(t,C,5,1),l.impl.addMultipleOverlays(s,r.line),m||b){var a=r.label;if(!a){a=r.label=document.createElement("div"),a.className="measure-label",l.container.appendChild(a),a.style.pointerEvents="none";var c=document.createElement("div");c.className="adsk-icon-"+e+" measure-label-icon",a.appendChild(c)}a.classList.toggle("visible",!0),r.intersectPoint=i.clone(),this.updateLabelPositions()}},this.drawEdgeAsCylinder=function(e,t,i,n){var o=[];if(1==n)for(var r=0;r<e.vertices.length;r+=2){var s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i);this.setCylinderScale(s),o.push(s)}else for(var r=0;r<e.vertices.length-1;r++){var s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i);this.setCylinderScale(s),o.push(s)}return o},this.drawLineAsCylinder=function(e,t,i){var n;return 2==e.vertices.length&&(n=this.cylinderMesh(e.vertices[0],e.vertices[1],t,i),this.setCylinderScale(n)),n},this.cylinderMesh=function(e,t,i,n){var o=(new THREE.Vector3).subVectors(t,e),r=new THREE.Matrix4;r.lookAt(e,t,(new THREE.Object3D).up),r.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var s=new THREE.CylinderGeometry(.1*n,.1*n,o.length(),8,1,!0),a=new THREE.Mesh(s,i);return a.applyMatrix(r),a.position.x=(t.x+e.x)/2,a.position.y=(t.y+e.y)/2,a.position.z=(t.z+e.z)/2,a},this.setCylinderScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.z=t},this.showFirstFace=function(e,t){this.showFace("first",e,t)},this.showSecondFace=function(e,t){this.showFace("second",e,t)},this.showFace=function(e,t,i){S||(S=new THREE.MeshPhongMaterial({color:n,ambient:n,opacity:o,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),l.impl.createOverlayScene(c));var r=D[e];if(r.mesh&&l.impl.removeOverlay(c,r.mesh),r.mesh=new THREE.Mesh(t,S),l.impl.addOverlay(c,r.mesh),m||b){var s=r.label;if(!s){s=r.label=document.createElement("div"),s.className="measure-label",l.container.appendChild(s),s.style.pointerEvents="none";var a=document.createElement("div");a.className="adsk-icon-"+e+" measure-label-icon",s.appendChild(a)}s.classList.toggle("visible",!0),r.intersectPoint=i.clone(),this.updateLabelPositions()}},this.drawExtensionFace=function(e,t,i){P||(P=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),l.impl.createOverlayScene(g));var n=new THREE.Mesh(e,P);n.position.set(t.x,t.y,t.z);var o=n.position.clone();o.add(i),n.lookAt(o),n.updateMatrixWorld(),l.impl.addOverlay(g,n)},this.drawGreyOutPlane=function(e){V||(V=new THREE.MeshPhongMaterial({color:0,ambient:0,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),l.impl.createOverlayScene(T));var t=l.model.getMetadata("page_dimensions","page_width"),i=l.model.getMetadata("page_dimensions","page_height"),n=new THREE.Shape;n.moveTo(0,0),n.lineTo(t,0),n.lineTo(t,i),n.lineTo(0,i),n.lineTo(0,0);var o=B=l.model.getClip(e),r=o.contours[0],s=new THREE.Path;s.moveTo(o.points[r[0]].x,o.points[r[0]].y);for(var a=1;a<r.length;a++)s.lineTo(o.points[r[a]].x,o.points[r[a]].y);s.lineTo(o.points[r[0]].x,o.points[r[0]].y),n.holes.push(s);var c=new THREE.ShapeGeometry(n),u=new THREE.Mesh(c,V);l.impl.addOverlay(T,u)},this.getEdgeLength=function(e){for(var t=0,i=e.clone(),n=i.vertices,o=0;o<n.length;o+=2)l.model.is2d()&&l.model.pageToModel(n[o],n[o+1],O),t+=n[o].distanceTo(n[o+1]);return t=Autodesk.Viewing.Private.convertUnits(l.model.getUnitString(),A,t),Autodesk.Viewing.Private.formatValueWithUnits(t,A,3,y)},this.getCircularArcRadius=function(e){var t=e.radius;if(t){if(l.model.is2d()){var i=e.center.clone(),n=e.vertices[0].clone();l.model.pageToModel(i,n,O),t=i.distanceTo(n)}return t=Autodesk.Viewing.Private.convertUnits(l.model.getUnitString(),A,t),Autodesk.Viewing.Private.formatValueWithUnits(t,A,3,y)}},this.getFaceArea=function(e){for(var t=0,i=e.vertices,n=new THREE.Vector3,o=new THREE.Vector3,r=0;r<i.length;r+=3)n.subVectors(i[r+1],i[r]),o.subVectors(i[r+2],i[r]),t+=n.length()*o.length()*Math.sin(n.angleTo(o))/2;return t=Autodesk.Viewing.Private.convertUnits(l.model.getUnitString(),A,t,"square"),A?Autodesk.Viewing.Private.formatValueWithUnits(t,A+"^2",3,y):Autodesk.Viewing.Private.formatValueWithUnits(t,null,3,y)},this.updateLabels=function(){f===SNAP_EDGE?N.first.label.children[0].textContent=this.getEdgeLength(h):f===SNAP_FACE&&(D.first.label.children[0].textContent=this.getFaceArea(h)),E===SNAP_EDGE?N.second.label.children[0].textContent=this.getEdgeLength(d):E===SNAP_FACE&&(D.second.label.children[0].textContent=this.getFaceArea(d))},this.updateLabelPositions=function(){function e(e,t,i){var n=l.navigation.getCamera(),o=l.navigation.getScreenViewport(),r=new THREE.Vector3(e,t,i);return r=r.project(n),{x:Math.round((r.x+1)/2*o.width)+5,y:Math.round((-r.y+1)/2*o.height)+5}}for(var t in L)if(L.hasOwnProperty(t)){var i=L[t],n=i.label;if(n){var o=e((i.p1.x+i.p2.x)/2,(i.p1.y+i.p2.y)/2,(i.p1.z+i.p2.z)/2);n.style.top=o.y+"px",n.style.left=o.x+"px",H.push(n)}}if(_&&(n=_.label)){var o=e((_.p1.x+_.p2.x)/2,(_.p1.y+_.p2.y)/2,(_.p1.z+_.p2.z)/2);n.style.top=o.y+"px",n.style.left=o.x+"px",H.push(n)}for(var t in D)if(D.hasOwnProperty(t)){var r=D[t],n=r.label,s=r.intersectPoint;if(n&&s){var o=e(s.x,s.y,s.z);n.style.top=o.y+"px",n.style.left=o.x+"px",H.push(n)}}for(var t in N)if(N.hasOwnProperty(t)){var a=N[t],n=a.label,s=a.intersectPoint;if(n&&s){var o=e(s.x,s.y,s.z);n.style.top=o.y+"px",n.style.left=o.x+"px",H.push(n)}}for(var t in I)if(I.hasOwnProperty(t)){var c=I[t],n=c.label,s=c.position;if(n&&s){var o=e(s.x,s.y,s.z);n.style.top=o.y+"px",n.style.left=o.x+"px",H.push(n)}}for(var u=0;u<H.length;u++)for(var h=0;h<u;h++)this.labelsOverlapDetection(H[h],H[u]);H=[]},this.labelsOverlapDetection=function(e,t){var i=e.getBoundingClientRect(),n=t.getBoundingClientRect();n.top<=i.bottom&&n.bottom>=i.top&&(n.right>=i.left&&n.right<=i.right?t.style.left=parseInt(t.style.left,10)-(n.right-i.left)+"px":n.left>=i.left&&n.left<=i.right?t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px":n.left<=i.left&&n.right>=i.right&&(t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px"))},this.drawLine=function(e,n,r){function s(e,n,r,s,a,c,u,h){var d=L[e],p=d.line,v=d.label,g=new THREE.Vector3(n,r,s),f=new THREE.Vector3(a,c,u);if(p&&(l.impl.removeOverlay("MeasureTool-"+e,p),d.line=null),v&&v.classList.remove("visible"),g.distanceTo(f)>=Math.pow(.1,y)&&h){var E="xyz"===e||!i&&m;p||(d.material=new THREE.MeshBasicMaterial({color:parseInt(d.color,16),depthTest:!1,depthWrite:!1}),d.overlayName="MeasureTool-"+e,l.impl.createOverlayScene(d.overlayName)),m?d.material.opacity=1:d.material.opacity=o,l.impl.clearOverlay(d.overlayName);var A=d.geometry=new THREE.Geometry;A.vertices.push(g),A.vertices.push(f);var T="xyz"===e?5:"z"===e?1:2;if(p=d.line=t.drawLineAsCylinder(A,d.material,T),l.impl.addOverlay(d.overlayName,p),p.visible=E,d.p1=g,d.p2=f,"xyz"!=e||m){if(!v){if(v=d.label=document.createElement("div"),v.className="measure-length","xyz"===e){var w=document.createElement("div");w.className="measure-length-text",v.appendChild(w)}v.style.pointerEvents="none",d.axis&&(v.className="adsk-icon-axis-"+e+" measure-label-axis measure-label-axis-"+e),l.container.appendChild(v)}d.axis||t.updateDistance(),v.classList.toggle("visible",E)}}}function a(e,t){var i=Math.pow(.1,y);return!(Math.abs(e.x-t.x)>=i&&Math.abs(e.y-t.y)<i&&Math.abs(e.z-t.z)<i||Math.abs(e.y-t.y)>=i&&Math.abs(e.x-t.x)<i&&Math.abs(e.z-t.z)<i||Math.abs(e.z-t.z)>=i&&Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i)}s("xyz",e.x,e.y,e.z,n.x,n.y,n.z,!0);var c=l.navigation.getAlignedUpVector(),u=Math.abs(c.x),h=Math.abs(c.y),d=Math.abs(c.z),p=!r&&a(e,n);d>u&&d>h?(s("x",e.x,e.y,e.z,n.x,e.y,e.z,p),s("y",n.x,e.y,e.z,n.x,n.y,e.z,p),s("z",n.x,n.y,e.z,n.x,n.y,n.z,p)):h>u&&h>d?(s("x",e.x,e.y,e.z,n.x,e.y,e.z,p),s("z",n.x,e.y,e.z,n.x,e.y,n.z,p),s("y",n.x,e.y,n.z,n.x,n.y,n.z,p)):(s("y",e.x,e.y,e.z,e.x,n.y,e.z,p),s("z",e.x,n.y,e.z,e.x,n.y,n.z,p),s("x",e.x,n.y,n.z,n.x,n.y,n.z,p)),this.updateLabelPositions()},this.updateDistance=function(){var e=L.xyz.label;e&&(e.children[0].textContent="~ "+a.getDistance("xyz"))},this.updateAngle=function(){var e=_.label;e&&(e.children[0].textContent="~ "+a.getAngle())},this.drawExtensionLine=function(e,t,i){var n,r,s,a,c=new THREE.Vector3,u=new THREE.Vector3;if(c.subVectors(t,e),u.subVectors(i,t),a=c.dot(u),c.subVectors(i,t),a=-a/c.dot(c),c.subVectors(i,t),c.multiplyScalar(a),s=c.add(t),a<0)n=t,r=s;else{if(!(a>1))return;n=i,r=s}R||(R=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),l.impl.createOverlayScene(v)),m?R.opacity=1:R.opacity=o;var h=this.setScale(n);R.dashSize=4*h,R.gapSize=2*h;var d=new THREE.Geometry;d.vertices.push(n),d.vertices.push(r),d.computeLineDistances();var p=new THREE.Line(d,R);l.impl.addOverlay(v,p)},this.drawExtensionLinePointToPoint=function(e,t){var i=e,n=t;R||(R=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),l.impl.createOverlayScene(v)),m?R.opacity=1:R.opacity=o;var r=this.setScale(i);R.dashSize=4*r,R.gapSize=2*r;var s=new THREE.Geometry;s.vertices.push(i),s.vertices.push(n),s.computeLineDistances();var a=new THREE.Line(s,R);l.impl.addOverlay(v,a)},this.nearestPointsInSegmentToSegment=function(e,t,i,n){var o=.001,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3;r.subVectors(t,e),s.subVectors(n,i),a.subVectors(e,i);var l,c,u,h,d=r.dot(r),p=r.dot(s),v=s.dot(s),g=r.dot(a),m=s.dot(a),f=d*v-p*p,E=f,A=f;return f<o?(c=0,E=1,h=m,A=v):(c=p*m-v*g,h=d*m-p*g,c<0?(c=0,h=m,A=v):c>E&&(c=E,h=m+p,A=v)),h<0?(h=0,-g<0?c=0:-g>d?c=E:(c=-g,E=d)):h>A&&(h=A,-g+p<0?c=0:-g+p>d?c=E:(c=-g+p,E=d)),l=Math.abs(c)<o?0:c/E,u=Math.abs(h)<o?0:h/A,r.multiplyScalar(l),s.multiplyScalar(u),a.add(r),a.sub(s),r.add(e),s.add(i),[r,s]},this.edgeToEdgeMeasure=function(e,t,i){var n=.01,o=x.getEndPointsInEdge(e),r=o[0].clone(),s=o[1].clone();o=x.getEndPointsInEdge(t);var a=o[0].clone(),l=o[1].clone(),c=this.nearestPointInPointToLine(r,a,l),u=this.nearestPointInPointToLine(s,a,l),h=new THREE.Vector3,d=new THREE.Vector3;if(h.subVectors(r,s),d.subVectors(a,l),h.normalize(),d.normalize(),this.isEqualVectors(h,d,n)||this.isInverseVectors(h,d,n))return r.distanceTo(i)<=s.distanceTo(i)?(this.drawLine(r,c),this.drawExtensionLine(r,a,l),[r,c]):(this.drawLine(s,u),this.drawExtensionLine(s,a,l),[s,u]);var p=this.nearestPointInPointToLine(i,r,s),v=this.angleVectorToVector(h,d);return r.distanceTo(a)<r.distanceTo(l)&&r.distanceTo(a)<s.distanceTo(a)&&r.distanceTo(a)<s.distanceTo(l)?this.drawAngleLineToLine(r,p,a,l,v):r.distanceTo(l)<r.distanceTo(a)&&r.distanceTo(l)<s.distanceTo(a)&&r.distanceTo(l)<s.distanceTo(l)?this.drawAngleLineToLine(r,p,l,a,v):s.distanceTo(a)<r.distanceTo(a)&&s.distanceTo(a)<r.distanceTo(l)&&s.distanceTo(a)<s.distanceTo(l)?this.drawAngleLineToLine(s,p,a,l,v):this.drawAngleLineToLine(s,p,l,a,v),v},this.curvedEdgeToEdgeMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=null,o=null,r=e.vertices,s=x.getEndPointsInEdge(t),a=0;a<r.length;a+=2){var l=this.nearestPointsInSegmentToSegment(r[a],r[a+1],s[0],s[1]),c=l[0].distanceTo(l[1]);c<i&&(i=c,n=l[0],o=l[1])}return this.drawLine(n,o),[n,o]},this.curvedEdgeToCurvedEdgeMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=null,o=null,r=e.vertices,s=t.vertices,a=0;a<r.length;a+=2)for(var l=0;l<s.length;l+=2){var c=this.nearestPointsInSegmentToSegment(r[a],r[a+1],s[l],s[l+1]),u=c[0].distanceTo(c[1]);u<i&&(i=u,n=c[0],o=c[1])}return this.drawLine(n,o),[n,o]},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)},this.pointToEdgeMeasure=function(e,t,i){var n=x.getEndPointsInEdge(t),o=n[0],r=n[1],s=this.nearestPointInPointToLine(e,o,r),a=this.nearestPointInPointToLine(i,o,r),l=new THREE.Vector3;return l.subVectors(a,s),l.add(e),this.drawLine(l,a),this.drawExtensionLinePointToPoint(e,l),[e,s]},this.edgeToPointMeasure=function(e,t){var i=x.getEndPointsInEdge(e),n=i[0],o=i[1],r=this.nearestPointInPointToLine(t,n,o);return this.drawLine(t,r),this.drawExtensionLine(t,n,o),[t,r]},this.curvedEdgeToVertexMeasure=function(e,t){for(var i=e.vertices,n=Number.MAX_VALUE,o=null,r=0;r<i.length;r+=2){var s=this.nearestPointInPointToSegment(t,i[r],i[r+1]),a=t.distanceTo(s);a<n&&(n=a,o=s)}return this.drawLine(t,o),[t,o]},this.faceToFaceMeasure=function(e,t,i,n){var o=.01,r=t.clone(),s=n.clone(),a=this.angleVectorToVector(t,n);if(r.x<=s.x+o&&r.x>=s.x-o&&r.y<=s.y+o&&r.y>=s.y-o&&r.z<=s.z+o&&r.z>=s.z-o||r.x<=-s.x+o&&r.x>=-s.x-o&&r.y<=-s.y+o&&r.y>=-s.y-o&&r.z<=-s.z+o&&r.z>=-s.z-o){var l=new THREE.Vector3;l.subVectors(e,i);var c=r.dot(l)/r.dot(s);l.addVectors(i,s.multiplyScalar(c));var u=2*l.distanceTo(e),h=new THREE.PlaneBufferGeometry(u,u);return this.drawExtensionFace(h,e,t),this.drawLine(i,l,!0),[i,l,a]}return a=this.drawAngleFaceToFace(e,t,i,n)},this.angleVectorToVector=function(e,t){var i=180*e.angleTo(t)/Math.PI;return i},this.intersectPlaneToPlane=function(e,t,i,n){var o=new THREE.Vector3;o.crossVectors(t,n);var r,s=o.x>=0?o.x:-o.x,a=o.y>=0?o.y:-o.y,l=o.z>=0?o.z:-o.z;r=s>a?s>l?1:3:a>l?2:3;var c,u,h=new THREE.Vector3;switch(c=-t.dot(e),u=-n.dot(i),r){case 1:h.x=0,0!==o.x?(h.y=(u*t.z-c*n.z)/o.x,h.z=(c*n.y-u*t.y)/o.x):(h.y=-(u*t.z)/(t.z*n.y),h.z=-(c*n.y)/(t.z*n.y));break;case 2:h.y=0,0!==o.y?(h.x=(c*n.z-u*t.z)/o.y,h.z=(u*t.x-c*n.x)/o.y):(h.x=-(c*n.z)/(t.x*n.z),h.z=-(u*t.x)/(t.x*n.z));break;case 3:h.z=0,0!==o.z?(h.x=(u*t.y-c*n.y)/o.z,h.y=(c*n.x-u*t.x)/o.z):(h.x=-(u*t.y)/(t.y*n.x),h.y=-(c*n.x)/(t.y*n.x))}var d=new THREE.Vector3;d.addVectors(h,o.multiplyScalar(100));var p=this.nearestPointInPointToLine(e,h,d),v=this.nearestPointInPointToLine(i,h,d);return[p,v]},this.drawAngle=function(e,t,i,n,o,r){var s=.001;k||(k=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),M=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1}),l.impl.createOverlayScene(u,k),l.impl.createOverlayScene(p,M)),l.impl.clearOverlay(u),l.impl.clearOverlay(p);var a=e.distanceTo(t),c=100,h=new THREE.CircleGeometry(a,c,0,o*Math.PI/180),d=new THREE.Mesh(h,k),v=d.geometry.vertices[0].clone();d.geometry.vertices.push(v),d.position.set(e.x,e.y,e.z);var g=d.position.clone();g.add(n),d.lookAt(g),d.updateMatrixWorld();var m=d.geometry.vertices[1].clone(),f=d.geometry.vertices[d.geometry.vertices.length-2].clone();m.applyMatrix4(d.matrixWorld),f.applyMatrix4(d.matrixWorld);var E=new THREE.Vector3,A=new THREE.Vector3,y=new THREE.Vector3,T=new THREE.Vector3;E.subVectors(m,e),A.subVectors(f,e),y.subVectors(t,e),T.subVectors(i,e);var w,b=E.angleTo(y),C=E.angleTo(T),S=A.angleTo(y),x=A.angleTo(T);w=(b<=s&&b>=-s||C<=s&&C>=-s)&&(S<=s&&S>=-s||x<=s&&x>=-s)?0:(b<=Math.PI+s&&b>=Math.PI-s||C<=Math.PI+s&&C>=Math.PI-s)&&(S<=Math.PI+s&&S>=Math.PI-s||x<=Math.PI+s&&x>=Math.PI-s)?Math.PI:b<=S+s&&b>=S-s||b<=x+s&&b>=x-s?b:C;var R=new THREE.Matrix4;if(R.makeRotationAxis(n,w),R.multiply(d.matrix),d.matrix=R,d.rotation.setFromRotationMatrix(d.matrix),d.updateMatrixWorld(),m=d.geometry.vertices[1].clone(),f=d.geometry.vertices[d.geometry.vertices.length-2].clone(),m.applyMatrix4(d.matrixWorld),f.applyMatrix4(d.matrixWorld),E.subVectors(m,e),A.subVectors(f,e),b=E.angleTo(y),C=E.angleTo(T),S=A.angleTo(y),x=A.angleTo(T),b>=s&&C>=s){var R=new THREE.Matrix4;R.makeRotationAxis(n,2*-w),R.multiply(d.matrix),d.matrix=R,d.rotation.setFromRotationMatrix(d.matrix)}var P=new THREE.CircleGeometry(.9*a,c,0,o*Math.PI/180);P.vertices.splice(0,1),d.updateMatrixWorld(),P.applyMatrix(d.matrixWorld);var V=this.drawEdgeAsCylinder(P,M,2.5,0),I=new THREE.Geometry,N=new THREE.Geometry;I.vertices.push(d.geometry.vertices[0].clone(),d.geometry.vertices[1].clone()),N.vertices.push(d.geometry.vertices[0].clone(),d.geometry.vertices[d.geometry.vertices.length-2].clone()),I.applyMatrix(d.matrixWorld),N.applyMatrix(d.matrixWorld);var D=this.drawLineAsCylinder(I,M,2.5),L=this.drawLineAsCylinder(N,M,2.5);l.impl.addOverlay(u,d),l.impl.addMultipleOverlays(p,V),l.impl.addOverlay(p,D),l.impl.addOverlay(p,L),r.copy(d.geometry.vertices[Math.round(d.geometry.vertices.length/2)-1]),r.applyMatrix4(d.matrixWorld)},this.drawAngleFaceToFace=function(e,t,i,n){var o=this.intersectPlaneToPlane(e,t,i,n),r=new THREE.Vector3,s=new THREE.Vector3;r.subVectors(e,o[0]),s.subVectors(i,o[1]);var c=this.angleVectorToVector(r,s),u=o[0].clone(),h=new THREE.Vector3;h.crossVectors(t,n),h.normalize(),o=this.intersectPlaneToPlane(e,t,u,h);var d=o[0].clone();o=this.intersectPlaneToPlane(i,n,u,h);var p=o[0].clone(),v=new THREE.Vector3;if(this.drawAngle(u,d,p,h,c,v),m){var g=_.label;if(!g){g=_.label=document.createElement("div"),g.className="measure-length",l.container.appendChild(g);var f=document.createElement("div");f.className="measure-length-text",g.appendChild(f),g.style.pointerEvents="none"}g.children[0].textContent=a.getAngle(),g.classList.toggle("visible",!0),_.p1=v.clone(),_.p2=v.clone(),this.updateLabelPositions()}return c},this.drawAngleLineToLine=function(e,t,i,n,o){var r=e,s=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3;c.subVectors(e,t),u.subVectors(i,n),s.crossVectors(c,u),s.normalize();var h=t,d=new THREE.Vector3;d.subVectors(r,i),d.add(n);var p=new THREE.Vector3;if(this.drawAngle(r,h,d,s,o,p),m){var v=_.label;if(!v){v=_.label=document.createElement("div"),v.className="measure-length",l.container.appendChild(v);var g=document.createElement("div");g.className="measure-length-text",v.appendChild(g),v.style.pointerEvents="none"}v.children[0].textContent=a.getAngle(),v.classList.toggle("visible",!0),_.p1=p.clone(),_.p2=p.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3;o.subVectors(i,e),o.cross(n),r.crossVectors(t,n);var s=o.divide(r);return r=t.clone(),r.multiplyScalar(s),o.addVectors(e,r),o},this.nearestPointInPointToPlane=function(e,t,i){var n=new THREE.Vector3,o=i.clone(),r=new THREE.Vector3;r.subVectors(e,t);var s=-o.dot(r),a=o.dot(o),l=s/a;return n.addVectors(e,o.multiplyScalar(l)),n},this.faceToPointMeasure=function(e,t,i,n){var o=e.vertices[0],r=this.nearestPointInPointToPlane(n,o,t),s=i.clone(),a=new THREE.Vector3;a.subVectors(s,r),a.add(n);var l=2*r.distanceTo(i),c=new THREE.PlaneBufferGeometry(l,l);return this.drawExtensionFace(c,i,t),this.drawLine(n,r),[n,r]},this.nearestPointInPointToTriangle=function(e,t,i,n){var o,r=Number.MAX_VALUE;if(o=this.pointProjectsInTriangle(e,t,i,n))return o;var s=this.nearestPointInPointToSegment(e,t,i);return e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,t,n),e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,i,n),e.distanceTo(s)<r&&(o=s.clone()),o},this.pointToFaceMeasure=function(e,t,i,n){var o=t.vertices[0],r=this.nearestPointInPointToPlane(e,o,i),s=n.clone(),a=new THREE.Vector3;return a.subVectors(s,r),a.add(e),this.drawLine(s,a),this.drawExtensionLinePointToPoint(e,a),[e,r]},this.curvedFaceToVertexMeasure=function(e,t){for(var i,n=Number.MAX_VALUE,o=e.vertices,r=0;r<o.length;r+=3){var s=this.nearestPointInPointToTriangle(t,o[r],o[r+1],o[r+2]);t.distanceTo(s)<n&&(n=t.distanceTo(s),i=s)}return this.drawLine(i,t),[i,t]},this.pointProjectsInTriangle=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3;o.subVectors(i,t),r.subVectors(n,t),a.crossVectors(o,r),s.subVectors(e,t),o.cross(s);var l=o.dot(a)/a.dot(a);s.cross(r);var i=s.dot(a)/a.dot(a),t=1-l-i;if(t>=0&&t<=1&&i>=0&&i<=1&&l>=0&&l<=1){var c=THREE.Triangle.normal(t,i,n),u=this.nearestPointInPointToPlane(e,t,c);return u}},this.nearestPointsInLineSegmentToTriangle=function(e,t,i,n,o){var r,s,a=[],l=Number.MAX_VALUE,c=this.pointProjectsInTriangle(e,i,n,o);c&&e.distanceTo(c)<l&&(l=e.distanceTo(c),a[0]=e,a[1]=c);var u=this.pointProjectsInTriangle(t,i,n,o);u&&t.distanceTo(u)<l&&(l=t.distanceTo(u),a[0]=t,a[1]=u),r=i,s=n;var h=this.nearestPointsInSegmentToSegment(e,t,r,s);return h[0].distanceTo(h[1])<l&&(l=h[0].distanceTo(h[1]),a[0]=h[0].clone(),a[1]=h[1].clone()),r=i,s=o,h=this.nearestPointsInSegmentToSegment(e,t,r,s),h[0].distanceTo(h[1])<l&&(l=h[0].distanceTo(h[1]),a[0]=h[0].clone(),a[1]=h[1].clone()),r=n,s=o,h=this.nearestPointsInSegmentToSegment(e,t,r,s),h[0].distanceTo(h[1])<l&&(a[0]=h[0].clone(),a[1]=h[1].clone()),a},this.nearestPointsInEdgeToFace=function(e,t,i){for(var n=[],o=Number.MAX_VALUE,r=0;r<i.vertices.length;r+=3){
var s=this.nearestPointsInLineSegmentToTriangle(e,t,i.vertices[r],i.vertices[r+1],i.vertices[r+2]);s[0].distanceTo(s[1])<o&&(o=s[0].distanceTo(s[1]),n=s)}return n},this.nearestPointsInTriangleToTriangle=function(e,t,i,n,o,r){function s(e,t,i,n){var o=l.pointProjectsInTriangle(e,t,i,n);o&&e.distanceTo(o)<u&&(u=e.distanceTo(o),c[0]=e,c[1]=o)}function a(e,t,i,n){var o=l.nearestPointsInSegmentToSegment(e,t,i,n);o[0].distanceTo(o[1])<u&&(u=o[0].distanceTo(o[1]),c=o)}var l=this,c=[],u=Number.MAX_VALUE;return s(e,n,o,r),s(t,n,o,r),s(i,n,o,r),s(n,e,t,i),s(o,e,t,i),s(r,e,t,i),a(e,t,n,o),a(e,t,n,r),a(e,t,o,r),a(e,i,n,o),a(e,i,n,r),a(e,i,o,r),a(t,i,n,o),a(t,i,n,r),a(t,i,o,r),c},this.curvedEdgeToFaceMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=[],o=e.vertices,r=0;r<o.length;r+=2){var s=this.nearestPointsInEdgeToFace(o[r],o[r+1],t);s[0].distanceTo(s[1])<i&&(i=s[0].distanceTo(s[1]),n=s)}return this.drawLine(n[0],n[1]),[n[0],n[1]]},this.curvedFaceToFaceMeasure=function(e,t){var i=Number.MAX_VALUE,n=[],o=e.vertices,r=t.vertices;e.computeBoundingSphere(),t.computeBoundingSphere();var s=new THREE.Sphere,a=new THREE.Sphere,l=[],c=Number.MAX_VALUE,u=[],h=[];e.bSpheres=[],t.bSpheres=[];for(var d=0;d<o.length;d+=3){s.setFromPoints([o[d],o[d+1],o[d+2]]),e.bSpheres.push(s.clone());var p=s.center.distanceTo(t.boundingSphere.center)+s.radius+t.boundingSphere.radius;p<c&&(c=p)}for(var d=0;d<o.length;d+=3){s=e.bSpheres[d/3];var v=s.center.distanceTo(t.boundingSphere.center)-s.radius-t.boundingSphere.radius;v<=c&&u.push(d)}c=Number.MAX_VALUE;for(var g=0;g<r.length;g+=3){a.setFromPoints(r[g],r[g+1],r[g+2]),t.bSpheres.push(a.clone());var p=a.center.distanceTo(e.boundingSphere.center)+a.radius+e.boundingSphere.radius;p<c&&(c=p)}for(var g=0;g<r.length;g+=3){a=t.bSpheres[g/3];var v=a.center.distanceTo(e.boundingSphere.center)-a.radius-e.boundingSphere.radius;v<=c&&h.push(g)}c=Number.MAX_VALUE;for(var d=0;d<u.length;d++){s=e.bSpheres[u[d]/3];for(var g=0;g<h.length;g++){a=t.bSpheres[h[g]/3];var v=s.center.distanceTo(a.center)-s.radius-a.radius,p=s.center.distanceTo(a.center)+s.radius+a.radius;p<c&&(c=p,l.push({i:u[d],j:h[g],value:v}))}}for(var m=0;m<l.length;m++)if(l[m].value<=c&&l[m].value<i){var f=this.nearestPointsInTriangleToTriangle(o[l[m].i],o[l[m].i+1],o[l[m].i+2],r[l[m].j],r[l[m].j+1],r[l[m].j+2]);f[0].distanceTo(f[1])<i&&(i=f[0].distanceTo(f[1]),n=f)}return this.drawLine(n[0],n[1]),[n[0],n[1]]},this.faceToEdgeMeasure=function(e,t,i,n,o){var r,s,a=.01,l=x.getEndPointsInEdge(n);l[0].distanceTo(i)<l[1].distanceTo(i)?(r=l[0],s=l[1]):(r=l[1],s=l[0]);var c=new THREE.Vector3;c.subVectors(s,r);var u=this.angleLineToPlane(c,t);if(c.dot(t)<=a&&c.dot(t)>=-a){var h=e.vertices[0],d=this.nearestPointInPointToPlane(r,h,t),p=this.nearestPointInPointToLine(o,r,s);return this.faceToPointMeasure(e,t,i,p),[r,d,u]}var v=this.nearestPointInPointToLine(o,r,s);return this.drawAngleEdgeToFace(e.vertices[0],t,i,r,v,u),u},this.edgeToFaceMeasure=function(e,t,i,n,o){var r,s,a=.01,l=x.getEndPointsInEdge(e);l[0].distanceTo(o)<l[1].distanceTo(o)?(r=l[0],s=l[1]):(r=l[1],s=l[0]);var c=new THREE.Vector3;c.subVectors(s,r);var u=this.angleLineToPlane(c,n);if(c.dot(n)<=a&&c.dot(n)>=-a){var h=i.vertices[0],d=this.nearestPointInPointToPlane(r,h,n),p=new THREE.Vector3;p.subVectors(o,d),p.add(r);var v=new THREE.Vector3;return v.subVectors(o,d),v.add(s),this.drawLine(p,o),this.drawExtensionLinePointToPoint(p,v),[r,d,u]}var g=this.nearestPointInPointToLine(t,r,s);return this.drawAngleEdgeToFace(i.vertices[0],n,o,r,g,u),u},this.angleLineToPlane=function(e,t){var i=this.angleVectorToVector(e,t);return i>90?i-=90:i=90-i,i},this.drawAngleEdgeToFace=function(e,t,i,n,o,r){var s=this.intersectPointLineToPlane(e,t,n,o);if(s){var c=o;if(90===r)var u=i.clone();else var u=this.nearestPointInPointToPlane(o,e,t);var h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3;d.subVectors(o,n),p.subVectors(u,s),h.crossVectors(d,p),h.normalize();var v=new THREE.Vector3;if(this.drawAngle(s,c,u,h,r,v),m){var g=_.label;if(!g){g=_.label=document.createElement("div"),g.className="measure-length",l.container.appendChild(g);var f=document.createElement("div");f.className="measure-length-text",g.appendChild(f),g.style.pointerEvents="none"}g.children[0].textContent=a.getAngle(),g.classList.toggle("visible",!0),_.p1=v.clone(),_.p2=v.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(e,t,i,n){var o=.001,r=new THREE.Vector3,s=new THREE.Vector3;r.subVectors(n,i),s.subVectors(i,e);var a=t.dot(r),l=-t.dot(s);return Math.abs(a)<o?null:(r.multiplyScalar(l/a),r.add(i),r)},this.nearestVertexInVertexToEdge=function(e,t){for(var i,n=Number.MAX_VALUE,o=0;o<t.vertices.length;o++){var r=e.distanceTo(t.vertices[o]);n>r&&(i=t.vertices[o],n=r)}return i},this.isEqualVectors=function(e,t,i){return Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i},this.isInverseVectors=function(e,t,i){return Math.abs(e.x+t.x)<=i&&Math.abs(e.y+t.y)<=i&&Math.abs(e.z+t.z)<=i},this.setSimple=function(e){if(i!=e){i=e;for(var t in L)if("xyz"!==t&&L.hasOwnProperty(t)){var n=L[t];n.line&&(n.line.visible=!e,n.label&&n.label.classList.toggle("visible",!e))}l.impl.invalidate(!1,!1,!0)}},this.hide=function(){var e;for(e in I)if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(t.mesh.visible=!1),t.label&&t.label.classList.remove("visible")}for(e in N)if(N.hasOwnProperty(e)){var i=N[e];if(i.line)for(var n in i.line)i.line[n].visible=!1;i.label&&i.label.classList.remove("visible")}for(e in D)if(D.hasOwnProperty(e)){var o=D[e];o.mesh&&(o.mesh.visible=!1),o.label&&o.label.classList.remove("visible")}for(e in L)if(L.hasOwnProperty(e)){var r=L[e];r.line&&(r.line.visible=!1),r.label&&r.label.classList.remove("visible")}_.label&&_.label.classList.remove("visible"),k&&(l.impl.clearOverlay(u),l.impl.clearOverlay(p)),R&&l.impl.clearOverlay(v),P&&l.impl.clearOverlay(g),V&&l.impl.clearOverlay(T),l.impl.invalidate(!1,!1,!0)},this.hideClick=function(e){if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(t.mesh.visible=!1),t.label&&t.label.classList.remove("visible")}if(N.hasOwnProperty(e)){var i=N[e];if(i.line)for(var n in i.line)i.line[n].visible=!1;i.label&&i.label.classList.remove("visible")}if(D.hasOwnProperty(e)){var o=D[e];o.mesh&&(o.mesh.visible=!1),o.label&&o.label.classList.remove("visible")}for(var r in L)if(L.hasOwnProperty(r)){var s=L[r];s.line&&(s.line.visible=!1),s.label&&s.label.classList.remove("visible")}_.label&&_.label.classList.remove("visible"),k&&(l.impl.clearOverlay(u),l.impl.clearOverlay(p)),R&&l.impl.clearOverlay(v),P&&l.impl.clearOverlay(g),l.impl.invalidate(!1,!1,!0)},this.destroy=function(){var e;for(e in I)if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(l.impl.removeOverlay(r,t.mesh),t.mesh=t.geometry=null),t.label&&(t.label.parentNode.removeChild(t.label),t.label=null)}for(e in N)if(N.hasOwnProperty(e)){var i=N[e];i.line&&(l.impl.removeMultipleOverlays(s,i.line),i.line=i.intersectPoint=null),i.label&&(i.label.parentNode.removeChild(i.label),i.label=null)}for(e in D)if(D.hasOwnProperty(e)){var n=D[e];n.mesh&&(l.impl.removeOverlay(c,n.mesh),n.mesh=n.intersectPoint=null),n.label&&(n.label.parentNode.removeChild(n.label),n.label=null)}w&&(w=null,l.impl.removeOverlayScene(r)),S&&(S=null,l.impl.removeOverlayScene(c)),C&&(C=null,l.impl.removeOverlayScene(s)),R&&(R=null,l.impl.removeOverlayScene(v)),P&&(P=null,l.impl.removeOverlayScene(g)),V&&(V=null,l.impl.clearOverlay(T));for(e in L)if(L.hasOwnProperty(e)){var o=L[e];o.line&&(l.impl.removeOverlay(o.overlayName,o.line),l.impl.removeOverlayScene(o.overlayName),o.material=o.line=o.geometry=null),o.label&&(o.label.parentNode.removeChild(o.label),o.label=null),o.material=o.line=o.geometry=o.label=o.p1=o.p2=null}_.label&&(_.label.parentNode.removeChild(_.label),_.label=null),_.label=_.p1=_.p2=null}}var a=this,l=e,c=["measure"],u=!1,h=null,d=null,p=!1,v=!1,g=0,m=!1,f=null,E=null,A="",y=3,T={},w=0,b=!1,C=null,S=null,k="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto",x=null,M=null,R=null,P=null,V=null,I=null,N=null,D=null,L=null,O=null,_=null,H=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,B=null;this.register=function(){H&&!S&&(S=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(a,l,"measure-panel","Measure",t),l.addPanel(S)),x||(x=new Autodesk.Viewing.Extensions.Measure.Snapper(e),l.toolController.registerTool(x))},this.deregister=function(){this.deactivate(),S&&(l.removePanel(S),S.uninitialize()),l.toolController.deregisterTool(x),x=null},this.isActive=function(){return u},this.getNames=function(){return c},this.getName=function(){return c[0]},this.getCursor=function(){return p&&!v?null:k},this.activate=function(){u=!0,g=0,p=!1,A||(A=l.model.getDisplayUnit()),y=l.model&&l.model.is2d()?3:1,o(),l.clearSelection(),l.toolController.activateTool("snapper"),l.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),l.addEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.deactivate=function(){u=!1,h=d=null,T={},this.clearMeasurement(),r(),x&&x.isActive()&&l.toolController.deactivateTool("snapper"),l.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),l.removeEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.update=function(){return!1},this.getUnits=function(){return A},this.setUnits=function(e){A!==e&&(A=e,C&&C.updateDistance())},this.getPrecision=function(){return y},this.setPrecision=function(e){y!==e&&(y=e,C&&C.updateDistance())},this.getDistance=function(e){if(l.model&&l.model.isLoadDone()){var t=Autodesk.Viewing.Private.convertUnits(l.model.getUnitString(),A,T[e]||0);return Autodesk.Viewing.Private.formatValueWithUnits(t,A,3,y)}},this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(w,String.fromCharCode(176),3,y)},this.getMeasurement=function(e,t){A=e||A,y=t||y;var i=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"],n={from:i[this.getFirstGeometry().type],to:i[this.getSecondGeometry().type],distance:this.getDistance("xyz"),deltaX:this.getDistance("x"),deltaY:this.getDistance("y"),deltaZ:this.getDistance("z"),angle:this.getAngle(),unitType:A,precision:y};return n},this.clearMeasurement=function(){h=d=null,f=E=null,D=L=null,O=_=null,g=1,T={},w=0,B=null,C&&C.hide(),S&&(S.updatePanel(),S.hideMeasureResult(),S.isolateMeasure&&this.clearIsolate()),l.model.is2d()&&(e.impl.updateViewportId(0),x&&x.setFirstClickVpId(null))},this.clearRubberBand=function(){d=null,E=null,C.hideClick("second")},this.clearFirstPick=function(){d?(C.hide(),h=d.clone(),f=E,M=R,P=V,D=L,O=_,I=N,l.model.is2d()&&(e.impl.updateViewportId(O),x&&x.setFirstClickVpId(O)),b=!0,f===SNAP_VERTEX?C.showFirstVertex(h):f===SNAP_EDGE?C.showFirstEdge(h,M):f===SNAP_FACE?C.showFirstFace(h,M):f===SNAP_CIRCULARARC?(h.center=d.center,h.radius=d.radius,C.showFirstEdge(h,M)):f===SNAP_CURVEDFACE&&C.showFirstFace(h,M),b=!1,d=null,E=null,L=null,_=null,N=null,g=2,T={},w=0,S&&S.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),S&&S.showSelection1()},this.clearSecondPick=function(){d=null,E=null,L=null,_=null,g=2,T={},w=0,C.hideClick("second"),S&&S.isolateMeasure&&this.clearIsolate(),l.model.is2d()&&(e.impl.updateViewportId(O),x&&x.setFirstClickVpId(O))},this.getIndicator=function(){return C},this.getFirstGeometry=function(){return{type:f,geometry:h}},this.getSecondGeometry=function(){return{type:E,geometry:d}},this.getEdgeLength=function(e){return C.getEdgeLength(e)},this.getFaceArea=function(e){return C.getFaceArea(e)},this.getCircularArcRadius=function(e){return C.getCircularArcRadius(e)},this.isolateMeasurement=function(){if(D&&L){var e=[D,L];l.isolate(e)}},this.clearIsolate=function(){l.showAll()},this.isIdenticalEdges=function(){if(h.vertices.length===d.vertices.length){for(var e=0;e<h.vertices.length;e++)if(!h.vertices[e].equals(d.vertices[e]))return!1;return!0}return!1},this.isIdenticalFaces=function(){if(h.faceId&&d.faceId){if(h.fragId===d.fragId&&h.faceId===d.faceId)return!0}else if(h.vertices.length===d.vertices.length){for(var e=0;e<h.vertices.length;e++)if(!h.vertices[e].equals(d.vertices[e]))return!1;return!0}return!1},this.isIdenticalGeometries=function(){if(f===E)switch(f){case SNAP_VERTEX:if(h.equals(d))return!0;break;case SNAP_EDGE:return this.isIdenticalEdges();case SNAP_FACE:return this.isIdenticalFaces();case SNAP_CIRCULARARC:return this.isIdenticalEdges();case SNAP_CURVEDEDGE:return this.isIdenticalEdges();case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},this._handleMouseEvent=function(t){if(x.isSnapped()){if(0===g&&(this.clearMeasurement(),g=1),1===g)O=x.getViewportIndex(),f=x.getHighlightGeometry(),M=x.getIntersectPoint(),l.model.is2d()&&(e.impl.updateViewportId(O),x&&x.setFirstClickVpId(O)),h=x.getGeometry(),f===SNAP_VERTEX?C.showFirstVertex(h):f===SNAP_EDGE||f===SNAP_CURVEDEDGE?C.showFirstEdge(h,M):f===SNAP_FACE?(P=x.getFaceNormal(),C.showFirstFace(h,M)):f===SNAP_CIRCULARARC?(I=x.getCircularArcCenter(),h.center=x.getCircularArcCenter(),h.radius=x.getCircularArcRadius(),C.showFirstEdge(h,M)):f===SNAP_CURVEDFACE&&C.showFirstFace(h,M),D=x.getSnapNode(),S&&S.showSelection1();else if(2===g){var i=null;if(E=x.getHighlightGeometry(),R=x.getIntersectPoint(),d=x.getGeometry(),E===SNAP_CIRCULARARC&&(d.center=x.getCircularArcCenter(),d.radius=x.getCircularArcRadius()),this.isIdenticalGeometries())return!1;if(f===SNAP_VERTEX&&E===SNAP_VERTEX?(C.showSecondVertex(d),C.drawLine(h,d),i=[h,d]):f===SNAP_EDGE&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.edgeToEdgeMeasure(d,h,R)):f===SNAP_FACE&&E===SNAP_FACE?(V=x.getFaceNormal(),C.showSecondFace(d,R),i=C.faceToFaceMeasure(M,P,R,V)):f===SNAP_VERTEX&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.pointToEdgeMeasure(h,d,R)):f===SNAP_EDGE&&E===SNAP_VERTEX?(C.showSecondVertex(d),i=C.edgeToPointMeasure(h,d)):f===SNAP_VERTEX&&E===SNAP_FACE?(V=x.getFaceNormal(),C.showSecondFace(d,R),i=C.pointToFaceMeasure(h,d,V,R)):f===SNAP_FACE&&E===SNAP_VERTEX?(C.showSecondVertex(d),i=C.faceToPointMeasure(h,P,M,d)):f===SNAP_EDGE&&E===SNAP_FACE?(V=x.getFaceNormal(),C.showSecondFace(d,R),i=C.edgeToFaceMeasure(h,M,d,V,R)):f===SNAP_FACE&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.faceToEdgeMeasure(h,P,M,d,R)):f===SNAP_CIRCULARARC&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),I.equals(N)?(d=C.nearestVertexInVertexToEdge(R,d),E=SNAP_VERTEX,C.showSecondVertex(d),C.drawLine(I,d),i=[I,d]):(C.showSecondEdge(d,R),C.drawLine(I,N),i=[I,N])):f===SNAP_CIRCULARARC&&E===SNAP_VERTEX?(C.showSecondVertex(d),C.drawLine(I,d),i=[I,d]):f===SNAP_VERTEX&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),C.showSecondEdge(d,R),C.drawLine(h,N),i=[h,N]):f===SNAP_CIRCULARARC&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.pointToEdgeMeasure(I,d,R)):f===SNAP_EDGE&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),C.showSecondEdge(d,R),i=C.edgeToPointMeasure(h,N)):f===SNAP_CIRCULARARC&&E===SNAP_FACE?(V=x.getFaceNormal(),C.showSecondFace(d,R),i=C.pointToFaceMeasure(I,d,V,R)):f===SNAP_FACE&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),C.showSecondEdge(d,R),i=C.faceToPointMeasure(h,P,M,N)):f===SNAP_CURVEDEDGE&&E===SNAP_VERTEX?(C.showSecondVertex(d),i=C.curvedEdgeToVertexMeasure(h,d)):f===SNAP_VERTEX&&E===SNAP_CURVEDEDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToVertexMeasure(d,h)):f===SNAP_CURVEDEDGE&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),C.showSecondEdge(d,R),i=C.curvedEdgeToVertexMeasure(h,N)):f===SNAP_CIRCULARARC&&E===SNAP_CURVEDEDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToVertexMeasure(d,I)):f===SNAP_CURVEDEDGE&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToEdgeMeasure(h,d)):f===SNAP_EDGE&&E===SNAP_CURVEDEDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToEdgeMeasure(d,h)):f===SNAP_CURVEDEDGE&&E===SNAP_CURVEDEDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToCurvedEdgeMeasure(h,d)):f!==SNAP_CURVEDEDGE||E!==SNAP_FACE&&E!==SNAP_CURVEDFACE?f!==SNAP_FACE&&f!==SNAP_CURVEDFACE||E!==SNAP_CURVEDEDGE?f===SNAP_CURVEDFACE&&E===SNAP_VERTEX?(C.showSecondVertex(d),i=C.curvedFaceToVertexMeasure(h,d)):f===SNAP_VERTEX&&E===SNAP_CURVEDFACE?(C.showSecondFace(d,R),i=C.curvedFaceToVertexMeasure(d,h)):f===SNAP_CURVEDFACE&&E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),C.showSecondEdge(d,R),i=C.curvedFaceToVertexMeasure(h,N)):f===SNAP_CIRCULARARC&&E===SNAP_CURVEDFACE?(C.showSecondFace(d,R),i=C.curvedFaceToVertexMeasure(d,I)):f===SNAP_CURVEDFACE&&E===SNAP_EDGE?(C.showSecondEdge(d,R),i=C.curvedEdgeToFaceMeasure(d,h)):f===SNAP_EDGE&&E===SNAP_CURVEDFACE?(C.showSecondFace(d,R),i=C.curvedEdgeToFaceMeasure(h,d)):f!==SNAP_CURVEDFACE||E!==SNAP_FACE&&E!==SNAP_CURVEDFACE?f===SNAP_FACE&&E===SNAP_CURVEDFACE&&(C.showSecondFace(d,R),i=C.curvedFaceToFaceMeasure(h,d)):(C.showSecondFace(d,R),i=C.curvedFaceToFaceMeasure(h,d)):(C.showSecondEdge(d,R),i=C.curvedEdgeToFaceMeasure(d,h)):(C.showSecondFace(d,R),i=C.curvedEdgeToFaceMeasure(h,d)),m){if(void 0===i.length)w=i,S&&S.showAngleResult();else{var n=i[0].clone(),o=i[1].clone();l.model.is2d()&&l.model.pageToModel(n,o,O),T.xyz=n.distanceTo(o),T.x=Math.abs(n.x-o.x),T.y=Math.abs(n.y-o.y),T.z=Math.abs(n.z-o.z),S&&(f===SNAP_FACE&&E===SNAP_FACE?S.showDistanceResult(!0):S.showDistanceResult())}S&&(S.showSelection2(),S.updatePanel()),C.updateDistance(),C.updateAngle(),L=x.getSnapNode(),_=x.getViewportIndex(),S&&S.isolateMeasure&&this.isolateMeasurement(),l.model.is2d()&&(e.impl.updateViewportId(0),x&&x.setFirstClickVpId(null))}C.updateLabelPositions()}return!0}if(2===g){var r=this.inverseProject(t.canvasX,t.canvasY);f===SNAP_VERTEX?C.drawLine(h,r):f===SNAP_EDGE?C.edgeToPointMeasure(h,r):f===SNAP_FACE?C.faceToPointMeasure(h,P,M,r):f===SNAP_CIRCULARARC?C.drawLine(I,r):f===SNAP_CURVEDEDGE?C.curvedEdgeToVertexMeasure(h,r):f===SNAP_CURVEDFACE&&C.curvedFaceToVertexMeasure(h,r)}return!1},this.inverseProject=function(e,t){var i=l.navigation.getCamera(),n=l.navigation.getScreenViewport(),o=new THREE.Vector3;return o.x=e/n.width*2-1,o.y=-(t/n.height*2-1),o.z=0,o=o.unproject(i)},this.handleButtonDown=function(e,t){return p=!0,0!==t||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(m=!0),!1},this.handleMouseMove=function(e){return m=!1,2===g&&(this.clearRubberBand(),this._handleMouseEvent(e)),!1},this.handleButtonUp=function(e,t){return p=!1,!1},this.handleSingleClick=function(e,t){return m&&(this._handleMouseEvent(e)||(this.clearMeasurement(),g=0),1!==g&&2!==g||(g=1===g?2:0),m=!1),!0},this.handleDoubleClick=function(e,t){return!0},this.handleWheelInput=function(e){return C.updateScale(),!1},this.handleSingleTap=function(e){return!0},this.handleDoubleTap=function(e){return!0},this.handleResize=function(){C&&C.updateLabelPositions()}},function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.Private,o=Autodesk.Viewing.UI,r=function(e,i,r,s,a){o.DockingPanel.call(this,i.container,r,s,a),this.kPanelExpandedHeight=310,this.kPanelCollapsedHeight=35,this.isDeltaExpanded=!0,this.isSettingsExpanded=!1,this.isolateMeasure=!1,this.measureTool=e,this.viewer=i,this.parentContainer=i.container,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="300px",this.container.style.width="300px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="200px",this.container.style.left="220px",this.container.style.position="absolute",this.addEventListener(this.closer,"click",function(e){a&&a.onCloseCallback&&a.onCloseCallback()});var l=this.container.children[0];l.classList.add("expanded"),a=a||{},a.heightAdjustment||(a.heightAdjustment=40),a.marginTop||(a.marginTop=0),a.left=!1,this.createScrollContainer(a),this.measureResults=document.createElement("div"),this.scrollContainer.appendChild(this.measureResults);var c=this;this.selection1=document.createElement("div"),this.selection1.className="measure-result-container",this.measureResults.appendChild(this.selection1);var u=document.createElement("div");u.className="measure-selectionOne-label",this.selection1.appendChild(u);var h=document.createElement("div");h.className="adsk-icon-first measure-label-icon",u.appendChild(h),this.selection1Result=document.createElement("div"),this.selection1Result.className="measure-selection-result",this.selection1.appendChild(this.selection1Result);var d=document.createElement("div");d.className="adsk-icon-refresh measure-repick",d.addEventListener("click",function(e){c.firstSelectionRepick()},!0),this.selection1.appendChild(d),this.addDivider(this.selection1),this.results=document.createElement("div"),this.results.className="measure-result-container",this.measureResults.appendChild(this.results),this.distIcon=document.createElement("div"),this.distIcon.className="adsk-icon-measure-distance measure-distance-icon",this.results.appendChild(this.distIcon),this.angleIcon=document.createElement("div"),this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon",this.results.appendChild(this.angleIcon),this.distanceDiv=document.createElement("div"),this.distanceDiv.className="measure-result",this.results.appendChild(this.distanceDiv),this.angleDiv=document.createElement("div"),this.angleDiv.className="measure-result",this.results.appendChild(this.angleDiv),this.initialDiv=document.createElement("div"),this.initialDiv.className="measure-initial",this.initialDiv.textContent="0.00",this.results.appendChild(this.initialDiv),this.settingsButton=document.createElement("div"),this.settingsButton.className="adsk-icon-settings measure-settings-button",this.settingsButton.addEventListener("click",function(e){c.showMeasureSettings()},!0),this.results.appendChild(this.settingsButton),this.deltaButton=document.createElement("div"),this.deltaButton.className="adsk-icon-arrow measure-delta-button",this.deltaButton.addEventListener("click",function(e){c.toggle()},!0),this.results.appendChild(this.deltaButton),this.deltaXDiv=document.createElement("div"),this.deltaXDiv.className="measure-delta-result",this.results.appendChild(this.deltaXDiv);var p=document.createElement("span");p.setAttribute("data-i18n","Delta"),p.textContent=t.i18n.translate("Delta"),this.deltaXDiv.appendChild(p);var v=document.createElement("span");v.className="measure-label-axis-x",v.textContent="X",this.deltaXDiv.appendChild(v);var g=document.createElement("span");this.deltaXDiv.appendChild(g),this.deltaYDiv=document.createElement("div"),this.deltaYDiv.className="measure-delta-result",this.results.appendChild(this.deltaYDiv);var m=document.createElement("span");m.setAttribute("data-i18n","Delta"),m.textContent=t.i18n.translate("Delta"),this.deltaYDiv.appendChild(m);var f=document.createElement("span");f.className="measure-label-axis-y",f.textContent="Y",this.deltaYDiv.appendChild(f);var E=document.createElement("span");this.deltaYDiv.appendChild(E),this.deltaZDiv=document.createElement("div"),this.deltaZDiv.className="measure-delta-result",this.results.appendChild(this.deltaZDiv);var A=document.createElement("span");A.setAttribute("data-i18n","Delta"),A.textContent=t.i18n.translate("Delta"),this.deltaZDiv.appendChild(A);var y=document.createElement("span");y.className="measure-label-axis-z",y.textContent="Z",this.deltaZDiv.appendChild(y);var T=document.createElement("span");this.deltaZDiv.appendChild(T),this.addDivider(this.results),this.selection2=document.createElement("div"),this.selection2.className="measure-result-container",this.measureResults.appendChild(this.selection2);var w=document.createElement("div");w.className="measure-selectionTwo-label",this.selection2.appendChild(w);var b=document.createElement("div");b.className="adsk-icon-second measure-label-icon",w.appendChild(b),this.selection2Result=document.createElement("div"),this.selection2Result.className="measure-selection-result",this.selection2.appendChild(this.selection2Result);var C=document.createElement("div");C.className="adsk-icon-refresh measure-repick",C.addEventListener("click",function(e){c.secondSelectionRepick()},!0),this.selection2.appendChild(C),this.addDivider(this.selection2),this.measureSettings=document.createElement("div"),this.measureSettings.className="measure-settings",this.measureSettings.style.display="none",this.measureResults.appendChild(this.measureSettings),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable measure-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.measureSettings.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var S=this.findUnits(),k=[],x=0;x<this.units.length;++x)k.push(this.units[x].name);this.unitList=new n.OptionDropDown("Unit type",this.tbody,k,S),this.addEventListener(this.unitList,"change",function(e){var t=c.unitList.selectedIndex,i=c.units[t].units;c.measureTool.setUnits(i),c.updatePanel(),c.setupPrecision(),n.logger.track({category:"pref_changed",name:"measure/units",value:i})}),this.precisionList=new n.OptionDropDown("Precision",this.tbody,[],-1),this.addEventListener(this.precisionList,"change",function(e){var t=c.precisionList.selectedIndex;c.measureTool.setPrecision(t),c.updatePanel(),n.logger.track({category:"pref_changed",name:"measure/precision",value:t})}),this.setupPrecision(),this.isolate=new n.OptionCheckbox("Isolate measurement",this.tbody,!1),this.addEventListener(this.isolate,"change",function(e){var t=c.isolate.checked;c.isolateMeasure=t,c.isolateMeasure?c.measureTool.isolateMeasurement():c.measureTool.clearIsolate(),n.logger.track({category:"pref_changed",name:"measure/isolate",value:t})}),this.addDivider(this.measureSettings);var M=document.createElement("div");M.className="measure-restart",M.setAttribute("data-i18n","Restart"),M.textContent=t.i18n.translate("Restart"),M.addEventListener("click",function(){c.measureTool.clearMeasurement()},!1),this.measureResults.appendChild(M),this.updatePanel(),this.addVisibilityListener(function(){c.resizeToContent({maxHeight:c.parentContainer.offsetHeight-75})}),this.hideMeasureResult()};r.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(r.prototype),r.prototype.addDropDownMenu=function(e,i,n,o,r){var s=function(e){var t=e.target.selectedIndex;r(t)},a=document.createElement("select");a.className="optionDropDown";for(var l=0;l<n.length;l++){var c=document.createElement("option");c.value=l,c.setAttribute("data-i18n",n[l]),c.textContent=t.i18n.translate(n[l]),a.add(c)}var u=document.createElement("div");u.className="measure-submenu-select";var h=document.createElement("div");return h.className="measure-submenu-selectlabel",h.setAttribute("for",i),h.setAttribute("data-i18n",i),h.textContent=t.i18n.translate(i),u.appendChild(h),u.appendChild(a),e.appendChild(u),a.selectedIndex=o,a.onchange=s,a},r.prototype.addDivider=function(e){var t=document.createElement("div");return t.className="measure-horizontal-divider",e.appendChild(t),t},r.prototype.findUnits=function(){var e,t,i=this.measureTool.getUnits();for(e=0;e<this.units.length;++e){var n=this.units[e].matches;if(n)for(t=0;t<n.length;++t)if(n[t]===i)return e}return 0},r.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);var e,t=this.measureTool.getUnits();e="ft-and-fractional-in"===t||"fractional-in"===t?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"];for(var i=0;i<e.length;++i){var n=document.createElement("option");n.value=i,n.textContent=e[i],this.precisionList.dropdownElement.appendChild(n);
}var o=this.measureTool.getPrecision();e.length<=o&&(o=e.length-1,self.measureTool.setPrecision(o)),this.precisionList.dropdownElement.selectedIndex=o},r.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},r.prototype.onTitleClick=function(e){},r.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated"),this.measureTool.getIndicator().setSimple(this.isDeltaExpanded),this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),this.isDeltaExpanded=!0),this.resizeToContent()},r.prototype.toggle=function(){this.deltaCollapse()},r.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")},r.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}},r.prototype.updatePanel=function(){function e(e,i){"angle"===i?e.textContent="~ "+t.measureTool.getAngle():"xyz"===i?e.textContent="~ "+t.measureTool.getDistance(i):e.children[2].textContent=" = ~ "+t.measureTool.getDistance(i)}var t=this;e(this.distanceDiv,"xyz"),e(this.deltaXDiv,"x"),e(this.deltaYDiv,"y"),e(this.deltaZDiv,"z"),e(this.angleDiv,"angle"),this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.initialDiv.textContent=n.formatValueWithUnits(0,null,3,this.measureTool.getPrecision()),this.showSelection1(),this.showSelection2()},r.prototype.showDistanceResult=function(e){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="inline-block",this.distIcon.style.display="inline-block",e?(this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none")):(this.deltaButton.style.display="inline-block",this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"))),this.resizeToContent()},r.prototype.showAngleResult=function(){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="inline-block",this.angleIcon.style.display="inline-block",this.distanceDiv.style.display="none",this.distIcon.style.display="none",this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"),this.resizeToContent()},r.prototype.showSelection1=function(){var e=this.measureTool.getFirstGeometry();null!==e.type&&(e.type===SNAP_VERTEX?(this.selection1Result.setAttribute("data-i18n","Vertex"),this.selection1Result.textContent=t.i18n.translate("Vertex"),this.selection1Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection1Result.setAttribute("data-i18n","Edge"),this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection1Result.setAttribute("data-i18n","Face"),this.selection1Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection1Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"),this.selection1.style.display="block",this.resizeToContent())},r.prototype.showSelection2=function(){var e=this.measureTool.getSecondGeometry();null!==e.type&&(e.type===SNAP_VERTEX?(this.selection2Result.setAttribute("data-i18n","Vertex"),this.selection2Result.textContent=t.i18n.translate("Vertex"),this.selection2Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection2Result.setAttribute("data-i18n","Edge"),this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection2Result.setAttribute("data-i18n","Face"),this.selection2Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection2Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"),this.selection2.style.display="block",this.resizeToContent())},r.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick(),this.selection1Result.textContent=this.selection2Result.textContent,this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.hideMeasureResult=function(){this.clearSelectionOne(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.disableUnitOption=function(e){null!=e?this.unitList.dropdownElement.children[e].style.display="none":this.unitList.dropdownElement.disabled=!0},r.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0),this.resizeToContent()},r.prototype.clearSelectionOne=function(){this.selection1Result.setAttribute("data-i18n","Select Object"),this.selection1Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearSelectionTwo=function(){this.selection2Result.setAttribute("data-i18n","Select Object"),this.selection2Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearResult=function(){this.distIcon.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="none",this.angleDiv.style.display="none",this.initialDiv.style.display="inline-block",this.deltaButton.style.display="none",this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"},e.MeasurePanel=r}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5,SNAP_PRECISION=.001;Autodesk.Viewing.Extensions.Measure.Snapper=function(e,t){function i(e,t){this.viewer=e,this.snapper=t,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=this.snapper.getDetectRadius()}var n=e,o=t?["snapper-markup"]:["snapper"],r=!1,s="MeasureTool-snapper-face",a="MeasureTool-snapper-vertex",l="MeasureTool-snapper-edge",c=null,u=Number.MAX_VALUE,h=null,d=null,p=null,v=null,g=null,m=null,f=null,E=null,A=!1,y=!1,T=null,w=null,b=null,C=null,S=null;this.markupMode=t,this.isActive=function(){return r},this.getNames=function(){return o},this.getName=function(){return o[0]},this.activate=function(){r=!0},this.deactivate=function(){r=!1,this.destroy()},this.getFace=function(){return d},this.getEdge=function(){return p},this.getVertex=function(){return v},this.getGeometry=function(){switch(m){case SNAP_VERTEX:return this.getVertex();case SNAP_EDGE:return this.getEdge();case SNAP_FACE:return this.getFace();case SNAP_CIRCULARARC:return this.getEdge();case SNAP_CURVEDEDGE:return this.getEdge();case SNAP_CURVEDFACE:return this.getFace()}},this.getSnapNode=function(){return g},this.getHighlightGeometry=function(){return m},this.getIntersectPoint=function(){return f},this.getFaceNormal=function(){return E},this.getEndPointsInEdge=function(e){for(var t=e.vertices,i=[],n=0;n<t.length;++n){for(var o=!1,r=0;r<t.length;++r)if(r!==n&&t[r].equals(t[n])){o=!0;break}o||i.push(t[n])}return i},this.getViewportIndex=function(){return T},this.getCircularArcCenter=function(){return w},this.getCircularArcRadius=function(){return b},this.getDetectRadius=function(){return c},this.isSnapped=function(){return y},this.setClip=function(e){C=e},this.setFirstClickVpId=function(e){S=e},this.isEqualWithPrecision=function(e,t){return Math.abs(e-t)<=SNAP_PRECISION},this.isEqualVectorsWithPrecision=function(e,t){return Math.abs(e.x-t.x)<=SNAP_PRECISION&&Math.abs(e.y-t.y)<=SNAP_PRECISION&&Math.abs(e.z-t.z)<=SNAP_PRECISION},this.isInverseVectorsWithPrecision=function(e,t){return Math.abs(e.x+t.x)<=SNAP_PRECISION&&Math.abs(e.y+t.y)<=SNAP_PRECISION&&Math.abs(e.z+t.z)<=SNAP_PRECISION},this.snapping3D=function(e){g=e.dbId;var t=e.face;f=e.intersectPoint;var i;if(i=void 0===e.fragId.length?[e.fragId]:e.fragId,n.model.hasTopology()){g&&(i=[],n.model.getData().instanceTree.enumNodeFragments(g,function(e){i.push(e)},!0)),d=p=v=null,u=Number.MAX_VALUE;for(var o=0;o<i.length;++o){var r=i[o],s=n.impl.getRenderProxy(n.model,r),a=s.geometry,l=n.model.getTopoIndex(r),A=n.model.getTopology(l),T=A.faces,C=A.edges;A.vertices;if(!d){d=this.faceSnappingWithTopology(t,a,T,s),d&&(d.fragId=r);var S=(new THREE.Matrix3).getNormalMatrix(s.matrixWorld);E=t.normal.applyMatrix3(S).normalize()}this.edgeSnappingWithTopology(f,a,C,s)}if(v=this.vertexSnappingWithTopology(p,f),d){if(c=this.setDetectRadius(f),h<c)this.drawPoint(v),m=SNAP_VERTEX;else if(u<c){this.drawLine(p);var k=this.edgeIsCircle(p);k?(w=k,b=k.distanceTo(p.vertices[0]),m=SNAP_CIRCULARARC):m=this.edgeIsCurved(p)?SNAP_CURVEDEDGE:SNAP_EDGE}else this.drawFace(d),m=this.faceIsCurved(d)?SNAP_CURVEDFACE:SNAP_FACE;y=!0}}else for(var o=0;o<i.length;++o){var r=i[o],s=n.impl.getRenderProxy(n.model,r),a=s.geometry;if(d=this.faceSnapping(t,a)){d.applyMatrix(s.matrixWorld),p=this.edgeSnapping(d,f),v=this.vertexSnapping(p,f);var S=(new THREE.Matrix3).getNormalMatrix(s.matrixWorld);E=t.normal.applyMatrix3(S).normalize(),c=this.setDetectRadius(f),h<c?(this.drawPoint(v),m=SNAP_VERTEX):u<c?(this.drawLine(p),m=SNAP_EDGE):(this.drawFace(d),m=SNAP_FACE),y=!0;break}}},this.faceSnappingWithTopology=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Geometry,l=t.attributes;if(void 0!==l.index){for(var c=t.vb?t.vb:l.position.array,u=t.vb?t.vbstride:3,h=0;h<i.length;h++){for(var d=i[h].indexList,p=i[h].id,v=0;v<d.length;v+=3)if(e.a===d[v]){if(e.b===d[v+1]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v+1])break}else if(e.a===d[v+1]){if(e.b===d[v]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v])break}else if(e.a===d[v+2]&&(e.b===d[v]&&e.c===d[v+1]||e.b===d[v+1]&&e.c===d[v]))break;if(v<d.length)break}if(h<i.length)for(var v=0;v<d.length;v+=3){o.set(c[d[v]*u],c[d[v]*u+1],c[d[v]*u+2]),r.set(c[d[v+1]*u],c[d[v+1]*u+1],c[d[v+1]*u+2]),s.set(c[d[v+2]*u],c[d[v+2]*u+1],c[d[v+2]*u+2]);var g=a.vertices.length;a.vertices.push(o.clone()),a.vertices.push(r.clone()),a.vertices.push(s.clone()),a.faces.push(new THREE.Face3(g,g+1,g+2))}}return a.vertices.length>0?(a.faceId=p,a.applyMatrix(n.matrixWorld),a):null},this.faceSnapping=function(e,t){var i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Geometry,s=t.attributes;if(void 0!==s.index){var a=s.index.array||t.ib,l=t.vb?t.vb:s.position.array,c=t.vb?t.vbstride:3,u=t.offsets;u&&0!==u.length||(u=[{start:0,count:a.length,index:0}]);for(var h=0;h<u.length;++h)for(var d=u[h].start,p=u[h].count,v=u[h].index,g=d;g<d+p;g+=3){var m=v+a[g],f=v+a[g+1],E=v+a[g+2];i.set(l[m*c],l[m*c+1],l[m*c+2]),n.set(l[f*c],l[f*c+1],l[f*c+2]),o.set(l[E*c],l[E*c+1],l[E*c+2]);var A=THREE.Triangle.normal(i,n,o),y=new THREE.Vector3;if(y.set(l[e.a*c],l[e.a*c+1],l[e.a*c+2]),this.isEqualVectorsWithPrecision(A,e.normal)&&this.isEqualWithPrecision(A.dot(i),e.normal.dot(y))){var T=r.vertices.length;r.vertices.push(i.clone()),r.vertices.push(n.clone()),r.vertices.push(o.clone()),r.faces.push(new THREE.Face3(T,T+1,T+2))}}}return r.vertices.length>0?this.getTrianglesOnSameFace(r,e,l,c):null},this.getTrianglesOnSameFace=function(e,t,i,n){var o=!1,r=e.vertices.slice(),s=new THREE.Vector3;s.set(i[t.a*n],i[t.a*n+1],i[t.a*n+2]);var a=new THREE.Vector3;a.set(i[t.b*n],i[t.b*n+1],i[t.b*n+2]);var l=new THREE.Vector3;l.set(i[t.c*n],i[t.c*n+1],i[t.c*n+2]);var c=new THREE.Geometry;c.vertices.push(s),c.vertices.push(a),c.vertices.push(l),c.faces.push(new THREE.Face3(0,1,2));var u=[];do{u=[];for(var h=0;h<r.length;h+=3)if(r[h].equals(s)&&r[h+1].equals(a)&&r[h+2].equals(l))o=!0,u.push(h);else for(var d=0;d<c.vertices.length;d+=3)if(this.trianglesSharedEdge(r[h],r[h+1],r[h+2],c.vertices[d],c.vertices[d+1],c.vertices[d+2])){var p=c.vertices.length;c.vertices.push(r[h].clone()),c.vertices.push(r[h+1].clone()),c.vertices.push(r[h+2].clone()),c.faces.push(new THREE.Face3(p,p+1,p+2)),u.push(h);break}for(var v=u.length-1;v>=0;--v)r.splice(u[v],3)}while(u.length>0);return o?c:null},this.trianglesSharedEdge=function(e,t,i,n,o,r){var s=!1,a=!1,l=!1;return(e.equals(n)||e.equals(o)||e.equals(r))&&(s=!0),(t.equals(n)||t.equals(o)||t.equals(r))&&(a=!0),(i.equals(n)||i.equals(o)||i.equals(r))&&(l=!0),!!(s&a||s&l||a&l)},this.edgeSnappingWithTopology=function(e,t,i,n){var o,r=new THREE.Geometry,s=Number.MAX_VALUE,a=new THREE.Vector3,l=new THREE.Vector3,c=t.attributes;if(void 0!==c.index&&void 0!=i){for(var h=t.vb?t.vb:c.position.array,d=t.vb?t.vbstride:3,v=0;v<i.length;v++)for(var g=i[v].indexList,m=0;m<g.length-1;m++){a.set(h[g[m]*d],h[g[m]*d+1],h[g[m]*d+2]),l.set(h[g[m+1]*d],h[g[m+1]*d+1],h[g[m+1]*d+2]),a.applyMatrix4(n.matrixWorld),l.applyMatrix4(n.matrixWorld);var f=this.distancePointToLine(e,a,l);f<s&&(s=f,o=v)}if(o){g=i[o].indexList;for(var E=0;E<g.length-1;E++)r.vertices.push(new THREE.Vector3(h[g[E]*d],h[g[E]*d+1],h[g[E]*d+2])),r.vertices.push(new THREE.Vector3(h[g[E+1]*d],h[g[E+1]*d+1],h[g[E+1]*d+2]))}}u>=s&&r.vertices.length>0&&(u=s,r.applyMatrix(n.matrixWorld),p=r)},this.edgeSnapping=function(e,t){for(var i=new THREE.Geometry,n=!0,o=!0,r=!0,s=0;s<e.vertices.length;s+=3){for(var a=0;a<e.vertices.length;a+=3)s!==a&&((e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(n=!1),(e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(o=!1),(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(r=!1));n&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+1].clone())),o&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+2].clone())),r&&(i.vertices.push(e.vertices[s+1].clone()),i.vertices.push(e.vertices[s+2].clone())),n=!0,o=!0,r=!0}for(var l,c=new THREE.Geometry,h=Number.MAX_VALUE,d=0;d<i.vertices.length;d+=2){var p=this.distancePointToLine(t,i.vertices[d],i.vertices[d+1]);p<h&&(h=p,l=d)}return c.vertices.push(i.vertices[l].clone()),c.vertices.push(i.vertices[l+1].clone()),c.vertices=this.getConnectedLineSegmentsOnSameLine(i,c.vertices),u=h,c},this.distancePointToLine=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=e.distanceTo(t):o>1?n=e.distanceTo(i):(r.subVectors(e,t),s.subVectors(e,i),r.cross(s),s.subVectors(i,t),n=Math.sqrt(r.dot(r))/Math.sqrt(s.dot(s))),n},this.getConnectedLineSegmentsOnSameLine=function(e,t){var i=e.vertices.slice(),n=t[0],o=t[1],r=[];do{r=[];for(var s=0;s<i.length;s+=2)if(!i[s].equals(n)||!i[s+1].equals(o))for(var a=0;a<t.length;a+=2)if(i[s].equals(t[a])||i[s+1].equals(t[a])||i[s].equals(t[a+1])||i[s+1].equals(t[a+1])){var l=new THREE.Vector3,c=new THREE.Vector3;if(l.subVectors(t[a],t[a+1]),l.normalize(),c.subVectors(i[s],i[s+1]),c.normalize(),this.isEqualVectorsWithPrecision(l,c)||this.isInverseVectorsWithPrecision(l,c)){r.push(s);break}}for(var u=r.length-1;u>=0;--u)t.push(i[r[u]]),t.push(i[r[u]+1]),i.splice(r[u],2)}while(r.length>0);return t},this.vertexSnappingWithTopology=function(e,t){var i=Number.MAX_VALUE,n=new THREE.Vector3;if(e&&e.vertices.length>1){var o=t.distanceTo(e.vertices[0]),r=t.distanceTo(e.vertices[e.vertices.length-1]);o<=r?(i=o,n=e.vertices[0].clone()):(i=r,n=e.vertices[e.vertices.length-1].clone())}return h=i,n},this.vertexSnapping=function(e,t){for(var i=Number.MAX_VALUE,n=new THREE.Vector3,o=0;o<e.vertices.length;++o){var r=t.distanceTo(e.vertices[o]);r<i-SNAP_PRECISION&&(i=r,n=e.vertices[o].clone())}return h=i,n},this.edgeIsCircle=function(e){var t=e.vertices;if(t.length<8)return!1;if(t[0].equals(t[t.length-1])){for(var i=new THREE.Vector3(0,0,0),n=0;n<t.length;n+=2)i.add(t[n]);i.divideScalar(t.length/2);for(var o=i.distanceTo(t[0]),n=0;n<t.length;n+=2)if(!(Math.abs(i.distanceTo(t[n])-o)<=SNAP_PRECISION))return!1;return i}return!1},this.edgeIsCurved=function(e){var t=e.vertices;if(t.length<=2)return!1;if(t[0].equals(t[t.length-1]))return!0;var i=new THREE.Vector3;i.subVectors(t[0],t[1]);for(var n=new THREE.Vector3,o=2;o<t.length;o+=2)if(n.subVectors(t[o],t[o+1]),!this.isEqualVectorsWithPrecision(i,n))return!0;return!1},this.faceIsCurved=function(e){var t=e.vertices,i=e.faces;if(i.length<=1)return!1;for(var n=THREE.Triangle.normal(t[i[0].a],t[i[0].b],t[i[0].c]),o=t[i[0].a],r=1;r<i.length;r++){var s=THREE.Triangle.normal(t[i[r].a],t[i[r].b],t[i[r].c]),a=t[i[r].a];if(!this.isEqualVectorsWithPrecision(n,s)||!this.isEqualWithPrecision(n.dot(o),s.dot(a)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0?Math.atan(e.y/e.x)+Math.PI:e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null},i.prototype.onLineSegment=function(e,t,i,n,o){var r=this.snapper.getIntersectPoint(),s=this.lineGeom.vertices,a=new THREE.Vector3(e,t,r.z),l=new THREE.Vector3(i,n,r.z),c=this.snapper.distancePointToLine(r,a,l);c<=this.detectRadius&&c<this.minDist&&(s.splice(0,2,a,l),this.minDist=c,this.vpIdLine=o)},i.prototype.onCircularArc=function(e,t,i,n,o,r){var s=this.snapper.getIntersectPoint(),a=new THREE.Vector2(s.x,s.y),l=new THREE.Vector2(e,t),c=a.distanceTo(l);a.sub(l);var u=this.snapper.angleVector2(a);if(Math.abs(c-o)<=this.detectRadius){if(n>i&&u>=i&&u<=n)var h=new THREE.CircleGeometry(o,100,i,n-i);else{if(!(n<i&&(u>=i||u<=n)))return;var h=new THREE.CircleGeometry(o,100,i,2*Math.PI-i+n)}h.vertices.splice(0,1),h.applyMatrix((new THREE.Matrix4).makeTranslation(e,t,s.z)),this.circularArc=h,this.circularArcCenter=new THREE.Vector3(e,t,s.z),this.circularArcRadius=o,this.vpIdCircular=r}},i.prototype.onEllipticalArc=function(e,t,i,n,o,r,s,a){var l=this.snapper.getIntersectPoint(),c=new THREE.Vector2(l.x,l.y),u=o-this.detectRadius,h=r-this.detectRadius,d=o+this.detectRadius,p=r+this.detectRadius,v=(c.x-e)*(c.x-e)/(u*u)+(c.y-t)*(c.y-t)/(h*h),g=(c.x-e)*(c.x-e)/(d*d)+(c.y-t)*(c.y-t)/(p*p),m=new THREE.Vector2(e,t);c.sub(m),c.x*=r,c.y*=o;var f=this.snapper.angleVector2(c);if(n>2*Math.PI&&(n=2*Math.PI),v>=1&&g<=1&&(n>i&&f>=i&&f<=n||n<i&&(f>=i||f<=n))){var E=new THREE.EllipseCurve(e,t,o,r,i,n,!1),A=new THREE.Path(E.getPoints(50)),y=A.createPointsGeometry(50);this.snapper.isEqualWithPrecision(n-i,2*Math.PI)||y.vertices.pop(),y.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,l.z)),this.ellipticalArc=y,this.ellipticalArcCenter=new THREE.Vector3(e,t,l.z),this.vpIdElliptical=a}},this.snapping2D=function(e){if(e){var t=e.intersectPoint,o=e.fragId;if("undefined"!=typeof o){Array.isArray(o)||(o=[o]),f=t,c=this.setDetectRadius(t);var r=null!=n.model.getFragmentList();if(!r)return y=!0,m=SNAP_VERTEX,v=t,void this.drawPoint(v);for(var s=new i(n,this),a=0;a<o.length;++a){var l=n.impl.getRenderProxy(n.model,o[a]),u=new Autodesk.Viewing.Private.VertexBufferReader(l.geometry);u.enumGeomsForObject(e.dbId,s)}if(s.circularArc){if(T=s.vpIdCircular,null!==S&&S!==T)return;t.distanceTo(s.circularArc.vertices[0])<c?(v=s.circularArc.vertices[0],this.drawPoint(v),m=SNAP_VERTEX):t.distanceTo(s.circularArc.vertices[s.circularArc.vertices.length-1])<c?(v=s.circularArc.vertices[s.circularArc.vertices.length-1],this.drawPoint(v),m=SNAP_VERTEX):(this.lineStripToPieces(s.circularArc),p=s.circularArc,this.drawLine(p),w=s.circularArcCenter,b=s.circularArcRadius,m=SNAP_CIRCULARARC),y=!0}else if(s.ellipticalArc){if(T=s.vpIdElliptical,null!==S&&S!==T)return;t.distanceTo(s.ellipticalArc.vertices[0])<c?(v=s.ellipticalArc.vertices[0],this.drawPoint(v),m=SNAP_VERTEX):t.distanceTo(s.ellipticalArc.vertices[s.ellipticalArc.vertices.length-1])<c?(v=s.ellipticalArc.vertices[s.ellipticalArc.vertices.length-1],this.drawPoint(v),m=SNAP_VERTEX):(this.lineStripToPieces(s.ellipticalArc),p=s.ellipticalArc,this.drawLine(p),w=s.ellipticalArcCenter,b=null,m=SNAP_CIRCULARARC),y=!0}else if(s.lineGeom.vertices.length){if(T=s.vpIdLine,null!==S&&S!==T)return;if(this.markupMode){var h=s.lineGeom.vertices[0],d=s.lineGeom.vertices[1],g=new THREE.Vector3;g.addVectors(h,d),g.divideScalar(2);var E=t.distanceTo(g),A=t.distanceTo(h),C=t.distanceTo(d);p=s.lineGeom,E<c?(v=g,this.drawPoint(v),m=SNAP_VERTEX):A<c?(v=h,this.drawPoint(v),m=SNAP_VERTEX):C<c?(v=d,this.drawPoint(v),m=SNAP_VERTEX):(this.drawLine(p),m=SNAP_EDGE)}else t.distanceTo(s.lineGeom.vertices[0])<c?(v=s.lineGeom.vertices[0],this.drawPoint(v),m=SNAP_VERTEX):t.distanceTo(s.lineGeom.vertices[1])<c?(v=s.lineGeom.vertices[1],this.drawPoint(v),m=SNAP_VERTEX):(p=s.lineGeom,this.drawLine(p),m=SNAP_EDGE);y=!0}}}},this.lineStripToPieces=function(e){for(var t=e.vertices,i=t.length-2;i>0;i--)t.splice(i,0,t[i])},this.createOverlay=function(e){n.impl.createOverlayScene(e)},this.addOverlay=function(e,t){n.impl.addOverlay(e,t)},this.clearOverlay=function(){n.impl.overlayScenes[s]&&n.impl.clearOverlay(s),n.impl.overlayScenes[a]&&n.impl.clearOverlay(a),n.impl.overlayScenes[l]&&n.impl.clearOverlay(l)},this.drawFace=function(e){this.createOverlay(s);var t=52224,i=.5,n=new THREE.MeshPhongMaterial({color:t,ambient:t,opacity:i,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),o=new THREE.Mesh(e,n,!0);this.addOverlay(s,o)},this.cylinderMesh=function(e,t,i){var n=(new THREE.Vector3).subVectors(t,e),o=new THREE.Matrix4;o.lookAt(e,t,(new THREE.Object3D).up),o.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var r=new THREE.CylinderGeometry(.5,.5,n.length(),8,1,!0),s=new THREE.Mesh(r,i);return s.applyMatrix(o),s.position.x=(t.x+e.x)/2,s.position.y=(t.y+e.y)/2,s.position.z=(t.z+e.z)/2,s},this.drawLine=function(e){this.createOverlay(l);for(var t=52224,i=.5,n=new THREE.MeshPhongMaterial({color:t,ambient:t,opacity:i,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),o=0;o<e.vertices.length;o+=2){var r=this.cylinderMesh(e.vertices[o],e.vertices[o+1],n);this.setEdgeScale(r),this.addOverlay(l,r)}},this.drawArc=function(e){this.createOverlay(l);for(var t=52224,i=.5,n=new THREE.MeshPhongMaterial({color:t,ambient:t,opacity:i,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),o=0;o<e.vertices.length-1;o++){var r=this.cylinderMesh(e.vertices[o],e.vertices[o+1],n);this.setEdgeScale(r),this.addOverlay(l,r)}},this.drawPoint=function(e){this.createOverlay(a);var t=52224,i=.5,n=new THREE.MeshPhongMaterial({color:t,ambient:t,opacity:i,transparent:!0,depthTest:!1,depthWrite:!1}),o=new THREE.Mesh(new THREE.SphereGeometry(1),n);o.position.set(e.x,e.y,e.z),this.setPointScale(o),this.addOverlay(a,o)},this.setScale=function(e){var t=5,i=n.navigation,o=i.getCamera(),r=i.getEyeVector(),s=i.getPosition(),a=e.position.clone(),l=o.isPerspective?a.sub(s).dot(r.normalize()):i.getEyeVector().length(),c=i.getVerticalFov(),u=2*l*Math.tan(THREE.Math.degToRad(.5*c)),h=i.getScreenViewport(),d=window.devicePixelRatio||1,p=t*u/(h.height*d);return p},this.setPointScale=function(e){var t=this.setScale(e);e.scale.x=t,e.scale.y=t,e.scale.z=t},this.setEdgeScale=function(e){var t=this.setScale(e);e.scale.x=t,e.scale.z=t},this.updatePointScale=function(){var e=n.impl.overlayScenes[a];if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var o=t.children[i];o&&this.setPointScale(o)}},this.updateEdgeScale=function(){var e=n.impl.overlayScenes[l];if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var o=t.children[i];o&&this.setEdgeScale(o)}},this.setDetectRadius=function(e){var t=av.isMobileDevice()?25:10,i=n.navigation,o=i.getCamera(),r=i.getEyeVector(),s=i.getPosition(),a=e.clone(),l=o.isPerspective?a.sub(s).dot(r.normalize()):i.getEyeVector().length(),c=i.getVerticalFov(),u=2*l*Math.tan(THREE.Math.degToRad(.5*c)),h=i.getScreenViewport(),d=window.devicePixelRatio||1,p=t*u/(h.height*d);return p},this.drawIntersectFace=function(e,t,i,n){this.createOverlay();var o=new THREE.Vector3;o.set(t[e.a*i],t[e.a*i+1],t[e.a*i+2]);var r=new THREE.Vector3;r.set(t[e.b*i],t[e.b*i+1],t[e.b*i+2]);var s=new THREE.Vector3;s.set(t[e.c*i],t[e.c*i+1],t[e.c*i+2]);var a=new THREE.Geometry;a.vertices.push(o),a.vertices.push(r),a.vertices.push(s),a.faces.push(new THREE.Face3(0,1,2));var l=new THREE.Mesh(a,n.material,!0);l.matrixWorld=n.matrixWorld,this.addOverlay(l)},this.handleWheelInput=function(e){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(e,t){return A=!0,!1},this.handleButtonUp=function(e,t){return A=!1,!1},this.handleMouseMove=function(e){if(!A){this.clearOverlay(),d=null,p=null,v=null,y=!1;var t=n.impl.snappingHitTest(e.canvasX,e.canvasY,!1);t&&t.intersectPoint&&(t.face?this.snapping3D(t):this.snapping2D(t))}return!1},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.destroy=function(){this.clearOverlay(),n.impl.removeOverlayScene(s),n.impl.removeOverlayScene(a),n.impl.removeOverlayScene(l)},this.onMouseMove=function(e){this.clearOverlay(),d=null,p=null,v=null,m=null,y=!1;var t=n.impl.snappingHitTest(e.x,e.y,!1);t&&t.intersectPoint&&(t.face?this.snapping3D(t):this.snapping2D(t))},this.nearestPointInPointToEdge=function(e,t){for(var i=e.vertices,n=Number.MAX_VALUE,o=null,r=0;r<i.length;r+=2){var s=this.nearestPointInPointToSegment(t,i[r],i[r+1]),a=t.distanceTo(s);a<n&&(n=a,o=s)}return o},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)}},function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(e){function t(e){if(m)return!1;var t=e.ctrlKey||o&&e.metaKey,i=e.metaKey&&!o;return t||i||e.shiftKey||e.altKey}var i,n=Autodesk.Viewing.Private,o=navigator.userAgent.search("Mac OS")!=-1,r=e.navigation,s=e.container,a=r.getCamera(),l=["firstperson"],c={SHIFT:0,ALT:0,CONTROL:0},u=Autodesk.Viewing.theHotkeyManager.KEYCODES,h=!1,d=!1,p=!0,v=!1,g=0,m=null,f=new THREE.Clock(!0),E=-1,A=5e3,y=1,T=1,w=2,b=2,C=1,S=.5,k=.0035,x=0,M=0,R=0,P=-1e20,V=0,I=0,N=-1e20,D=0,L=0,O=!1,_=!1,H=!1,B=!1,F=!1,z=!1,U=a.fov,G=!1,W=a.isPerspective,j=!1,Y=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(i=new Autodesk.Viewing.Extensions.GamepadModule(e)),this.isActive=function(){return h},this.getNames=function(){return l},this.getName=function(){return l[0]},this.activate=function(t){f.start(),W=a.isPerspective,r.toPerspective(),U=a.fov,r.setVerticalFov(75,!0),y=e.model.getUnitScale();var n=e.model.getBoundingBox().size();T=Math.max(Math.min(Math.min(n.x,n.y),n.z)/10,1e-4),e.canvas.focus(),h=!0,e.getFirstPersonToolPopup()&&!Y&&Q(),addCrosshair(),i&&i.activate(this.getName())},this.deactivate=function(e){h=!1,f.stop(),X(),removeCrosshair(),G&&r.setVerticalFov(U,!0),j&&(W||r.toOrthographic()),i&&i.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(e){0===e?b=w:(b*=e>0?1.1:.9,b<.01&&(b=.01))},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return m="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===m&&this.handleMouseMove(e);case"dragend":return"drag"===m&&(this.handleButtonUp(e,0),m=null,!0)}return!1},this.handleSingleClick=function(e,t){return!1},this.handleButtonDown=function(e,i){X(),g+=1<<i;var n=t(e);return!(0===i&&!n)||(M=e.pageX-window.innerWidth/2,V=e.pageY-window.innerHeight/2,P=e.pageX,N=e.pageY,D=L=0,R=I=0,v=!0,!0)},this.handleMouseMove=function(e){var t=P<-1e10?0:e.pageX-P,i=N<-1e10?0:e.pageY-N;return P=e.pageX,N=e.pageY,v!==p||d||(D+=t*k,L+=i*k),!0},this.handleButtonUp=function(e,t){return g-=1<<t,0!==t||!v||(D=L=0,R=I=0,v=!1,!0)},this.handleKeyDown=function(e,t){if(d)return!1;X();var i=!1,n=!1;switch(t){case u.ESCAPE:break;case u.TAB:n=!1;break;case u.SHIFT:c.SHIFT=1,i=n=!0;break;case u.CONTROL:c.CONTROL=1,i=n=!0;break;case u.ALT:c.ALT=1,i=n=!0;break;case u.SPACE:c.SPACE=1,i=n=!0;break;case u.EQUALS:this.adjustSpeed(1),n=!0;break;case u.DASH:this.adjustSpeed(-1),n=!0;break;case u.ZERO:this.adjustSpeed(0),n=!0;break;case u.UP:case u.w:O=!0,n=!0;break;case u.LEFT:case u.a:H=!0,n=!0;break;case u.DOWN:case u.s:_=!0,n=!0;break;case u.RIGHT:case u.d:B=!0,n=!0;break;case u.q:F=!0,n=!0;break;
case u.e:z=!0,n=!0;break;case u.g:n=!0;break;case u.F1:n=!0}return n},this.handleKeyUp=function(e,t){if(d)return!1;var i=!1,n=!1;switch(t){case u.TAB:n=!1;break;case u.SHIFT:c.SHIFT=0,i=n=!0;break;case u.CONTROL:c.CONTROL=0,i=n=!0;break;case u.ALT:c.ALT=0,i=n=!0;break;case u.SPACE:c.SPACE=0,i=n=!0;break;case u.UP:case u.w:O=!1,n=!0;break;case u.LEFT:case u.a:H=!1,n=!0;break;case u.DOWN:case u.s:_=!1,n=!0;break;case u.RIGHT:case u.d:B=!1,n=!0;break;case u.q:F=!1,n=!0;break;case u.e:z=!1,n=!0;break;case u.g:R=I=0,p=!p,K(p),n=!0;break;case u.F1:Q(),n=!0}return n},this.handleWheelInput=function(e){return!d&&(r.getReverseZoomDirection()&&(e*=-1),x+=e,!0)},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return O=_=!1,H=B=!1,F=z=!1,!1},this.update=function(){if(!h||!r.isActionEnabled("walk"))return!1;var e=f.getDelta();if(E>-1){var t=(new Date).getTime();t-E>A&&X()}a.isPerspective||(console.log("Lost perspective mode: resetting view."),r.toPerspective());var n=a.clone(),o=e*b*T*(1===c.SHIFT?4:1),s=e*S*T*(1===c.SHIFT?4:1);if(0!=x){var l=x*C*T*(1===c.SHIFT?4:1);n.translateZ(-l),x=0}O&&n.translateZ(-o),_&&n.translateZ(o),H&&n.translateX(-o),B&&n.translateX(o),F&&n.translateY(s),z&&n.translateY(-s);var u=n.position,d=0!==u.distanceToSquared(a.position),p=n.target,v=a.target.clone().sub(a.position),g=v.clone().cross(a.up).normalize();if(0!=L){var m=new THREE.Quaternion;m.setFromAxisAngle(g,-L);var y=v.clone();y.applyQuaternion(m);var w=a.worldup.clone(),k=y.angleTo(w),M=THREE.Math.degToRad(5);k>=M&&k<=Math.PI-M&&(v.applyQuaternion(m),n.up.applyQuaternion(m)),L=0}if(0!=D){var R=new THREE.Quaternion;R.setFromAxisAngle(a.worldup,-D),v.applyQuaternion(R),n.up.applyQuaternion(R),D=0}p=u.clone().add(v);var P=0!==p.distanceToSquared(a.target);return(d||P)&&(r.setView(u,p),r.orientCameraUp()),i&&(a=i.update(a)),a.dirty};var q=function(e,t,i,n,o){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(s,e,i,n,o),t>0?(E=(new Date).getTime(),A=t):(E=-1,A=0))},X=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),E=-1},K=function(e){X();var t={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:e?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation"},i=function(){};q(t,0,i)},Q=function(){X();var t={msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:Y},i=function(){};q(t,0,i,null,function(t){Y=t.target.checked,e.setFirstPersonToolPopup(!t.target.checked)})};addCrosshair=function(){n.stringToDOM&&(this.crosshair=n.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),e.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var e=this,t=this.viewer,i=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(t.toolName.indexOf("firstperson")!==-1&&e.firstPersonToolButton){var n=t.active?i.Button.State.ACTIVE:i.Button.State.INACTIVE;e.firstPersonToolButton.setState(n)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,i=Autodesk.Viewing.UI,n=e.getToolbar(!0),o=n.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new i.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(n){var o=t.firstPersonToolButton.getState();o===i.Button.State.INACTIVE?e.setActiveNavigationTool("firstperson"):o===i.Button.State.ACTIVE&&e.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var r=o.getControl("toolbar-cameraSubmenuTool");r?o.addControl(this.firstPersonToolButton,{index:o.indexOf(r.getId())}):o.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var t=e.getToolbar(!1);t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRTool=function(e,t){var i=Autodesk.Viewing,n=e.navigation,o=e.container,r=n.getCamera(),s=["vr"],a=!1,l=null,c=!1,u=!0,h=!1,d={SHIFT:0,ALT:0,CONTROL:0},p=Autodesk.Viewing.theHotkeyManager.KEYCODES,v=0,g=!1,m=!1,f=!1,E=!1,A=!1,y=!1,T=!1,w=new THREE.Clock(!0),b=-1,C=5e3,S=1,k=16,x=15,M=3,R=!1,P=1.75,V=16,I=15,N=(r.fov,r.isPerspective),D=null,L=null,O=null,_=!1,H=-1,B=!0,F=null,z=null,U=.15,G=!1,W=new THREE.Vector3(0,0,0),j=new THREE.Vector3(0,0,0),Y=!1;Math.PI/2;this.isActive=function(){return a},this.getNames=function(){return s},this.getName=function(){return s[0]},this.activate=function(t){if(!a){c=r.worldup&&1===r.worldup.x,u=r.worldup&&1===r.worldup.y,h=r.worldup&&1===r.worldup.z,console.log("VRTool : camera world up = "+r.worldup.x+","+r.worldup.y+","+r.worldup.z),w.start(),Q()?(se(),q(!1),console.log("VR Supported (Web API): Oculus, etc.")):(re(),window.addEventListener("deviceorientation",ee,!0));var i=e.config&&e.config.useVR?e.config.useVR:"";Y="wearality"===i.toLowerCase(),X(!0);var n=e.utilities.getBoundingBox(!0).size();S=Math.max(Math.min(Math.min(n.x,n.y),n.z)/100,1),this.resetPointerTracking(),e.canvas.focus(),ne(),a=!0}},this.deactivate=function(e){a&&(a=!1,ie(),D&&(O&&(O.stop(),O=null),D.disconnect(),D=null,L&&L.disable()),X(!1),i.exitFullscreen(),w.stop(),q(!0))},this.getCursor=function(){return"url(data:image/gif;base64,R0lGODlhGAAYAMIDAAQEBH19feDg4P///////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAYABgAAAMqSLrc/jDKSau9OOvN8fjDNghBIITZEABAgHpr+15jeYpgp+987//AICEBADs=), auto"};var q=function(e){var t=document.getElementsByClassName("toolbar-menu");t.length>0&&""!==t[0]&&(t[0].style.display=e?"block":"none")},X=function(t){if(t!==!!l)if(console.log("Enable Render Context: "+t),t){e.displayViewCube(!1,!1),N=e.navigation.isPerspective,N||e.navigation.toPerspective();var n=!!F,o=null;if(Y){var r=.075;o={useWarp:n,HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:r,lensSeparationDistance:r,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]}}}else o={useWarp:n};l=new Autodesk.Viewing.Extensions.Oculus.StereoRenderContext(o),e.impl.setUserRenderContext(l),e.resize(e.canvas.clientWidth,e.canvas.clientHeight),F?i.launchFullscreen(e.impl.canvas,{vrDisplay:F}):i.launchFullscreen(e.impl.canvas)}else l=null,e.impl.setUserRenderContext(null),e.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),e.displayViewCube(e.prefs.get("viewCube"),!1)};this.handleSingleTap=function(t){if(D&&t.pointers){if(1===t.pointers.length)return setTimeout(function(){e.setActiveNavigationTool(e.defaultNavigationToolName)},10),!0;if(2===t.pointers.length)return K(),!0}return!1},this.handleDoubleTap=function(e){return!1},this.handlePressHold=function(e){return!1},this.handleGesture=function(e){if(D)switch(e.type){case"dragstart":T=!0;break;case"dragmove":break;case"dragend":T=!1}return!1},this.handleKeyDown=function(e,t){var i=!1,n=!1;switch(t){case p.TAB:n=!0;break;case p.SHIFT:d.SHIFT=1,i=!0,n=!0;break;case p.CONTROL:d.CONTROL=1,i=!0,n=!0;break;case p.ALT:d.ALT=1,i=!0,n=!0;break;case p.SPACE:n=!0;break;case p.EQUALS:this.adjustSpeed(1),n=!0;break;case p.DASH:this.adjustSpeed(-1),n=!0;break;case p.ZERO:this.adjustSpeed(0),n=!0;break;case p.w:if(1===d.CONTROL&&1===d.SHIFT){n=!0;break}case p.UP:g=!0,n=!0;break;case p.LEFT:case p.a:f=!0,n=!0;break;case p.DOWN:case p.s:m=!0,n=!0;break;case p.RIGHT:case p.d:E=!0,n=!0;break;case p.q:y=!0,n=!0;break;case p.e:A=!0,n=!0;break;case p.h:n=!0}return n},this.handleKeyUp=function(e,t){var i=!1,n=!1;switch(t){case p.SHIFT:d.SHIFT=0,i=!0;break;case p.CONTROL:d.CONTROL=0,i=!0;break;case p.ALT:d.ALT=0,i=!0;break;case p.SPACE:F&&J(),n=!0;break;case p.w:if(!g&&1===d.CONTROL&&1===d.SHIFT){setTimeout(function(){X(!1),Y=!Y,X(!0)},10),n=!0;break}case p.UP:g=!1,n=!0;break;case p.LEFT:case p.a:f=!1,n=!0;break;case p.DOWN:case p.s:m=!1,n=!0;break;case p.RIGHT:case p.d:E=!1,n=!0;break;case p.q:y=!1,n=!0;break;case p.e:A=!1,n=!0;break;case p.h:ne(),n=!0}return n},this.handleBlur=function(e){return g=!1,m=!1,f=!1,E=!1,!1},this.update=function(e){if(a){var t=w.getDelta();if(b>-1){var i=(new Date).getTime();i-b>C&&ie()}var o=!1;F&&Z(t)?o=!0:D&&$(t)&&(o=!0);var s=r.clone(),l=t*k*S*(1===d.SHIFT?4:1),c=t*x*S*(1===d.SHIFT?4:1);if(0!=v){var u=v*M*S*(1===d.SHIFT?4:1);s.translateZ(-u),v=0}var h=!1,p=!1,T=!1,P=!1;R&&(h=!0),(g||h)&&s.translateZ(-l),(m||p)&&s.translateZ(l),(f||T)&&s.translateX(-l),(E||P)&&s.translateX(l),A&&s.translateY(c),y&&s.translateY(-c);var V=s.position,I=0!==V.distanceToSquared(r.position);if(I){var N=s.target,L=V.clone().sub(r.position);N.add(L),n.setView(V,N)}return r.dirty}},this.resetPointerTracking=function(){g=m=!1,f=E=!1,A=y=!1,_mouseDraggingLookMode=!1};var K=function(){return R=!R,R?(V=k,k=P,H=(new Date).getTime()):k=V,oe(R),R},Q=function(){function e(e){for(var i=0;i<e.length;++i)e[i]instanceof HMDVRDevice&&(F=e[i]);for(var i=0;i<e.length;++i)e[i]instanceof PositionSensorVRDevice&&(!F||e[i].hardwareUnitId==F.hardwareUnitId)&&(z=e[i],t=!0)}var t=!1;return navigator.getVRDevices?navigator.getVRDevices().then(e):navigator.mozGetVRDevices?navigator.mozGetVRDevices(e):t=!1,t},Z=function(e){if(!z)return!1;var t=z.getState();if(r){if(h?(j.x=t.position.x,j.y=-t.position.z,j.z=t.position.y):(j.x=t.position.x,j.y=t.position.y,j.z=t.position.z),G){var i=W.distanceTo(j);if(i>=U){var n=(i-U)/.0762,o=e*k*S*n,s=j.clone().sub(W).normalize().multiplyScalar(o);r.position.add(s)}}h?(r.quaternion.x=t.orientation.x,r.quaternion.y=-t.orientation.z,r.quaternion.z=t.orientation.y,r.quaternion.w=t.orientation.w):(r.quaternion.x=t.orientation.x,r.quaternion.y=t.orientation.y,r.quaternion.z=t.orientation.z,r.quaternion.w=t.orientation.w);var a=new THREE.Vector3(0,0,-1);h&&(a=new THREE.Vector3(a.x,-a.z,a.y)),a.applyQuaternion(r.quaternion),r.target=r.position.clone().add(a.clone().multiplyScalar(10)),r.dirty=!0}return!0},J=function(){F&&(G=!G,G&&W.copy(j),oe(G))},$=function(e){if(!D)return!1;var t=D.update();if(!t)return!1;if(h){var i=t.z;t.z=t.y,t.y=-i}var o=h?new THREE.Vector3(0,1,0):new THREE.Vector3(0,0,-1),s=o.clone().applyQuaternion(t),a=r.target.clone().sub(r.position).length();if(n.setTarget(r.position.clone().add(s.multiplyScalar(a))),O){if(O.isStarted())if(H<=0)O.checkVideoThreshold(I)&&K();else{var l=O.checkVideoThreshold(I);if(l){if(R){var c=(new Date).getTime(),u=c-H;u>250&&(H=c,k+=V,oe(!0))}}else H=-1}}else{var d=h?new THREE.Vector3(0,0,-1):new THREE.Vector3(0,-1,0),p=THREE.Math.radToDeg(s.angleTo(d));if(p<30)if(_){if(R){var c=(new Date).getTime(),u=c-H,v=B?1500:1e3;u>=v&&(B=!1,H=c,k+=V,oe(!0))}}else K(),_=!0,R&&(B=!0);else p>=30&&(_=!1,H=-1)}return r.dirty=!0,!0},ee=function(e){return!!e.alpha&&(window.removeEventListener("deviceorientation",ee,!0),D=new THREE.DeviceOrientationControls,D.connect(),L||(L=new window.NoSleep,L.enable()),O=new VideoHelper("videoVR","videoVR-canvas",1),O.start()||(O=null,console.log("VideoHelper : Failed to start.")),q(!1),console.log("VR Supported (DeviceOrientation): Google Goggles, etc."),!0)},te=function(e,t){Autodesk.Viewing.Private.HudMessage.dismiss(),Autodesk.Viewing.Private.HudMessage.displayMessage(o,e),b=(new Date).getTime(),(!t||t<=0)&&(t=5e3),C=t},ie=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),b=-1},ne=function(){var e={msgTitleKey:"Virtual Reality Tool",messageKey:"Virtual Reality Tool",messageDefaultValue:"This is the Virtual Reality tool"};te(e,3e3)},oe=function(e,t){(!t||t<=0)&&(t=250);var i=Autodesk.Viewing.i18n.translate("START Auto Move"),n=Autodesk.Viewing.i18n.translate("STOP Auto Move"),o=e?i+" ("+Math.floor(k)+")":n,r={msgTitleKey:"VR Toggle Move",messageKey:"VR Toggle Move",messageDefaultValue:o};te(r,t)},re=function(){var e={msgTitleKey:"VR Device Orientation",messageKey:"VR Device Orientation",messageDefaultValue:"VR Mode Enabled Device Orientation"};te(e,2e3)},se=function(){var e={msgTitleKey:"VR Head Mounted Display",messageKey:"VR Head Mounted Display",messageDefaultValue:"VR Mode Enabled Head Mounted Display"};te(e,2e3)}},AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.VR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.VR.VRExtension,Autodesk.Viewing.Extensions.VR.VRExtension.prototype.load=function(){var e=this,t=this.viewer,i=t.getToolbar(!0),n=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.VR.VRTool(t,this),t.toolController.registerTool(this.tool),this.createUI(i),this.onToolChanged=function(t){if(t.toolName.indexOf("vr")!==-1){var i=t.active?n.Button.State.ACTIVE:n.Button.State.INACTIVE;e.vrToolButton.setState(i)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.createUI=function(e){var t=this,i=this.viewer,n=Autodesk.Viewing.UI,o=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new n.Button("toolbar-vrTool"),this.vrToolButton.setToolTip("Virtual Reality Tool"),this.vrToolButton.setIcon("toolbar-vrToolButton"),this.vrToolButton.onClick=function(e){var o=t.vrToolButton.getState();o===n.Button.State.INACTIVE?i.setActiveNavigationTool("vr"):o===n.Button.State.ACTIVE&&i.setActiveNavigationTool()};var r=o.getControl("toolbar-cameraSubmenuTool");r?o.addControl(this.vrToolButton,{index:o.indexOf(r.getId())}):o.addControl(this.vrToolButton)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.unload=function(){var e=this.viewer;e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var t=e.getToolbar(!1);return t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId()),this.vrToolButton=null,e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.VR",Autodesk.Viewing.Extensions.VR.VRExtension),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}function t(e){function t(){return 100*e.model.getUnitScale()}function i(e){var t=e[1];return e[1]=-e[2],e[2]=t,e}function s(e,t){var i=t.model.getData().globalOffset;return i&&(e[0]+=i.x,e[1]+=i.y,e[2]+=i.z),e}function l(e){return e.isOrthographic?e.orthographicHeight*e.aspectRatio:r(Math.tan(a(e.fieldOfView)*e.aspectRatio))}function c(e){var i=t(e.Units);e.View.Eye[0]*=i,e.View.Eye[1]*=i,e.View.Eye[2]*=i,e.Projection.IsOrthographic&&(e.Projection.Extent*=i)}var u=new Autodesk.Viewing.Private.ViewerState(e).getState(),h=u.viewport,d=h.eye,p=h.target,v=h.up;d=s(d,e),p=s(p,e),d=i(d),p=i(p),v=i(v),p=o([p[0]-d[0],p[1]-d[1],p[2]-d[2]]),v=o(v);var g=l(h),m=n(e),f={Projection:{Extent:g,IsOrthographic:h.isOrthographic,NativeAspect:h.aspectRatio},Units:m,View:{Eye:d,At:p,Up:v}};return c(f),f.Units="CENTIMETER",f}function i(e,t){function i(e,t){var i=1/(100*t.model.getUnitScale()),n=1;switch(e.toUpperCase()){case"FOOT":n=1/30.48;break;case"INCH":n=1/2.54;break;case"KILOMETER":n=1e-5;break;case"METER":n=.01;break;case"CENTIMETER":n=1;break;case"MILLIMETER":n=10}return i}function n(e){var t=e[1];return e[1]=e[2],e[2]=-t,e}function a(e,t,n){var o=i(t.Units,n);e.viewport.eye[0]*=o,e.viewport.eye[1]*=o,e.viewport.eye[2]*=o,e.viewport.isOrthographic&&(e.viewport.orthographicHeight*=o)}function l(e,t){var i=t.model.getData().globalOffset;return i&&(e[0]-=i.x,e[1]-=i.y,e[2]-=i.z),e}function c(e,t){var i=t.Projection,n=i.NativeAspect;i.IsOrthographic?e.viewport.orthographicHeight=i.Extent/n:e.viewport.fieldOfView=s(r(Math.tan(i.Extent))/n)}t=JSON.parse(JSON.stringify(t)),t.Projection.IsOrthographic=t.Projection.IsOrthographic||t.Projection.isOrthographic;var u=n(t.View.Eye),h=o(n(t.View.At)),d=o(n(t.View.Up)),p=t.Projection.NativeAspect,v=t.Projection.IsOrthographic,g=v?"orthographic":"perspective",m={viewport:{eye:u,target:[u[0]+h[0],u[1]+h[1],u[2]+h[2]],up:d,aspectRatio:p,projection:g,isOrthographic:v}};c(m,t),a(m,t,e),l(m.viewport.eye,e),m.viewport.target=[m.viewport.eye[0]+10*h[0],m.viewport.eye[1]+10*h[1],m.viewport.eye[2]+10*h[2]],new Autodesk.Viewing.Private.ViewerState(e).restoreState(m)}function n(e){var t=e.model.getUnitScale();switch(t){case 1:return"METER";case.3048:return"FOOT";case.0254:return"INCH";case.01:return"CENTIMETER";case.001:return"MILLIMETER";case 1e3:return"KILOMETER";default:return"METER"}}function o(e){var t=e[0],i=e[1],n=e[2],o=Math.sqrt(t*t+i*i+n*n);if(0===o)return e;var r=1/o;return[t*r,i*r,n*r]}function r(e){var t=Math.atan(e);return t<0?t+Math.PI:t}function s(e){return e*(180/Math.PI)}function a(e){return e*(Math.PI/180)}var l=AutodeskNamespace("Autodesk.Viewing.Extensions.RaaS");c=Object.create(Autodesk.Viewing.Extension.prototype),c.constructor=e,l.RaaS=e;var c=e.prototype;c.load=function(){return!0},c.unload=function(){return!0},c.setShot=function(e){},c.getShot=function(){},c.getCameraAsRenderDescriptor=function(){return t(this.viewer)},c.setCameraFromViewName=function(e){var t=this.viewer.model.getDocumentNode();t.search({type:"3d",role:"view"}),this.viewer.setViewCube(e)},c.setCameraFromRenderDescriptor=function(e){return i(this.viewer,e)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.RaaS",e)}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e;var i=e.prototype;i.load=function(){var e=this.viewer,i=e.getToolbar(!0);return this.tool=new t.ZoomWindowTool(e),e.toolController.registerTool(this.tool),this.createUI(i),!0},i.createUI=function(e){var t=this,i=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);i.dollybutton&&(i.removeControl(i.dollybutton.getId()),this.defaultDollyButton=i.dollybutton),this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("adsk-icon-zoom"),this.createZoomSubmenu(this.zoomWindowToolButton),i.addControl(this.zoomWindowToolButton);var n=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){t.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(t.viewer.setActiveNavigationTool(),t.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}];Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,n)},i.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1);if(t){var i=t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);i&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(i)),i.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,i.panbutton&&this.defaultDollyButton?i.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},i.createNavToggler=function(e,t,i){return function(){var n=t.getState();n===Autodesk.Viewing.UI.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):n===Autodesk.Viewing.UI.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},i.createZoomSubmenu=function(e){var t=this.viewer,i=t.getToolbar(!0),n=(i.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"));n.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),n.setIcon("toolbar-zoomWindowTool"),n.onClick=this.createNavToggler(t,n,"zoomwindow"),e.addControl(n);var o=new Autodesk.Viewing.UI.Button("toolbar-zoomTool");o.setToolTip("Zoom"),o.setIcon("adsk-icon-zoom"),o.onClick=this.createNavToggler(t,o,"dolly"),e.addControl(o),e.onClick=o.onClick},i.unload=function(){var e=this.viewer;return"dolly"!==e.getActiveNavigationTool()&&"zoomwindow"!==e.getActiveNavigationTool()||e.setActiveNavigationTool(),this.destroyUI(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",e)}(),function(){"use strict";function e(e){var n=["zoomwindow"],o=!1,r=!1,s=new THREE.Vector3(0,0,-10),a=new THREE.Vector3(0,0,-10),l=null,c=null,u=null,h=null,d=null,p=e.navigation.getCamera();this.isActive=function(){return o},this.getNames=function(){return n},this.getName=function(){return n[0]},this.onResize=function(){d=null;var t=e.canvas,i=t.clientWidth,n=t.clientHeight,o=new THREE.OrthographicCamera(0,i,0,n,1,1e3);e.impl.overlayScenes.ZoomWindowRect.camera=o},this.activate=function(t){if(o=!0,null===l){var i=null;i=e.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),l=new THREE.LineBasicMaterial({color:i,opacity:.6,linewidth:1})}var n=e.canvas,r=n.clientWidth,s=n.clientHeight,a=new THREE.OrthographicCamera(0,r,0,s,1,1e3);e.impl.createOverlayScene("ZoomWindowRect",l,l,a),e.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);var c=e.toolController.getTool("dolly");c.activate("orbit")},this.deactivate=function(t){d=null,e.impl.removeOverlayScene("ZoomWindowRect"),o=!1,r=!1,e.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);var i=e.toolController.getTool("dolly");i.deactivate("orbit")},this.getCursor=function(){var t=e.toolController.getTool("dolly"),i=t.getTriggeredMode();switch(i){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"},this.handleGesture=function(e){return!0},this.handleSingleClick=function(e,t){return!0},this.startDrag=function(t){if(r===!1){if(r=!0,s.x=t.canvasX,s.y=t.canvasY,a.x=t.canvasX,a.y=t.canvasY,null===d){c=new THREE.Geometry,c.vertices.push(s.clone(),s.clone(),s.clone(),s.clone(),s.clone()),u=new THREE.Geometry,u.vertices.push(s.clone(),s.clone()),h=new THREE.Geometry,h.vertices.push(s.clone(),s.clone());var i=new THREE.Line(c,l,THREE.LineStrip),n=new THREE.Line(u,l,THREE.LineStrip),o=new THREE.Line(h,l,THREE.LineStrip);d=new THREE.Group,d.add(i),d.add(n),d.add(o)}else c.vertices[0]=s.clone(),c.vertices[1]=s.clone(),c.vertices[2]=s.clone(),c.vertices[3]=s.clone(),c.vertices[4]=s.clone(),u.vertices[0]=s.clone(),u.vertices[1]=s.clone(),h.vertices[0]=s.clone(),h.vertices[1]=s.clone(),u.verticesNeedUpdate=!0,h.verticesNeedUpdate=!0,c.verticesNeedUpdate=!0;e.impl.addOverlay("ZoomWindowRect",d)}},this.handleButtonDown=function(e,t){return 0===t&&(this.startDrag(e),!0)},this.handleMouseMove=function(e){return!(!c||!r)&&(a.x=e.canvasX,a.y=e.canvasY,!0)},this.endDrag=function(t){r===!0&&(e.impl.removeOverlay("ZoomWindowRect",d),r=!1)},this.handleButtonUp=function(e,t){return 0===t&&(this.endDrag(),!0)},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return!1},this.update=function(){if(this.isActive()){if(!c||!r)return this.zoomWindow();c.vertices[1].x=s.x,c.vertices[1].y=a.y,c.vertices[2]=a.clone(),c.vertices[3].x=a.x,c.vertices[3].y=s.y,c.vertices[4]=c.vertices[0];var t=Math.abs(a.x-s.x),n=Math.abs(a.y-s.y),o=t>n?n:t;o>i&&(o=i);var l=.5*o,d=[.5*(a.x+s.x),.5*(a.y+s.y)];return u.vertices[0].x=d[0]-l,u.vertices[0].y=d[1],u.vertices[1].x=d[0]+l,u.vertices[1].y=d[1],h.vertices[0].x=d[0],h.vertices[0].y=d[1]-l,h.vertices[1].x=d[0],h.vertices[1].y=d[1]+l,u.verticesNeedUpdate=!0,h.verticesNeedUpdate=!0,c.verticesNeedUpdate=!0,e.impl.invalidate(!1,!1,!0),!1}},this.getScreenRay=function(e,i,n,o,r){var s=r.position.clone(),a=r.target.clone(),l=a.clone().sub(s),c=r.up.clone(),u=l.clone().cross(c),h=l.length(),d=h*Math.tan(r.fov*t),p=d*r.aspect,v=2*e*p/n,g=v-p,m=2*i*d/o,f=m-d;c=c.normalize().multiplyScalar(f),u=u.normalize().multiplyScalar(g);var E=new THREE.Vector3,A=new THREE.Vector3;return r.isPerspective?(E=s.clone(),A=l.clone(),A.add(c),A.add(u)):(E=s.clone(),E.add(u),E.add(c),A.add(l)),{rayOrigin:E,rayDirection:A}},this.queryMouseRaySceneIntersection=function(t,i){if(null==e)return null;if(null==e.model)return null;if(e.model.is2d())return null;var n=e.impl.hitTest(t,i,!1);return n?n.intersectPoint:null};this.zoomWindow=function(){var t=p,i=e.canvas.clientWidth,n=e.canvas.clientHeight,o=s.x,r=s.y,l=a.x,c=a.y,u=Math.abs(l-o),h=Math.abs(c-r);if(0===u||0===h)return!1;if(a.copy(s),e.navigation.getIs2D()){var d={x:.5*(o+l),y:.5*(r+c)},v=e.navigation.getEyeVector().length(),g=e.impl.clientToViewport(d.x,d.y),m=e.impl.clientToViewport(i/2,n/2);g.subVectors(g,m),e.navigation.panRelative(g.x/2,g.y/2,v);var f=u/i,E=h/n,A=f>E?f:E;v=e.navigation.getEyeVector().length();var y=e.navigation.getWorldPoint(.5,.5);return e.navigation.dollyFromPoint(v*(A-1),y),!0}var T=!1,w=null;if(!T){var b=.5*(o+l),C=.5*(r+c),S=this.getScreenRay(b,C,i,n,p);w=this.queryMouseRaySceneIntersection(b,C),null===w&&(w=S.rayOrigin.add(S.rayDirection))}var k=t.position.clone(),x=t.target.clone(),M=x.clone().sub(k);M.normalize();var R=t.up.clone();R.normalize();var P=u/h>i/n?i/u:n/h,V=w.distanceTo(k),I=1*V/P,N=M.clone().negate().multiplyScalar(I);k=w.clone().add(N),t.position.set(k.x,k.y,k.z),x=w.clone();var D=x.clone().sub(k);return D.normalize(),t.target.set(x.x,x.y,x.z),t.dirty=!0,!0}}AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");var t=.017453292519943295,i=20;Autodesk.Viewing.Extensions.ZoomWindow.ZoomWindowTool=e}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");var e=Autodesk.Viewing,t=e.UI,i=e.Extensions.FusionOrbit,n=function(t,i){e.Extension.call(this,t,i)};n.prototype=Object.create(e.Extension.prototype),n.prototype.constructor=n,n.prototype.load=function(){function t(){o.removeEventListener(e.TOOLBAR_CREATED_EVENT,t),n.createUI()}var n=this,o=this.viewer,r=o.getToolbar?o.getToolbar(!0):void 0;if(this.tool=new i.FusionOrbitTool,this.tool.setViewer(o),o.toolController.registerTool(this.tool),r){var s=r.getControl(e.TOOLBAR.MODELTOOLSID);s&&s.getNumberOfControls()>0?t():o.addEventListener(e.TOOLBAR_CREATED_EVENT,t)}else o.addEventListener(e.TOOLBAR_CREATED_EVENT,t);return!0},n.prototype.createUI=function(){var i=this.viewer,n=i.getToolbar(!1),o=n.getControl(e.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=o.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=o.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=o.returnToDefault,o.freeorbitbutton.onClick=function(e){var n=o.freeorbitbutton.getState();n===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit"),o.freeorbitbutton.setState(t.Button.State.ACTIVE)):n===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),o.freeorbitbutton.setState(t.Button.State.INACTIVE))},o.orbitbutton.onClick=function(e){var n=o.orbitbutton.getState();n===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit constrained"),o.orbitbutton.setState(t.Button.State.ACTIVE)):n===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),o.orbitbutton.setState(t.Button.State.INACTIVE))},o.returnToDefault=function(){o.orbittoolsbutton.setState(t.Button.State.ACTIVE),o.orbittoolsbutton.setState(t.Button.State.INACTIVE)},o.orbittoolsbutton.setState(t.Button.State.INACTIVE),i.prefs.fusionOrbitConstrained?(o.orbittoolsbutton.onClick=o.orbitbutton.onClick,o.orbittoolsbutton.setIcon(o.orbitbutton.iconClass),i.setDefaultNavigationTool("orbit")):(o.orbittoolsbutton.onClick=o.freeorbitbutton.onClick,o.orbittoolsbutton.setIcon(o.freeorbitbutton.iconClass),i.setDefaultNavigationTool("freeorbit")),i.setActiveNavigationTool(),o.returnToDefault()},n.prototype.unload=function(){var i=this.viewer,n=i.getToolbar(!1),o=n.getControl(e.TOOLBAR.NAVTOOLSID);return o&&(o.orbitbutton&&(o.orbitbutton.onClick=this.classicBehavior.orbitOnClick),o.freeorbitbutton&&(o.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),
o.returnToDefault=this.classicBehavior.returnToDefault,o.orbittoolsbutton&&(o.orbittoolsbutton.onClick=o.orbitbutton.onClick,o.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),o.orbittoolsbutton.setState(t.Button.State.ACTIVE))),i.setActiveNavigationTool("orbit"),i.setDefaultNavigationTool("orbit"),i.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},i.FusionOrbitExtension=n,e.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",n)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var e,t,i,n,o,r,s=Autodesk.Viewing,a=Autodesk.Viewing.Private,l=["fusion orbit","fusion orbit constrained"],c=.8,u=1.2,h="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",d={HORIZONTAL:0,VERTICAL:1,ROLL:2},p={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},v=s.isTouchDevice(),g=!1,m={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},f=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null};var E=function(e){m.buttons[e.touches?0:e.button]=!0,m.src=e.target.className,m.x=0,m.y=0,m.dx=0,m.dy=0,m.firstMove=!0,m.mode=void 0,"ring"===m.src?m.mode=d.ROLL:"edgemark-area"===m.src&&("layout-ver"===e.target.parentNode.className?m.mode=d.HORIZONTAL:"layout-hor"===e.target.parentNode.className&&(m.mode=d.VERTICAL)),S(),e.stopPropagation()},A=function(e){m.buttons[e.touches?0:e.button]=!1,m.src=void 0},y=function(e){m.buttons[0]&&(T(e),w(),m.firstMove=!1)},T=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY;m.firstMove||(m.dx=t-m.x,m.dy=i-m.y),m.x=t,m.y=i},w=function(){switch(m.mode){case d.ROLL:if(!f.navapi.isActionEnabled("roll"))return;break;case d.HORIZONTAL:case d.VERTICAL:if(!f.navapi.isActionEnabled("orbit"))return}var e=r.target.clone().sub(r.position).normalize(),i=e.clone().cross(r.up).normalize(),n=i.clone().cross(e).normalize();if(r.up.copy(n),m.mode===d.ROLL){var s=new THREE.Vector3(m.x-t.center.x,m.y-t.center.y,0),a=new THREE.Vector3(m.dx,m.dy,0).add(s);s.normalize(),a.normalize();var l=s.clone().cross(a),c=Math.asin(l.z);r.up.applyAxisAngle(e,-c*p.ROLL)}else{var u,h;m.mode===d.HORIZONTAL?(h=-m.dx*p.HORIZONTAL,o&&(r.up=Autodesk.Viewing.Navigation.snapToAxis(r.up.clone())),u=r.up):m.mode===d.VERTICAL&&(h=-m.dy*p.VERTICAL,o?(m.firstMove&&(r.up=Autodesk.Viewing.Navigation.snapToAxis(r.up.clone())),u=e.clone().cross(r.up).normalize()):u=i,r.up.applyAxisAngle(u,h));var v=f.navapi.getPivotPoint(),g=r.position.clone().sub(v);g.applyAxisAngle(u,h),r.position.addVectors(v,g);var E=r.target.clone().sub(v);E.applyAxisAngle(u,h),r.target.addVectors(v,E)}r.dirty=!0},b=function(){var e=r.target.clone().sub(r.position).normalize(),t=f.viewer.impl.rayIntersect(new THREE.Ray(r.position,e));return t&&t.intersectPoint?t.intersectPoint:r.target},C=function(e,t){var i=t||e.clone().sub(r.position).normalize();return new THREE.Plane(i,-i.x*e.x-i.y*e.y-i.z*e.z)},S=function(){var e=r.target.clone().sub(r.position).normalize(),t=C(r.position,e),i=t.distanceToPoint(r.pivot);r.pivot.copy(e).multiplyScalar(i).add(r.position)},k=function(e){e.touches||0!==e.button||S()},x=function(e){g&&f.viewer.setActiveNavigationTool()},M=function(e,t){var i,n=f.viewer.impl.hitTest(e,t);if(n&&n.intersectPoint)i=n.intersectPoint;else{var o=f.viewer.impl.viewportToRay(f.viewer.impl.clientToViewport(e,t));i=o.intersectPlane(C(r.target))}var s=r.position.clone().sub(b()).add(i);f.navapi.setRequestTransition(!0,s,i,r.fov)};this.register=function(){e=a.stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html),e.style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),i=e.querySelector(".ring"),i.addEventListener("mousedown",E),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),function(e,t){e.addEventListener("mousedown",E),v&&e.addEventListener("touchstart",E)}),window.addEventListener("mouseup",A),window.addEventListener("mousemove",y),n=e.querySelector(".outside"),n.addEventListener("mousedown",x);var t=e.querySelector(".circle");t.addEventListener("mousedown",k),v&&(i.addEventListener("touchstart",E),window.addEventListener("touchend",A),window.addEventListener("touchmove",y),n.addEventListener("touchstart",x),t.addEventListener("touchstart",k)),r=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",A),window.removeEventListener("mousemove",y),n.removeEventListener("mousedown",x),v&&(window.removeEventListener("touchend",A),window.removeEventListener("touchmove",y),n.removeEventListener("touchstart",x)),this.viewer.canvasWrap.removeChild(e),e=void 0,i=void 0,n=void 0},this.activate=function(t){e.style.display="",this.handleResize(),o="fusion orbit constrained"===t;var i=this.viewer.toolController.isToolActivated("hyperlink");i&&this.viewer.toolController.deactivateTool("hyperlink"),o?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),i&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(t){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return l},this.getName=function(){return l[0]},this.update=function(){return!1},this.handleSingleClick=function(e,t){return M(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return M(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){var t,i=this.viewer.impl.canvas.getBoundingClientRect();t=i.width>i.height?new THREE.Vector2(((e.canvasX+.5)/i.width*2-1)*i.width/i.height,2*-((e.canvasY+.5)/i.height)+1):new THREE.Vector2((e.canvasX+.5)/i.width*2-1,(2*-((e.canvasY+.5)/i.height)+1)*i.height/i.width);var o=t.length(),r=o>u;return g!==r&&(r?n.style.cursor="":n.style.cursor=h,g=r),!1},this.handleGesture=function(e){return S(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){t=e.getBoundingClientRect(),t.center={},t.center.x=t.left+t.width/2,t.center.y=t.top+t.height/2;var n=(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)*c;e.style.width=e.style.height=""+n+"px",e.style.top=e.style.left="calc(50% - "+n/2+"px)",i.style.borderWidth=""+.1*n+"px"}},AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function e(e,t,i){function o(t){var i=t.data.msg;if(a.x=i.x1,a.y=i.y1,l.x=i.x2,l.y=i.y2,c=i.explode,i.command)if("gohome"==i.command)a.x=a.y=0,l.x=l.y=0,e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0),u=null;else if("select"==i.command){var n=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));n?e.impl.selector.toggleSelection(n.dbId,n.model):e.impl.selector.clearSelection()}else if("hide"==i.command){var n=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));n&&e.hide(n.dbId)}else if("fly"==i.command)u=u?null:r.target.clone().sub(r.position).normalize();else if("savepoint"==i.command){var i=s.getState(A);f.push(i),alertify.success("Savepoint created.")}else"nextsavepoint"==i.command&&f.length&&(E>=f.length&&(E=0),s.restoreState(f[E++]))}var r,s,a=new THREE.Vector2,l=new THREE.Vector2,c=0,u=null,h=e,d=.02,p=.002,v=.05,g=.01,m=1,f=[],E=0,A={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},y=function(){if(!e.impl.model.is2d()){var t=e.impl.model.getData().bbox.size(),i=t.length();d*=i,p*=i,e.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,y)}};e.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,y),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(e){if(t.addEventListener("joystick",o),i.addEventListener("joystick",o),r=h.navigation.getCamera(),h.model){var a=h.model.getBoundingBox();m=.001*a.size().length(),s=new n.ViewerState(h)}},this.deactivate=function(e){t.removeEventListener("joystick",o),i.removeEventListener("joystick",o),r=null,s=null,f.length=0},this.update=function(t){if(r.isPerspective||e.navigation.toPerspective(),u){var i=u.clone().multiplyScalar(p);r.position.add(i),r.target.add(i)}if(0!=c){var n=e.getExplodeScale()+c*g;n>1&&(n=1),n<0&&(n=0),e.explode(n)}if(0==a.x&&0==a.y&&0==l.x&&0==l.y)return!(!u&&!c);var o=r.target.clone().sub(r.position),s=o.length();o.multiplyScalar(1/s);var h=o.clone().cross(r.up).normalize(),m=o.clone().multiplyScalar(a.y*d);r.position.add(m),r.target.add(m);var f=h.clone().multiplyScalar(a.x*d);r.position.add(f),r.target.add(f);var E=new THREE.Quaternion;E.setFromAxisAngle(h,l.y*v);var A=o.clone().applyQuaternion(E);r.up.applyQuaternion(E);var y=new THREE.Quaternion;return y.setFromAxisAngle(r.worldup,-l.x*v),A.applyQuaternion(y),r.up.applyQuaternion(y),A.multiplyScalar(s),r.target.copy(r.position).add(A),u&&u.copy(r.target).sub(r.position).normalize(),!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e,t){return!1},this.handleTouchChange=function(e,t){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=t.UI;n.Collaboration;i.RemoteControl=function(i,o){t.Extension.call(this,i,o),this.viewer=i,this.client=n.MessageClient.GetInstance(),this.p2p=new n.P2PClient(this.client),this.controllerTool=new e(i,this.client,this.p2p),i.toolController.registerTool(this.controllerTool)},i.RemoteControl.prototype=Object.create(t.Extension.prototype),i.RemoteControl.prototype.constructor=i.RemoteControl,i.RemoteControl.prototype.createUI=function(){var e=this,t=this.viewer;this.controlButton=new o.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===o.Button.State.INACTIVE?(e.connect(),this.setState(o.Button.State.ACTIVE)):(e.disconnect(),this.setState(o.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),t.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(t.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body);var i=Autodesk.Viewing.i18n.translate("Go to this link"),n=Autodesk.Viewing.i18n.translate("Scan the QR code with your device"),r=Autodesk.Viewing.i18n.translate("or");this.panel.body.innerHTML=['<p data-i18n="'+i+'">'+i+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>','<p data-i18n="'+r+'">'+r+"</p>",'<p data-i18n="'+n+'">'+n+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},i.RemoteControl.prototype.load=function(){function e(n){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),i.createUI()}var t=this.viewer,i=this;return t.modelTools&&t.modelTools.getNumberOfControls()>0?i.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),!0},i.RemoteControl.prototype.unload=function(){var e=this.viewer;if(this.p2p.hangup(),this.client.disconnect(),e.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{e.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(e){n.logger.error("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},i.RemoteControl.prototype.addCrosshair=function(){this.crosshair=n.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},i.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},i.RemoteControl.prototype.connect=function(e){if(this.client.isConnected())return void console.log("RemoteControl already connected");var t=this;n.loadDependency("lmv_io","socket.io-1.3.5.js",function(){t.connectAux(e)})},i.RemoteControl.prototype.connectAux=function(e){var t=this,i=this.viewer;t.client.addEventListener("connectSucceeded",function(i){function o(){l&&l.setVisible(!1),t.p2p.removeEventListener("dataChannelAdded",o),t.addCrosshair()}n.logger.log("connect succeeded");var r=i.data.id+"rc";t.client.join(r);var s=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+r+"&env="+n.env,a="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(s),l=t.panel;l&&(l.link.href=s,l.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",l.qrImg.src=a,l.setVisible(!0)),t.p2p.addEventListener("dataChannelAdded",o),e&&e instanceof Function&&e(s)}),i.navigation.toPerspective(),t.client.connect(),i.toolController.activateTool(t.controllerTool.getName())},i.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},t.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",i.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(e){function t(){for(var e in N)if(N.hasOwnProperty(e)&&o.buttons[e].pressed&&.5!=o.buttons[e].value)return C[e]=!0,!0;for(var e in C)if(C.hasOwnProperty(e)&&C[e])return!0;return!(Math.abs(o.axes[V.LEFT_STICK_X])<y&&Math.abs(o.axes[V.LEFT_STICK_Y])<y&&Math.abs(o.axes[V.RIGHT_STICK_X])<y&&Math.abs(o.axes[V.RIGHT_STICK_Y])<y)}function i(){for(var e in P)P.hasOwnProperty(e)&&n(P[e])}function n(e){if(o.buttons[e].value>y)switch(C[e]=!0,e){case P.LEFT_SHOULDER:N[e]();break;case P.RIGHT_SHOULDER:N[e]();break;case P.LEFT_TRIGGER:N[e](o.buttons[P.LEFT_TRIGGER].value);break;case P.RIGHT_TRIGGER:N[e](o.buttons[P.RIGHT_TRIGGER].value)}else if(C[e])switch(C[e]=!1,e){case P.SOUTH_BTN:N[e]();break;case P.EAST_BTN:N[e]();break;case P.WEST_BTN:N[e]();break;case P.NORTH_BTN:N[e]();break;case P.NORTH_DPAD:N[e]();break;case P.SOUTH_DPAD:N[e]();break;case P.WEST_DPAD:N[e]();break;case P.EAST_DPAD:N[e]();break;case P.RIGHT_STICK_BUTTON:N[e]();break;case P.LEFT_STICK_BUTTON:N[e]();break;case P.LEFT_TRIGGER:N[e](o.buttons[P.LEFT_TRIGGER].value);break;case P.RIGHT_TRIGGER:N[e](o.buttons[P.RIGHT_TRIGGER].value)}}var o,r,s,a,l,c,u,h,d,p,v=Autodesk.Viewing.Private,g=e.navigation,m=e.container,f=g.getCamera(),E=1,A=0,y=.1,T=5.5,w=6,b=w,C={},S=new THREE.Clock(!0),k={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},x=2,M=75,R=-45,P={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},V={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},I=function(){},N={};for(var D in P)P.hasOwnProperty(D)&&(N[P[D]]=I);var L=function(){};this.activate=function(t){var i=e.model.getBoundingBox().size();E=Math.max(Math.min(Math.min(i.x,i.y),i.z)/10,1e-4),o=navigator.getGamepads()[0],a=new Autodesk.Viewing.Private.ViewerState(e),l=[],c=0,p=t,B(t)},this.deactivate=function(){p=null,a=null},this.update=function(e,n){if(n&&(f=n),e=S.getDelta(),o=navigator.getGamepads()[0],r>-1){var a=(new Date).getTime();a-r>s&&_()}if(o&&(h=e*x*E*b,f.isPerspective||g.toPerspective(),o&&t())){f.dirty=!0,u&&(d=f.position.z);var l=f.target.clone().sub(f.position),c=l.length();l.multiplyScalar(1/c);var p=l.clone().cross(f.up).normalize();if(Math.abs(o.axes[V.LEFT_STICK_Y])>y){var v=l.clone().multiplyScalar(-o.axes[V.LEFT_STICK_Y]*h);f.position.add(v),f.target.add(v)}if(Math.abs(o.axes[V.LEFT_STICK_X])>y){var m=p.clone().multiplyScalar(o.axes[V.LEFT_STICK_X]*h);f.position.add(m),f.target.add(m)}var A=new THREE.Quaternion,T=l;if(Math.abs(o.axes[V.RIGHT_STICK_Y])>y){var w=f.clone(),C=l.clone();A.setFromAxisAngle(p,-o.axes[V.RIGHT_STICK_Y]*h/2),C.applyQuaternion(A),w.up.applyQuaternion(A);var k=w.worldup.clone(),M=C.angleTo(k),R=THREE.Math.degToRad(5);M>=R&&M<=Math.PI-R&&(T=l.clone().applyQuaternion(A),f.up.applyQuaternion(A))}var P=new THREE.Quaternion;Math.abs(o.axes[V.RIGHT_STICK_X])>y&&(P.setFromAxisAngle(f.worldup,-o.axes[V.RIGHT_STICK_X]*h/2),T.applyQuaternion(P),f.up.applyQuaternion(P)),i(),u&&(f.position.z=d),T.multiplyScalar(c),f.target.copy(f.position).add(T)}return f};var O=function(e,t,i,n,o){Autodesk.Viewing.Private.HudMessage.displayMessage(m,e,i,n,o),t>0?(r=(new Date).getTime(),s=t):(r=-1,s=0)},_=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},H=function(e){_();var t;switch(e){case"up":t=u?"Vertical Lock Mode":"Fly mode";break;case"left":break;case"right":break;case"down":}var i={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t};O(i,2e3)},B=function(e){switch(e){case"headtracker":N[P.SOUTH_BTN]=K,N[P.SOUTH_DPAD]=F,N[P.NORTH_DPAD]=ee,N[P.WEST_BTN]=J,N[P.LEFT_SHOULDER]=z,N[P.RIGHT_SHOULDER]=U,N[P.LEFT_TRIGGER]=G,N[P.RIGHT_TRIGGER]=j,N[P.RIGHT_STICK_BUTTON]=Q,N[P.LEFT_STICK_BUTTON]=Z;break;default:N[P.SOUTH_BTN]=K,N[P.EAST_BTN]=Y,N[P.WEST_BTN]=J,N[P.NORTH_BTN]=$,N[P.SOUTH_DPAD]=F,N[P.WEST_DPAD]=q,N[P.EAST_DPAD]=X,N[P.NORTH_DPAD]=ee,N[P.LEFT_SHOULDER]=z,N[P.RIGHT_SHOULDER]=U,N[P.LEFT_TRIGGER]=W,N[P.RIGHT_TRIGGER]=j,N[P.RIGHT_STICK_BUTTON]=Q,N[P.LEFT_STICK_BUTTON]=Z}},F=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},z=function(){u?d+=-o.buttons[P.LEFT_SHOULDER].pressed*h:f.translateY(-o.buttons[P.LEFT_SHOULDER].pressed*h)},U=function(){u?d+=o.buttons[P.RIGHT_SHOULDER].pressed*h:f.translateY(o.buttons[P.RIGHT_SHOULDER].pressed*h)},G=function(t){if(t>y){if(.5==t)return void e.explode(0);A=t;var i=A;i>1&&(i=1),i<0&&(i=0),e.explode(i)}else e.explode(0)},W=function(e){if(e>y){if(.5==e)return f.fov=M,void(C[P.LEFT_TRIGGER]=!1);f.fov=R*e+M}else f.fov=M},j=function(e){if(e>y){if(.5==e)return void(C[P.RIGHT_TRIGGER]=!1);b=-(T*e)+w}else b=w},Y=function(){var e=a.getState(k);l.push(e),v.logger.log("Savepoint created.")},q=function(){l.length&&(c--,c<0&&(c=l.length-1),a.restoreState(l[c]))},X=function(){l.length&&(c++,c>=l.length&&(c=0),a.restoreState(l[c]))},K=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==p&&f.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},Q=function(){e.impl.selector.clearSelection()},Z=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},J=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},$=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},ee=function(){u=!u,u&&(d=f.position.z),H("up")};L()}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var e=this,t=this.viewer;if(this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(t),t.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],t.getToolbar){var i=t.getToolbar(!0);i?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),t.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var n=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return e.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,n),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var e=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),e.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(e.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var e=this.sectionStyle||"X";this.setSectionStyle(e,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(e,t){if(this.supportedStyles.indexOf(e)===-1)return!1;var i=this.isActive(),n=this.sectionStyle!==e||!t;return this.sectionStyle=e,i&&n?this.tool.setSection(e):i||(this.enableSectionTool(!0),n?this.tool.setSection(e):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(e){var t=this.viewer.toolController,i=this.tool.isActive();return e&&!i?(t.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var e=this.viewer,t=Autodesk.Viewing.UI;this.sectionToolButton=new t.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var i=e.getToolbar(!1),n=i.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(n){var o=n.getControl("toolbar-resetTool");o?n.addControl(this.sectionToolButton,{index:n.indexOf(o.getId())}):n.addControl(this.sectionToolButton,{index:0})}},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(e){function t(e,t){return function(){var i=e.getState(),o=function(){n.enableSectionTool(!0),e instanceof r.ComboButton==!1?n.tool.setSection(t):n.tool.attachControl(!0)};i===r.Button.State.INACTIVE?(e.setState(r.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o()):i===r.Button.State.ACTIVE&&(e.setState(r.Button.State.INACTIVE),n.enableSectionTool(!1)),n.sectionStyle=t}}function i(){var e=function(){var e=new THREE.Vector3;return function(t,i,n){return e.subVectors(t,i),e.lengthSq()<n}}(),t=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),a=o.autocam.getWorldRightVector(),l=o.autocam.getWorldUpVector(),c=o.autocam.getWorldFrontVector(),u=1e-4;e(l,t,u)?n.sectionYButton.setIcon("adsk-icon-plane-x"):e(l,s,u)?n.sectionYButton.setIcon("adsk-icon-plane-z"):n.sectionYButton.setIcon("adsk-icon-plane-y"),e(a,r,u)?n.sectionXButton.setIcon("adsk-icon-plane-y"):e(a,s,u)?n.sectionXButton.setIcon("adsk-icon-plane-z"):n.sectionXButton.setIcon("adsk-icon-plane-x"),e(c,t,u)?n.sectionZButton.setIcon("adsk-icon-plane-x"):e(c,r,u)?n.sectionZButton.setIcon("adsk-icon-plane-y"):n.sectionZButton.setIcon("adsk-icon-plane-z"),o.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)}var n=this,o=this.viewer,r=Autodesk.Viewing.UI,s=this.sectionXButton=new r.Button("toolbar-sectionTool-x");s.setToolTip("Add X plane"),s.setIcon("adsk-icon-plane-x"),s.onClick=t(s,"X"),e.addControl(s);var a=this.sectionYButton=new r.Button("toolbar-sectionTool-y");a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=t(a,"Y"),e.addControl(a);var l=this.sectionZButton=new r.Button("toolbar-sectionTool-z");l.setToolTip("Add Z plane"),l.setIcon("adsk-icon-plane-z"),l.onClick=t(l,"Z"),e.addControl(l);var c=this.sectionBoxButton=new r.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=t(c,"BOX"),e.addControl(c),o.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1);if(t){var i=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(i&&this.sectionToolButton){var n=i.getControl("toolbar-inspectSubMenu");n?n.removeControl(this.sectionToolButton.getId()):i.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(e,t){function i(){V||(E=new THREE.TransformControls(y.camera,y.canvas,"transrotate"),E.addEventListener("change",o),E.setSnap(Math.PI/2,Math.PI/36),A=new THREE.TransformControls(y.camera,y.canvas,"translate"),A.addEventListener("change",o),void 0===y.overlayScenes[R]&&y.createOverlayScene(R),y.addOverlay(R,E),y.addOverlay(R,A),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,r),e.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,s),e.addEventListener(Autodesk.Viewing.HIDE_EVENT,s),e.addEventListener(Autodesk.Viewing.SHOW_EVENT,s),V=!0)}function n(){V&&(y.removeOverlay(R,E),E.removeEventListener("change",o),E=null,y.removeOverlay(R,A),A.removeEventListener("change",o),A=null,y.removeOverlayScene(R),e.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,r),e.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,s),e.removeEventListener(Autodesk.Viewing.HIDE_EVENT,s),e.removeEventListener(Autodesk.Viewing.SHOW_EVENT,s),V=!1)}function o(){y.invalidate(!1,!1,!0)}function r(){E&&E.update(),A&&A.update()}function s(){1===k.length&&(u(!0),r(),l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)))}function a(e){return e.color||new THREE.Color(16777215)}function l(e){init_three_triangulator(),init_three_intersector();var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t);var i=new THREE.Object3D;i.name="section",y.sceneAfter.add(i);var n=new THREE.Object3D;i.add(n);var o=new THREE.Object3D;i.add(o);var r=Autodesk.Viewing.Private,s=r.Intersector.makePlaneBasis(e),l=(new THREE.Matrix4).getInverse(s),c=y.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),u=y.matman().findMaterial(null,c);u.transparent=!0,u.depthTest=!0,u.polygonOffset=!0,u.polygonOffsetFactor=-1,u.polygonOffsetUnits=.1;var h=new THREE.Box3,d=y.getVisibleBounds(!0),p=(25e-6*d.size().length(),y.modelQueue().getModels());p.forEach(function(t){var i=t.getData().instanceTree;if(i){var c=t.getFragmentList();i.enumNodeChildren(t.getRootId(),function(t){if(!i.isNodeHidden(t)&&!i.isNodeOff(t)){var d,p=[];if(i.enumNodeFragments(t,function(t){c.getWorldBounds(t,h),r.Intersector.intersectBoxPlane(e,h)&&(d=c.getVizmesh(t),d.geometry&&(d.geometry.is2d||d.geometry.isLines||d.material.cutplanes&&r.Intersector.intersectMeshPlane(e,d,p)))},!1),p.length){var v=new THREE.Box3;r.Intersector.convertToPlaneCoords(s,p,v);var g=new r.VertexBufferBuilder(!1,8*p.length),m=a(d.material),f=0|.25*m.r*255.5,E=0|.25*m.g*255.5,A=0|.25*m.b*255.5,T=4278190080|A<<16|E<<8|f,w=new r.Triangulator.ContourSet(p,v);w.snapEdges(),w.sanitizeEdges(),w.stitchContours();for(var b=0;b<w.contours.length;b++)for(var C=w.contours[b],f=0|255.5*Math.random(),E=0|255.5*Math.random(),A=0|255.5*Math.random(),S=(C[0]===C[C.length-1],1);S<C.length;S++){var k=w.pts[C[S-1]],x=w.pts[C[S]];g.addSegment(k.x,k.y,x.x,x.y,0,.02,T,t,0)}var M={mesh:g.toMesh()};r.BufferGeometryUtils.meshToGeometry(M);var R=M.geometry;R.streamingDraw=!0,R.streamingIndex=!0;var P=new THREE.Mesh(R,u);P.matrix.copy(l),P.matrixAutoUpdate=!1,P.frustumCulled=!1,o.add(P);var V=new r.Triangulator.TriangulatedSurface(w);if(V.indices.length){for(var I=new THREE.BufferGeometry,N=new Float32Array(3*V.pts.length),b=0;b<V.pts.length;b++)N[3*b]=V.pts[b].x,N[3*b+1]=V.pts[b].y,N[3*b+2]=0;I.addAttribute("position",new THREE.BufferAttribute(N,3));for(var D=d.material.packedNormals,L=D?new Uint16Array(2*V.pts.length):new Float32Array(3*V.pts.length),b=0;b<V.pts.length;b++)if(D){var O=.5*(0/Math.PI+1),_=1;L[2*b]=65535*O|0,L[2*b+1]=65535*_|0}else L[3*b]=0,L[3*b+1]=0,L[3*b+2]=1;I.addAttribute("normal",new THREE.BufferAttribute(L,D?2:3)),D&&(I.attributes.normal.bytesPerItem=2,I.attributes.normal.normalize=!0);var H=new Uint16Array(V.indices.length);H.set(V.indices),I.addAttribute("index",new THREE.BufferAttribute(H,1)),I.streamingDraw=!0,
I.streamingIndex=!0;var B=y.matman().cloneMaterial(d.material);B.packedNormals=D,B.cutplanes=null,B.side=THREE.FrontSide,B.depthTest=!0,B.map=null,B.bumpMap=null,B.normalMap=null,B.alphaMap=null,B.specularMap=null,B.transparent=!1,B.depthWrite=!0,B.hatchPattern=!0,B.needsUpdate=!0;var F=(d.material.id+2)*Math.PI*.125,z=Math.tan(F);B.hatchParams=new THREE.Vector2(z,10),B.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,B.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=B.prismType&&(B.defines={},B.defines[B.prismType.toUpperCase()]="","PrismWood"==B.prismType&&(B.defines.NO_UVW=""));var U=new THREE.Mesh(I,B);U.matrix.copy(l),U.matrixAutoUpdate=!1,U.dbId=t,U.fragId=p.fragId,n.add(U)}}}},!0)}})}function c(e,t){var i,n=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),e.normal);if(t){var o=e.projectPoint(t.max),r=e.projectPoint(t.min),s=n.clone().inverse();o.applyQuaternion(s),r.applyQuaternion(s);var a=(new THREE.Vector3).subVectors(o,r);i=new THREE.PlaneBufferGeometry(a.x,a.y)}else{t=y.getVisibleBounds();var a=2*t.getBoundingSphere().radius;i=new THREE.PlaneBufferGeometry(a,a)}var l=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),c=new D.SectionMesh(i,l,e),u=e.projectPoint(t.center());c.position.copy(u),c.quaternion.multiply(n);for(var h=Autodesk.Viewing.Private.LightPresets[y.currentLightPreset()].bgColorGradient,d="rgb("+(255-h[0])+","+(255-h[1])+","+(255-h[2])+")",p=new THREE.LineBasicMaterial({color:d,linewidth:1,depthTest:!1}),v=c.geometry.getAttribute("position"),g=0;g<N.length;g++){var i=new THREE.Geometry;i.vertices.push((new THREE.Vector3).fromArray(v.array,N[g][0]*v.itemSize),(new THREE.Vector3).fromArray(v.array,N[g][1]*v.itemSize));var m=new THREE.Line(i,p);c.add(m),c.outlines.push(m)}return c}function u(e){h(function(t){if(t instanceof D.SectionMesh)if(t.connectivity.length>0){for(var i=(new THREE.Matrix4).getInverse(t.matrixWorld),n=new THREE.Vector3,o=t.geometry.getAttribute("position"),r=0;r<o.length/o.itemSize;r++){var s=t.connectivity[r];null!==L(t.plane,s[0],s[1],n)&&(n.applyMatrix4(i),o.setXYZ(r,n.x,n.y,n.z))}o.needsUpdate=!0,t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere();for(var r=0;r<t.outlines.length;r++){var a=t.outlines[r];a.geometry.vertices[0].fromArray(o.array,N[r][0]*o.itemSize),a.geometry.vertices[1].fromArray(o.array,N[r][1]*o.itemSize),a.geometry.verticesNeedUpdate=!0}}else if(e){var l=y.getVisibleBounds(),c=2*l.getBoundingSphere().radius,n=t.plane.projectPoint(l.center());t.geometry=new THREE.PlaneBufferGeometry(c,c),t.position.copy(n);for(var o=t.geometry.getAttribute("position"),r=0;r<t.outlines.length;r++){var a=t.outlines[r];a.geometry.vertices[0].fromArray(o.array,N[r][0]*o.itemSize),a.geometry.vertices[1].fromArray(o.array,N[r][1]*o.itemSize),a.geometry.verticesNeedUpdate=!0}}})}function h(e){for(var t=0;t<S.length;t++)S[t].traverse(e)}function d(){h(function(e){e instanceof D.SectionMesh&&e.update()}),1===k.length&&l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),y.setCutPlanes(k)}function p(e){for(var t=0;t<S.length;t++)S[t].visible=e;C!==e&&o(),C=e}function v(t){t&&k.length>0&&(1===k.length&&l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),e.setCutPlanes(k)),p(t)}function g(e,t){e.attach(t),e.setPosition(t.position),e.visible=!0}function m(e){var t=y.api.navigation.getEyeVector();t.dot(e)>0&&e.negate();var i=new THREE.Group,n=new THREE.Plane(e,0),o=c(n,null);i.add(o),k.push(o.planeVec),S.push(i),y.addOverlay(R,i),g(E,o),E.showRotationGizmos(!0),x=E.getPicker(),d()}function f(){for(var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],t=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],i=new THREE.Group,n=y.getVisibleBounds(),o=n.center(),r=new THREE.Box3(n.min,o),s=[],a=[],l=0;l<e.length;l++){var u=new THREE.Plane(e[l],-1*o.dot(e[l]));if(s.push(u),l>2){var h=u.orthoPoint(r.max),p=u.orthoPoint(r.min),v=(new THREE.Vector3).subVectors(h,p);u.constant-=v.length()}var m=c(u,r);i.add(m),a.push(m),k.push(m.planeVec)}for(var l=0;l<a.length;l++)for(var m=a[l],f=t[l],T=0;T<f.length;T++){for(var w=[],b=f[T],C=0;C<b.length;C++)w.push(s[b[C]]);m.connectivity.push(w)}S.push(i),y.addOverlay(R,i),g(E,S[0].children[0]),g(A,S[0]),E.showRotationGizmos(!1),x=E.getPicker().concat(A.getPicker()),d()}var E,A,y=e.impl,T=["section"],w=!1,b=!1,C=!0,S=[],k=[],x=[],M="",R="gizmo",P=null,V=!1,I=!0,N=[[0,1],[1,3],[3,2],[2,0]],D=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var L=function(){var e=new THREE.Matrix3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(o,r,s,a){e.set(o.normal.x,o.normal.y,o.normal.z,r.normal.x,r.normal.y,r.normal.z,s.normal.x,s.normal.y,s.normal.z);var l=e.determinant();if(0===l)return null;t.crossVectors(r.normal,s.normal).multiplyScalar(-o.constant),i.crossVectors(s.normal,o.normal).multiplyScalar(-r.constant),n.crossVectors(o.normal,r.normal).multiplyScalar(-s.constant);var c=a||new THREE.Vector3;return c.copy(t).add(i).add(n).divideScalar(l)}}(),O=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Raycaster,n=y.camera;return function(o,r,s){var a=y.canvas.getBoundingClientRect(),l=(o.clientX-a.left)/a.width*2-1,c=2*-((o.clientY-a.top)/a.height)+1;n.isPerspective?(e.set(l,c,.5),e.unproject(n),i.set(n.position,e.sub(n.position).normalize())):(e.set(l,c,-1),e.unproject(n),t.set(0,0,-1),i.set(e,t.transformDirection(n.matrixWorld)));var u=i.intersectObjects(r,s);return u[0]?u[0]:null}}();this.isActive=function(){return w},this.setSection=function(e){switch(this.clearSection(),e){case"X":var t=new THREE.Vector3(1,0,0);m(t);break;case"Y":var t=new THREE.Vector3(0,1,0);m(t);break;case"Z":var t=new THREE.Vector3(0,0,1);m(t);break;case"BOX":f()}M=e},this.clearSection=function(){for(E&&E.detach(),A&&A.detach();k.length>0;)k.pop();for(;S.length>0;){var e=S.pop();y.removeOverlay(R,e)}var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t),y.setCutPlanes()},this.isPlaneOn=function(){return C},this.showPlane=function(e){p(e)},this.attachControl=function(e){e?(g(E,S[0].children[0]),E.highlight(),"BOX"===M&&g(A,S[0])):(E.detach(),A.detach())},this.resetSection=function(){this.setSection(M)},this.getNames=function(){return T},this.getName=function(){return T[0]},this.register=function(){},this.deregister=function(){this.clearSection(),n()},this.activate=function(e){i(),w=!0,b=!1,I=!0,k=k||[],v(!0)},this.deactivate=function(e){w=!1,b=!1;var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t),v(!1),y.setCutPlanes(),E.detach(),A.detach()},this.update=function(e){return!1},this.handleSingleClick=function(e,t){var i=e.pointers?e.pointers[0]:e,n=O(i,S[0].children);return n&&(g(E,n.object),E.highlight(),o()),!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return b=!0,!!A.onPointerDown(e)||E.onPointerDown(e)},this.handleButtonUp=function(e,t){return b=!1,!!A.onPointerUp(e)||E.onPointerUp(e)},this.handleMouseMove=function(e){if(b){if(A.onPointerMove(e))return d(),E.update(),!0;if(E.onPointerMove(e))return d(),u(),!0}if("touch"!==e.pointerType){var t=e.pointers?e.pointers[0]:e,i=O(t,S[0].children);i&&(I=!1);var n=!!(I||i||O(t,x,!0));E.visible=n,A.visible=void 0!==A.object&&n,p(n)}return!!A.onPointerHover(e)||E.onPointerHover(e)},this.handleGesture=function(e){switch(e.type){case"dragstart":return P="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===P&&this.handleMouseMove(e);case"dragend":return"drag"===P&&(P=null,this.handleButtonUp(e,0))}return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){},this.handlePressHold=function(e){return!0}},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=function(){this.studyNode,this.constraintsNode=-1,this.constraintNodes=[],this.loadsNode=-1,this.loadNodes=[],this.resultsNode=-1,this.bodyNode=-1,this.resultTypes={},this.resultGroups={},this.simNodes=[],this.modelNodes=[],this.modalAnalysis=!1,this.modalResults={},this.modelStructurePanel=null,this.simExt=null},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateResult=function(e,t){this.resultTypes[t]=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateResultGroup=function(e,t){this.resultGroups[t]=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateModalResult=function(e,t){var i=[];if(i=this.modalResults[e],null==i){var n=[];n.push(t),i=n}else i.push(t);this.modalResults[e]=i},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.reset=function(){this.studyNode=-1,this.constraintsNode=-1,this.constraintNodes=[],this.loadsNode=-1,this.loadNodes=[],this.resultsNode=-1,this.bodyNode=-1,this.resultTypes={},this.resultGroups={},this.simNodes=[],this.modelNodes=[],this.modalAnalysis=!1,this.modalResults={},this.modelStructurePanel=null},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel=function(e){this.viewer=e,this.simDef=null,Autodesk.Viewing.UI.DockingPanel.call(this,e.container,"Simulation-Panel","Simulation Results")},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel,Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.initialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.initialize.call(this);var e=this;this.kPanelExpandedHeight=420,this.kPanelCollapsedHeight=35,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="380px",this.container.style.width="380px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="150px",this.container.style.left="220px",this.container.style.position="absolute",this.legend=document.createElement("div"),this.container.appendChild(this.legend),this.resultsGroup=document.createElement("select"),this.resultsGroup.classList.add("simulation-resultGroup"),this.resultsGroup.style.position="absolute",this.resultsGroup.style.top="42px",this.resultsGroup.style.width="180px",this.resultsGroup.style.left="5px",this.resultsGroup.style.color="black",this.resultsGroup.style.height="22px",this.resultsGroup.style.border="1px",this.resultsGroup.addEventListener("change",function(t){e.viewer.hide(e.simDef.resultsNode),0==e.simDef.modalAnalysis?e.fillResultTypes(e.resultsGroup.value):e.fillModalResultTypes(e.resultsGroup.value),setTimeout(function(){e.setSimObjectsVisibility()},100)}),this.legend.appendChild(this.resultsGroup),this.resultTypes=document.createElement("select"),this.resultTypes.classList.add("simulation-resultTypes"),this.resultTypes.style.position="absolute",this.resultTypes.style.top="42px",this.resultTypes.style.width="180px",this.resultTypes.style.left="190px",this.resultTypes.style.color="black",this.resultTypes.style.height="22px",this.resultTypes.style.border="1px",this.resultTypes.addEventListener("change",function(t){e.viewer.hide(e.simDef.resultsNode),e.setSimObjectsVisibility()}),this.legend.appendChild(this.resultTypes),this.colorScale=document.createElement("div"),this.colorScale.classList.add("simulation-colorscale"),this.colorScale.style.width="210px",this.colorScale.style.height="20px",this.colorScale.style.margin="5px",this.colorScale.style.position="absolute",this.colorScale.style.left="-70px",this.colorScale.style.top="170px",this.colorScale.style.backgroundRepeat="repeat",this.legend.appendChild(this.colorScale),this.colorScaleTopText=document.createElement("div"),this.colorScaleTopText.style.position="absolute",this.colorScaleTopText.style.left="52px",this.colorScaleTopText.style.top="73px",this.colorScaleTopText.innerHTML="- 3333",this.legend.appendChild(this.colorScaleTopText),this.colorScaleBottomText=document.createElement("div"),this.colorScaleBottomText.style.position="absolute",this.colorScaleBottomText.style.left="52px",this.colorScaleBottomText.style.top="281px",this.colorScaleBottomText.innerHTML="- 3333",this.legend.appendChild(this.colorScaleBottomText),this.line=document.createElement("hr"),this.line.style.position="absolute",this.line.style.top="300px",this.line.style.width="100%",this.line.style.borderTop="1px solid black",this.legend.appendChild(this.line),this.tbl=document.createElement("table"),this.tblBody=document.createElement("tbody"),this.tbl.appendChild(this.tblBody),this.legend.appendChild(this.tbl),this.tbl.style.position="absolute",this.tbl.style.top="310px",this.tbl.style.margin="5px"},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setSimulationDef=function(e){function t(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function i(e){var i=t(e.properties,"Name");r.setTitle(i)}function n(e,t,i){}function o(e){var i=t(e.properties,"Elements"),n=t(e.properties,"Nodes");r.cellTextElements2.nodeValue=i,r.cellTextNodes2.nodeValue=n}this.simDef=e;var r=this,s=Number(this.simDef.studyNode);this.viewer.getProperties(s,i,n);var a;if(a=1==this.simDef.modalAnalysis?Autodesk.Viewing.i18n.translate("Modal Frequencies"):Autodesk.Viewing.i18n.translate("Static Stress"),this.rowType)this.cellTextType2.nodeValue=a;else{this.rowType=document.createElement("tr"),this.cellType1=document.createElement("td"),this.cellTextType1=document.createTextNode(Autodesk.Viewing.i18n.translate("Analysis Type")),this.cellType1.appendChild(this.cellTextType1),this.cellType1.style.width="180px",this.cellType2=document.createElement("td"),this.cellTextType2=document.createTextNode(a),this.cellType2.appendChild(this.cellTextType2),this.rowType.appendChild(this.cellType1),this.rowType.appendChild(this.cellType2),this.tblBody.appendChild(this.rowType),this.rowNodes=document.createElement("tr"),this.cellNodes1=document.createElement("td"),this.cellTextNodes1=document.createTextNode(Autodesk.Viewing.i18n.translate("Nodes")),this.cellNodes1.appendChild(this.cellTextNodes1),this.cellNodes2=document.createElement("td");var l="1872";this.cellTextNodes2=document.createTextNode(l),this.cellNodes2.appendChild(this.cellTextNodes2),this.rowNodes.appendChild(this.cellNodes1),this.rowNodes.appendChild(this.cellNodes2),this.tblBody.appendChild(this.rowNodes),this.rowElements=document.createElement("tr"),this.cellElements1=document.createElement("td"),this.cellTextElements1=document.createTextNode(Autodesk.Viewing.i18n.translate("Elements")),this.cellElements1.appendChild(this.cellTextElements1),this.cellElements2=document.createElement("td");var c="1084";this.cellTextElements2=document.createTextNode(c),this.cellElements2.appendChild(this.cellTextElements2),this.rowElements.appendChild(this.cellElements1),this.rowElements.appendChild(this.cellElements2),this.tblBody.appendChild(this.rowElements),this.rowMin=document.createElement("tr"),this.cellMin1=document.createElement("td"),this.cellTextMin1=document.createTextNode(Autodesk.Viewing.i18n.translate("Min")),this.cellMin1.appendChild(this.cellTextMin1),this.cellMin2=document.createElement("td");var u="0.000E+02 MPa";this.cellTextMin2=document.createTextNode(u),this.cellMin2.appendChild(this.cellTextMin2),this.rowMin.appendChild(this.cellMin1),this.rowMin.appendChild(this.cellMin2),this.tblBody.appendChild(this.rowMin),this.rowMax=document.createElement("tr"),this.cellMax1=document.createElement("td"),this.cellTextMax1=document.createTextNode(Autodesk.Viewing.i18n.translate("Max")),this.cellMax1.appendChild(this.cellTextMax1),this.cellMax2=document.createElement("td");var h="5.117E+02 MPa";this.cellTextMax2=document.createTextNode(h),this.cellMax2.appendChild(this.cellTextMax2),this.rowMax.appendChild(this.cellMax1),this.rowMax.appendChild(this.cellMax2),this.tblBody.appendChild(this.rowMax)}if(this.resultsGroup.options.length=0,0==this.simDef.modalAnalysis){var d=Object.keys(e.resultGroups);if(!d||0==d.length)return void this.setSimObjectsVisibility();for(var p=0;p<d.length;p++){var v=document.createElement("option");v.value=d[p];var g=e.resultGroups[d[p]];v.setAttribute("data-i18n",g),v.textContent=Autodesk.Viewing.i18n.translate(g),this.resultsGroup.add(v)}}else{var d=Object.keys(e.modalResults);if(!d||0==d.length)return void this.setSimObjectsVisibility();for(var p=0;p<d.length;p++){var v=document.createElement("option");v.value=d[p];var g=d[p];v.setAttribute("data-i18n",g),v.textContent=Autodesk.Viewing.i18n.translate(g),this.resultsGroup.add(v)}}this.resultsGroup.options.length<=1?(this.resultsGroup.disabled=!0,this.resultsGroup.style.webkitAppearance="none",this.resultsGroup.style.mozappearance="none",this.resultsGroup.style.MozAppearance="none",this.resultsGroup.style.appearance="none"):(this.resultsGroup.disabled=!1,this.resultsGroup.style.webkitAppearance="",this.resultsGroup.style.mozappearance="",this.resultsGroup.style.MozAppearance="",this.resultsGroup.style.appearance="");var r=this,m=r.viewer.model;m.getObjectTree(function(t){r.instanceTree=t,0==r.simDef.modalAnalysis?r.fillResultTypes(r.resultsGroup.value):r.fillModalResultTypes(r.resultsGroup.value),setTimeout(function(){e.simExt.showResultsDlg(!0),e.simExt.applySettings(),r.setSimObjectsVisibility()},500)});var f=Number(this.simDef.resultsNode);this.viewer.getProperties(f,o,n)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.processNodes=function(e,t){function i(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function n(e,t){function n(n){var o=n.properties,s=i(n.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87");if(s){var l=!0;if("SIM_CONSTRAINTS"==s)a.constraintsNode=e;else if("SIM_CONSTRAINT"==s)a.constraintNodes.push(e);else if("SIM_LOADS"==s)a.loadsNode=e;else if("SIM_LOAD"==s)a.loadNodes.push(e);else if("SIM_RESULTS_SCALAR_PLOT"==s)0==a.modalAnalysis?a.associateResult(i(o,"Name"),e):a.associateModalResult(i(o,"Name"),e);else if("SIM_RESULTS_GROUP"==s)0==a.modalAnalysis&&a.associateResultGroup(i(o,"Name"),e);else if("SIM_RESULTS"==s)a.resultsNode=e,r.viewer.hide(e);else if("SIM_STUDY"==s){a.studyNode=e;var c=i(n.properties,"Study Type");"SimCaseModalFrequencies"==c&&(a.modalAnalysis=!0)}1==l&&a.simNodes.push(e)}else a.modelNodes.push(e);t()}function o(e,i,n){t()}e&&r.viewer&&r.viewer.getProperties(e,n,o)}function o(){s.length>0?n(s.shift(),o):(Autodesk.Viewing.Extensions.Fusion360Sim.$getObjectTree=function(){return a},t(a))}var r=this,s=[],a=this.simDef;a?a.reset():a=new Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef,e.enumNodeChildren(e.getRootId(),function(e){s.push(e)},!0),o()},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.initModel=function(e,t){if(this.viewer){var i=this;i.processNodes(e,function(e){e.simExt=t,i.setSimulationDef(e)}),i.addEventListener(i.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(e){if(i.simDef.loadsNode!=-1&&i.hightlightNode(i.simDef.loadsNode,!1),i.simDef.constraintsNode!=-1&&i.hightlightNode(i.simDef.constraintsNode,!1),i.simDef.modelNodes&&i.simDef.modelNodes.length>0)for(var t=0;t<i.simDef.modelNodes.length;++t)i.hightlightNode(i.simDef.modelNodes[t],!1);var n=e.nodeIdArray;n&&(0==n.length?i.setSimObjectsVisibility():1==n.length&&i.isModelNode(n[0])&&(i.simDef.loadsNode&&i.viewer.hide(i.simDef.loadsNode),i.simDef.constraintsNode&&i.viewer.hide(i.simDef.constraintsNode),i.simDef.resultsNode&&i.viewer.hide(i.simDef.resultsNode)))})}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.hightlightNode=function(e,t){var i=this.viewer.impl,n=this,o=!1,r=this.viewer.model.getData().instanceTree;if(r){var s=r.getRootId();o="number"==typeof e&&e===s}o&&t||n.instanceTree.enumNodeFragments(e,function(e){i.highlightFragment(n.viewer.model,e,t,!0)},!0)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.fillResultTypes=function(e){function t(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function i(e){function i(e){var i=t(e.properties,"Result group");if(i===r){var n=document.createElement("option");n.value=e.dbId;var s=o.simDef.resultTypes[e.dbId];n.setAttribute("data-i18n",s),n.textContent=Autodesk.Viewing.i18n.translate(s),o.resultTypes.add(n),o.resultTypes.options.length<=1?(o.resultTypes.disabled=!0,o.resultTypes.style.webkitAppearance="none",o.resultTypes.style.mozappearance="none",o.resultTypes.style.MozAppearance="none",o.resultTypes.style.appearance="none"):(o.resultTypes.disabled=!1,o.resultTypes.style.webkitAppearance="",o.resultTypes.style.mozappearance="",o.resultTypes.style.MozAppearance="",o.resultTypes.style.appearance="")}}for(var r=t(e.properties,"Result group"),s=Object.keys(o.simDef.resultTypes),a=0;a<s.length;a++){var l=Number(s[a]);o.viewer.getProperties(l,i,n)}}function n(e,t,i){}var o=this;o.resultTypes.options.length=0;var r=Number(e);o.viewer.getProperties(r,i,n)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.fillModalResultTypes=function(e){function t(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function i(e){var i=t(e.properties,"Result type");if(i===r){var n=document.createElement("option");n.value=e.dbId;var s=t(e.properties,"Mode"),a=s;n.setAttribute("data-i18n",a),n.textContent=a,o.resultTypes.add(n),o.simDef.associateResult(a,e.dbId),o.resultTypes.options.length<=1?(o.resultTypes.disabled=!0,o.resultTypes.style.webkitAppearance="none",o.resultTypes.style.mozappearance="none",o.resultTypes.style.MozAppearance="none",o.resultTypes.style.appearance="none"):(o.resultTypes.disabled=!1,o.resultTypes.style.webkitAppearance="",o.resultTypes.style.mozappearance="",o.resultTypes.style.MozAppearance="",o.resultTypes.style.appearance="")}}function n(e,t,i){}var o=this;o.resultTypes.options.length=0;for(var r=e,s=o.simDef.modalResults[r],a=0;a<s.length;a++){var l=Number(s[a]);o.viewer.getProperties(l,i,n)}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setTitle=function(e,t){e||(e="Simulations",t=t||{},t.localizeTitle=!0),Autodesk.Viewing.UI.DockingPanel.prototype.setTitle.call(this,e,t)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setModelNodesVisible=function(e){if(this.simDef.modelNodes&&this.simDef.modelNodes.length>0)for(var t=0;t<this.simDef.modelNodes.length;t++){var i=this.simDef.modelNodes[t],n=!1,o=this.viewer.model.getData().instanceTree;if(o){var r=o.getRootId();n="number"==typeof i&&i===r}n||(e?this.viewer.show(i):this.viewer.hide(i))}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isModelNode=function(e){return!(!this.simDef.modelNodes||0==this.simDef.modelNodes.length)&&this.simDef.modelNodes.indexOf(e)!==-1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setNodeVisibility=function(e,t){t?this.viewer.show(e):this.viewer.hide(e)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimLoadNode=function(e){return!!this.simDef.loadNodes&&this.simDef.loadNodes.indexOf(e)!==-1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimConstraintNode=function(e){return!!this.simDef.constraintNodes&&this.simDef.constraintNodes.indexOf(e)!==-1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimLoadsNode=function(e){return this.simDef.loadsNode!=-1&&this.simDef.loadsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimConstraintsNode=function(e){return this.simDef.constraintsNode!=-1&&this.simDef.constraintsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimStudyNode=function(e){return!!this.simDef.studyNode&&this.simDef.studyNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimResultsNode=function(e){return!!this.simDef.resultsNode&&this.simDef.resultsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setSimObjectsVisibility=function(e){function t(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function i(e){var i=t(e.properties,"Minimal value"),n=t(e.properties,"Maximal value"),r=t(e.properties,"Scale reversed"),s=t(e.properties,"Unit");o.cellTextMin2.nodeValue=i+" "+s,o.cellTextMax2.nodeValue=n+" "+s;var a=t(e.properties,"Lower referential value"),l=t(e.properties,"Upper referential value");"True"==r?(o.colorScale.style.transform="rotate(90deg)",o.colorScale.style.moztransform="rotate(90deg)",o.colorScale.style.webkittransform="rotate(90deg)"):(o.colorScale.style.transform="rotate(-90deg)",o.colorScale.style.moztransform="rotate(-90deg)",o.colorScale.style.webkittransform="rotate(-90deg)"),o.colorScaleTopText.innerHTML="- "+l+" "+s,o.colorScaleBottomText.innerHTML="- "+a+" "+s}function n(e,t,i){}if(!this.resultTypes||0==this.resultTypes.options.length)return this.setModelNodesVisible(!0),void this.simDef.simExt.showResultsDlg(!1);var o=this;this.viewer.hide(this.simDef.resultsNode);var r=Number(this.resultTypes.value);if(e){var s=!1,a=this.viewer.model.getData().instanceTree;if(a){var l=a.getRootId();s="number"==typeof e&&e===l}this.setModelNodesVisible(!1);var c=(this.isSimLoadNode(e),this.isSimLoadsNode(e),this.isSimConstraintNode(e),this.isSimConstraintsNode(e),this.isSimStudyNode(e));this.viewer.hide(this.simDef.resultsNode),this.viewer.show(r),this.simDef.loadsNode&&this.viewer.show(this.simDef.loadsNode),this.simDef.constraintsNode&&this.viewer.show(this.simDef.constraintsNode),s||c||a.enumNodeFragments(e,function(e){o.viewer.impl.highlightFragment(o.viewer.model,e,!0,!0)},!0)}else this.setModelNodesVisible(!1),this.viewer.show(r),this.simDef.loadsNode!=-1&&this.viewer.show(this.simDef.loadsNode),this.simDef.constraintsNode!=-1&&this.viewer.show(this.simDef.constraintsNode);var o=this;o.viewer.getProperties(r,i,n)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(e,t,i){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,e.viewer,t,i),this.viewer=e.viewer,this.ext=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(e){this.simGalleryPanel=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode)&&this.simGalleryPanel.simDef.studyNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&this.simGalleryPanel.simDef.modelNodes.indexOf(e)!==-1},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(e){return!this.isSimStudyNode(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(e,t){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.simGalleryPanel.setModelNodesVisible(!0),this.simGalleryPanel.hightlightNode(e,!0),this.simGalleryPanel.simDef.loadsNode&&this.viewer.hide(this.simGalleryPanel.simDef.loadsNode),this.simGalleryPanel.simDef.constraintsNode&&this.viewer.hide(this.simGalleryPanel.simDef.constraintsNode),this.simGalleryPanel.simDef.resultsNode&&this.viewer.hide(this.simGalleryPanel.simDef.resultsNode)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel=function(e,t,i){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,e.viewer,t,i),this.viewer=e.viewer,this.ext=e,this.container.style.left="350px"},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.setGallery=function(e){this.simGalleryPanel=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.isSimResultsNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.isModelNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&1==this.simGalleryPanel.simDef.modelNodes.indexOf(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.shouldInclude=function(e){return!this.isSimResultsNode(e)&&!this.isModelNode(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.onClick=function(e,t){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.simGalleryPanel.setSimObjectsVisibility(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.Simulation=function(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e,this.simButton=null,this.useSetupPanel=!0,this.useModelPanel=!0,t&&(void 0!==t.useSetupPanel&&(this.useSetupPanel=t.useSetupPanel),void 0!==t.useModelPanel&&(this.useModelPanel=t.useModelPanel))},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.Simulation,Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.load=function(){var e=this,t=this.viewer;e.galleryPanel=new Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel(e.viewer),e.viewer.addPanel(e.galleryPanel),e.simButton=new Autodesk.Viewing.UI.Button("toolbar-simulation"),e.simButton.setToolTip("Simulation Results"),e.simButton.onClick=function(t){
var i=e.galleryPanel.isVisible();e.galleryPanel.setVisible(!i),e.simButton.setState(i?Autodesk.Viewing.UI.Button.State.INACTIVE:Autodesk.Viewing.UI.Button.State.ACTIVE)},e.simButton.setIcon("toolbar-simulationIcon"),t.settingsTools.addControl(e.simButton,{index:1}),this.hideLines=t.prefs.get("lineRendering"),this.ghosting=t.prefs.get("ghosting"),this.ambientShadow=t.prefs.get("ambientShadows"),this.antialiazing=t.prefs.get("antialiasing"),this.lightPreset=t.prefs.get("lightPreset");var i=function(){t.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i);var n=e.viewer.model;n.getObjectTree(function(t){e.galleryPanel.initModel(t,e),e.useModelPanel&&e.initModelBrowser(),e.useSetupPanel&&e.initSetupPanel()})};this.initIfLoaded=function(){var t=e.viewer.model;t&&t.isLoadDone&&t.getObjectTree(function(t){setTimeout(function(){e.galleryPanel.initModel(t,e),e.useModelPanel&&e.initModelBrowser(),e.useSetupPanel&&e.initSetupPanel()},100)})};var n=e.viewer.model;return n&&n.isLoadDone?(t.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.initIfLoaded),n.getObjectTree(function(t){setTimeout(function(){e.galleryPanel.initModel(t,e),e.useModelPanel&&e.initModelBrowser(),e.useSetupPanel&&e.initSetupPanel()},100)})):t.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i),!0},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.unload=function(){return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.initIfLoaded),this.showResultsDlg(!1),this.viewer.settingsTools.removeControl(this.simButton),this.viewer.removePanel(this.galleryPanel),this.galleryPanel.uninitialize(),this.viewer.hideLines(!this.hideLines),this.viewer.setGhosting(this.ghosting),this.viewer.setQualityLevel(this.ambientShadow,this.antialiazing),this.viewer.setLightPreset(this.lightPreset),this.modelStructurePanel&&this.viewer.setModelStructurePanel(null),this.simSetupPanel&&(this.simSetupPanel.setVisible(!1),this.viewer.removePanel(this.simSetupPanel),this.simSetupPanel.uninitialize()),!0},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.initSetupPanel=function(){var e=this;setTimeout(function(){e.simSetupButton=new Autodesk.Viewing.UI.Button("toolbar-simulation-setup"),e.simSetupButton.setToolTip("Simulation Setup"),e.simSetupButton.onClick=function(t){var i=e.simSetupPanel.isVisible();e.simSetupPanel.setVisible(!i),e.simSetupButton.setState(i?Autodesk.Viewing.UI.Button.State.INACTIVE:Autodesk.Viewing.UI.Button.State.ACTIVE)},e.simSetupButton.setIcon("toolbar-simulationSetupIcon"),e.viewer.settingsTools.addControl(e.simSetupButton,{index:0}),e.simSetupPanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel(e,Autodesk.Viewing.i18n.translate("Simulation Setup Loading"),e.options),e.simSetupPanel.setGallery(e.galleryPanel),e.viewer.addPanel(e.simSetupPanel),e.viewer.model&&e.viewer.model.getObjectTree(function(t){e.simSetupPanel.setModel(t,Autodesk.Viewing.i18n.translate("Simulation Setup"))})},100)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.initModelBrowser=function(){var e=this;setTimeout(function(){e.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(e,"Simulation Model Structure Loading",e.options),e.viewer.setModelStructurePanel(e.modelStructurePanel),e.modelStructurePanel.setGallery(e.galleryPanel)},100)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.showResultsDlg=function(e){this.simButton.setState(e?Autodesk.Viewing.UI.Button.State.ACTIVE:Autodesk.Viewing.UI.Button.State.INACTIVE),this.simButton.setVisible(e),this.galleryPanel.setVisible(e)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.applySettings=function(e){this.viewer.hideLines(!1),this.viewer.setGhosting(!1),this.viewer.setQualityLevel(!1,!0),this.viewer.setLightPreset(4)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.simData=function(){return this.galleryPanel.simDef},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Fusion360.Simulation",Autodesk.Viewing.Extensions.Fusion360Sim.Simulation),function(){"use strict";var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),i=function(t,i){e.Extension.call(this,t,i),this.tool=null};i.prototype=Object.create(e.Extension.prototype),i.prototype.constructor=i,i.prototype.load=function(){return this.tool=new t.HyperlinkTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),!0},i.prototype.unload=function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},t.HyperlinkExtension=i,e.theExtensionManager.registerExtension("Autodesk.Hyperlink",i)}(),function(){"use strict";var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),i=function(t){e.ToolInterface.call(this),this.names=["hyperlink"];var i=this,n=-1,o=!1,r=[],s=[],a=null,l=null,c=null,u={},h="Hyperlink-bBox",d=null,p="Hyperlink-bBox-select",v=null,g=null;this.panel=null;var m=function(i,n,o,r){a||(a=document.createElement("div"),t.container.appendChild(a),a.setAttribute("data-i18n","Ctrl + Click to preview the link"),a.textContent=e.i18n.translate("Ctrl + Click to preview the link")),a.className="hyperlink-tooltip",a.style.top=n+20+"px",a.style.left=i+20+"px",a.intersectPoint=r},f=function(){a&&(t.container.removeChild(a),a=null)},E=function(){if(a){var e=t.navigation.getCamera(),i=t.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(a.intersectPoint);n.project(e);var o=Math.round((n.x+1)/2*i.width),r=Math.round((-n.y+1)/2*i.height);a.style.left=o+20+"px",a.style.top=r+20+"px"}},A=function(n){t.removeEventListener(e.GEOMETRY_LOADED_EVENT,A);var o=t.model.getData();l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()},y=function(){i.panel&&i.panel.updatePosition(),E()};this.activate=function(n){if(t.model&&t.model.isLoadDone()){var o=t.model.getData();l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()}else t.addEventListener(e.GEOMETRY_LOADED_EVENT,A);t.addEventListener(e.CAMERA_CHANGE_EVENT,y)},this.deactivate=function(i){t.removeEventListener(e.CAMERA_CHANGE_EVENT,y),r=[],s=[],f(),this.panel&&(this.panel.uninitialize(),this.panel=null),t.HyperlinkBack&&(t.HyperlinkBack.uninitialize(),t.HyperlinkBack=null),t.impl.clearOverlay(h),t.impl.clearOverlay(p)},this.update=function(e){return!1},this.handleSingleClick=function(o,a){this.clearSelection(),this.panel&&(this.panel.uninitialize(),this.panel=null);var l=t.impl.hitTest(o.canvasX,o.canvasY,!1);if(l){var c=l.dbId,u=t.model.getDocumentNode(),h=null;u&&(h=u.data.viewableID);var d=new THREE.Vector2(o.canvasX,o.canvasY);if(t.model.is2d())for(var p in r){var v=r[p];if(v.dbId===c){var g=l.intersectPoint.x,m=l.intersectPoint.y;if(g>=v.bBox[0]&&g<=v.bBox[2]&&m>=v.bBox[1]&&m<=v.bBox[3]){if(v.node){var E=v.node.data.name;this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,E,v.link,h,c,v.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,null,v.link,h);return this.highlightSelection(v.bBoxMesh),!0}}}else if(o.ctrlKey&&s[n]){this.controller.setIsLocked(!1),f();var v=s[n];if(v.node){var E=v.node.data.name;this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,E,v.link,h,c,v.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,null,v.link,h,c);return!0}}return!1},this.handleButtonDown=function(e,t){return o=!0,!1},this.handleButtonUp=function(e,t){return o=!1,!1},this.handleMouseMove=function(e){if(!o){if(!t.model.is2d()){var i=t.impl.hitTest(e.canvasX,e.canvasY,!1);if(i){var r=i.dbId;if(r!=n&&(n=r,f()),this.panel&&this.panel.dbId===r)return;s.hasOwnProperty(n)?null!==s[n]&&m(e.canvasX,e.canvasY,s[n],i.intersectPoint):(s[n]=null,this.loadHyperlink3d(n,e.canvasX,e.canvasY,i.intersectPoint))}else f()}return!1}},this.getCursor=function(){return a?"pointer":null},this.loadHyperlinks=function(){if(l)for(var e=0;e<l.length;e++){var t=l[e];this.loadHyperlink2d(t,e)}},this.loadHyperlink2d=function(e,n){t.getProperties(e,function(o){for(var s=o.properties,a=0,l=s.length;a<l;a++){var c=s[a];if("__hyperlink__"===c.displayCategory){var u=null,h=c.displayValue,d=t.model.getDocumentNode();if(d){d=d.getRootNode();var p=d.search({viewableID:h});p&&p.length&&(u=p[0])}r[n]={dbId:e,link:h,node:u},i.highlightText(n);break}}})},this.loadHyperlink3d=function(e,i,n,o){t.getProperties(e,function(r){for(var a=r.properties,l=0,c=a.length;l<c;l++){var u=a[l];if("__hyperlink__"===u.displayCategory){var h=null,d=u.displayValue,p=t.model.getDocumentNode();if(p){p=p.getRootNode();var v=p.search({viewableID:d});v&&v.length&&(h=v[0])}s[e]={link:d,node:h},m(i,n,s[e],o);break}}})},this.getHyperlinks=function(){return _linkCache},this.getThumbnail=function(e,i,n){if(u.hasOwnProperty(e))return void n(u[e]);var o={urn:t.model.getData().urn,width:400,height:400,guid:encodeURIComponent(i.guid),acmsession:t.model.getData().acmSessionId},r=function(t){var i=new FileReader;i.onload=function(t){var i=t.target.result;u[e]=i,n(i)},i.readAsDataURL(t)},s={responseType:"blob",skipAssetCallback:!0,size:o.width,guid:o.guid},a="urn:"+o.urn;avp.ViewingService.getThumbnail(avp.initLoadContext(),a,r,null,s)},this.highlightText=function(e){var t=.2,i=c[4*e]-t,n=c[4*e+1]-t,o=c[4*e+2]+t,s=c[4*e+3]+t;r[e].bBox=[i,n,o,s],this.addRectangle(e,i,n,o,s)},this.addRectangle=function(e,i,n,o,s){var a=0,l=new THREE.Vector3(i,n,a),c=new THREE.Vector3(o,n,a),u=new THREE.Vector3(o,s,a),p=new THREE.Vector3(i,s,a),v=new THREE.Geometry;if(v.vertices.push(l),v.vertices.push(c),v.vertices.push(u),v.vertices.push(p),v.faces.push(new THREE.Face3(0,1,2)),v.faces.push(new THREE.Face3(0,3,2)),!d){var g=240116,m=.8;d=new THREE.MeshBasicMaterial({color:g,opacity:m,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene(h)}var f=r[e].bBoxMesh=new THREE.Mesh(v,d,!0);t.impl.addOverlay(h,f)},this.highlightSelection=function(e){if(g=e,t.impl.removeOverlay(h,e),!v){var i=16744272,n=.8;v=new THREE.MeshBasicMaterial({color:i,opacity:n,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene(p)}var o=new THREE.Mesh(e.geometry,v);t.impl.addOverlay(p,o)},this.clearSelection=function(){g&&(t.impl.clearOverlay(p),t.impl.addOverlay(h,g),g=null)}};t.HyperlinkTool=i}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),t=Autodesk.Viewing,i=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private,Autodesk.Viewing.UI,function(i,n,o,r,s,a,l,c,u,h){function d(e){p.thumbnail.src=e}var p=this;this.viewer=n,this.container=document.createElement("div"),this.container.className="hyperlink-container",n.container.appendChild(this.container),this.container.style.left=o.x+"px",this.container.style.top=o.y-70+"px",this.intersectPoint=r,this.dbId=c,this.triangle=document.createElement("div"),this.triangle.className="hyperlink-container-triangle",this.container.appendChild(this.triangle),this.panel=document.createElement("div"),this.panel.className="hyperlink-panel",this.container.appendChild(this.panel),this.title=document.createElement("div"),this.title.className="hyperlink-panel-title",s?this.title.textContent=s:(this.title.setAttribute("data-i18n","External Link"),this.title.textContent=t.i18n.translate("External Link")),this.panel.appendChild(this.title),u?(this.thumbnail=document.createElement("img"),this.thumbnail.className="hyperlink-panel-thumbnail",h(c,u,d),this.panel.appendChild(this.thumbnail)):(this.externalLink=document.createElement("div"),this.externalLink.className="hyperlink-panel-external-link",this.externalLink.textContent=a,this.panel.appendChild(this.externalLink)),this.viewButton=document.createElement("div"),this.viewButton.className="hyperlink-panel-view-button",this.viewButton.setAttribute("data-i18n","View"),this.viewButton.textContent=t.i18n.translate("View"),this.panel.appendChild(this.viewButton),this.viewButton.addEventListener("click",function(){p.uninitialize(),i.panel=null,n.HyperlinkBack&&(n.HyperlinkBack.uninitialize(),n.HyperlinkBack=null),n.fireEvent({type:t.HYPERLINK_EVENT,data:{href:a}}),u&&(n.HyperlinkBack=new e.HyperlinkBack(i,n,l))}),this.triangle.style.bottom=this.container.clientHeight-100+"px",this.boundsCheck()});i.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},i.prototype.boundsCheck=function(){var e=this.viewer.navigation.getScreenViewport(),t=this.container.clientWidth,i=this.container.clientHeight,n=parseInt(this.container.style.left,10),o=parseInt(this.container.style.top,10),r=n,s=o;n<0&&(r=0),o<0&&(s=0),e.width<n+t&&(r=e.width-t),e.height<o+i&&(s=e.height-i);var a=this.viewer.navigation.getEyeVector().length(),l=this.viewer.impl.clientToViewport(n,o),c=this.viewer.impl.clientToViewport(r,s);l.subVectors(l,c),this.viewer.navigation.panRelative(l.x/2,l.y/2,a),this.container.style.left=r+"px",this.container.style.top=s+"px"},i.prototype.updatePosition=function(){var e=this.viewer.navigation.getCamera(),t=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(this.intersectPoint);i.project(e);var n=Math.round((i.x+1)/2*t.width),o=Math.round((-i.y+1)/2*t.height);this.container.style.left=n+"px",this.container.style.top=o-70+"px"},e.HyperlinkPanel=i;var n=function(e,i,n){var o=this;this.viewer=i,this.container=document.createElement("div"),this.container.className="hyperlink-back",i.container.appendChild(this.container),this.backButton=document.createElement("div"),this.backButton.className="hyperlink-back-button",this.backButton.setAttribute("data-i18n","Back"),this.backButton.textContent=t.i18n.translate("Back"),this.container.appendChild(this.backButton),this.backButton.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null,e.panel&&(e.panel.uninitialize(),e.panel=null),i.fireEvent({type:t.HYPERLINK_EVENT,data:{href:n}})}),this.closer=document.createElement("div"),this.closer.className="hyperlink-back-closer",this.closer.innerHTML="&times;",this.container.appendChild(this.closer),this.closer.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null})};n.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},e.HyperlinkBack=n}(),function(){"use strict";function e(e){this.viewer=e,this.mappingPromise=null,this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0}}function t(e){for(var t={},i=[],n=e.length,o=0,r=0;r<n;r++){var s=e[r];1!==t[s]&&(t[s]=1,i[o++]=s)}return i}var i=AutodeskNamespace("Autodesk.Viewing.Comments"),n=Autodesk.Viewing.Private,o=e.prototype;o.destroy=function(){this.viewer=null},o.createCommentObj=function(e){var t=this.viewer.getState(this.filter);return this.injectInfo(t,e),t},o.injectInfo=function(e,t){e.body=t.message||"",e.status="open",e.jsonVersion="2.0",e.inputSource="Web",e.type="geometry";var i=this.viewer.model.getDocumentNode();if(i&&(i=i.findParentGeom2Dor3D(),e.layoutName=i.data.guid,e.layoutIndex=i.data.order),t.point3d){var n=t.point3d;n instanceof THREE.Vector3&&(n=n.toArray()),this.pushTag(e,{name:"nodeOffset",value:n})}},o.isCommentForCurrentSheet=function(e){var t=this.viewer.model.getDocumentNode();return!t||(t=t.findParentGeom2Dor3D(),t.data.guid===e.layoutName)},o.getManifestNode=function(e){var t=this.viewer.model.getDocumentNode();if(t){var i=t.getRootNode();return i.findByGuid(e.layoutName)}return null},o.pushTag=function(e,t){Array.isArray(e.tags)||(e.tags=[]),e.tags.push(t)},o.getTag=function(e,t){var i=e.tags;if(i&&Array.isArray(i))for(var n=0,o=i.length;n<o;++n)if(i[n].name===t)return i[n];return null},o.getTagValue=function(e,t,i){var n=this.getTag(e,t);return n?n.value:i||null},o.exportCommentObj=function(e){var t=this;return new Promise(function(i){t.applyGlobalOffset(e),t.getMappingPromise().then(function(n){t.mapObjectSetLmvToExternal(e,n,function(e){i(e)})})})},o.importCommentObj=function(e){var t={};for(var i in this.filter)this.filter.hasOwnProperty(i)&&e.hasOwnProperty(i)&&(t[i]=e[i]);var n=JSON.parse(JSON.stringify(t)),o=this;return new Promise(function(e){o.getMappingPromise().then(function(t){o.mapObjectSetExternalToLmv(n,t),o.removeGlobalOffset(n),e(n)})})},o.applyGlobalOffset=function(e){var t=this.viewer.model.getData().globalOffset;if(t){this.applyOffsetToCamera(e.viewport,t);var i=this.getTag(e,"nodeOffset");return i&&this.applyOffset(i.value,t),!0}return!1},o.removeGlobalOffset=function(e){var t=this.viewer.model.getData().globalOffset;if(t){var i={x:-t.x,y:-t.y,z:-t.z};this.applyOffsetToCamera(e.viewport,i);var n=this.getTag(e,"nodeOffset");return n&&this.applyOffset(n.value,i),!0}return!1},o.applyOffsetToCamera=function(e,t){e&&t&&(this.applyOffset(e.eye,t),this.applyOffset(e.target,t),this.applyOffset(e.pivotPoint,t))},o.applyOffset=function(e,t){if(e){var i=Number(e[0])+t.x,n=Number(e[1])+t.y,o=Number(e[2])+t.z;e[0]="string"==typeof e[0]?i.toString():i,e[1]="string"==typeof e[1]?n.toString():n,e[2]="string"==typeof e[2]?o.toString():o}},o.mapObjectSetLmvToExternal=function(e,i,n){i||n(e),this.viewer.model.is2d()&&n(e);var o=this.getObjectSetElementWithIdType(e.objectSet,"lmv"),r=[].concat(o.id).concat(o.hidden).concat(o.isolated);t(r),this.viewer.model.getBulkProperties(r,["externalId"],function(t){var i={};t.forEach(function(e){i[e.dbId]=e.externalId});var r=JSON.parse(JSON.stringify(o));r.idType="external";var s=function(e){return i[e]};r.id=r.id.map(s),r.hidden=r.hidden.map(s),r.isolated=r.isolated.map(s),e.objectSet.push(r),n(e)},function(){n(e)})},o.mapObjectSetExternalToLmv=function(e,t){if(t){var i=e.objectSet,n=this.getObjectSetElementWithIdType(i,"lmv");if(!n){var o=this.getObjectSetElementWithIdType(i,"external");if(o){var r=function(e){return t[e]},s=JSON.parse(JSON.stringify(o));s.id=s.id.map(r),s.isolated=s.isolated.map(r),s.hidden=s.hidden.map(r),s.idType="lmv",i.unshift(s)}}}},o.getObjectSetElementWithIdType=function(e,t){if(!e||!Array.isArray(e))return null;for(var i=0,n=e.length;i<n;++i)if(e[i].idType===t)return e[i];return null},o.getMappingPromise=function(){if(!this.mappingPromise){var e=this;this.mappingPromise=new Promise(function(t){e.viewer.model.getExternalIdMapping(function(e){n.logger.log("[Autodesk.Comment]Successfully fetched external id mapping."),t(e)},function(){n.logger.error("[Autodesk.Comment]Failed to fetch the external id mapping."),t(null)})})}return this.mappingPromise},i.CommentFactory=e}(),function(){"use strict";function e(e,t,i){this.viewer=e,this.cache=i,this.PATH_STORAGE=null,this.fakeRequest=null,this.init(t)}function t(e,t,i,n,o,r){if(e.fakeRequest)return e.fakeRequest.createRequest(t,i,o,r);var s=e.getToken(),a=new XMLHttpRequest;return a.open(t,i,!0),n&&a.setRequestHeader("Content-Type",n),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Authorization","Bearer "+s),a.onload=o.onLoad,a.onerror=o.onError,a.ontimeout=o.onTimeout,a}function i(e,t,i){return{onLoad:function(n){200==n.currentTarget.status?e(i?n.currentTarget.response:n.currentTarget.responseText):t(n.currentTarget)},onError:function(e){t(e.currentTarget)},onTimeout:function(e){t(e.currentTarget)}}}function n(e,t){t&&t.forEach(function(t){e.setRequestHeader(t.name,t.value)})}function o(e){return window.btoa?window.btoa(e):window.Base64.encode(e)}var r=AutodeskNamespace("Autodesk.Viewing.Comments"),s=(Autodesk.Viewing.Private,e.prototype);r.ENV_TABLE={Local:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Development:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Staging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},Production:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"},AutodeskDevelopment:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},AutodeskStaging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},AutodeskProduction:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"}},s.init=function(e){e=e||{},this.env=Autodesk.Viewing.Private.env,e.fakeServer&&(this.fakeRequest=new r.FakeRequest(e)),this.token=e.token3leg;var t=r.ENV_TABLE[this.env];this.COMMENT_SERVICE_URL=t.COMMENT,this.OBJECT_STORAGE_SERVICE_URL=t.OBJECT_STORAGE;var i=e.urn;if(i)this.setPathStorage(i);else{var n=this.viewer,o=this,s=function(){var e=n.model.getDocumentNode();if(e){var t=e.urn(!0);o.setPathStorage(t)}};n.model?s():n.addEventListener(av.GEOMETRY_LOADED_EVENT,function e(){n.removeEventListener(av.GEOMETRY_LOADED_EVENT,e),s()})}},s.destroy=function(){this.viewer=null,this.fakeRequest=null},s.setPathStorage=function(e){if(e){var t=e.length%4;t>0&&(e+="=".repeat(4-t)),this.PATH_STORAGE=e}},s.listComments=function(){var e=this;return new Promise(function(n,o){var r=[e.COMMENT_SERVICE_URL,"resources/",e.PATH_STORAGE].join(""),s=i(function(t){var i=JSON.parse(t);e.cache.comments=i,n(i)},o),a=t(e,"GET",r,"text/plain",s);a.send()})},s.postComment=function(e){var n=this;return new Promise(function(o,r){var s=[n.COMMENT_SERVICE_URL,"resources/",n.PATH_STORAGE].join(""),a=i(o,r),l=t(n,"POST",s,"text/plain",a);l.send(JSON.stringify(e))})},s.postCommentReply=function(e,n){var r=this;return new Promise(function(s,a){var l=window.encodeURIComponent(o(n)),c=[r.COMMENT_SERVICE_URL,"resources/",l].join(""),u=i(s,a),h=t(r,"POST",c,"text/plain",u);h.send(JSON.stringify(e))})},s.deleteComment=function(e){var n=this;return new Promise(function(r,s){var a=o(e),l=window.encodeURIComponent(a),c=[n.COMMENT_SERVICE_URL,"resources/",l].join(""),u=i(r,s),h=t(n,"DELETE",c,"text/plain",u);h.send()})},s.fetchLocationForNewOssAttachment=function(e,i){var o=[this.COMMENT_SERVICE_URL,"resources/",this.PATH_STORAGE,"/attachment"].join(""),r=t(this,"POST",o,"application/json",i,"fetchLocationForNewOssAttachment");n(r,e),r.send()},s.getAttachment=function(e,o,r){var s=this;return new Promise(function(a,l){var c=s.extractOssBucketAndId(e),u=[s.OBJECT_STORAGE_SERVICE_URL,"buckets/",c[0],"/objects/",c[1]].join(""),h=i(a,l,o),d=t(s,"GET",u,null,h);n(d,r),o&&(d.responseType="arraybuffer"),d.send()})},s.postAttachment=function(e,i,o,r,s){var a=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",o,"/objects/",e].join(""),l=t(this,"PUT",a,"text/plain",s);n(l,r),l.send(i)},s.deleteAttachment=function(e,i,n){var o=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",i,"/objects/",e].join(""),r=t(this,"DELETE",o,"text/plain",n);r.send()},s.extractOssBucketAndId=function(e){var t=e.split("/"),i=t[0],n=i.split(":");return t[0]=n[n.length-1],t},s.getToken=function(){return this.token||Autodesk.Viewing.Private.token.accessToken},r.CommentService=e}(),function(){"use strict";function e(e,n){Autodesk.Viewing.Extension.call(this,e,n||{});var o,r;this.load=function(){var e=this.getCache();if(o=new i.CommentFactory(this.viewer),r=new i.CommentService(this.viewer,this.options,e),e.restoreComment){var t=e.restoreComment;delete e.restoreComment;var n=this,s=function(){var e=function(){n.isCommentForCurrentSheet(t)&&n.restoreComment(t)};n.viewer.getObjectTree(e,e)};this.viewer.model?s():this.viewer.addEventListener(av.GEOMETRY_LOADED_EVENT,function e(){n.viewer.removeEventListener(av.GEOMETRY_LOADED_EVENT,e),s()})}return!0},this.unload=function(){return r&&(r.destroy(),r=null),o&&(o.destroy(),o=null),!0},this.createComment=function(e){var t=e||{};"string"==typeof e&&(t={message:e});var i=o.createCommentObj(t);return o.exportCommentObj(i)},this.isCommentForCurrentSheet=function(e){return o.isCommentForCurrentSheet(e)},this.restoreComment=function(e,t,i){if(!this.isCommentForCurrentSheet(e)){var n=o.getManifestNode(e);if(n){var r=this.getCache();return r.restoreComment=e,void this.viewer.fireEvent({type:Autodesk.Viewing.LOAD_GEOMETRY_EVENT,data:{item:n.data}})}}var s=this,a=o.importCommentObj(e);a.then(function(e){s.viewer.restoreState(e,t,i)})},this.setPathStorage=function(e){if(!e)throw new Error(t+": Invalid path storage");r.setPathStorage(e)},this.comments=function(){var e=this.getCache();return e.comments||[]},this.getComments=function(){return r.listComments()},this.postComment=function(e){return r.postComment(e)},this.postCommentReply=function(e,t){return r.postCommentReply(e,t)},this.deleteComment=function(e){return r.deleteComment(e)}}var t="Autodesk.Comments",i=AutodeskNamespace("Autodesk.Viewing.Comments");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,Autodesk.Viewing.theExtensionManager.registerExtension(t,e),i.CommentsExtension=e}(),function(){"use strict";function e(e){this.options=e||{},this.FAKE_SERVER_DELAY=this.options.fakeSeverDelay||200,this.FAKE_NEXT_ID=11}var t=AutodeskNamespace("Autodesk.Viewing.Comments"),i=e.prototype;i.createRequest=function(e,t,i,n){var o=this,r={notifyCallback:function(e){o.FAKE_SERVER_DELAY?setTimeout(function(){i.onLoad(e)},o.FAKE_SERVER_DELAY):i.onLoad(e)},replyPostComment:function(e){var t=JSON.parse(e);t.id=o.FAKE_NEXT_ID++,t.index=t.id,t.layoutName=t.layoutName||"Another Sheet",t.actor||(t.actor={name:o.options.displayName||"John Doe",id:o.options.oxygenId||"ABCDEFGHIJK"}),t.published=(new Date).toUTCString(),this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(t)}})},replyFetchLocationForNewOssAttachment:function(){var e={attachment:[{url:"urn:adsk.objects:os.object:comments/filename"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(e)}})},send:function(t){switch(e){case"GET":this.notifyCallback({currentTarget:{status:200,responseText:"[]"}});break;case"POST":switch(n){case"fetchLocationForNewOssAttachment":this.replyFetchLocationForNewOssAttachment();break;default:this.replyPostComment(t)}break;case"DELETE":this.notifyCallback({currentTarget:{status:200,responseText:"{}"}});break;case"PUT":try{JSON.parse(t),this.notifyCallback({currentTarget:{status:200,responseText:t}})}catch(e){var i={objects:[{id:"test",key:"test","content-type":"image/png",location:"http://www.autodesk.com"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(i)}})}}},setRequestHeader:function(){}};return r},t.FakeRequest=e}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),t=Autodesk.Viewing;e.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS=5,e.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS=12,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS=15,e.isTouchDevice=function(){return!(!t.isTouchDevice||"function"!=typeof Hammer)&&t.isTouchDevice()},e.createSvgElement=function(e){var t="http://www.w3.org/2000/svg";return document.createElementNS(t,e)},e.setSvgParentAttributes=function(e){return e.setAttribute("version","1.1"),e.setAttribute("baseProfile","full"),e},e.createMarkupPathSvg=function(){var t=e.createSvgElement("g");t.setAttribute("cursor","inherit"),t.setAttribute("pointer-events","none");var i=e.createSvgElement("path");i.setAttribute("id","markup");var n=e.createSvgElement("path");return n.setAttribute("id","hitarea"),n.setAttribute("fill","transparent"),n.setAttribute("stroke","transparent"),t.markup=i,t.hitarea=n,t.appendChild(i),t.appendChild(n),t},e.setAttributeToMarkupSvg=function(e,t,i){e.markup.setAttribute(t,i)},e.updateMarkupPathSvgHitarea=function(t,i){var n=t.markup,o=t.hitarea,r=i.sizeFromClientToMarkups(0,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;r+=parseFloat(n.getAttribute("stroke-width"))+r;var s=n.getAttribute("fill"),a=n.getAttribute("stroke"),l=""!==a&&"none"!==a,c=""!==s&&"none"!==s;if(o.setAttribute("d",n.getAttribute("d")),o.setAttribute("stroke-width",r),o.setAttribute("transform",n.getAttribute("transform")),!i.navigating){if(l&&c)return void t.setAttribute("pointer-events","painted");if(l)return void t.setAttribute("pointer-events","stroke");if(!c)return void t.setAttribute("pointer-events","fill")}t.setAttribute("pointer-events","none")},e.createMarkupTextSvg=function(){var t=e.createSvgElement("g");t.setAttribute("cursor","default");var i="markup-clipper-"+e.getClipPathId(),n="url(#"+i+")",o=e.createSvgElement("clipPath");o.setAttribute("id",i),o.removeAttribute("pointer-events"),o.rect=e.createSvgElement("rect"),o.appendChild(o.rect);var r=e.createSvgElement("rect");r.setAttribute("id","markup-background");var s=e.createSvgElement("text");s.setAttribute("id","markup"),r.removeAttribute("pointer-events");var a=e.createSvgElement("rect");a.setAttribute("id","hitarea"),a.setAttribute("fill","transparent"),a.setAttribute("stroke","none"),a.setAttribute("stroke-width","0");var l=e.createSvgElement("g");return l.setAttribute("clip-path",n),l.appendChild(o),l.appendChild(r),l.appendChild(s),t.appendChild(l),t.appendChild(a),t.clipper=o,t.background=r,t.markup=s,t.hitarea=a,t},e.setMarkupTextSvgTransform=function(e,t,i){e.clipper.rect.setAttribute("transform",t),e.background.setAttribute("transform",t),e.markup.setAttribute("transform",i),e.hitarea.setAttribute("transform",t)},e.updateMarkupTextSvgHitarea=function(t,i,n,o){var r=t.hitarea,s=o.sizeFromClientToMarkups(0,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;r.setAttribute("x",-s),r.setAttribute("y",-s),r.setAttribute("width",i+2*s),r.setAttribute("height",n+2*s),t.setAttribute("pointer-events",o.navigating?"none":"painted")},e.updateMarkupTextSvgBackground=function(e,t,i,n){var o=e.background;o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("width",t),o.setAttribute("height",i),o.setAttribute("fill",n)},e.updateMarkupTextSvgClipper=function(e,t,i){var n=e.clipper;n.rect.setAttribute("x",0),n.rect.setAttribute("y",0),n.rect.setAttribute("width",t),n.rect.setAttribute("height",i)},e.addSvgMetadata=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","metadata"),n=document.createElement("markup_document");return i.appendChild(n),n.setAttribute("data-model-version",t["data-model-version"]),e.insertBefore(i,e.firstChild),i},e.addMarkupMetadata=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","metadata"),n=document.createElement("markup_element");i.appendChild(n);for(var o in t)t.hasOwnProperty(o)&&n.setAttribute(o,t[o]);return e.insertBefore(i,e.firstChild),i},e.removeAllMetadata=function(e){if(e.getElementsByTagName)for(var t=e.getElementsByTagName("metadata"),i=0;i<t.length;++i){var n=t[i];n.parentNode&&n.parentNode.removeChild(n)}var o=e.children||e.childNodes;if(o)for(i=0;i<o.length;++i)this.removeAllMetadata(o[i])},e.transferChildNodes=function(e,t){for(var i=e.children||e.childNodes,n=[],o=0;o<i.length;++o)n.push(i[o]);n.forEach(function(e){t.appendChild(e)})},e.getClipPathId=function(){for(var e=document.getElementsByTagName("clipPath"),t=e.length,i=0,n=0;n<t;++n){var o=e[n].id;o.indexOf("markup-clipper-")!==-1&&(o=o.replace("markup-clipper-",""),i=Math.max(i,o))}return i+1},e.svgNodeToString=function(e){function t(e,i){var n=e.hitarea,o=n&&n.parentNode;o&&(i.push({hitarea:n,parent:o}),o.removeChild(n));for(var r=e.childNodes,s=r.length,a=0;a<s;++a)t(r.item(a),i)}function i(e){for(var t=e.length,i=0;i<t;++i){var n=e[i];n.parent.appendChild(n.hitarea)}}var n;try{var o=[];t(e,o);var r=new XMLSerializer;n=r.serializeToString(e),i(o)}catch(e){n="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return n},e.stringToSvgNode=function(e){var t=null;try{var i=new DOMParser,n=i.parseFromString(e,"text/xml");t=n.firstChild}catch(e){t=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return t},e.addTraitEventDispatcher=function(e){
e.listeners={},e.addEventListener=function(e,t){"undefined"==typeof this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t)},e.hasEventListener=function(e,t){if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[e]&&i[e].indexOf(t)!==-1},e.removeEventListener=function(e,t){if(this.listeners[e]instanceof Array)for(var i=this.listeners[e],n=0,o=i.length;n<o;n++)if(i[n]===t){i.splice(n,1);break}},e.fireEvent=function(e){if("string"==typeof e&&(e={type:e}),e.target||(e.target=this),!e.type)throw new Error("event type unknown.");if(this.listeners[e.type]instanceof Array)for(var t=this.listeners[e.type].slice(),i=0;i<t.length;i++)t[i].call(this,e)}},e.removeTraitEventDispatcher=function(e){try{delete e.listeners,delete e.addEventListener,delete e.hasEventListener,delete e.removeEventListener,delete e.fireEvent}catch(e){}},e.worldToClient=function(t,i,n){var o=e.worldToViewport(t,i),r=e.viewportToClient(o.x,o.y,i);return r.z=0,n&&(r.x=Math.floor(r.x)+.5,r.y=Math.floor(r.y)+.5),r},e.clientToWorld=function(t,i,n,o){var r=e.clientToViewport(t,i,o);return r.z=n,r.unproject(o.impl.camera),r},e.clientToViewport=function(e,t,i){return i.impl.clientToViewport(e,t)},e.viewportToClient=function(e,t,i){return i.impl.viewportToClient(e,t)},e.worldToViewport=function(e,t){var i=new THREE.Vector3;return i.x=e.x,i.y=e.y,i.z=e.z,i.project(t.impl.camera),i},e.metersToModel=function(e,t){var i=t.model.getUnitScale(),n=1/i;return n*e},e.radiansToDegrees=function(e){return e*(180/Math.PI)},e.degreesToRadians=function(e){return e*(Math.PI/180)},e.sign=function(e){return e>=0?1:-1},e.areMarkupsPointsInClientRange=function(e,t,i,n){i=n.sizeFromClientToMarkups(0,i).y;var o=e.x-t.x,r=e.y-t.y;return i*i>=o*o+r*r},e.hideLmvUi=function(t){t.toolbar&&(t.setActiveNavigationTool(),e.dismissLmvHudMessage(),e.hideLmvPanels(!0,t),e.hideLmvToolsAndPanels(t))},e.restoreLmvUi=function(t){t.toolbar&&(e.dismissLmvHudMessage(),e.hideLmvPanels(!1,t),e.showLmvToolsAndPanels(t))},e.hideLmvPanels=function(e,t){var i=t.dockingPanels;if(i)for(var n=0;n<i.length;++n){var o=i[n],r=o.container;r.classList.contains("dockingPanelVisible")&&(r.style.display=e?"none":"block",o.visibilityChanged())}},e.showLmvToolsAndPanels=function(e){e&&e.model&&!e.model.is2d()&&e.displayViewCube(!0,!1);var t=document.getElementsByClassName("homeViewWrapper"),i=document.getElementsByClassName("infoButton"),n=document.getElementsByClassName("toolbar-animationSubtoolbar");if(t.length>0&&(t[0].style.display=""),i.length>0&&(i[0].style.display=""),n.length>0&&(n[0].style.display=""),e.toolbar){for(var o=e.toolbar.container,r=o.children.length,s=0;s<r;++s)o.children[s].style.display="";e.centerToolBar()}},e.hideLmvToolsAndPanels=function(e){e&&e.model&&!e.model.is2d()&&e.displayViewCube(!1,!1);var t=document.getElementsByClassName("homeViewWrapper"),i=document.getElementsByClassName("infoButton"),n=document.getElementsByClassName("toolbar-animationSubtoolbar");if(t.length>0&&(t[0].style.display="none"),i.length>0&&(i[0].style.display="none"),n.length>0){n[0].style.display="none";var o=e.impl.keyFrameAnimator;if(o&&!o.isPaused){o.pauseCameraAnimations(),o.pause();var r=e.modelTools.getControl("toolbar-animationPlay");r&&(r.setIcon("toolbar-animationPauseIcon"),r.setToolTip("Pause"))}}if(e.toolbar)for(var s=e.toolbar.container,a=s.children.length,l=0;l<a;++l)s.children[l].style.display="none"},e.dismissLmvHudMessage=function(){try{for(var e=!0;e;)e=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(e){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},e.createStyle=function(t,i){for(var n={},o=0;o<t.length;++o)n[t[o]]=null;for(var r=e.getStyleDefaultValues(n,i),o=0;o<t.length;++o){var s=t[o];n[s]=r[s].values[r[s].default].value}return n},e.copyStyle=function(e,t){for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.cloneStyle=function(e){var t={};for(var i in e)t[i]=e[i];return t},e.getStyleDefaultValues=function(t,i){function n(e,t){var i=t.sizeFromClientToMarkups(0,e);return i.y}function o(e){return{values:[{name:"Thin",value:e/2},{name:"Normal",value:e},{name:"Thick",value:2*e}],default:1}}function r(){return{values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0}}function s(e){return{values:[{name:"Thin",value:e/2},{name:"Normal",value:e},{name:"Thick",value:2*e}],default:1}}function a(){return{values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"}],default:0}}function l(e){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:e?4:0}}function c(){return{values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0}}function u(){return{values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0}}function h(){return{values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0}}var d=e.cloneStyle(t),p=n(e.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,i),v=n(e.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,i);for(var g in d)switch(g){case"stroke-width":d[g]=o(p);break;case"stroke-linejoin":d[g]=r();break;case"font-size":d[g]=s(v);break;case"font-family":d[g]=c();break;case"font-style":d[g]=u();break;case"font-weight":d[g]=h();break;case"stroke-color":case"fill-color":d[g]=a();break;case"stroke-opacity":var m=!1;d[g]=l(m);break;case"fill-opacity":var m=!0;d[g]=l(m)}return d},e.composeRGBAString=function(e,t){return!e||!t||t<=0?"none":["rgba("+parseInt("0x"+e.substr(1,2)),",",parseInt("0x"+e.substr(3,2)),",",parseInt("0x"+e.substr(5,2)),",",t,")"].join("")},e.checkLineSegment=function(e,t,i,n,o){function r(e,t){e=Math.round(e),t=Math.round(t);for(var i=0,n=0,o=-a;o<=a;o+=2*a)n+=s(e,t+o)?o:0;for(var r=-a;r<=a;r+=2*a)i+=s(e+r,t)?r:0;return{x:Math.round(e/a+i),y:Math.round((c-t)/a-n)}}function s(e,t){if(e<0||e>=l||t<0||t>=c)return!1;var i=4*(t*l+e);return 255!==u[i]||255!==u[i+1]||255!==u[i+2]}var a=window.devicePixelRatio||1;e*=a,t*=a,i*=a,n*=a;var l=o.width,c=o.height,u=o.buffer;e=Math.round(e),i=Math.round(i),t=Math.round(c-t),n=Math.round(c-n);var h=i-e,d=n-t,p=0!==h?d/h:1,v=e,g=t;if(0!==h&&Math.abs(p)<=1){if(e<=i){for(;v<=i;++v,g+=p)if(s(v,Math.round(g)))return r(v,g)}else for(;v>=i;--v,g-=p)if(s(v,Math.round(g)))return r(v,g)}else if(p=0!==h?1/p:0,t<=n){for(;g<=n;++g,v+=p)if(s(Math.round(v),g))return r(v,g)}else for(;g>=n;--g,v-=p)if(s(Math.round(v),g))return r(v,g)},e.checkPolygon=function(e,t){function i(e,t){for(var i=0,o=0,s=-r;s<=r;s+=2*r)o+=n(e,t+s)?s:0;for(var l=-r;l<=r;l+=2*r)i+=n(e+l,t)?l:0;return{x:Math.round(e/r)+i,y:Math.round((a-t)/r-o)}}function n(e,t){if(e<0||e>=s||t<0||t>=a)return!1;var i=4*(t*s+e);return(255!==l[i]||255!==l[i+1]||255!==l[i+2])&&o(e,t)}function o(t,i){for(var n=!1,o=e.vertexCount,r=0,s=o-1;r<o;s=r++)h[r]>i!=h[s]>i&&t<(u[s]-u[r])*(i-h[r])/(h[s]-h[r])+u[r]&&(n=!n);return n}if(!e||e.verxtexCount<3||!t)return null;for(var r=window.devicePixelRatio||1,s=t.width,a=t.height,l=t.buffer,c=e.vertexCount,u=Float32Array.from(e.xVertices),h=Float32Array.from(e.yVertices),d=Number.POSITIVE_INFINITY,p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=0;m<c;++m){var f=u[m]=u[m]*r,E=h[m]=a-h[m]*r;d=Math.min(d,f),p=Math.min(p,E),v=Math.max(v,f),g=Math.max(g,E)}if(v<0||d>s||g<0||p>a)return null;var A=Math.round(v-d),y=Math.round(g-p),T=Math.round(.5*(d+v)),w=Math.round(.5*(p+g)),b=T,C=w,S=1,k=1;do{for(var x=b+S,M=C+k;b<x;++b)if(n(b,C))return i(b,C);for(;C<M;++C)if(n(b,C))return i(b,C);for(S<A?(x=b-++S,++S):x=b-S,k<y?(M=C-++k,++k):M=C-k;b>x;--b)if(n(b,C))return i(b,C);for(;C>M;--C)if(n(b,C))return i(b,C)}while(S<A||k<y)},e.createStyleSheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet},e.addRuleToStyleSheet=function(e,t,i,n){"insertRule"in e?e.insertRule(t+"{"+i+"}",n):"addRule"in e&&e.addRule(t,i,n)},e.measureTextLines=function(t,i,n){var o=n.sizeFromMarkupsToClient(0,i["font-size"]).y,r=(new e.DomElementStyle).setAttribute("font-family",i["font-family"]).setAttribute("font-size",o+"px").setAttribute("font-weight",i["font-weight"]?"bold":"").setAttribute("font-style",i["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),s=document.createElement("div");s.setAttribute("style",r),n.viewer.container.appendChild(s);for(var a=[],l=t.length,c=0;c<l;++c)s.innerHTML=t[c],a.push({line:t[c],width:s.clientWidth,height:s.clientHeight});return n.viewer.container.removeChild(s),a},e.createArcTo=function(e,t,i,n,o,r){return r.push(o?"a":"A"),r.push(i),r.push(n),r.push(0),r.push(1),r.push(1),r.push(e),r.push(t),r},e.createEllipsePath=function(t,i,n,o,r,s){var a=.5*n,l=.5*o;s.push(r?"m":"M"),s.push(t),s.push(i),e.createArcTo(n,0,a,l,!0,s),e.createArcTo(-n,0,a,l,!0,s),s.push("z")},e.createRectanglePath=function(e,t,i,n,o,r){r.push(o?"m":"M"),r.push(e),r.push(t),r.push("l"),r.push(i),r.push(0),r.push("l"),r.push(0),r.push(n),r.push("l"),r.push(-i),r.push(0),r.push("z")},e.renderToCanvas=function(t,i,n,o,r){for(var s=o["stroke-width"],a=o["stroke-linejoin"],l=o["stroke-color"],c=o["stroke-opacity"],u=o["fill-color"],h=o["fill-opacity"],d=new THREE.Vector3(0,0,0),p=(new THREE.Matrix4).extractRotation(r),v=180*Math.atan2(p.elements[4],p.elements[0])/Math.PI,g=t.positionFromMarkupsToClient.bind(t),m=t.vectorFromMarkupsToClient.bind(t),f=t.sizeFromMarkupsToClient.bind(t),E=n.length,A=!1,y=0;y<E;)switch(n[y++]){case"M":case"L":d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(r);var T=g(d.x,d.y);n[y++]=T.x,n[y++]=T.y;break;case"m":case"l":d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(p);var T=m(d.x,d.y);n[y++]=T.x,n[y++]=T.y;break;case"c":d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(p);var w=m(d.x,d.y);n[y++]=w.x,n[y++]=w.y,d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(p);var b=m(d.x,d.y);n[y++]=b.x,n[y++]=b.y,d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(p);var C=m(d.x,d.y);n[y++]=C.x,n[y++]=C.y;break;case"a":var S=f(n[y],n[y+1]);n[y++]=S.x,n[y++]=S.y,n[y++]=v,y++,n[y]=1==n[y++]?0:1,d.x=n[y],d.y=n[y+1],d=d.applyMatrix4(p);var C=m(d.x,d.y);n[y++]=C.x,n[y++]=C.y;break;case"Z":case"z":A=!0}i.strokeStyle=e.composeRGBAString(l,c),i.fillStyle=e.composeRGBAString(u,h),i.lineJoin=a,i.lineWidth=t.sizeFromMarkupsToClient(s,0).x,n=new Path2D(n.join(" ")),A&&0!==h&&i.fill(n),i.stroke(n)}}(),function(){"use strict";function e(e,t,i){this.type=t,this.editor=e,this.targetId=i,this.addToHistory=!0,this.selectOnExecution=!0}AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),Autodesk.Viewing.Extensions.Markups.Core.EditAction=e,Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.execute=function(){this.editor.actionManager.execute(this)},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.redo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.undo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.merge=function(e){return!1},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.isIdentity=function(){return!1}}(),function(){"use strict";function e(e){this.historySize=e,this.undoStack=new Array(e),this.redoStack=new Array(e),i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.EVENT_HISTORY_CHANGED="EVENT_HISTORY_CHANGED";var n=e.prototype;n.execute=function(e){var i=this.redoStack,n=this.undoStack;i.splice(0,i.length),e.redo();var o=this.getEditActionGroup();o.isOpen()?o.addAction(e):(o.open(),o.addAction(e),o.close()),n.length>this.historySize&&n.splice(0,1);var r=e.selectOnExecution?e.targetId:-1;this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:r}})},n.beginActionGroup=function(){var e=this.undoStack,t=e.length,i=null;0===t||e[t-1].isClosed()?(i=this.getEditActionGroup(),i.open()):console.warn("Markups - Undo/Redo - Action edit group already open.")},n.closeActionGroup=function(){var e=this.undoStack,t=e.length;if(0===t)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var i=e[t-1];i.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),i.isEmpty()&&e.pop()},n.cancelActionGroup=function(){var e=this.undoStack,i=e.length;if(0===i)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var n=e[i-1];return n.close()?(n.undo(),e.pop(),void this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})):void console.warn("Markups - Undo/Redo - Action edit group already closed.")},n.undo=function(){var e=this.undoStack,i=this.redoStack;if(0!==e.length){var n=e.pop(),o=n.undo();i.push(n),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:o}})}},n.redo=function(){var e=this.undoStack,i=this.redoStack;if(0!==i.length){var n=i.pop(),o=n.redo();e.push(n),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:o}})}},n.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},n.isUndoStackEmpty=function(){return 0===this.undoStack.length},n.isRedoStackEmpty=function(){return 0===this.redoStack.length},n.getEditActionGroup=function(){var e=this.undoStack,i=this.undoStack.length,n=null;return 0===i||e[i-1].isClosed()?(n=new t.EditActionGroup,e.push(n)):n=e[i-1],n},t.EditActionManager=e}(),function(){"use strict";function e(){this.reset()}function t(e){var t=[];for(var i in e){var n=e[i];t.push(i),t.push(":"),t.push(n),t.push("; ")}return t.join("")}var i=Autodesk.Viewing.Extensions.Markups.Core.Utils,n=["-ms-","-webkit-","-moz-","-o-"],o=e.prototype;o.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},o.setAttribute=function(e,t,i){if(this.attributes[e]=t,i&&i.allBrowsers){var o=this;n.forEach(function(i){o.attributes[i+e]=t})}return this.dirty=!0,this},o.removeAttribute=function(e){Array.isArray(e)||(e=[e]);var t=this;return e.forEach(function(e){e in t.attributes&&(delete t.attributes[e],t.dirty=!0)}),this},o.getStyleString=function(){return this.dirty&&(this.styleString=t(this.attributes),this.dirty=!1),this.styleString},o.clone=function(){var e=new i.DomElementStyle,t=this.attributes;for(var n in t)e.setAttribute(n,t[n]);return e},i.DomElementStyle=e}(),function(){"use strict";function e(e,t){this.containingDiv=e,this.editor=t,this.selectionLayer=i(),this.frameMargin=10,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},c.bind(this)(),w.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.selectionLayer,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}]],inputClass:Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded)),v.bind(this)(),g.bind(this)(),f.bind(this)(),m.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),w.addTraitEventDispatcher(this)}function t(e){e.pageX=e.pointers[0].clientX,e.pageY=e.pointers[0].clientY}function i(){var e=document.createElement("div");return e.style.position="absolute",e.style.top=0,e.style.bottom=0,e.style.left=0,e.style.right=0,e.style.overflow="hidden",e.style.visibility="hidden",E(e,!1),e}function n(e,t){var i=document.createElement("div");i.style.position="absolute",i.style.height=e+"px",i.style.width=e+"px",i.style.background=C,i.style.borderColor=b,i.style.borderWidth="1px",i.style.borderStyle="solid",r(i,t),i.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+t,i.setAttribute("data-sdp-handle",t);var n=-e-2;switch(t){case"n":i.style.top=n+"px",i.style.left="calc(50% - "+e/2+"px)",i.style.position="relative",i.style.margin=0;break;case"s":i.style.top="calc(100% - "+(e+2)+"px)",i.style.left="calc(50% - "+e/2+"px)",i.style.position="relative",i.style.margin=0;break;case"w":i.style.left=n+"px",i.style.top="50%",i.style.transform="translate3d(0, -50%, 0)";break;case"e":i.style.right=n+"px",i.style.top="50%",i.style.transform="translate3d(0, -50%, 0)";break;case"nw":i.style.top=n+"px",i.style.left=n+"px";break;case"ne":i.style.top=n+"px",i.style.right=n+"px";break;case"sw":i.style.bottom=n+"px",i.style.left=n+"px";break;case"se":i.style.bottom=n+"px",i.style.right=n+"px"}return i}function o(){var e=18,t=1,i=document.createElement("div");return i.style.position="absolute",i.style.background=C,i.style.border=t+"px solid rgba(30, 30, 255, 0.25)",i.style.height=e+"px",i.style.width=e+"px",i.style.borderRadius=e/2+t+"px",i.style.boxSizing="border-box",i.classList.add("selector-rotate-point"),i.style.left="50%",i.style.transform="translate3d(-50%, 0px, 0px)",i.style.top="-70px",i.classList.add("autodesk-markups-extension-core-make-me-bigger"),i}function r(e,t){var i;switch(t){case"n":case"s":i="ns-resize";break;case"w":case"e":i="ew-resize";break;case"ne":case"sw":i="nesw-resize";break;case"nw":case"se":i="nwse-resize"}e.style.cursor=i}function s(e){var t=16;["n","s","w","e","nw","ne","sw","se"].forEach(function(i){this.selection.handle[i]=n(t,i),e.appendChild(this.selection.handle[i])}.bind(this))}function a(e){return y(e,".selector-drag-point")}function l(e){return y(e,".selector-rotate-point")}function c(){var e=1,t=document.createElement("div");return t.style.position="absolute",t.style.border=e+"px solid "+b,t.style.zIndex=1,t.style.cursor="move",t.style.boxSizing="border-box",E(t,!0),t.classList.add("selector-box"),s.bind(this)(t),this.selection.rotationHandle=o(),t.appendChild(this.selection.rotationHandle),this.selection.element=t,this.selectionLayer.appendChild(this.selection.element),h.bind(this)(!1),t}function u(e,t){return"translate3d("+e+"px,"+t+"px,0)"}function h(e){this.selection.active=e,this.selection.element.style.display=e?"block":"none"}function d(e,t,i){this.selection.x=e,this.selection.y=t,this.selection.rotation=i;var n=this.markup.getClientSize();n.x+=2*this.frameMargin,n.y+=2*this.frameMargin,this.selection.element.style.msTransform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.msTransformOrigin=n.x/2+"px "+n.y/2+"px",this.selection.element.style.webkitTransform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.webkitTransformOrigin=n.x/2+"px "+n.y/2+"px",this.selection.element.style.transform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.transformOrigin=n.x/2+"px "+n.y/2+"px"}function p(e,t){this.selection.width=e,this.selection.height=t,this.selection.element.style.width=e+"px",this.selection.element.style.height=t+"px"}function v(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}function g(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function m(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function f(){var e=function(e){this.selection.dragging=!1;var t=this.editor.editMode;t&&t.onMouseDoubleClick(this.markup)}.bind(this),t=this.selectionLayer;t.addEventListener("dblclick",e)}function E(e,t){e.style.pointerEvents=t?"auto":"none"}function A(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function y(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)}var T=Autodesk.Viewing.Extensions.Markups.Core,w=Autodesk.Viewing.Extensions.Markups.Core.Utils;T.EVENT_EDITFRAME_EDITION_START="EVENT_EDITFRAME_EDITION_START",T.EVENT_EDITFRAME_EDITION_END="EVENT_EDITFRAME_EDITION_END";var b="rgba(30, 30, 255, 0.30)",C="gainsboro",S=e.prototype;S.setSelection=function(e,t,i,n,o){var r=this.frameMargin,s=2*r;p.bind(this)(i+s,n+s),d.bind(this)(e-r,t-r,o),h.bind(this)(!0),this.selectionLayer.style.visibility="visible"},S.setMarkup=function(e){if(this.hammer&&this.hammer.set({enable:null!==e}),this.markup=e,h.bind(this)(!1),e){var t=e.getClientSize(),i=e.getClientPosition(),n=t.x,o=t.y,r=e.getRotation();this.setSelection(i.x-n/2,i.y-o/2,n,o,r),this.enableResizeHandles(),this.enableRotationHandle()}},S.startDrag=function(e){this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(e,this.editor.getMousePosition())},S.isActive=function(){return this.isDragging()||this.isResizing()||this.isRotating()},S.isDragging=function(){return this.selection.dragging},S.isResizing=function(){return this.selection.resizing},S.isRotating=function(){return this.selection.rotating},S.onMouseMove=function(e){},S.onMouseUp=function(e){},S.onHammerDrag=function(e){function i(e,t,i){var n=t.getBoundingClientRect();e.mousePosition.x=i.pageX-n.left,e.mousePosition.y=i.pageY-n.top}switch(t(e),e.type){case"dragstart":i(this.editor.input,this.editor.svg,e),l(e.target)?this._onRotationMouseDown(e):a(e.target)?this._onResizeMouseDown(e):this.startDrag(e),e.preventDefault();break;case"dragmove":i(this.editor.input,this.editor.svg,e),this.onMouseMove(e),e.preventDefault();break;case"dragend":i(this.editor.input,this.editor.svg,e),this.onMouseUp(e),e.preventDefault()}},S.onHammerDoubleTap=function(e){function i(e,t,i){var n=t.getBoundingClientRect();e.mousePosition.x=i.pageX-n.left,e.mousePosition.y=i.pageY-n.top}t(e),i(this.editor.input,this.editor.svg,e),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},S.enableResizeHandles=function(){var e,t=this.markup;if(t.isHeightConstrained()||t.isWidthConstrained()){for(var i in this.selection.handle)e=this.selection.handle[i],e&&(e.style.display="none");t.isHeightConstrained()&&(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block"),t.isWidthConstrained()&&(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block")}else for(var i in this.selection.handle)e=this.selection.handle[i],e&&(e.style.display="block")},S.enableRotationHandle=function(){var e=this.markup,t=this.selection.rotationHandle,i=e.isRotationConstrained()?"none":"block";t.style.display=i};var k=!1;S._onRepositionMouseDown=function(e,t){k=!0;var i=!(e instanceof MouseEvent);if((i||!a(e.target)&&!l(e.target))&&(t=i?t:this.editor.getMousePosition(),this.initialCursor=t,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),e&&e.altKey){var n=this.editor,o=new T.CloneMarkup(n,n.getId(),this.markup,this.markup.position);o.execute()}this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START})}},S._onRepositionMouseMove=function(e){if(k)return void(k=!1);if(this.selection.dragging){var t=this.editor.getMousePosition(),i=this.editor.input.constrainAxis;this.areAxisConstrained!==i&&(this.areAxisConstrained=i,this.axisConstrains=i?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=t.x-this.initialCursor.x,this.initialPosition.y+=t.y-this.initialCursor.y,this.initialCursor.x=t.x,this.initialCursor.y=t.y);var n={x:t.x-this.initialCursor.x,y:t.y-this.initialCursor.y},o=15;0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(n.x)>o?(this.axisConstrains.x=1,n.x+=n.x<0?o:-o):Math.abs(n.y)>o&&(this.axisConstrains.y=1,n.y+=n.y<0?o:-o));var r=this.initialPosition.x+n.x*this.axisConstrains.x,s=this.initialPosition.y+n.y*this.axisConstrains.y;d.bind(this)(r,s,this.selection.rotation);var a=this.editor.positionFromClientToMarkups(r,s),l=new T.SetPosition(this.editor,this.markup,a);l.execute()}},S._onRepositionMouseUp=function(){this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END}))},S._onResizeMouseDown=function(e){var t=e.target;if(a(t)){this.selection.handle.resizing=t;var i=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=i+"-resize";var n=this.editor.getMousePosition(),o=this.markup.getClientPosition(),r=this.markup.getClientSize();this.initial={x:o.x,y:o.y,width:r.x,height:r.y,mouseX:n.x,mouseY:n.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START}))}},S._onResizeMouseMove=function(e){if(this.selection.resizing){var t=this.editor.getMousePosition(),i=this.initial,n={x:t.x-i.mouseX,y:t.y-i.mouseY},o=new THREE.Vector3(n.x,n.y,0),r=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);n=o.applyMatrix4(r);var s=i.x,a=i.y,l=i.width,c=i.height,u=new THREE.Vector3,h=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&["nw","ne","sw","se"].indexOf(h)!==-1){var d=new THREE.Vector3(n.x,n.y,0);switch(h){case"nw":n.set(-i.width,-i.height,0);break;case"ne":n.set(i.width,-i.height,0);break;case"sw":n.set(i.width,-i.height,0);break;case"se":n.set(i.width,i.height,0)}n.normalize(),n=d.projectOnVector(n)}var p={n:function(){c-=n.y,u.y=n.y},s:function(){c+=n.y,u.y=n.y},w:function(){l-=n.x,u.x=n.x},e:function(){l+=n.x,u.x=n.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}};p[h]();var v=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),g=u.applyMatrix4(v),m=this.editor.positionFromClientToMarkups(s+.5*g.x,a+.5*g.y),f=this.editor.sizeFromClientToMarkups(l,c),E=new T.SetSize(this.editor,this.markup,m,f.x,f.y);E.execute()}},S._onResizeMouseUp=function(e){this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.editor.closeActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}};var x,M;S._onRotationMouseDown=function(e){l(e.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,M=this.editor.getMousePosition(),x=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START}))},S._onRotationMouseMove=function(e){if(this.selection.rotating){var t=this.editor.getMousePosition(),i=this.markup.getClientPosition(),n=A(i,t),o=A(i,M),r=n-o+x;if(this.editor.input.snapRotations){var s=w.degreesToRadians(22.5);r=Math.ceil(r/s)*s}d.bind(this)(this.selection.x,this.selection.y,r);var a=new T.SetRotation(this.editor,this.markup,r);a.execute()}},S._onRotationMouseUp=function(e){this.selection.rotating=!1,x=null,M=null,this.editor.closeActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END})},T.EditFrame=e}(),function(){"use strict";function e(e,t,n){this.id=e,this.type="",this.editor=t,this.viewer=t.viewer,this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=i.createStyle(n,this.editor),this.style=i.copyStyle(t.getDefaultStyle(),this.style),this.highlightColor="#FAFF3C",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.highlighted=!1,this.selected=!1,i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.MARKUP_TYPE_ARROW="arrow",t.MARKUP_TYPE_TEXT="label",t.MARKUP_TYPE_RECTANGLE="rectangle",t.MARKUP_TYPE_CIRCLE="ellipse",t.MARKUP_TYPE_CLOUD="cloud",t.MARKUP_TYPE_FREEHAND="freehand",t.MARKUP_TYPE_POLYLINE="polyline",t.MARKUP_TYPE_POLYCLOUD="polycloud",t.EVENT_EDITMODE_CHANGED="EVENT_EDITMODE_CHANGED",t.EVENT_EDITMODE_ENTER="EVENT_EDITMODE_ENTER",t.EVENT_EDITMODE_LEAVE="EVENT_EDITMODE_LEAVE",t.EVENT_MARKUP_SELECTED="EVENT_MARKUP_SELECTED",t.EVENT_MARKUP_DRAGGING="EVENT_MARKUP_DRAGGING",t.EVENT_MARKUP_ENTER_EDITION="EVENT_MARKUP_ENTER_EDITION",t.EVENT_MARKUP_CANCEL_EDITION="EVENT_MARKUP_CANCEL_EDITION",t.EVENT_MARKUP_DELETE_EDITION="EVENT_MARKUP_DELETE_EDITION";var n=e.prototype;t.Markup=e,n.destroy=function(){this.unselect(),this.setParent(null)},n.setParent=function(e){var t=this.shape;t.parentNode&&t.parentNode.removeChild(t),e&&e.appendChild(t)},n.clone=function(){var e=Object.create(this.__proto__),t=this.getCloneOverrides();for(var i in this)if(this.hasOwnProperty(i)){var n=this[i];t.hasOwnProperty(i)?e[i]=t[i]:n.clone instanceof Function?e[i]=n.clone():n instanceof Function?e[i]=n.bind(e):n.nodeType?e[i]=n.cloneNode(!0):n instanceof Object?e[i]=JSON.parse(JSON.stringify(n)):e[i]=n}return this.cloneShape(e),e},n.cloneShape=function(e){e.shape.markup=e.shape.childNodes.item(0),e.shape.hitarea=e.shape.childNodes.item(1),e.bindDomEvents()},n.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},n.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.fireEvent({type:t.EVENT_MARKUP_SELECTED,markup:this}))},n.unselect=function(){this.selected=!1},n.highlight=function(e){this.interactionsDisabled||(this.highlighted=e,this.updateStyle())},n.getStyle=function(){return i.cloneStyle(this.style)},n.setStyle=function(e){i.copyStyle(e,this.style),this.updateStyle()},n.updateStyle=function(){},n.edit=function(){this.fireEvent({type:t.EVENT_MARKUP_ENTER_EDITION,markup:this})},n.cancel=function(){this.fireEvent({type:t.EVENT_MARKUP_CANCEL_EDITION,markup:this})},n.deleteMarkup=function(){this.fireEvent({type:t.EVENT_MARKUP_DELETE_EDITION,markup:this})},n.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},n.getClientPosition=function(){var e=this.position;return this.editor.positionFromMarkupsToClient(e.x,e.y)},n.getClientSize=function(){var e=this.size;return this.editor.sizeFromMarkupsToClient(e.x,e.y)},n.setRotation=function(e){this.rotation=e,this.updateStyle()},n.getRotation=function(){return this.rotation},n.setPosition=function(e,t){this.position.x=e,this.position.y=t,this.updateStyle()},n.setSize=function(e,t,i){this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.isWidthConstrained=function(){return this.constraintWidth},n.isHeightConstrained=function(){return this.constraintHeight},n.isRotationConstrained=function(){return this.constraintRotation},n.disableInteractions=function(e){this.interactionsDisabled=e},n.setStrokeWidth=function(e){},n.constrainsToBounds=function(e){},n.onMouseDown=function(e){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(e))},n.generatePoint3d=function(e){function t(t,n){var r=i.checkLineSegment(t.x,t.y,n.x,n.y,e),s=r&&o.clientToWorld(r.x,r.y);return s&&s.point}function n(t){var n=i.checkPolygon(t,e),r=n&&o.clientToWorld(n.x,n.y);return r&&r.point}var o=this.viewer,r=this.generateBoundingPolygon(),s=r.xVertices,a=r.yVertices,l=new THREE.Vector2(s[0]+s[1],a[0]+a[1]).multiplyScalar(.5),c=new THREE.Vector2(s[0]+s[3],a[0]+a[3]).multiplyScalar(.5),u=new THREE.Vector2(s[2]+s[1],a[2]+a[1]).multiplyScalar(.5),h=new THREE.Vector2(s[2]+s[3],a[2]+a[3]).multiplyScalar(.5),d=c.clone().add(u).multiplyScalar(.5),p=t(d,u)||t(d,c)||t(d,l)||t(d,h);
return p||n(r)},n.generateBoundingBox=function(){for(var e={min:{x:0,y:0},max:{x:0,y:0}},t=this.generateBoundingPolygon(),i=t.vertexCount,n=t.xVertices,o=t.yVertices,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=0;c<i;++c){var u=n[c],h=o[c];r=Math.min(r,u),s=Math.min(s,h),a=Math.max(a,u),l=Math.max(l,h)}return e.min.x=r,e.min.y=s,e.max.x=a,e.max.y=l,e},n.generateBoundingPolygon=function(){var e=this.getClientPosition(),t=this.getClientSize();t.x*=.5,t.y*=.5;var i=new THREE.Vector3(-t.x,-t.y).add(e),n=new THREE.Vector3(t.x,-t.y).add(e),o=new THREE.Vector3(t.x,t.y).add(e),r=new THREE.Vector3(-t.x,t.y).add(e);if(0!==this.rotation){var s=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,0),a=(new THREE.Matrix4).makeRotationZ(this.rotation),l=(new THREE.Matrix4).makeTranslation(e.x,e.y,0),c=l.multiply(a).multiply(s);i.applyMatrix4(c),n.applyMatrix4(c),o.applyMatrix4(c),r.applyMatrix4(c)}return{vertexCount:4,xVertices:new Float32Array([i.x,n.x,o.x,r.x]),yVertices:new Float32Array([i.y,n.y,o.y,r.y])}},n.setMetadata=function(){return null},n.bindDomEvents=function(){i.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.shape,{recognizers:[[Hammer.Tap,{event:"singletap",pointers:1,threshold:2}]],inputClass:Hammer.TouchInput}),this.onSingleTapBinded=function(e){this.onMouseDown(e)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded)),this.shape.addEventListener("mousedown",this.onMouseDown.bind(this),!0),this.shape.addEventListener("mouseout",function(){this.highlight(!1)}.bind(this)),this.shape.addEventListener("mouseover",function(){this.highlight(!0)}.bind(this))},n.renderToCanvas=function(e){var t=(new THREE.Matrix4).makeRotationZ(-this.rotation),n=(new THREE.Matrix4).makeTranslation(this.position.x,this.position.y,0),o=n.multiply(t);i.renderToCanvas(this.editor,e,this.getPath(),this.style,o)},n.getPath=function(){},n.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",i.radiansToDegrees(-this.rotation),")"].join(" ")}}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeArrow(this.editor)},n.set=function(e,t,i,n){var o=new THREE.Vector2(e,t),r=new THREE.Vector2(i,n),s=r.clone().sub(o).normalize();this.size.x=o.distanceTo(r),this.rotation=Math.acos(s.dot(new THREE.Vector2(1,0))),this.rotation=n>t?2*Math.PI-this.rotation:this.rotation;var a=this.head,l=this.tail;a.set(i,n,0),l.set(e,t,0),this.position.x=l.x+.5*(a.x-l.x),this.position.y=l.y+.5*(a.y-l.y),this.updateStyle()},n.setRotation=function(e){this.rotation=e;var t=Math.cos(-e),i=Math.sin(-e),n=new THREE.Vector2(t,i);n.multiplyScalar(.5*this.size.x);var o=new THREE.Vector2(this.position.x,this.position.y),r=o.clone().sub(n),s=o.clone().add(n);this.head.set(s.x,s.y,0),this.tail.set(r.x,r.y,0),this.updateStyle()},n.setSize=function(e,t,i){var n=Math.cos(-this.rotation),o=Math.sin(-this.rotation),r=new THREE.Vector2(n,o);r.multiplyScalar(.5*t);var s=new THREE.Vector2(e.x,e.y),a=s.clone().sub(r),l=s.clone().add(r);this.head.set(l.x,l.y,0),this.tail.set(a.x,a.y,0),this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=e["stroke-width"],o=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),r=this.getTransform();this.size.y=3*n,this.style["fill-color"]=e["stroke-color"],this.style["fill-opacity"]=e["stroke-opacity"],i.setAttributeToMarkupSvg(t,"d",this.getPath().join(" ")),i.setAttributeToMarkupSvg(t,"stroke-width",n),i.setAttributeToMarkupSvg(t,"stroke",o),i.setAttributeToMarkupSvg(t,"fill",o),i.setAttributeToMarkupSvg(t,"transform",r),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setPosition=function(e,t){var i=this.head,n=this.tail,o=i.x-n.x,r=i.y-n.y,s=e+.5*o,a=t+.5*r;i.x=s,i.y=a,n.x=s-o,n.y=a-r,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},n.generatePoint3d=function(e){var t=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),n=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),o=t.clone().sub(n).normalize(),r=i.checkLineSegment(t.x,t.y,t.x+200*o.x,t.y+200*o.y,e),s=r&&this.viewer.clientToWorld(r.x,r.y);return s&&s.point},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.head=[this.head.x,this.head.y].join(" "),e.tail=[this.tail.x,this.tail.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.size.x,t=this.size.y,i=t/3,n=this.style["stroke-width"],o=e-3*n,r=e-o,s=.3*n;return["M",.5*-e,.5*-t+i,"l",o,0,"l",-s,-i,"l",r+s,1.5*i,"l",-r-s,1.5*i,"l",s,-i,"l",-o,0,"z"]},t.MarkupArrow=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_CIRCLE,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeCircle(this.editor)},n.set=function(e,t){this.setSize(e,t.x,t.y)},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.size;if(1===e.x||1===e.y)return[""];var t=this.style["stroke-width"],n=e.x,o=e.y,r=n-t,s=o-t,a=.5*t,l=a-.5*n,c=0,u=[];return i.createEllipsePath(l,c,r,s,!1,u),u},t.MarkupCircle=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_CLOUD,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeCloud(this.editor)},n.set=function(e,t){this.setSize(e,t.x,t.y)},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){function e(e,t,i,n,o){return o.push("a"),o.push(i),o.push(n),o.push(0),o.push(1),o.push(1),o.push(e),o.push(t),o}function t(t,i,n,o,r){switch(t){case"LT":return e(i,-n,i,n,r);case"RT":return e(i,n,i,n,r);case"RB":return e(-i,n,i,n,r);case"LB":return e(-i,-n,i,n,r)}}function n(e,t,i,n){var o=2*i,r=Math.abs(t-e-n),s=Math.round(r/o);o+=(r-o*s)/s,i=.5*o;var a=.05*o,l=3.5*i/3;return{count:s,radius:i,diameter:o,p1:{x:a,y:-l},p2:{x:o-a,y:-l},p3:{x:o,y:0}}}function o(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(i.p1.x),t.push(i.p1.y),t.push(i.p2.x),t.push(i.p2.y),t.push(i.p3.x),t.push(i.p3.y);return t}function r(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(-i.p1.y),t.push(i.p1.x),t.push(-i.p2.y),t.push(i.p2.x),t.push(-i.p3.y),t.push(i.p3.x);return t}function s(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(-i.p1.x),t.push(-i.p1.y),t.push(-i.p2.x),t.push(-i.p2.y),t.push(-i.p3.x),t.push(-i.p3.y);return t}function a(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(i.p1.y),t.push(-i.p1.x),t.push(i.p2.y),t.push(-i.p2.x),t.push(i.p3.y),t.push(-i.p3.x);return t}var l=this.position,c=this.size,u=this.style["stroke-width"],h=2*u,d=l.x,p=l.y,v=l.x+c.x,g=l.y+c.y,m=5*h,f=[];if(c.x<m||c.y<m){var E=c.x-u,A=c.y-u,y=.5*-c.x,T=0;i.createEllipsePath(y,T,E,A,!1,f)}else{var w=n(d,v,h,u),b=n(p,g,h,u),C=w.diameter,S=b.diameter,k=w.radius,x=b.radius;w=n(d+C,v-C,h,u),b=n(p+S,g-S,h,u);var M=.5*u,y=.5*-c.x+M+k,T=.5*-c.y+M+2*x;f.push("M"),f.push(y),f.push(T),t("LT",k,x,u,f),o(w,f),t("RT",k,x,u,f),r(b,f),t("RB",k,x,u,f),s(w,f),t("LB",k,x,u,f),a(b,f)}return f.push("z"),f},t.MarkupCloud=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_FREEHAND,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeFreehand(this.editor)},n.set=function(e,t,i){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s="none",a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=[],t=this.locations,i=t.length;if(i>1){e.push("M"),e.push(t[0].x),e.push(t[0].y);for(var n=1;n<i;++n){var o=t[n-1],r=t[n];e.push("l"),e.push(r.x-o.x),e.push(r.y-o.y)}}return e},t.MarkupFreehand=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_POLYLINE,this.shape=i.createMarkupPathSvg("path"),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModePolyline(this.editor)},n.set=function(e,t,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.closed=n,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),r=this.closed?i.composeRGBAString(e["fill-color"],e["fill-opacity"]):"none",s=this.getTransform();i.setAttributeToMarkupSvg(t,"d",this.getPath().join(" ")),i.setAttributeToMarkupSvg(t,"stroke-width",n),i.setAttributeToMarkupSvg(t,"stroke",o),i.setAttributeToMarkupSvg(t,"fill",r),i.setAttributeToMarkupSvg(t,"transform",s),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=[],t=this.locations,i=t.length;if(0===i)return" ";e.push("M"),e.push(t[0].x),e.push(t[0].y);for(var n=1;n<i;++n){var o=t[n-1],r=t[n];e.push("l"),e.push(r.x-o.x),e.push(r.y-o.y)}return this.closed&&e.push("z"),e},t.MarkupPolyline=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModePolycloud(this.editor)},n.set=function(e,t,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.closed=n,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=this.closed?i.composeRGBAString(e["fill-color"],e["fill-opacity"]):"none",a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){function e(e){switch(e.length){case 0:case 1:return 1;case 2:var t=e[0],i=e[1];return t.y>i.y?1:-1;default:var n=e[0],o=e[1],r=e[2],s=(o.x-n.x)*(o.y+n.y)+(r.x-o.x)*(r.y+o.y);return s<0?1:-1}}function t(e,t){for(var i=e.length,n=[],o=i-(t?0:1),r=0;r<o;++r){var s=e[r],a=e[(r+1)%i],l=a.x-s.x,c=a.y-s.y,u=Math.sqrt(l*l+c*c);n.push({index:r,pointA:new THREE.Vector3(s.x,s.y,0),pointB:new THREE.Vector3(a.x,a.y,0),vecAB:new THREE.Vector3(l/u,c/u,0),vecBA:new THREE.Vector3(-l/u,-c/u,0),length:u})}return n}function i(e,t,i){for(var n=2*i,o=e.length,r=0;r<o;++r){var s=e[r],a=t[r],l=t[(r+1)%o];s.bodyA=s.vecAB.clone().multiplyScalar(a.radius).add(s.pointA),s.bodyB=s.vecBA.clone().multiplyScalar(l.radius).add(s.pointB),s.body=s.bodyB.clone().sub(s.bodyA).length(),s.bodyCount=Math.round(s.body/n),s.bodyDiameter=n+(s.body-n*s.bodyCount)/s.bodyCount,s.bodyRadius=.5*s.bodyDiameter}}function n(e,t,i){for(var n=[],o=e.length,r=0;r<o;++r){var s=e[0!==r?r-1:o-1],a=e[r],l=s.vecBA.clone().cross(a.vecAB).z<0,c=s.length<t||a.length<t;c||0===r&&!i?n.push({pointA:a.pointA.clone(),pointB:a.pointA.clone(),radius:0,large:!1}):n.push({pointA:a.pointA.clone().add(s.vecBA.clone().multiplyScalar(t)),pointB:a.pointA.clone().add(a.vecAB.clone().multiplyScalar(t)),radius:t,large:l})}return n}function o(e,t,i){var n=e.bodyRadius,o=e.bodyDiameter,r=.05*o,s=3.5*n/3,a=new THREE.Vector3(r,t*-s),l=new THREE.Vector3(o-r,t*-s),c=new THREE.Vector3(o,0),u=Math.acos(e.vecAB.x)*(e.vecAB.y<0?-1:1),h=(new THREE.Matrix4).makeRotationZ(u);a.applyMatrix4(h),l.applyMatrix4(h),c.applyMatrix4(h);for(var d=e.bodyCount,p=0;p<d;++p)i.push("c"),i.push(a.x),i.push(a.y),i.push(l.x),i.push(l.y),i.push(c.x),i.push(c.y)}function r(e,t,i,n){t&&(n.push("M"),n.push(e.pointA.x),n.push(e.pointA.y));var o=1===i?e.large:!e.large;return 0!==e.radius&&(n.push("a"),n.push(e.radius),n.push(e.radius),n.push(0),n.push(o?1:0),n.push(1===i?1:0),n.push(e.pointB.x-e.pointA.x),n.push(e.pointB.y-e.pointA.y)),n}var s=this.style["stroke-width"],a=2*s,l=e(this.locations),c=this.closed,u=[],h=t(this.locations,c),d=n(h,a,c),p=d.length;i(h,d,a);for(var v=0;v<p;++v)r(d[v],0===v,l,u),o(h[v],l,u);return c&&u.push("z"),u},t.MarkupPolycloud=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_RECTANGLE,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeRectangle(this.editor)},n.set=function(e,t){this.position.x=e.x,this.position.y=e.y,this.size.x=t.x,this.size.y=t.y,this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.style["stroke-width"],t=this.size.x-e,n=this.size.y-e,o=.5*-t,r=.5*-n,s=[];return i.createRectanglePath(o,r,t,n,!1,s),s},t.MarkupRectangle=e}(),function(){"use strict";function e(e,n,o){var r=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];t.Markup.call(this,e,n,r),this.type=t.MARKUP_TYPE_TEXT,this.shape=i.createMarkupTextSvg(),this.constraintRotation=!0,this.size.x=o.x,this.size.y=o.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeText(this.editor)},n.set=function(e,t,i,n){this.position.x=e.x,this.position.y=e.y,this.size.x=t.x,this.size.y=t.y,this.setText(i,n)},n.setSize=function(e,t,i){this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setStyle=function(e){i.copyStyle(e,this.style),this.updateStyle()},n.setText=function(e){this.currentText=e,this.updateStyle()},n.getText=function(){return this.currentText},n.getTextLines=function(){return this.currentTextLines.concat()},n.updateStyle=function(){function e(){var e=this.style,t=this.shape,n=this.style["font-size"],o=this.style["font-family"],r=this.style["font-weight"],s=this.style["font-style"],a=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),l=i.composeRGBAString(e["fill-color"],e["fill-opacity"]);this.rebuildTextSvg(),i.setAttributeToMarkupSvg(t,"font-family",o),i.setAttributeToMarkupSvg(t,"font-size",n),i.setAttributeToMarkupSvg(t,"fill",a),i.setAttributeToMarkupSvg(t,"font-weight",r),i.setAttributeToMarkupSvg(t,"font-style",s);var c=this.editor,u=this.getTransform(),h=this.getTextTransform(),d=this.textSize;i.setMarkupTextSvgTransform(t,u,h),i.updateMarkupTextSvgBackground(t,d.x,d.y,l),i.updateMarkupTextSvgClipper(t,d.x,d.y),i.updateMarkupTextSvgHitarea(t,d.x,d.y,c),this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,requestAnimationFrame(e.bind(this)))},n.rebuildTextSvg=function(){var e=this.editor.editMode;if(e&&e.type===this.type){var t=i.cloneStyle(e.textInputHelper.style),n=e.textInputHelper.textArea.value;this.currentTextLines=e.textInputHelper.getTextValuesForMarkup(this).lines,e.selectedMarkup!==this&&(e.textInputHelper.textArea.value=n,e.textInputHelper.setStyle(t))}var o=i.createSvgElement("text");o.setAttribute("id","markup"),o.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(o),this.shape.markup=o;var r=0,s=0,a=this.getLineHeight();this.currentTextLines.forEach(function(e){var t=i.createSvgElement("tspan");t.setAttribute("x",r),t.setAttribute("y",s),t.textContent=e,o.appendChild(t),s+=a}.bind(this));var l=this.generateBoundingPolygon(),c=this.editor.sizeFromClientToMarkups(l.xVertices[1]-l.xVertices[0],l.yVertices[2]-l.yVertices[0]);this.textSize.x=Math.min(c.x,this.size.x),this.textSize.y=Math.min(c.y,this.size.y)},n.generateBoundingPolygon=function(){function e(e,t,n){for(var o={w:0,h:0},e=i.measureTextLines(e,t,n),r=e.length,s=0;s<r;++s){var a=e[s];o.w=Math.max(o.w,a.width),o.h=o.h+a.height}return 0!==o.h&&(o.h+=n.sizeFromMarkupsToClient(0,.25*t["font-size"]).y),o}var t=this.getClientPosition(),n=this.getClientSize(),o=e(this.currentTextLines,this.style,this.editor),r=Math.min(n.x,o.w),s=Math.min(n.y,o.h),a=new THREE.Vector2(.5*-n.x,.5*-n.y).add(t),l=new THREE.Vector2(a.x+r,a.y),c=new THREE.Vector2(l.x,l.y+s),u=new THREE.Vector2(a.x,c.y);return{vertexCount:4,xVertices:new Float32Array([a.x,l.x,c.x,u.x]),yVertices:new Float32Array([a.y,l.y,c.y,u.y])}},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.text=String(this.currentText),i.addMarkupMetadata(this.shape,e)},n.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},n.getLineHeight=function(){return this.style["font-size"]},n.renderToCanvas=function(e){function t(e,t,i,n){var o=0;t.forEach(function(t){o+i>n||(e.fillText(t,0,o),o+=i)})}var n=this.style["font-family"],o=this.style["font-style"],r=this.style["font-weight"],s=this.style["stroke-color"],a=this.style["stroke-opacity"],l=this.getClientFontSize(),c=this.editor.positionFromMarkupsToClient(this.position.x,this.position.y),u=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y),h=this.editor.sizeFromMarkupsToClient(this.textSize.x,this.textSize.y),d=this.editor.sizeFromMarkupsToClient(0,this.getLineHeight()).y;e.save();var p=this.style["fill-color"],v=this.style["fill-opacity"];e.fillStyle=i.composeRGBAString(p,v),e.translate(c.x,c.y),0!==v&&e.fillRect(u.x*-.5,u.y*-.5,h.x,h.y),e.restore(),e.fillStyle=s,e.strokeStyle=s,e.textBaseline="Alphabetic",e.translate(c.x-.5*u.x,c.y-.5*u.y+d),e.font=o+" "+r+" "+l+"px "+n,e.globalAlpha=a,t(e,this.currentTextLines,d,u.y)},n.getTransform=function(){var e=this.position.x-.5*this.size.x,t=this.position.y+.5*this.size.y;return["translate(",e,",",t,")","rotate(",i.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},n.getTextTransform=function(){var e=this.getLineHeight(),t=this.position.x-.5*this.size.x,n=this.position.y+.5*this.size.y-e;return["translate(",t,",",n,")","rotate(",i.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},n.cloneShape=function(e){e.shape=i.createMarkupTextSvg(),e.bindDomEvents()},t.MarkupText=e}(),function(){"use strict";function e(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.coreExt=null,this.hotkeysEnabled=!0;var e=!1,t=!1;this.allowNavigation=function(e){this.allowNav=e},this.setCoreExtension=function(e){this.coreExt=e},this.setHotkeysEnabled=function(e){this.hotkeysEnabled=e},this.activate=function(e,t){this.panTool=t.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan")},this.deactivate=function(e){this.panTool&&this.panTool.deactivate("pan"),this.panTool=null},this.handleKeyDown=function(i,n){if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:e=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:t=!0;break;case Autodesk.Viewing.KeyCode.x:e&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:e&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:e&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:e&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!e||t||this.allowNav?e&&t&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:e&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var o=this.coreExt.getSelection();o&&this.coreExt.deleteMarkup(o);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(i,n){if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:e=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:t=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(e,t)},this.handleDoubleClick=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(e,t)},this.handleSingleTap=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(e)},this.handleDoubleTap=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(e)},this.handleWheelInput=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleWheelInput)&&this.panTool.handleWheelInput(e)},this.handleButtonDown=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(e,t)},this.handleButtonUp=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(e,t)},this.handleMouseMove=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(e)},this.handleGesture=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(e)},this.handleBlur=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(e)}}var t=Autodesk.Viewing.Extensions.Markups.Core;t.MarkupTool=e}(),function(){"use strict";function e(e,n){Autodesk.Viewing.Extension.call(this,e,n),this.options=this.options||{},this.markups=[],this.styles={},this.duringViewMode=!1,this.duringEditMode=!1,this.actionManager=new t.EditActionManager(50),this.actionManager.addEventListener(t.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new t.Clipboard(this),this.input=new t.InputHandler,i.addTraitEventDispatcher(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(e){var t=this;t.onViewerResize(e),requestAnimationFrame(function(){t.duringViewMode&&t.onViewerResize(e)})}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this);var o=i.createStyleSheet();i.addRuleToStyleSheet(o,".autodesk-markups-extension-core-make-me-bigger:after",'content:""; position:absolute; top:-10px; bottom:-10px; left:-10px; right:-10px;',0)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),i=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),n=1e3;e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,t.MarkupsCore=e,t.EVENT_ENTER_EDIT_MODE="EVENT_MARKUP_CORE_ENTER_EDIT_MODE",t.EVENT_LEAVE_EDIT_MODE="EVENT_MARKUP_CORE_LEAVE_EDIT_MODE",t.EVENT_SELECTION_CHANGED="EVENT_MARKUP_SELECTION_CHANGED";var o=e.prototype;o.load=function(){var e=this.svg=i.createSvgElement("svg");i.setSvgParentAttributes(e);var n=new i.DomElementStyle;n.setAttribute("position","absolute"),n.setAttribute("left","0"),n.setAttribute("top","0"),n.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),n.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),e.setAttribute("style",n.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new t.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(t.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(t.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this));var o=this.options.markupToolClass||t.MarkupTool;return this.markupTool=new o,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(!this.options.markupDisableHotkeys),this.viewer.toolController.registerTool(this.markupTool),this.snapper=new Autodesk.Viewing.Extensions.Measure.Snapper(this.viewer,!0),this.viewer.toolController.registerTool(this.snapper),!0},o.unload=function(){this.hide(),this.input.detachFrom(this),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var e=this.svg;return e&&this.onMouseDownBinded&&(e.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),e.parentNode&&e.parentNode.removeChild(e),this.editModeSvgLayerNode=null,this.svg=null,!0},o.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},o.enterEditMode=function(){return!!this.duringEditMode||!(!this.duringViewMode&&!this.show())&&(this.editModeSvgLayerNode||(this.editModeSvgLayerNode=i.createSvgElement("g"),this.editModeSvgLayerNode.setAttribute("cursor","default")),this.svg.insertBefore(this.editModeSvgLayerNode,this.svg.firstChild),this.svg.setAttribute("cursor","crosshair"),this.input.enterEditMode(),this.activateTool(!0),this.allowNavigation(!1),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new t.EditModeArrow(this)),this.actionManager.clear(),this.fireEvent({
type:t.EVENT_EDITMODE_ENTER}),!0)},o.leaveEditMode=function(){var e=!0,i=!1;if(!this.duringEditMode||!this.duringViewMode)return e;var n=this.viewer;return n?(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.svg.removeChild(this.editModeSvgLayerNode),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.fireEvent({type:t.EVENT_EDITMODE_LEAVE}),e):i},o.toggle=function(){this.duringViewMode?this.hide():this.show()},o.show=function(){var e=this.viewer;if(!e||!e.model)return!1;if(this.duringViewMode||this.duringEditMode)return!0;e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),e.container.appendChild(this.svg),this.input.enterViewMode(),i.hideLmvUi(e),this.onViewerRolloverObject=e.impl.rolloverObject,e.impl.rolloverObject=function(){},this.activateTool(!0);var t=e.impl.camera;return this.onViewerResize({width:t.clientWidth,height:t.clientHeight}),this.clear(),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},o.hide=function(){var e=!0,t=!1,n=this.viewer;if(!n||!this.duringViewMode)return e;if(this.duringEditMode&&!this.leaveEditMode())return t;n.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),n.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var o=this.svg;return o.parentNode&&o.parentNode.removeChild(o),this.unloadMarkupsAllLayers(),i.removeAllMetadata(o),this.input.leaveViewMode(),i.restoreLmvUi(n),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,e},o.clear=function(){for(var e=this.markups;e.length>0;){var t=e[0];this.removeMarkup(t),t.destroy()}var i=this.editModeSvgLayerNode;if(i&&i.childNodes.length>0)for(;i.childNodes.length;)i.removeChild(i.childNodes[0])},o.generateData=function(){this.editMode&&this.editMode.onSave(),i.removeAllMetadata(this.svg);var e=i.createSvgElement("svg");i.transferChildNodes(this.svg,e),i.transferChildNodes(this.editModeSvgLayerNode,this.svg);var t={"data-model-version":"4"},n=i.addSvgMetadata(this.svg,t),o=[n];this.markups.forEach(function(e){var t=e.setMetadata();t&&o.push(t)});var r=i.svgNodeToString(this.svg);return o.forEach(function(e){e.parentNode.removeChild(e)}),i.transferChildNodes(this.svg,this.editModeSvgLayerNode),i.transferChildNodes(e,this.svg),e=null,r},o.generatePoints3d=function(){var e={markups:[],main:null},n=this.markups,o=n.length;if(0===o)return e;for(var r=this.viewer.impl.renderer().readbackTargetId(),s=0;s<o;++s){var a=n[s],l=a.generatePoint3d(r)||null;e.markups.push({id:a.id,type:a.type,point:l||null})}if(1===o){var c=e.markups[0].point;return e.main=c&&c.clone(),e}for(var s=0;s<o;++s){var u=e.markups[s];if(u.type===t.MARKUP_TYPE_ARROW&&null!==u.point)return e.main=u.point.clone(),e}for(var h=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,v=Number.NEGATIVE_INFINITY,s=0;s<o;++s){var g=n[s].generateBoundingBox();h=Math.min(h,g.min.x),d=Math.min(d,g.min.y),p=Math.max(p,g.max.x),v=Math.max(v,g.max.y)}var m={};m.vertexCount=4,m.xVertices=new Float32Array([h,p,p,h]),m.yVertices=new Float32Array([d,d,v,v]);var f=i.checkPolygon(m,r),E=f&&this.viewer.clientToWorld(f.x,f.y);return e.main=E&&E.point,e},o.renderToCanvas=function(e){this.markups.forEach(function(t){e.save(),t.renderToCanvas(e),e.restore()})},o.changeEditMode=function(e){var n=this.editMode;n&&n.destroy(),e.addEventListener(t.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),e.addEventListener(t.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),e.addEventListener(t.EVENT_MARKUP_DESELECT,function(e){this.fireEvent(e)}.bind(this)),this.editMode=e,this.styles[e.type]=i.cloneStyle(e.getStyle()),this.fireEvent({type:t.EVENT_EDITMODE_CHANGED,target:e})},o.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},o.allowNavigation=function(e){if(e&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;var t=this.editMode;this.navigating=e,e?(this.svg.setAttribute("pointer-events","none"),t&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted");for(var i=this.markups,n=i.length,o=0;o<n;++o)i[o].updateStyle();this.markupTool.allowNavigation(e),t&&t.notifyAllowNavigation(e)},o.disableMarkupInteractions=function(e){this.markups.forEach(function(t){t.disableInteractions(e)})},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.activateTool=function(e){if(e)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var t=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(t)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onToolChange=function(e){if(e.toolName===this.markupTool.getName()){if(e.active){var t=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:t,zoom:t,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(e.active)}},o.changeInputHandler=function(e){this.input.detachFrom(this),e.attachTo(this),this.input=e,this.duringEditMode&&e.enterEditMode(),this.duringViewMode&&e.enterViewMode()},o.copy=function(){this.clipboard.copy()},o.cut=function(){this.clipboard.cut()},o.paste=function(){this.clipboard.paste()},o.undo=function(){this.actionManager.undo()},o.redo=function(){this.actionManager.redo()},o.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},o.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},o.beginActionGroup=function(){this.actionManager.beginActionGroup()},o.closeActionGroup=function(){this.actionManager.closeActionGroup()},o.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},o.getId=function(){return++this.nextId},o.onEditActionHistoryChanged=function(e){var t=e.data,i=this.editMode,n=i&&i.selectedMarkup&&i.selectedMarkup.id===t.targetId;if("undo"!==t.action&&t.targetId!==-1||"undo"===t.action&&n){var o=this.getMarkup(t.targetId);this.selectMarkup(o)}this.fireEvent(e)},o.getMarkup=function(e){for(var t=this.markups,i=t.length,n=0;n<i;++n)if(t[n].id==e)return t[n];return null},o.selectMarkup=function(e){if(e)if(this.editMode.type===e.type)this.editMode.setSelection(e);else{var t=e.getEditMode();t.setSelection(null),this.changeEditMode(t),this.setStyle(e.getStyle()),this.editMode.setSelection(e)}else this.editMode.setSelection(null)},o.getSelection=function(){return this.editMode.getSelection()},o.deleteMarkup=function(e,t){var i=e.getEditMode();i.deleteMarkup(e,t)},o.addMarkup=function(e){e.setParent(this.editModeSvgLayerNode),e.addEventListener(t.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),e.addEventListener(t.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),e.addEventListener(t.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),e.addEventListener(t.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.markups.push(e)},o.removeMarkup=function(e){e.setParent(null),e.removeEventListener(t.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),e.removeEventListener(t.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),e.removeEventListener(t.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),e.removeEventListener(t.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var i=this.markups,n=i.indexOf(e);n!==-1&&i.splice(n,1);var o=this.editMode;if(o){var r=o.getSelection();r===e&&this.selectMarkup(null)}},o.setStyle=function(e){var t=this.styles,n=this.editMode;i.copyStyle(e,t[n.type]),n.setStyle(t[n.type])},o.getStyle=function(){return i.cloneStyle(this.styles[this.editMode.type])},o.getDefaultStyle=function(){var e=["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"];return this.defaultStyle=this.defaultStyle||i.createStyle(e,this),this.defaultStyle},o.bringToFront=function(e){this.sendMarkupTo(e,this.markups.length-1)},o.sendToBack=function(e){this.sendMarkupTo(e,0)},o.bringForward=function(e){var t=this.markups.indexOf(e);this.sendMarkupTo(e,t+1)},o.bringBackward=function(e){var t=this.markups.indexOf(e);this.sendMarkupTo(e,t-1)},o.sendMarkupTo=function(e,t){var i=this.markups,n=i.indexOf(e);n===-1||t<0||t>=i.length||(i.splice(n,1),t=n>t?t-1:t,i.splice(t,0,e),e.setParent(null),e.setParent(this.editModeSvgLayerNode))},o.loadMarkups=function(e,t){var o=this,r=o.viewer,s=r.impl.camera,a=function(e,t){var n=i.clientToWorld(e,t,0,r);return n.add(s.position).applyMatrix4(s.matrixWorldInverse),n.z=0,n},l=function(e,t){var n=o.viewer.impl.camera,r=i.clientToWorld(e,t,0,o.viewer),s=o.viewer.model.getData().globalOffset;return s&&r.sub(s),r.add(n.position),r.applyMatrix4(n.matrixWorldInverse),r.z=0,r},c=i.getClipPathId(),u=function(e){if("markup_element"==e.tagName&&"label"===e.getAttribute("type")){var t=e.parentNode.parentNode.childNodes[1].childNodes[0],i="markup-clipper-"+c++,n="url(#"+i+")";t.setAttribute("id",i),t.parentNode.setAttribute("clip-path",n)}else for(var o=e.childNodes,r=o.length,s=0;s<r;++s)u(o[s])};if(!this.duringViewMode)return!1;if(!t)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var h=i.stringToSvgNode(e);if(!h)return!1;var d=h.childNodes[0].childNodes[0],p=parseFloat(d.getAttribute("data-model-version")),v={x:0,y:0},g=this.viewer.model.getData().globalOffset;if(p<2&&g){var m=l(0,0).sub(a(0,0));v.x+=m.x,v.y+=m.y}if(p<4&&g&&!s.isPerspective){var f=this.clientToMarkups(0,0).sub(l(0,0));v.x+=f.x,v.y+=f.y}var E=null;p<4&&s.isPerspective&&(E=n),p>=3&&u(h),i.removeAllMetadata(h);var A=this.svgLayersMap[t];A||(A=i.createSvgElement("g"),this.svg.appendChild(A),this.svgLayersMap[t]=A);for(var y=h.childNodes;y.length;){var T=y[0],w=T.getAttribute("transform")||"";0===v.x&&0===v.y||(w="translate("+v.x+", "+v.y+") "+w),E&&(w="scale("+E+", "+E+") "+w),(v||E)&&T.setAttribute("transform",w),A.appendChild(T),T.setAttribute("pointer-events","none")}return!0},o.unloadMarkups=function(e){if(!e)return console.warn("unloadMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];return!!t&&(this.svg.removeChild(t),delete this.svgLayersMap[e],!0)},o.unloadMarkupsAllLayers=function(){for(var e in this.svgLayersMap)this.svgLayersMap.hasOwnProperty(e)&&this.svg.removeChild(this.svgLayersMap[e]);this.svgLayersMap={}},o.hideMarkups=function(e){if(!e)return console.warn("hideMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];return!!t&&void t.setAttribute("visibility","hidden")},o.showMarkups=function(e){if(!e)return console.warn("showMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];return!!t&&void t.setAttribute("visibility","visible")},o.positionFromClientToMarkups=function(e,t){return this.clientToMarkups(e,t)},o.positionFromMarkupsToClient=function(e,t){return this.markupsToClient(e,t)},o.vectorFromClientToMarkups=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t);return{x:n.x-i.x,y:n.y-i.y}},o.vectorFromMarkupsToClient=function(e,t){var i=this.markupsToClient(0,0),n=this.markupsToClient(e,t);return{x:n.x-i.x,y:n.y-i.y}},o.sizeFromClientToMarkups=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},o.sizeFromMarkupsToClient=function(e,t){var i=this.markupsToClient(0,0),n=this.markupsToClient(e,t);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},o.markupsToClient=function(e,t){var o=this.viewer.impl.camera,r=new THREE.Vector3(e,t,0);if(o.isPerspective){var s=this.viewer.impl.canvas.getBoundingClientRect();r.x=r.x/n*(.5*s.height)+.5*s.width,r.y=-r.y/n*(.5*s.height)+.5*s.height}else{r.applyMatrix4(o.matrixWorld),r.sub(o.position);var a=this.viewer.model.getData().globalOffset;a&&r.sub(a),r=i.worldToClient(r,this.viewer,!1),r.z=0}return r},o.clientToMarkups=function(e,t){var o=this.viewer.impl.camera,r=new THREE.Vector3(e,t,0);if(o.isPerspective){var s=this.viewer.impl.canvas.getBoundingClientRect();r.x=(r.x-.5*s.width)/(.5*s.height)*n,r.y=-(r.y-.5*s.height)/(.5*s.height)*n}else{r=i.clientToWorld(r.x,r.y,0,this.viewer);var a=this.viewer.model.getData().globalOffset;a&&r.add(a),r.add(o.position),r.applyMatrix4(o.matrixWorldInverse),r.z=0}return r},o.getSvgViewBox=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t),o=Math.min(i.x,n.x),r=Math.min(i.y,n.y),s=Math.max(i.x,n.x),a=Math.max(i.y,n.y);return[o,r,s-o,a-r].join(" ")},o.getBounds=function(){return this.bounds},o.getMousePosition=function(){return this.viewer.model.is2d()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},o.getSnapPosition=function(){var e,t=this.snapper.getHighlightGeometry(),i=this.snapper.getGeometry();e=t===SNAP_VERTEX?i:this.snapper.nearestPointInPointToEdge(i,this.snapper.getIntersectPoint());var n=this.project(e);return{x:n.x,y:n.y}},o.project=function(e){var t=this.viewer.navigation.getCamera(),i=this.viewer.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(e);return n.project(t),new THREE.Vector3(Math.round((n.x+1)/2*i.width),Math.round((-n.y+1)/2*i.height),n.z)},o.onCameraChange=function(e){var t=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==t){this.svg.setAttribute("viewBox",t);var i=this.editMode;if(i){var n=i.getSelection();this.editFrame.setMarkup(n)}}},o.onViewerResize=function(e){this.bounds.x=0,this.bounds.y=0,this.bounds.width=e.width,this.bounds.height=e.height,this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height),this.onCameraChange()},o.onMouseMove=function(e){if(!this.navigating){if(this.editFrame.isActive()&&"mousemove"===e.type&&this.editFrame.onMouseMove(e),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var t=this.input.getMousePosition();this.snapper&&this.snapper.onMouseMove(t)}this.editMode&&this.editMode.onMouseMove(e)}};var r=0,s="";o.onMouseDown=function(e){var t=performance.now();if(!(t-r<400&&s!==e.type)){r=t,s=e.type,i.dismissLmvHudMessage();var n=this.getBounds(),o=this.getMousePosition();o.x>=n.x&&o.x<=n.x+n.width&&o.y>=n.y&&o.y<=n.y+n.height&&this.editMode.onMouseDown(e),this.editMode.creating||e.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1}};var a=0,l="";o.onMouseUp=function(e){var t=performance.now();if(!(t-a<400&&l!==e.type||(a=t,l=e.type,this.navigating)))return this.editFrame.isActive()?void this.editFrame.onMouseUp(e):void(this.ignoreNextMouseUp||this.editMode.onMouseUp(e))},o.onMouseDoubleClick=function(e){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(e)},o.onUserCancel=function(){this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect()},o.onMarkupSelected=function(e){this.selectMarkup(e.markup),this.fireEvent(e)},o.onMarkupEnterEdition=function(e){},o.onMarkupCancelEdition=function(e){this.onUserCancel()},o.onMarkupDeleteEdition=function(e){this.removeMarkup(e.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",e)}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"CLONE-MARKUP",i),this.clone=n.clone(),this.clone.id=i,this.position={x:o.x,y:o.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor,t=this.clone,i=this.position;if(!e.getMarkup(this.targetId)){var n=t.clone();n.setPosition(i.x,i.y),e.addMarkup(n)}},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CloneMarkup=e}(),function(){"use strict";function e(e,n,o,r,s){t.EditAction.call(this,e,"CREATE-ARROW",n),this.selectOnExecution=!1,this.tail=r,this.head=o,this.style=i.cloneStyle(s)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupArrow(this.targetId,e);e.addMarkup(i),i.set(this.head.x,this.head.y,this.tail.x,this.tail.y),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateArrow=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-CIRCLE",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupCircle(this.targetId,e);e.addMarkup(i),i.setSize(this.position,this.size.x,this.size.y),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateCircle=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-CLOUD",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupCloud(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateCloud=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-FREEHAND",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupFreehand(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateFreehand=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-POLYCLOUD",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupPolycloud(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreatePolycloud=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-POLYLINE",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupPolyline(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreatePolyline=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-RECTANGLE",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupRectangle(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateRectangle=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-TEXT",n),this.text=s,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=this.position,n=this.size,o=new t.MarkupText(this.targetId,e,n);e.addMarkup(o),o.setSize(i,n.x,n.y),o.setText(this.text),o.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&(this.editor.removeMarkup(e),e.destroy())},t.CreateText=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-ARROW",i.id),this.createArrow=new t.CreateArrow(e,i.id,i.head,i.tail,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createArrow.undo()},i.undo=function(){this.createArrow.redo()},t.DeleteArrow=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-CIRCLE",i.id),this.createCircle=new t.CreateCircle(e,i.id,i.position,i.size,i.rotation,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createCircle.undo()},i.undo=function(){this.createCircle.redo()},t.DeleteCircle=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-CLOUD",i.id),this.createCloud=new t.CreateCloud(e,i.id,i.position,i.size,i.rotation,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createCloud.undo()},i.undo=function(){this.createCloud.redo()},t.DeleteCloud=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-FREEHAND",i.id),this.createFreehand=new t.CreateFreehand(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createFreehand.undo()},i.undo=function(){this.createFreehand.redo()},t.DeleteFreehand=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-POLYCLOUD",i.id),this.createPolycloud=new t.CreatePolyline(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createPolycloud.undo()},i.undo=function(){this.createPolycloud.redo()},t.DeletePolycloud=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-POLYLINE",i.id),this.createPolyline=new t.CreatePolyline(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createPolyline.undo()},i.undo=function(){this.createPolyline.redo()},t.DeletePolyline=e}(),function(){"use strict";var e=Autodesk.Viewing.Extensions.Markups.Core,t=function(t,i){e.EditAction.call(this,t,"DELETE-RECTANGLE",i.id),this.createRectangle=new e.CreateRectangle(t,i.id,i.position,i.size,i.rotation,i.getStyle())};t.prototype=Object.create(e.EditAction.prototype),t.prototype.constructor=t;var i=t.prototype;i.redo=function(){this.createRectangle.undo()},i.undo=function(){this.createRectangle.redo()},e.DeleteRectangle=t}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-TEXT",i.id);var n={x:i.position.x,y:i.position.y},o={x:i.size.x,y:i.size.y};this.createText=new t.CreateText(e,i.id,n,o,i.getText(),i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createText.undo()},i.undo=function(){this.createText.redo()},t.DeleteText=e}(),function(){"use strict";function e(){this.actions=[],this.closed=!0}var t=Autodesk.Viewing.Extensions.Markups.Core,i=e.prototype;i.open=function(){return!!this.closed&&(this.closed=!1,!0)},i.close=function(){return!this.closed&&(this.closed=!0,!0)},i.undo=function(){for(var e=this.actions,t=e.length-1,i=-1,n=t;n>=0;--n){var o=e[n];o.undo(),o.targetId!==-1&&(i=o.targetId)}return i},i.redo=function(){for(var e=this.actions,t=e.length,i=-1,n=0;n<t;++n){var o=e[n];o.redo(),o.targetId!==-1&&(i=o.targetId)}return i},i.isOpen=function(){return!this.closed},i.isClosed=function(){return this.closed},i.isEmpty=function(){return 0===this.actions.length},i.addAction=function(e){return!this.closed&&(this.actions.push(e),this.compact(),!0)},i.compact=function(){for(var e=this.actions,t=e.length,i=0;i<t;++i){var n=e[i];if(n.isIdentity())e.splice(i,1),--t,--i;else for(var o=i+1;o<t;++o){var r=e[o];if(n.type===r.type&&n.merge(r)){e.splice(o,1),--t,--i;break}}}},t.EditActionGroup=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-ARROW",i.id),this.newHead={x:n.x,y:n.y},this.newTail={x:o.x,y:o.y},this.oldHead={x:i.head.x,y:i.head.y},this.oldTail={x:i.tail.x,y:i.tail.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},i.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newHead=e.newHead,this.newTail=e.newTail,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){var o=1e-4;(Math.abs(n.head.x-t.x)>=o||Math.abs(n.head.y-t.y)>=o||Math.abs(n.tail.x-i.x)>=o||Math.abs(n.tail.y-i.y)>=o)&&n.set(t.x,t.y,i.x,i.y)}},i.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y},t.SetArrow=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-CIRCLE",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){var o=1e-4;(Math.abs(n.position.x-t.x)>o||Math.abs(n.size.y-i.y)>o||Math.abs(n.position.y-t.y)>o||Math.abs(n.size.y-i.y)>o)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetCircle=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-CLOUD",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){var o=1e-4;(Math.abs(n.position.x-t.x)>o||Math.abs(n.size.y-i.y)>o||Math.abs(n.position.y-t.y)>o||Math.abs(n.size.y-i.y)>o)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetCloud=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-FREEHAND",i.id),this.position=n,this.size=o,this.locations=r.concat()}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,!0)},i.isIdentity=function(){return!1},t.SetFreehand=e}(),function(){"use strict";function e(e,i,n,o,r,s){t.EditAction.call(this,e,"SET-POLYCLOUD",i.id),this.position=n,this.size=o,this.locations=r.concat(),this.closed=s}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations,this.closed)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,this.closed=e.closed,!0)},i.isIdentity=function(){return!1},t.SetPolycloud=e}(),function(){"use strict";function e(e,i,n,o,r,s){t.EditAction.call(this,e,"SET-POLYLINE",i.id),this.position=n,this.size=o,this.locations=r.concat(),this.closed=s}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations,this.closed)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,this.closed=e.closed,!0)},i.isIdentity=function(){return!1},t.SetPolyline=e}(),function(){"use strict";function e(e,i,n){t.EditAction.call(this,e,"SET-POSITION",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setPosition(this.newPosition.x,this.newPosition.y)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setPosition(this.oldPosition.x,this.oldPosition.y);
},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,!0)},i.isIdentity=function(){var e=this.newPosition,t=this.oldPosition;return e.x===t.x&&e.y===t.y},t.SetPosition=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-RECTANGLE",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){var o=1e-4;(Math.abs(n.position.x-t.x)>o||Math.abs(n.size.y-i.y)>o||Math.abs(n.position.y-t.y)>o||Math.abs(n.size.y-i.y)>o)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetRectangle=e}(),function(){"use strict";function e(e,i,n){t.EditAction.call(this,e,"SET-ROTATION",i.id);var o=i.getRotation();this.newRotation={angle:n},this.oldRotation={angle:o}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setRotation(this.newRotation.angle)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setRotation(this.oldRotation.angle)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newRotation=e.newRotation,!0)},i.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle},t.SetRotation=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-SIZE",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y},this.newWidth=o,this.oldWidth=i.size.x,this.newHeight=r,this.oldHeight=i.size.y}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setSize(this.newPosition,this.newWidth,this.newHeight)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newWidth=e.newWidth,this.newHeight=e.newHeight,!0)},i.isIdentity=function(){var e=this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight;return e},t.SetSize=e}(),function(){"use strict";function e(e,n,o){t.EditAction.call(this,e,"SET-STYLE",n.id),this.newStyle=i.cloneStyle(o),this.oldStyle=n.getStyle()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setStyle(this.newStyle)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setStyle(this.oldStyle)},t.SetStyle=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-TEXT",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y},this.newSize={x:o.x,y:o.y},this.oldSize={x:i.size.x,y:i.size.y},this.newText=r,this.oldText=i.getText()}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.newPosition,this.newSize,this.newText)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.oldPosition,this.oldSize,this.oldText)},t.SetText=e}(),function(){"use strict";function e(e){this.editor=e,this.content=null,this.pastePosition={x:0,y:0},i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils,n=e.prototype;n.copy=function(){var e=this.editor.getSelection();e&&(this.content=e.clone(),this.pastePosition.x=e.position.x,this.pastePosition.y=e.position.y)},n.cut=function(){var e=this.editor.getSelection();e&&(this.copy(),this.editor.deleteMarkup(e))},n.paste=function(){var e=this.content;if(e){var i=this.editor,n=this.pastePosition,o=i.sizeFromClientToMarkups(20,20);n.x+=o.x,n.y-=o.y;var r=new t.CloneMarkup(i,i.getId(),e,n);r.execute()}},t.Clipboard=e}(),function(){"use strict";function e(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.isMouseDown=!1}function t(e,t){var i=e.editor.svg.getBoundingClientRect();e.makeSameXY=t.shiftKey,e.snapRotations=t.shiftKey,e.keepAspectRatio=t.shiftKey,e.constrainAxis=t.shiftKey,e.mousePosition.x=t.clientX-i.left,e.mousePosition.y=t.clientY-i.top}function i(e){e.shiftKey=!1,e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY}var n=Autodesk.Viewing.Extensions.Markups.Core,o=Autodesk.Viewing.Extensions.Markups.Core.Utils,r=e.prototype;r.attachTo=function(e){this.editor&&this.detachFrom(this.editor),this.editor=e,o.isTouchDevice()&&(this.hammer=new Hammer.Manager(e.svg,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},r.detachFrom=function(e){this.hammer&&this.hammer.destroy(),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=e},r.enterEditMode=function(){this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded)),document.addEventListener("mousemove",this.onMouseMoveBinded,!0),document.addEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},r.leaveEditMode=function(){this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded)),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},r.enterViewMode=function(){},r.leaveViewMode=function(){},r.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},r.onWheel=function(e){e.preventDefault()},r.onMouseMove=function(e){t(this,e),this.editor.onMouseMove(e),e.preventDefault()},r.onMouseDown=function(e){t(this,e),this.isMouseDown=!0,this.editor.onMouseDown(e),e.preventDefault()},r.onMouseUp=function(e){t(this,e),this.isMouseDown=!1,this.editor.onMouseUp(e),e.preventDefault()},r.onMouseDoubleClick=function(e){t(this,e),this.editor.onMouseDoubleClick(e),e.preventDefault()},r.onTouchDrag=function(e){switch(i(e),e.type){case"dragstart":this.onMouseDown(e);break;case"dragmove":this.onMouseMove(e);break;case"dragend":this.onMouseUp(e)}e.preventDefault()},r.onSingleTap=function(e){i(e),this.onMouseDown(e),this.onMouseUp(e),e.preventDefault()},r.onDoubleTap=function(e){i(e),this.onMouseDoubleClick(e),e.preventDefault()},n.InputHandler=e}(),function(){"use strict";function e(e,t,n){this.editor=e,this.viewer=e.viewer,this.type=t,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=i.createStyle(n,this.editor),this.style=i.copyStyle(e.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.EVENT_EDITMODE_CREATION_BEGIN="EVENT_EDITMODE_CREATION_BEGIN",t.EVENT_EDITMODE_CREATION_END="EVENT_EDITMODE_CREATION_END",t.EVENT_MARKUP_DESELECT="EVENT_MARKUP_DESELECT";var n=e.prototype;n.destroy=function(){this.unselect(),i.removeTraitEventDispatcher(this)},n.unselect=function(){var e=!1,i=this.selectedMarkup;i&&(i.unselect(),this.selectedMarkup=null,e=!0),this.editor.editFrame.setMarkup(null),e&&this.fireEvent({type:t.EVENT_MARKUP_DESELECT})},n.creationBegin=function(){this.creating||(this.creating=!0,this.fireEvent({type:t.EVENT_EDITMODE_CREATION_BEGIN}))},n.creationEnd=function(){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?this.creationCancel():(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.unselect()))),this.creating=!1,this.fireEvent({type:t.EVENT_EDITMODE_CREATION_END}))},n.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(),this.selectedMarkup=null},n.setStyle=function(e){this.style=e;var i=this.selectedMarkup;if(i){var n=new t.SetStyle(this.editor,i,e);n.execute()}},n.getStyle=function(){return this.style},n.setSelection=function(e){this.selectedMarkup!==e&&(this.unselect(),e&&e.select()),this.selectedMarkup=e;var t=this.editor;e&&t.bringToFront(e),this.creating||t.editFrame.setMarkup(e)},n.getSelection=function(){return this.selectedMarkup},n.deleteMarkup=function(e,t){return!1},n.isMinSizeValid=function(){if(0!==this.minSize){var e=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return e.x*e.x+e.y*e.y>=this.minSize*this.minSize}return!0},n.startDragging=function(){var e=this.selectedMarkup,t=this.editor.getMousePosition();e&&(this.dragging=!0,this.draggingAnnotationIniPosition=e.getClientPosition(),this.draggingMouseIniPosition.set(t.x,t.y))},n.finishDragging=function(){var e=this.dragging,t=this.selectedMarkup;this.dragging=!1,t&&e&&t.finishDragging()},n.getFinalMouseDraggingPosition=function(){var e=this.editor,t=e.getBounds(),n=e.getMousePosition(),o=this.initialX,r=this.initialY,s=Math.min(Math.max(t.x,n.x),t.x+t.width),a=Math.min(Math.max(t.y,n.y),t.y+t.height);if(s==o&&a==r&&(s++,a++),e.input.makeSameXY){var l=Math.abs(s-o),c=Math.abs(a-r),u=Math.max(l,c);s=o+u*i.sign(s-o),a=r+u*i.sign(a-r)}return{x:s,y:a}},n.notifyAllowNavigation=function(e){},n.onMouseMove=function(e){},n.onMouseDown=function(){},n.onMouseUp=function(e){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},n.onMouseDoubleClick=function(e){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},n.onSave=function(){this.creating&&this.creationCancel()},n.getDraggingPosition=function(){var e=this.editor.getMousePosition(),t=e.x-this.draggingMouseIniPosition.x,i=e.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+t,y:this.draggingAnnotationIniPosition.y+i}},n.isInsideBounds=function(e,t,i){return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height},t.EditMode=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_ARROW,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteArrow(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();if(this.initialX=i.x,this.initialY=i.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,e.snapper){var n=e.snapper.getHighlightGeometry();n!==SNAP_VERTEX&&n!==SNAP_EDGE||(this.lineSnapped=e.snapper.getEdge())}var o=3.5*this.style["stroke-width"],r=e.sizeFromMarkupsToClient(o,0).x,s={x:this.initialX,y:this.initialY},a={x:Math.round(s.x+Math.cos(.25*Math.PI)*r),y:Math.round(s.y+Math.sin(.25*-Math.PI)*r)},l=function(e,t,i,n){this.isInsideBounds(t.x,t.y,n)||(t.y=Math.round(e.y+Math.sin(.25*Math.PI)*i),this.isInsideBounds(t.x,t.y,n)||(t.x=Math.round(e.x+Math.cos(.25*-Math.PI)*i),this.isInsideBounds(t.x,t.y,n)||(t.y=Math.round(e.y+Math.sin(.25*-Math.PI)*i))))}.bind(this);l(s,a,r,e.getBounds()),e.beginActionGroup(),s=e.positionFromClientToMarkups(s.x,s.y),a=e.positionFromClientToMarkups(a.x,a.y);var c=new THREE.Vector2(a.x-s.x,a.y-s.y);c.lengthSq()<o*o&&(c=c.normalize().multiplyScalar(o),a.x=s.x+c.x,a.y=s.y+c.y);var u=e.getId(),h=new t.CreateArrow(e,u,s,a,this.style);h.execute(),this.selectedMarkup=e.getMarkup(u),this.creationBegin()}},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.getFinalMouseDraggingPosition(),r=this.initialX,s=this.initialY;if(n.snapper&&!n.snapper.isSnapped()&&this.lineSnapped){var a=n.project(this.lineSnapped.vertices[0]),l=n.project(this.lineSnapped.vertices[1]),c=new THREE.Vector3(o.x,o.y,a.z),u=n.snapper.nearestPointInPointToLine(c,a,l),h=-(a.x-l.x)/(a.y-l.y),d=s-h*r,p=r+1,v=h*p+d,g=new THREE.Vector3(p,v,a.z),m=new THREE.Vector3(r,s,a.z),f=n.snapper.nearestPointInPointToLine(c,m,g);u.distanceTo(c)<=20?(o.x=u.x,o.y=u.y):f.distanceTo(c)<=20&&(o.x=f.x,o.y=f.y)}var E=n.positionFromClientToMarkups(r,s),A=n.positionFromClientToMarkups(o.x,o.y),y=new THREE.Vector2(A.x-E.x,A.y-E.y),T=3.5*i.style["stroke-width"];y.lengthSq()<T*T&&(y=y.normalize().multiplyScalar(T),A.x=E.x+y.x,A.y=E.y+y.y),this.size=n.sizeFromClientToMarkups(o.x-r,o.y-s);var w=new t.SetArrow(n,i,E,A);w.execute()}},t.EditModeArrow=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_CIRCLE,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteCircle(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.initialX,r=this.initialY,s=this.getFinalMouseDraggingPosition(),a=Math.abs(o-s.x),l=Math.abs(r-s.y),c=n.clientToMarkups(.5*(o+s.x),.5*(r+s.y)),u=this.size=n.sizeFromClientToMarkups(a,l),h=new t.SetCircle(n,i,c,u);h.execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId(),s=new t.CreateCircle(e,r,n,o,0,this.style);s.execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeCircle=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_CLOUD,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteCloud(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.initialX,r=this.initialY,s=this.getFinalMouseDraggingPosition(),a=n.clientToMarkups((o+s.x)/2,(r+s.y)/2),l=this.size=n.sizeFromClientToMarkups(s.x-o,s.y-r),c=new t.SetCloud(n,i,a,l);c.execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId(),s=new t.CreateCloud(e,r,n,o,0,this.style);s.execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeCloud=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_FREEHAND,i),this.style["stroke-opacity"]=.75}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteFreehand(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=n.getMousePosition(),r=this.movements,s=n.clientToMarkups(o.x,o.y);r.push(s);var a=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},l=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},c=a(r,"x"),u=a(r,"y"),h=l(r,"x"),d=l(r,"y"),p=h-c,v=d-u,g={x:c+.5*p,y:u+.5*v},m=this.size={x:p,y:v},f=r.map(function(e){return{x:e.x-g.x,y:e.y-g.y}}),E=new t.SetFreehand(n,i,g,m,f);E.execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY);this.movements=[n];var o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId(),s=new t.CreateFreehand(e,r,n,o,0,[{x:0,y:0}],this.style);s.execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeFreehand=e}(),function(){"use strict";function e(e){var t=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];i.EditMode.call(this,e,i.MARKUP_TYPE_POLYCLOUD,t),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function t(e,t){var i=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},n=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},o=t.style["stroke-width"],r=2*o+.5*o,s=i(e,"x")-r,a=i(e,"y")-r,l=n(e,"x")+r,c=n(e,"y")+r,u=l-s,h=c-a;t.size={x:u,y:h},t.position={x:s+.5*u,y:a+.5*h};var d=t.position;return e.map(function(e){return{x:e.x-d.x,y:e.y-d.y}})}var i=Autodesk.Viewing.Extensions.Markups.Core,n=Autodesk.Viewing.Extensions.Markups.Core.Utils,o=25;e.prototype=Object.create(i.EditMode.prototype),e.prototype.constructor=e;var r=e.prototype;r.deleteMarkup=function(e,t){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new i.DeletePolycloud(this.editor,e);return n.addToHistory=!t,n.execute(),!0}return!1},r.onMouseMove=function(e){i.EditMode.prototype.onMouseMove.call(this,e);var r=this.editor,s=this.selectedMarkup;if(s&&this.creating){this.dragging=!0;var a=this.movements;a.splice(a.length-1,1);var l=r.getMousePosition();l=r.clientToMarkups(l.x,l.y),a.length>=2&&n.areMarkupsPointsInClientRange(a[0],l,o,this.editor)&&(l=a[0]),a.push(l);var c=t(a,this),u=new i.SetPolycloud(r,s,this.position,this.size,c);u.execute()}},r.onMouseDown=function(){if(i.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var e=this.editor,t=e.getMousePosition();t=e.clientToMarkups(t.x,t.y);var n=this.size=e.sizeFromClientToMarkups(1,1);this.movements=[t,t],e.beginActionGroup();var o=e.getId(),r=new i.CreatePolycloud(e,o,t,n,0,[{x:0,y:0}],this.style);r.execute(),this.selectedMarkup=e.getMarkup(o),this.creationBegin()}},r.onMouseUp=function(e){if(i.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var r=this.editor,s=r.getMousePosition(),a=this.movements,l=!1;if(s=r.clientToMarkups(s.x,s.y),!(a.length>1&&n.areMarkupsPointsInClientRange(a[a.length-2],s,o,this.editor))){a.length>2&&n.areMarkupsPointsInClientRange(a[0],s,o,this.editor)&&(s=a[0],l=!0),a.splice(a.length-1,1),l||(a.push(s),a.push(s));var c=this.selectedMarkup,u=t(a,c),h=new i.SetPolycloud(r,c,c.position,c.size,u,l);h.execute(),l&&this.creationEnd()}}},r.onMouseDoubleClick=function(e){if(this.creating){var n=this.movements;if(n.splice(Math.max(0,n.length-1)),n.length<2)this.creationCancel();else{var o=this.selectedMarkup,r=t(n,o),s=new i.SetPolycloud(this.editor,o,o.position,o.size,r,!0);s.execute(),this.creationEnd()}}},r.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),i.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},r.creationCancel=function(){i.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},i.EditModePolycloud=e}(),function(){"use strict";function e(e){var t=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];i.EditMode.call(this,e,i.MARKUP_TYPE_POLYLINE,t),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function t(e,t){var i=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},n=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},o=i(e,"x"),r=i(e,"y"),s=n(e,"x"),a=n(e,"y"),l=s-o,c=a-r;t.size={x:l,y:c},t.position={x:o+.5*l,y:r+.5*c};var u=t.position;return e.map(function(e){return{x:e.x-u.x,y:e.y-u.y}})}var i=Autodesk.Viewing.Extensions.Markups.Core,n=Autodesk.Viewing.Extensions.Markups.Core.Utils,o=25;e.prototype=Object.create(i.EditMode.prototype),e.prototype.constructor=e;var r=e.prototype;r.deleteMarkup=function(e,t){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new i.DeletePolyline(this.editor,e);return n.addToHistory=!t,n.execute(),!0}return!1},r.onMouseMove=function(e){i.EditMode.prototype.onMouseMove.call(this,e);var r=this.editor,s=this.selectedMarkup;if(s&&this.creating){this.dragging=!0;var a=this.movements;a.splice(a.length-1,1);var l=r.getMousePosition();l=r.clientToMarkups(l.x,l.y),a.length>=2&&n.areMarkupsPointsInClientRange(a[0],l,o,this.editor)&&(l=a[0]),a.push(l);var c=t(a,this),u=new i.SetPolyline(r,s,this.position,this.size,c);u.execute()}},r.onMouseDown=function(e){if(i.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var t=this.editor,n=t.getMousePosition();n=t.clientToMarkups(n.x,n.y);var o=this.size=t.sizeFromClientToMarkups(1,1);this.movements=[n,n],t.beginActionGroup();var r=t.getId(),s=new i.CreatePolyline(t,r,n,o,0,[{x:0,y:0}],this.style);s.execute(),this.selectedMarkup=t.getMarkup(r),this.creationBegin()}},r.onMouseUp=function(){if(i.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,r=e.getMousePosition(),s=this.movements,a=!1;if(r=e.clientToMarkups(r.x,r.y),!(s.length>1&&n.areMarkupsPointsInClientRange(s[s.length-2],r,o,this.editor))){s.length>2&&n.areMarkupsPointsInClientRange(s[0],r,o,this.editor)&&(r=s[0],a=!0),s.splice(s.length-1,1),a||(s.push(r),s.push(r));var l=this.selectedMarkup,c=t(s,l),u=new i.SetPolyline(e,l,l.position,l.size,c,a);u.execute(),a&&this.creationEnd()}}},r.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),i.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},r.creationCancel=function(){i.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},r.onMouseDoubleClick=function(e){if(this.creating){var n=this.movements;if(n.splice(Math.max(0,n.length-1)),n.length<2)this.creationCancel();else{var o=this.selectedMarkup,r=t(n,o),s=new i.SetPolyline(this.editor,o,o.position,o.size,r,this.closed);s.execute(),this.creationEnd()}}},i.EditModePolyline=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_RECTANGLE,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteRectangle(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.setStyle=function(e){t.EditMode.prototype.setStyle.call(this,e);var i=this.selectedMarkup;if(i){var n=new t.SetRectangle(this.editor,i,i.position,i.size);n.execute()}},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n,o,r=this.editor,s=this.initialX,a=this.initialY,l=this.getFinalMouseDraggingPosition(),c=r.clientToMarkups((s+l.x)/2,(a+l.y)/2);if(r.snapper&&this.lineSnapped){var u=r.project(this.lineSnapped.vertices[0]),h=r.project(this.lineSnapped.vertices[1]),d=new THREE.Vector3(l.x,l.y,u.z),p=r.snapper.nearestPointInPointToLine(d,u,h);o=d.distanceTo(p);var v=-(u.x-h.x)/(u.y-h.y),g=a-v*s,m=s+1,f=v*m+g,E=new THREE.Vector3(m,f,u.z),A=new THREE.Vector3(s,a,u.z),y=r.snapper.nearestPointInPointToLine(d,A,E);n=d.distanceTo(y)}else n=l.x-s,o=l.y-a;var T=this.size=r.sizeFromClientToMarkups(n,o),w=new t.SetRectangle(r,i,c,T);w.execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1),r=0;if(this.lineSnapped=null,e.snapper){var s=e.snapper.getHighlightGeometry();if(s===SNAP_VERTEX||s===SNAP_EDGE){this.lineSnapped=e.snapper.getEdge();var a=e.project(this.lineSnapped.vertices[0]),l=e.project(this.lineSnapped.vertices[1]),c=(l.y-a.y)/(l.x-a.x);r=this.rotation=Math.atan(c)}}e.beginActionGroup();var u=e.getId(),h=new t.CreateRectangle(e,u,n,o,r,this.style);h.execute(),this.selectedMarkup=e.getMarkup(u),this.creationBegin()}},t.EditModeRectangle=e}(),function(){"use strict";function e(e){var i=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];t.EditMode.call(this,e,t.MARKUP_TYPE_TEXT,i);var n=new t.EditorTextInput(this.viewer.container,this.editor);n.addEventListener(n.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.textInputHelper=n,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if(e=e||this.selectedMarkup,e&&e.type==this.type){var n=new t.DeleteText(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.setStyle=function(e){this.textInputHelper.isActive()?this.textInputHelper.setStyle(e):t.EditMode.prototype.setStyle.call(this,e)},i.notifyAllowNavigation=function(e){e&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},i.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),t.EditMode.prototype.destroy.call(this)},i.onMouseDown=function(){if(this.textInputHelper.isActive())return void this.textInputHelper.acceptAndExit();if(!this.selectedMarkup){var e=this.editor,i=e.getMousePosition(),n=e.sizeFromMarkupsToClient(0,this.style["font-size"]).y,o=15*n,r=3*n,s=this.size=e.sizeFromClientToMarkups(o,r),a=e.positionFromClientToMarkups(i.x+.5*o,i.y+.5*r);this.creationBegin(),e.beginActionGroup();var l=new t.CreateText(e,e.getId(),a,s,"",this.style);l.execute(),this.creationEnd(),this.selectedMarkup=e.getMarkup(l.targetId),this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},i.onMouseUp=function(e){},i.onMouseDoubleClick=function(e){e===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper.setActive(e,!1))},i.onHelperTextChange=function(e){var i=e.data,n=i.markup,o=i.style;if(this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===i.newText){if(i.firstEdit)return this.editor.cancelActionGroup(),void this.editor.selectMarkup(null);var r=new t.DeleteText(this.editor,n);return r.execute(),void this.editor.selectMarkup(null)}i.firstEdit||this.editor.beginActionGroup();var s=this.editor.positionFromClientToMarkups(i.newPos.x,i.newPos.y),a=this.editor.sizeFromClientToMarkups(i.width,i.height),l=new t.SetSize(this.editor,n,s,a.x,a.y);l.execute();var c=new t.SetText(this.editor,n,n.position,n.size,i.newText);c.execute();var u=new t.SetStyle(this.editor,n,o);u.execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},i.onHistoryChange=function(e){this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},i.onSave=function(){if(t.EditMode.prototype.onSave.call(this),this.textInputHelper.isActive()){var e=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),e&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},t.EditModeText=e}(),function(){"use strict";function e(e,t){this.parentDiv=e,this.editor=t,this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.textArea=document.createElement("textarea"),this.textArea.setAttribute("maxlength","260"),this.textArea.setAttribute("data-i18n",r),this.onKeyHandlerBinded=this.onKeyHandler.bind(this),this.textArea.addEventListener("keydown",this.onKeyHandlerBinded),this.styleTextArea=new o.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("overflow-y","hidden"),this.measureDiv=document.createElement("div"),o.addTraitEventDispatcher(this),this.onResizeBinded=this.onWindowResize.bind(this);
}function t(e){if(0===e.length)return"";for(var t=e.length-1,i=t;i>=0;--i)if(" "!==e.charAt(i)){t=i;break}return e.substr(0,t+1)}function i(e){if(0===e.length)return"";for(var t=0,i=0;i<e.length;++i)if(" "!==e.charAt(i)){t=i;break}return e.substr(t)}var n=Autodesk.Viewing.Extensions.Markups.Core,o=Autodesk.Viewing.Extensions.Markups.Core.Utils,r="Write Something",s=e.prototype;s.destroy=function(){this.textArea.removeEventListener("keydown",this.onKeyHandlerBinded),this.setInactive()},s.setActive=function(e,t){if(this.textMarkup!==e){var i=Autodesk.Viewing.i18n.translate(r);this.textArea.setAttribute("placeholder",i),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=e,this.firstEdit=t||!1,this.initFromMarkup(),window.addEventListener("resize",this.onResizeBinded);var n=this.textArea;window.requestAnimationFrame(function(){n.focus()})}},s.setInactive=function(){window.removeEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null},s.isActive=function(){return!!this.textMarkup},s.initFromMarkup=function(){var e=this.textMarkup,t=e.getClientPosition(),i=e.getClientSize(),n=t.x-.5*i.x,o=t.y-.5*i.y,r=e.lineHeight+"%";this.styleTextArea.setAttribute("line-height",r),this.setPosAndSize(n,o,i.x,i.y),this.setStyle(e.getStyle()),this.textArea.value=e.getText()},s.setPosAndSize=function(e,t,i,n){e+i>=this.editor.viewer.container.clientWidth&&(e=this.editor.viewer.container.clientWidth-(i+10)),t+n>=this.editor.viewer.container.clientHeight&&(t=this.editor.viewer.container.clientHeight-(n+10)),this.styleTextArea.setAttribute("left",e+"px").setAttribute("top",t+"px").setAttribute("width",i+"px").setAttribute("height",n+"px")},s.setStyle=function(e){if(this.style){var t={};this.injectSizeValues(t),this.setPosAndSize(t.newPos.x-.5*t.width,t.newPos.y-.5*t.height,t.width,t.height)}var i=this.editor.sizeFromMarkupsToClient(0,e["font-size"]).y,n=this.styleTextArea.setAttribute("color",e["stroke-color"]).setAttribute("font-family",e["font-family"]).setAttribute("font-size",i+"px").setAttribute("font-weight",e["font-weight"]).setAttribute("font-style",e["font-style"]).getStyleString();this.textArea.setAttribute("style",n),this.style=o.cloneStyle(e)},s.getTextValuesForMarkup=function(e){var t=this.isActive(),i=this.textMarkup,n=this.firstEdit;this.setActive(e,!1);var o=this.getTextValues();return t?this.setActive(i,n):this.setInactive(),o},s.getTextValues=function(){var e=this.textArea.value;return e===r&&(e=""),{text:e,lines:this.generateLines()}},s.acceptAndExit=function(){var e=this.getTextValues(),t={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:e.text,newLines:e.lines};this.injectSizeValues(t),this.fireEvent({type:this.EVENT_TEXT_CHANGE,data:t}),this.setInactive()},s.injectSizeValues=function(e){var t=parseFloat(this.textArea.style.width),i=parseFloat(this.textArea.style.height),n=parseFloat(this.textArea.style.left),o=parseFloat(this.textArea.style.top);e.width=t,e.height=i,e.newPos={x:n+.5*t,y:o+.5*i}},s.onWindowResize=function(e){window.requestAnimationFrame(function(){var e=this.textArea.value;this.style=null,this.initFromMarkup(),this.textArea.value=e}.bind(this))},s.onKeyHandler=function(e){var t=e.keyCode,i=e.shiftKey;i||13!==t||(e.preventDefault(),this.acceptAndExit())},s.generateLines=function(){var e=this.textArea.value,i=e.split(/\r*\n/),n=this.styleTextArea.clone().removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",n),this.parentDiv.appendChild(this.measureDiv);for(var o=parseFloat(this.textArea.style.width),r=[],s=0,a=i.length;s<a;++s){var l=t(i[s]);this.splitLine(l,o,r)}return this.parentDiv.removeChild(this.measureDiv),r},s.splitLine=function(e,t,n){if(""!==e)for(var o="",r=!1;!r;){this.measureDiv.innerHTML=e;var s=this.measureDiv.clientWidth;if(s<=t)n.push(e),this.splitLine(i(o),t,n),r=!0;else{var a=this.getShorterLine(e);1===a.length?(this.splitWord(e,o,t,n),r=!0):(e=a[0],o=a[1]+o)}}},s.getShorterLine=function(e){var t=e.lastIndexOf(" ");if(t===-1)return[e];for(;" "===e.charAt(t-1);)t--;var i=e.substr(t),n=e.substr(0,t);return[n,i]},s.splitWord=function(e,t,i,n){for(var o=1,r=!0;r;){var s=e.substr(0,o);this.measureDiv.innerHTML=s;var a=this.measureDiv.clientWidth;if(a>i){if(1===o)return n.push(s),void this.splitWord(e.substr(1),t,i,n);var l=e.substr(0,o-1);n.push(l);var c=e.substr(o-1);return void this.splitLine(c+t,i,n)}if(o++,o>e.length)return void n.push(e)}},n.EditorTextInput=e}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.domEvents=[]}var t="Autodesk.Viewing.MarkupsCore",i=AutodeskNamespace("Autodesk.Markups.Gui"),n=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),o=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e;var r=e.prototype,s=Autodesk.Viewing,a=s.Private;r.load=function(){var e=this.viewer.getExtension(t);return e||(this.viewer.loadExtension(t),e=this.viewer.getExtension(t)),e?(this.core=e,this.viewer.toolbar?this.createToolbarUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),this.onEditModeEnterBinded=this.onEditModeEnter.bind(this),this.onEditModeLeaveBinded=this.onEditModeLeave.bind(this),this.onEditModeChangeBinded=this.onEditModeChange.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.core.addEventListener(n.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.addEventListener(n.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.addEventListener(n.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.addEventListener(n.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),!0):(a.logger.warn("Missing dependency:",t),!1)},r.unload=function(){return this.unhookAllEvents(),this.core.removeEventListener(n.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.removeEventListener(n.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.removeEventListener(n.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.removeEventListener(n.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),this.onEditModeEnterBinded=null,this.onEditModeLeaveBinded=null,this.onEditModeChangeBinded=null,this.onMarkupSelectedBinded=null,this.destroyToolbarUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),this.core=null,!0},r.onToolbarCreated=function(){this.viewer.removeEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createToolbarUI()},r.createToolbarUI=function(){var e=this,t=this.viewer,i=t.getToolbar(!0);this.markupToolButton=new Autodesk.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){e.core.enterEditMode()};var n=i.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);n&&n.addControl(this.markupToolButton,{index:0})},r.destroyToolbarUI=function(){if(this.markupToolButton){var e=this.viewer.getToolbar(!1);if(e){var t=e.getControl(s.TOOLBAR.MODELTOOLSID);t&&t.removeControl(this.markupToolButton)}this.markupToolButton=null}},r.onEditModeEnter=function(){a.logger.log("ENTER edit mode"),this.showToolsUi()},r.onEditModeLeave=function(){a.logger.log("LEAVE edit mode"),this.hideToolsUi()},r.onEditModeChange=function(e){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var t=this.core.editMode,i=this.domToolSelect.options,n=0,o=i.length;n<o;n++){var r=i[n];if(r.value===t.type){this.domToolSelect.selectedIndex=n;break}}},r.onMarkupSelected=function(e){var t=e.markup,i=this.core.editMode;this.setStylesUi(i,t)},r.showToolsUi=function(){this.createToolsUi();var e=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",e,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},r.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},r.createToolsUi=function(){function e(e,t){return['<option value="',t,'">',e,"</option>"].join("")}if(!this.domRoot){var t=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',e("Arrow",n.MARKUP_TYPE_ARROW),e("Rectangle",n.MARKUP_TYPE_RECTANGLE),e("Circle",n.MARKUP_TYPE_CIRCLE),e("Text",n.MARKUP_TYPE_TEXT),e("Cloud",n.MARKUP_TYPE_CLOUD),e("PolyLine",n.MARKUP_TYPE_POLYLINE),e("Polycloud",n.MARKUP_TYPE_POLYCLOUD),e("Freehand",n.MARKUP_TYPE_FREEHAND),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join("");this.domRoot=document.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=t,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}},r.getEditModeClass=function(e){var t;switch(e){case n.MARKUP_TYPE_ARROW:t="EditModeArrow";break;case n.MARKUP_TYPE_RECTANGLE:t="EditModeRectangle";break;case n.MARKUP_TYPE_CIRCLE:t="EditModeCircle";break;case n.MARKUP_TYPE_TEXT:t="EditModeText";break;case n.MARKUP_TYPE_CLOUD:t="EditModeCloud";break;case n.MARKUP_TYPE_POLYLINE:t="EditModePolyline";break;case n.MARKUP_TYPE_POLYCLOUD:t="EditModePolycloud";break;case n.MARKUP_TYPE_FREEHAND:t="EditModeFreehand"}if(!t)return null;var i=n[t],o=new i(this.core);return o},r.onToggleCollapse=function(){var e=this.domContent.style.display;"none"===e?this.domContent.style.display="block":this.domContent.style.display="none"},r.onEditModeDone=function(){this.core.hide()},r.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},r.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},r.onUndoClick=function(){this.core.undo()},r.onRedoClick=function(){this.core.redo()},r.onDeleteClick=function(){var e=this.core.getSelection();e&&this.core.deleteMarkup(e)},r.onCutClick=function(){this.core.cut()},r.onCopyClick=function(){this.core.copy()},r.onPasteClick=function(){this.core.paste()},r.onDuplicateClick=function(){var e=this.core.getSelection();e&&(this.core.copy(),this.core.paste())},r.onSelectEditMode=function(e){var t=e.target.value,i=this.getEditModeClass(t);return i?(this.ignoreChangeEvent=!0,this.core.changeEditMode(i),this.ignoreChangeEvent=!1,this.setStylesUi(i),void this.domToolSelect.blur()):void a.error("Markup editMode not found for type: "+t)},r.onStyleChange=function(e){function t(e,t){return"number"===t?Number(e):"boolean"===t?"true"===e:e}var i=e.target,n=i.options[i.selectedIndex],o=i.getAttribute("style-key"),r=i.getAttribute("value-type");i.blur();var s=this.core.getSelection(),a=s?s.getStyle():this.core.getStyle();a[o]=t(n.value,r),this.core.setStyle(a)},r.setStylesUi=function(e,t){a.logger.log("set ui for "+e.type);var i=t?t.style:e.style,n=o.getStyleDefaultValues(i,this.core);this.domStylesRoot.innerHTML="";for(var r in n){var s=this.getUiForStyleKey(r,n[r],i[r]);this.domStylesRoot.appendChild(s)}},r.getUiForStyleKey=function(e,t,i){for(var n=t.default,o=[],r=t.values,s=0,a=r.length;s<a;++s){var l=['<option value="',r[s].value,'">',r[s].name,"</option>"].join("");o.push(l),this.valueEquals(r[s].value,i)&&(n=s)}var c=typeof r[0].value,u=document.createElement("div"),h=["<span>",e,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',e,'" value-type="',c,'">',o.join(""),"</select>"].join("");u.innerHTML=h;var d=u.querySelector("select");return d.selectedIndex=n,u},r.valueEquals=function(e,t){return e===t},r.setControlVisibility=function(e,t,i){var n=this.domRoot.querySelector(e);i||(i="block"),n.style.display=t?i:"none"},r.hookEvent=function(e,t,i){var n=function(e){this.matchesSelector(e.target,t)&&i(e)}.bind(this);this.domRoot.addEventListener(e,n),this.domEvents.push({str:e,handler:n})},r.unhookAllEvents=function(){var e=this.domRoot;this.domEvents.forEach(function(t){e.removeEventListener(t.str,t.handler)}),this.domEvents=[]},r.matchesSelector=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)},r.getStyleOptions=function(e){var t=e.getStyle();return i.getStyleDefaultValues(t,this.core)},i.MarkupsGui=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsGui",e)}(),function(){"use strict";var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"),i=function(t,i){e.Extension.call(this,t,i)};i.prototype=Object.create(e.Extension.prototype),i.prototype.constructor=i,i.prototype.load=function(){var i=this;this.tool=new t.BillboardTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.onExplodeBinded=this.onExplode.bind(this),this.onSectionBinded=this.onSection.bind(this),this.viewer.addEventListener(e.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.addEventListener(e.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.addEventListener(e.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.addEventListener(e.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.HOTKEYS_ID="Autodesk.Billboard.Hotkeys";var n=[{keycodes:[e.theHotkeyManager.KEYCODES.ENTER],onRelease:function(){if(i.tool)return i.tool.enterEditAnnotation()}}];return e.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,n),!0},i.prototype.unload=function(){return e.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.viewer.removeEventListener(e.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.removeEventListener(e.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.removeEventListener(e.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.removeEventListener(e.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.clearAnnotations(),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},i.prototype.isActive=function(){return this.tool.isActive()},i.prototype.enterEditMode=function(){return this.tool.isActive()||this.viewer.toolController.activateTool("billboard"),!0},i.prototype.leaveEditMode=function(){return this.tool.isActive()&&this.viewer.toolController.deactivateTool("billboard"),!0},i.prototype.generateData=function(){return this.tool.generateData()},i.prototype.loadData=function(e){this.tool.loadData(e)},i.prototype.showAnnotations=function(){this.tool&&this.tool.showAnnotations()},i.prototype.hideAnnotations=function(){this.tool&&this.tool.hideAnnotations()},i.prototype.clearAnnotations=function(){this.tool&&this.tool.clearAnnotations()},i.prototype.showNumberMarkers=function(){this.tool&&this.tool.showNumMarkers()},i.prototype.hideNumberMarkers=function(){this.tool&&this.tool.hideNumMarkers()},i.prototype.onExplode=function(e){1*e.scale===0?this.showNumberMarkers():(this.hideAnnotations(),this.hideNumberMarkers())},i.prototype.onSection=function(e){Array.isArray(e.planes)&&e.planes.length>0?(this.hideAnnotations(),this.hideNumberMarkers()):this.showNumberMarkers()},t.BillboardExtension=i,e.theExtensionManager.registerExtension("Autodesk.Billboard",i)}(),function(){"use strict";var e=Autodesk.Viewing,t=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"));e.ANNOTATION_CREATED_EVENT="annotationCreated",e.ANNOTATION_DELETED_EVENT="annotationDeleted";var i=function(t){e.ToolInterface.call(this),this.names=["billboard"];var i=this,n=!1,o=!1,r=!1,s=1,a="url(data:;base64,AAABAAEAGBgAAAEAIACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAAAkAABMLAAATCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJAAAAtAAAAEkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMSEhL/sbGx/wAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwgICP99fX3//////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAdCAgI/3p6ev///////////wAAAP8AAADWAAAAqAAAAHwAAABJAAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQEBAT/AAAABAAAABMSEhL/hISE/////////////////+Li4v/W1tb/qKio/319ff9KSkr/EhIS/wAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP9kZGT/AAAAdAAAABMSEhL/sbGx//////////////////r6+v//////////////////////x8fH/3R0dP8dHR3/AAAARAAAAAAAAAAAAAAAAAAAADUzMzP/ra2t///////i4uL/VlZW/wQEBP8AAAD/MzMz/7m5uf///////////4qKiv9kZGT/hISE/7W1tf/t7e3///////////+tra3/MzMz/wAAADUAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/MzMz/wAAADEAAAAAAAAAUCkpKf+5ubn//////wAAAP8AAABmAAAAgwAAALQ4ODj/ioqK/+Li4v//////nZ2d/wAAAJwAAAAAAAAAAAAAAOzv7+///////2RkZP8AAACMAAAANQAAAAAAAAAJAAAAAAAAAFApKSn/ubm5/wAAALQAAAAAAAAAAAAAAAAAAAA1AAAAjGRkZP//////7+/v/wAAAOwAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/ODg4/wAAAP8ICAj/AAAAVwAAADUAAABQCwsL/////wD////U////1P///9T////U////AAcHB///////nZ2d/wAAAJwAAAAAAAAAAAAAADUzMzP/ra2t////////////7e3t/7W1tf+EhIT/VlZW/zMzM/8XFxf/FxcX/wAAAAAAAAD/AAAA/wAAAP8AAAD/AAAAADU1Nf+Ojo7/MzMz/wAAADUAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP/Hx8f/////////////////////////////////ZWVl/wAAAAT////UAAAA/wAAAP/////UAAAAAHFxcf8dHR3/AAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQSEhL/SkpK/319ff+oqKj/zMzM/+jo6P/6+vr/QEBA/wAAAAb////UAAAA/wAAAP/////UAAAAAAAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAASQAAAHwAAACoAAAAzAAAAOwAAAD5AAAA+wAAAAL////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAD////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAACMAAAA9gAAAIwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////UAAAA/wAAAP/////U////1P///9T////UAAAAAAAAAAAAAAD29vb2/0hISP8AAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/3R0dOr////UAAAA/wAAAP/////UdHR06gAAAP/////UAAAAAAAAAAAAAAD///////r6+v9OTk7/AAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP/////UAAAAAAAAAAAAAAD////////////6+vr/Tk5O/wAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////U////1P///9T////U////1P///9T////UAAAAAAAAAAAAAAD/////////////////+vr6/wAAAPkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAA/wAAAP8AAAD/AAAA+QAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD/8f8A/+H/AP/B/wD9gA8A8AADAOAAAQDAAAAAwEAAAMChwADAAhAAwAIQAOAAEQDwABMA/AAfAP/+HwAf8AMAD/ADAAfwAwAD8AMAA///AAP//wA=), auto",l="billboard-line",c="billboard-point",u=null,h=null,d=0,p=34181,v=null,g=16777215,m=null,f=0,E=null,A=16777215;this.annotations=[],this.numMarkers=[],this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0},this.isActive=function(){return n},this.getCursor=function(){return a},this.activate=function(){n=!0,t.clearSelection(),this.showAnnotations()},this.deactivate=function(){n=!1,this.billboard&&(this.billboard.annotationEditing?(this.billboard.dragging=!1,this.billboard.textArea.value?this.billboard.acceptButton.click():this.billboard.cancelButton.click()):this.destroyBillboard()),this.hideAnnotations()},this.onCameraChange=function(){i.updateBillboard(),i.updateAnnotations(),i.highlightAnnotation()},this.project=function(e){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),o=(new THREE.Vector3).copy(e);return o.project(i),new THREE.Vector3(Math.round((o.x+1)/2*n.width),Math.round((-o.y+1)/2*n.height),o.z)},this.unproject=function(e){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),o=new THREE.Vector3;return o.x=e.x/n.width*2-1,o.y=-(e.y/n.height*2-1),o.z=e.z,o.unproject(i),o},this.createBillboard=function(n,o){if(!r){r=!0,this.billboard=document.createElement("div"),this.billboard.className="billboard-container",t.container.appendChild(this.billboard);var s=new THREE.Vector3(0,0,0),a=s.x-n.x,l=s.y-n.y;this.billboard.deltaX=o?o.deltaX:a,this.billboard.deltaY=o?o.deltaY:l,this.setBillboardPosition(n,o),this.moveHandler(this.billboard),this.billboard.intersectPoint=n,this.billboard.show=!0,o&&(this.billboard.annotationEditing=!0);var c=this.billboard.textArea=document.createElement("TEXTAREA");c.className="billboard-textarea",this.billboard.appendChild(c),c.setAttribute("rows","4"),c.setAttribute("maxlength","140"),c.focus(),o&&(c.value=o.childNodes[0].innerHTML);var u=document.createElement("div");u.className="billboard-control",this.billboard.appendChild(u);var h=this.billboard.acceptButton=document.createElement("div");h.className="billboard-button-accept",h.setAttribute("data-i18n","Accept"),h.textContent=e.i18n.translate("Accept"),h.addEventListener("click",function(){if(!i.billboard.dragging&&i.billboard.childNodes[0].value){var e=i.billboard.childNodes[0].value,t=i.billboard.deltaX,r=i.billboard.deltaY;o?i.createAnnotation(n,e,t,r,o.id):i.createAnnotation(n,e,t,r),i.destroyBillboard()}},!1),u.appendChild(h),o||h.classList.add("billboard-button-accept-greyout"),c.addEventListener("input",function(){c.value?h.classList.remove("billboard-button-accept-greyout"):h.classList.add("billboard-button-accept-greyout")});var d=this.billboard.cancelButton=document.createElement("div");d.className="billboard-button-cancel";var p;p=o?"Delete":"Cancel",d.setAttribute("data-i18n",p),d.textContent=e.i18n.translate(p),d.addEventListener("click",function(){i.billboard.dragging||(i.destroyBillboard(),o&&(i.destroyNumMarker(o.id),t.fireEvent({type:e.ANNOTATION_DELETED_EVENT,data:o.commObj})))},!1),u.appendChild(d),this.drawLeadLine(n,this.billboard),this.drawLeadPoint(n,this.billboard),t.utilities.setPivotPoint(n,!0,!0)}},this.destroyBillboard=function(){r=!1,t.impl.removeMultipleOverlays(l,this.billboard.line),t.impl.removeMultipleOverlays(c,this.billboard.point),t.container.removeChild(this.billboard),this.billboard=null},this.setBillboardPosition=function(e,t){var i;t?i=(new THREE.Vector3).copy(t.position):(i=(new THREE.Vector3).copy(e),i.x+=this.billboard.deltaX,i.y+=this.billboard.deltaY),this.billboard.position=i;var n=this.project(i);this.borderCheck(this.billboard,n),this.billboard.style.left=n.x+"px",this.billboard.style.top=n.y+"px"},this.updateBillboardPosition=function(){var e=this.project(this.billboard.position);this.borderCheck(this.billboard,e),this.billboard.style.left=e.x+"px",this.billboard.style.top=e.y+"px"},this.borderCheck=function(e,i){var n=t.navigation.getScreenViewport(),o=e.clientWidth,r=e.clientHeight;i.x<5&&(i.x=0),i.y<5&&(i.y=0),n.width-5<i.x+o&&(i.x=n.width-o),n.height-5<i.y+r&&(i.y=n.height-r)},this.createAnnotation=function(n,o,r,a,l){function c(){function e(){u.dragging?i.highlightAnnotation():u.classList.contains("billboard-annotation-highlight")?i.editAnnotation(n,u):i.highlightAnnotation(u)}var t,o=0;return function(){o++,1==o?t=setTimeout(function(){e(),o=0},250):(clearTimeout(t),o=0)}}var u=document.createElement("div");u.className="billboard-annotation",t.container.appendChild(u);var h=new THREE.Vector3(0,0,0);r=r||h.x-n.x,a=a||h.y-n.y,u.deltaX=r,u.deltaY=a,this.setAnnotationPosition(u,n),this.moveHandler(u),u.intersectPoint=n,u.show=!0,l?(u.id=l,this.annotations[l-1]=u):(u.id=s++,this.annotations.push(u),this.createNumMarker(u));var d=document.createElement("div");d.innerHTML=o,u.appendChild(d),this.drawLeadLine(n,u);var p={message:o,point3d:n},v=t.getExtension("Autodesk.Comments"),g=u.cPromise=v.createComment(p);g.then(function(o){function r(){u.classList.contains("billboard-annotation-highlight")?i.editAnnotation(n,u):v.restoreComment(o,i.filter,!1)}u.commObj=o,u.addEventListener("click",c(),!1),u.addEventListener("dblclick",r,!1),e.isTouchDevice()&&Hammer(u).on("doubletap",r),t.fireEvent({type:e.ANNOTATION_CREATED_EVENT,data:o})},function(e){console.log("Create comments failed:"+e)})},this.destroyAnnotation=function(e){t.impl.removeMultipleOverlays(l,e.line),t.container.removeChild(e),this.annotations[e.id-1]=void 0},this.editAnnotation=function(e,t){r||(this.destroyAnnotation(t),this.createBillboard(e,t))},this.highlightAnnotation=function(e){for(var t=document.getElementsByClassName("billboard-annotation-highlight"),i=0;i<t.length;i++)t[i].classList.remove("billboard-annotation-highlight");e&&e.classList.add("billboard-annotation-highlight")},this.enterEditAnnotation=function(){for(var e=0;e<this.annotations.length;e++){var t=this.annotations[e];if(t&&t.classList.contains("billboard-annotation-highlight")){this.editAnnotation(t.intersectPoint,t);break}}},this.setAnnotationPosition=function(e,t){var i;r?i=(new THREE.Vector3).copy(this.billboard.position):(i=(new THREE.Vector3).copy(t),i.x+=e.deltaX,i.y+=e.deltaY),e.position=i;var n=this.project(i);e.style.left=n.x+"px",e.style.top=n.y+"px"},this.updateAnnotationPosition=function(e){var t=this.project(e.position);e.style.left=t.x+"px",e.style.top=t.y+"px"},this.drawLeadLine=function(e,t){t.line=[];var i=parseInt(t.style.left,10),n=parseInt(t.style.top,10)+t.childNodes[0].clientHeight,o=this.unproject(new THREE.Vector3(i,n,0));t.line.push(this.drawLine(e,o,2)),t.id?t.line.push(this.drawLine(e,o,1)):t.line.push(this.drawLine(e,o))},this.drawLine=function(e,i,n){u||(u=new THREE.LineBasicMaterial({color:d,linewidth:2,depthTest:!1,depthWrite:!1}),h=new THREE.LineBasicMaterial({color:p,linewidth:2,depthTest:!1,depthWrite:!1}),v=new THREE.LineBasicMaterial({color:g,linewidth:4,depthTest:!1,depthWrite:!1}),t.impl.createOverlayScene(l));var o=new THREE.Geometry;o.vertices.push(e),o.vertices.push(i);var r;r=1==n?h:2==n?v:u;var s=new THREE.Line(o,r);return t.impl.addOverlay(l,s),s},this.drawLeadPoint=function(e,t){t.point=[],t.point.push(this.drawPoint(e,0)),t.point.push(this.drawPoint(e,1))},this.drawPoint=function(e,i){m||(m=new THREE.MeshBasicMaterial({color:f,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),E=new THREE.MeshBasicMaterial({color:A,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),t.impl.createOverlayScene(c));var n=new THREE.Mesh(new THREE.SphereGeometry(1),i?m:E);return n.position.set(e.x,e.y,e.z),this.setPointScale(n,i?4:5),t.impl.addOverlay(c,n),n},this.setPointScale=function(e,t){var i=this.setScale(e,t);e.scale.x=i,e.scale.y=i,e.scale.z=i},this.setScale=function(e,i){var n=t.navigation,o=n.getCamera(),r=n.getEyeVector(),s=n.getPosition(),a=e.position.clone(),l=o.isPerspective?a.sub(s).dot(r.normalize()):n.getEyeVector().length(),c=n.getVerticalFov(),u=2*l*Math.tan(THREE.Math.degToRad(.5*c)),h=n.getScreenViewport(),d=window.devicePixelRatio||1,p=i*u/(h.height*d);return p},this.createNumMarker=function(e){var n=document.createElement("div");n.className="billboard-marker",this.numMarkers.push(n),n.innerHTML=e.id,t.container.appendChild(n),n.position=e.intersectPoint,this.setNumMarkerPosition(n),n.id=e.id,n.addEventListener("click",function(){var e=i.annotations[this.id-1];e.show?i.hideAnnotation(e):i.showAnnotation(e)})},this.destroyNumMarker=function(e){t.container.removeChild(this.numMarkers[e-1]),this.numMarkers[e-1]=void 0},this.setNumMarkerPosition=function(e){var t=this.project(e.position);e.style.left=t.x-e.offsetWidth/2+"px",e.style.top=t.y-e.offsetHeight/2+"px"},this.updateBillboard=function(){this.billboard&&(this.updateBillboardPosition(),this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.updateAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&(this.updateAnnotationPosition(this.annotations[e]),this.updateLine(this.annotations[e]));for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&this.setNumMarkerPosition(this.numMarkers[e])},this.updateLine=function(e){var i=e.line;if(t.impl.removeMultipleOverlays(l,i),e.show===!0){var n=e.intersectPoint;this.drawLeadLine(n,e)}},this.updatePoint=function(e){var i=e.point;t.impl.removeMultipleOverlays(c,i),e.show===!0&&this.drawLeadPoint(e.intersectPoint,e)},this.showBillboard=function(){this.billboard&&(this.billboard.show=!0,this.billboard.style.display="block",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.hideBillboard=function(){this.billboard&&(this.billboard.show=!1,this.billboard.style.display="none",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.showAnnotation=function(e){e.show=!0,e.style.display="block",this.updateLine(e)},this.showAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&this.showAnnotation(this.annotations[e])},this.hideAnnotation=function(e){e.show=!1,e.style.display="none",this.updateLine(e)},this.hideAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&this.hideAnnotation(this.annotations[e])},this.clearAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&(this.destroyNumMarker(this.annotations[e].id),this.destroyAnnotation(this.annotations[e]));s=1},this.generateData=function(){for(var e=[],i=t.getExtension("Autodesk.Comments"),n=0;n<this.annotations.length;n++)if(this.annotations[n]){var o=this.annotations[n].commObj,r=[this.annotations[n].deltaX,this.annotations[n].deltaY];i.factory.pushTag(o,{name:"textOffset",value:r}),e.push(o)}return e},this.loadData=function(e){for(var i=t.getExtension("Autodesk.Comments"),n=0;n<e.length;n++){
i.factory.removeGlobalOffset(e[n]);var o=i.factory.getTagValue(e[n],"nodeOffset"),r=new THREE.Vector3(o[0],o[1],o[2]),s=i.factory.getTagValue(e[n],"textOffset");s?this.createAnnotation(r,e[n].body,s[0],s[1]):this.createAnnotation(r,e[n].body)}},this.showNumMarkers=function(){for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&(this.numMarkers[e].style.visibility="visible")},this.hideNumMarkers=function(){for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&(this.numMarkers[e].style.visibility="hidden")},this.moveHandler=function(e){function i(i){"touchmove"===i.type&&(i.screenX=i.touches[0].screenX,i.screenY=i.touches[0].screenY),h+=i.screenX-a,d+=i.screenY-l,r=c+h,s=u+d;var n=t.navigation.getScreenViewport(),o=e.clientWidth,v=e.clientHeight;r<5&&(r=0),s<5&&(s=0),n.width-5<r+o&&(r=n.width-o),n.height-5<s+v&&(s=n.height-v),e.style.left=r+"px",e.style.top=s+"px",p.updateLine(e),a=i.screenX,l=i.screenY,e.dragging=!0}function n(t){var o=p.project(e.intersectPoint),a=p.unproject(new THREE.Vector3(r,s,o.z));e.deltaX=a.x-e.intersectPoint.x,e.deltaY=a.y-e.intersectPoint.y,e.position.copy(a),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",n)}function o(t){"textarea"!==t.target.tagName.toLowerCase()&&("touchstart"===t.type&&(t.screenX=t.touches[0].screenX,t.screenY=t.touches[0].screenY),a=t.screenX,l=t.screenY,h=0,d=0,r=c=e.offsetLeft,s=u=e.offsetTop,e.dragging=!1,window.addEventListener("mousemove",i),window.addEventListener("mouseup",n),window.addEventListener("touchmove",i),window.addEventListener("touchend",n))}var r,s,a,l,c,u,h,d,p=this;e.addEventListener("mousedown",o),e.addEventListener("touchstart",o)},this.handleButtonDown=function(e,t){return o=!0,!1},this.handleButtonUp=function(e,t){return o=!1,!1},this.handleMouseMove=function(e){return!1},this.handleSingleClick=function(e,i){var n=t.impl.hitTest(e.canvasX,e.canvasY,!1);return n&&this.createBillboard(n.intersectPoint),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return this.handleSingleClick(e)},this.handleDoubleTap=function(e){return!0},this.handleResize=function(){i.updateBillboard(),i.updateAnnotations(),i.highlightAnnotation()}};t.BillboardTool=i}(),function(){"use strict";var e="Autodesk.Billboard",t=Autodesk.Viewing,i=t.UI,n=AutodeskNamespace("Autodesk.Viewing.Extensions.BillboardGui"),o=function(e,i){t.Extension.call(this,e,i)};o.prototype=Object.create(t.Extension.prototype),o.prototype.constructor=o,o.prototype.load=function(){var t=this.viewer.getExtension(e);return t||(this.viewer.loadExtension(e),t=this.viewer.getExtension(e)),t?(this.core=t,this.viewer.toolbar?this.createToolbarUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0):(avp.logger.warn("Missing dependency:",e),!1)},o.prototype.unload=function(){return this.destroyToolbarUI(),this.core=null,!0},o.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createToolbarUI()},o.prototype.createToolbarUI=function(){var e=this,n=this.viewer,o=n.getToolbar(!0);this.billboardToolButton=new i.Button("toolbar-billboardTool"),this.billboardToolButton.setToolTip("Billboard"),this.billboardToolButton.setIcon("adsk-icon-billboard"),this.billboardToolButton.onClick=function(t){var n=e.billboardToolButton.getState();n===i.Button.State.INACTIVE?(e.core.enterEditMode(),e.billboardToolButton.setState(i.Button.State.ACTIVE)):n===i.Button.State.ACTIVE&&(e.core.leaveEditMode(),e.billboardToolButton.setState(i.Button.State.INACTIVE))};var r=o.getControl(t.TOOLBAR.MODELTOOLSID);r&&r.addControl(this.billboardToolButton,{index:0})},o.prototype.destroyToolbarUI=function(){if(this.billboardToolButton){var e=this.viewer.getToolbar(!1);if(e){var i=e.getControl(t.TOOLBAR.MODELTOOLSID);i&&i.removeControl(this.billboardToolButton)}this.billboardToolButton=null}},n.BillboardGui=o,t.theExtensionManager.registerExtension("Autodesk.BillboardGui",o)}();var AutodeskNamespace=AutodeskNamespace||function(e){"use strict";var t="undefined"!=typeof window&&null!==window?window:self,i=e.split(".");return i.forEach(function(e){t[e]=t[e]||{},t=t[e]}),t};!function(){"use strict";function e(e){return e&&0!==e.length?e.replace(/^#?\?/,"").split("&").map(function(e){return e.split("=").map(function(e){return decodeURIComponent(e)})}):null}function t(e){return"object"!=typeof e||null===e?e:(Object.getOwnPropertyNames&&Object.getOwnPropertyNames(e).forEach(function(i){var n=e[i];"object"!=typeof n||Object.isFrozen(n)||t(n)}),Object.freeze(e))}function i(e,t,i,n){function o(e,t){return function(){var t,n=null,o=null;if(4===r.readyState&&(t=r.status||e||-1,o=!r.response||"application/json"!==r.getResponseHeader("Content-Type")&&"json"!==r.responseType?r.response:JSON.parse(r.response),!s[t]))return s[t]=!0,200!==t&&(n=r.status||e||"unknown error"),n?void i(n,null):void i(null,o)}}if(i=i||function(){},!e||!t)return console.error("Invalid URL or Request Headers for the Query Service REST API"),void setTimeout(function(){i("Invalid URL or Request Headers for the Query Service REST API",null)},0);var r=new XMLHttpRequest;r.open("GET",e),Object.keys(t).forEach(function(e){"undefined"!=typeof t[e]&&null!==t[e]&&r.setRequestHeader(e,t[e])});var s=[];r.onreadystatechange=o(),r.onload=o(),r.onerror=o(null,"Error"),r.ontimeout=o(null,"TimeOut"),r.onabort=o(null,"Abort"),r.timeout=n||U,r.send()}function n(){var e,t,i=+new Date;M&&R&&(t=i-Y,Y=i,document.hidden?(q+=t,e={documentVisibleDuration:t,totalDocumentVisibleDuration:q,totalDocumentNotVisibleDuration:X},y(M,R,"documentNotVisible",e)):(X+=t,e={documentNotVisibleDuration:t,totalDocumentVisibleDuration:q,totalDocumentNotVisibleDuration:X},y(M,R,"documentVisible",e)))}function o(){var e,t={},i=+new Date;M&&R&&(e=i-Y,Y=i,document.hidden?X+=e:q+=e,t={totalDocumentVisibleDuration:q,totalDocumentNotVisibleDuration:X},y(M,R,"documentUnloaded",t))}function r(e,t){M=e,R=t}function s(e){var t={};return t[K.TOKEN_HEADER_NAME]=e.token,t[K.AUTHORIZATION_HEADER_NAME]=e.oauth2Token?"Bearer "+e.oauth2Token:void 0,t[K.ANON_SESSION_HEADER_NAME]=e.token||e.oauth2Token?"false":"true",t[K.CLIENT_ID_HEADER_NAME]=e.clientId,t[K.CLIENT_FEATURE_ID_HEADER_NAME]=e.clientFeatureId,t[K.SESSION_ID_HEADER_NAME]=e.sessionId,t[K.EXTRA_USER_ID_HEADER_NAME]=e.userId,t[K.DEBUG_HEADER_NAME]=V,t[K.CONTENT_TYPE_HEADER_NAME]="application/json",t[K.ACCEPT_HEADER_NAME]="application/json",t}function a(e){var t=null;return e[K.AUTHORIZATION_HEADER_NAME]&&"apidev"!==F&&"apistg"!==F&&"apiprod"!==F&&(t="'"+K.AUTHORIZATION_HEADER_NAME+"' header for OAUTH2 not valid for "+F+" endpoint. Use one of apidev/apistg/apiprod endpoints."),!e[K.TOKEN_HEADER_NAME]||"apidev"!==F&&"apistg"!==F&&"apiprod"!==F||(t="'"+K.AUTHORIZATION_HEADER_NAME+"' header for OAUTH1 not valid for "+F+" endpoint."),e[K.TOKEN_HEADER_NAME]&&e[K.AUTHORIZATION_HEADER_NAME]&&(t="'"+K.AUTHORIZATION_HEADER_NAME+"' and '"+K.AUTHORIZATION_HEADER_NAME+"' headers can not coexist."),e[K.EXTRA_USER_ID_HEADER_NAME]&&!e[K.AUTHORIZATION_HEADER_NAME]&&(t="'"+K.AUTHORIZATION_HEADER_NAME+"' OAUTH2 header must be used w/ '"+K.EXTRA_USER_ID_HEADER_NAME+"' header."),e[K.CLIENT_ID_HEADER_NAME]||(t="'"+K.CLIENT_ID_HEADER_NAME+"' header is required for all requests."),e[K.CLIENT_FEATURE_ID_HEADER_NAME]||(t="'"+K.CLIENT_FEATURE_ID_HEADER_NAME+"'header is required for all requests."),"application/json"!==e[K.CONTENT_TYPE_HEADER_NAME]&&(t="'"+K.CONTENT_TYPE_HEADER_NAME+"' header must be application/json for all requests."),e[K.TOKEN_HEADER_NAME]||e[K.AUTHORIZATION_HEADER_NAME]||e[K.SESSION_ID_HEADER_NAME]&&e[K.ANON_SESSION_HEADER_NAME]||(t="'"+K.TOKEN_HEADER_NAME+"' or '"+K.AUTHORIZATION_HEADER_NAME+"' header needs to be a valid value or both '"+K.SESSION_ID_HEADER_NAME+"' and '"+K.ANON_SESSION_HEADER_NAME+"' header need to be specified."),t}function l(e){var t=null;return e||(t="queryParams: needs to be specified."),e.pid||0===e.pid||(t="queryParams.pid: needs to be a valid Profile Id."),e.pid<0&&(t="queryParams.pid: Profile Id needs to be an integer greater than zero."),e.query||(t="queryParams.query empty."),e.page||(t="queryParams.page empty."),(e.page<0||e.page>100)&&(t="queryParams.page should be a positive integer between 1 and 100"),void 0!==e.language&&""!==e.language&&"string"!=typeof e.language&&console.warn("queryParams.language should be a language identifier"),t}function c(e,t){var i=e;return t.pid&&(i+="?pid="+t.pid),t.query&&(i+="&query="+encodeURIComponent(t.query)),t.language&&(i+="&language="+encodeURIComponent(t.language)),t.modifier&&(i+="&modifier="+encodeURIComponent(t.modifier)),t.filters&&(i+="&filters="+encodeURIComponent(t.filters)),t.sort&&"relevance"!==t.sort&&(i+="&sort="+encodeURIComponent(t.sort)),t.page&&1!==t.page&&(i+="&page="+encodeURIComponent(""+t.page)),F!==H&&(i+="&env="+encodeURIComponent(F)),i=i.replace(/^\?&/,"?")}function u(e,t,i){return e.indexOf(Q.escapeCharacter)===-1?e:e.split(t).join(i)}function h(e){return e=e||"",e=u(e,Q.escapeCharacter,Z.escapeCharacterEscSeq),e=u(e,Q.listItemDelimiter,Z.listItemDelimiterEscSeq),e=u(e,Q.nameValueDelimiter,Z.nameValueDelimiterEscSeq),e=u(e,Q.arrayListItemDelimiter,Z.arrayListItemDelimiterEscSeq),e=u(e,Q.arrayListValueDelimiter,Z.arrayListValueDelimiterEscSeq)}function d(e){var t=e.map(function(e){for(var t=e[0],i=1;i<e.length;i++)t+=Q.arrayListValueDelimiter+e[i];return t});return t.join(Q.arrayListItemDelimiter)}function p(e){var t=e.map(function(e){if(Q.reservedArrayListFilterNames.indexOf(e[0])!==-1&&Array.isArray(e[1])){var t=d(e[1]);return h(e[0])+Q.nameValueDelimiter+t}return h(e[0])+Q.nameValueDelimiter+h(e[1])});return t.join(Q.listItemDelimiter)}function v(e,t,i){if(!e||!t||!i)return[];for(var n=[],o="",r="",s=!1,a=0;a<e.length;a++)o=e[a],o===i?(s=!s,r+=o):o!==t||s?(r+=o,s=!1):(n.push(r),r="",s=!1);return r.length&&n.push(r),n}function g(e){var t=v(e,Q.arrayListItemDelimiter,Q.escapeCharacter);return t.map(function(e){return v(e,Q.arrayListValueDelimiter,Q.escapeCharacter)})}function m(e){var t=[];return e.map(function(e){return Q.reservedArrayListFilterNames.indexOf(e[0])!==-1?(t=g(e[1]),[e[0],t]):e})}function f(e){return e.map(function(e){return v(e,Q.nameValueDelimiter,Q.escapeCharacter)})}function E(e){return v(e,Q.listItemDelimiter,Q.escapeCharacter)}function A(e){if(!e||!e.length)return[];var t=E(e),i=f(t);return m(i)}function y(e,t,n,o,r){var s=!1;if(r&&"function"!=typeof r)throw new Error("Callback was not a function");r=r||function(){};var a=z+W.Log+"?queryId="+e+"&type="+encodeURIComponent(n)+"&sessionId="+(t.sessionId||"")+"&userId="+(t.userId||"")+"&clientId="+(t.clientId||"")+"&clientFeatureId="+(t.clientFeatureId||"")+"&body="+encodeURIComponent(JSON.stringify(o))+"&_n="+Math.floor(1e5*Math.random()),l=function(e,t){e&&console.debug("Logged(err:"+(e||"noerr")+" info:"+(t||"-")+"): "+a),r(e)},c={};c[K.CONTENT_TYPE_HEADER_NAME]="text/plain",s||i(a,c,l)}function T(e,t){var i,n;N||(window&&window.performance?(n=w(),n.searchSDKTimings={fetchStartToSearchSDKLoaded:j-n.timing.fetchStart,fetchStartToSearchSDKInstantiated:I-n.timing.fetchStart,fetchStartToNow:+new Date-n.timing.fetchStart},n.timingDelta={},n.timing&&(n.timingDelta.navigationStartToDomInteractive=n.timing.domInteractive-n.timing.navigationStart,n.timingDelta.dns=n.timing.domainLookupEnd-n.timing.domainLookupStart,n.timingDelta.htmlDownloadTime=n.timing.responseEnd-n.timing.responseStart,n.timingDelta.tcpConnectionSetup=n.timing.connectEnd-n.timing.connectStart,n.timing.secureConnectionStart&&(n.timingDelta.secureConnectionSetup=n.timing.connectEnd-n.timing.secureConnectionStart),Object.keys(n.timing).forEach(function(e){0!==n.timing[e]&&(n.timingDelta["fetchStartTo"+e[0].toUpperCase()+e.slice(1)]=n.timing[e]-n.timing.fetchStart)})),delete n.timing,i={url:document&&document.location&&document.location.href,userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,performance:n}):i={noPerformance:!0},y(e,t,"performance",i)),N=!0}function w(){if(!window||!window.performance)return{};var e=function(e){return window.performance[e]?Object.keys(Object.getPrototypeOf(window.performance[e])).reduce(function(t,i){return window.performance[e][i]>=0&&(t[i]=window.performance[e][i]),t},{}):null};return Object.keys(Object.getPrototypeOf(window.performance)).reduce(function(t,i){return 0!==i.indexOf("onwebkit")&&window.performance[i]&&"object"==typeof window.performance[i]&&(t[i]=e(i)),t},{})}function b(e,t,i){var n,o;i&&(o="SERP",n=[].concat(i.queryResults||[],i.federatedResults||[]),n.forEach(function(i,n){k(i,n+1,e,t,o,"")}))}function C(e,t,i){var n;i&&(n="suggestions",(i.suggestionGroups||[]).forEach(function(i){var o=i.name;i.suggestions.forEach(function(i,r){k(i,r+1,e,t,n,o)})}),(i.textSuggestions||[]).forEach(function(i,o){S(i,o,e,t,n,"")}))}function S(e,t,i,n,o,r){e.logClick=function(){var s={position:t,url:"",querySource:o,subQuerySource:r};e.suggestion&&(s.title=e.suggestion),y(i,n,"click",s)}}function k(e,t,i,n,o,r){e.logClick=function(){var s={position:t,url:"",querySource:o,subQuerySource:r};e.searchResultId&&(s.id=e.searchResultId.id,s.sourceSystem=e.searchResultId.sourceSystem),e.url&&(s.url=e.url),y(i,n,"click",s)}}function x(n){F=n&&B.hasOwnProperty(n)?n:H,z=B[F];var o=this;this.getApiVersion=function(){return D.version},this.getServerMinRestApiVersion=function(){return D.minRestApiVersion},this.getBuildDate=function(){return D.buildDate},this.getBuildNumber=function(){return D.buildNumber},this.getServiceEnvironments=function(){return Object.keys(B)},this.getFilterConfig=function(){return Q},this.filterStringToFilterArray=function(e){return A(e)},this.filterArrayToFilterString=function(e){return p(e)},this.getLanguageFromBcp47Code=function(e){return J[e]||"ENU"},this.sanitizeAndHighlightString=function(e,t,i){var n,o,r=!1;return e?(t=t||"<em class='highlight'>",i=i||"</em>",o=document.createElement("div"),o.textContent=e,n=o.innerHTML,n=n.replace(/[\uE000\uE001]/g,function(n,o,s){return""!==n||r?""===n&&r?(r=!1,i):void console.warn("Warning: Incorrect number of highlight tokens in string: "+e):(r=!0,t)}),r&&(n+=i,console.warn("Warning: Incorrect number of highlight tokens in string: "+e)),n):""},this.removeHighlightTokens=function(e){return e?e=e.replace(/[\uE000\uE001]/g,""):""},this.query=function(e,n,o){var u,h=l(e);if(h)return console.error("Invalid Query Parameters for the Query Service REST API - "+h),void setTimeout(function(){o("Invalid Query Parameters for the Query Service REST API - "+h,null)},0);u=c(z+W.Query,e);var d=s(n),p=a(d);return p?(console.error("Invalid Request Headers for the Query Service REST API - "+p),void setTimeout(function(){o("Invalid Request Headers for the Query Service REST API - "+p,null)},0)):void i(u,d,function(e,i){!e&&i&&(b(i.queryId,n,i),t(i),T(i.queryId,n),r(i.queryId,n)),o(e,i)})},this.findCategories=function(e,t,n){var o,r=l(e);if(r)return console.error("Invalid Query Parameters for the Query Service REST API - "+r),void setTimeout(function(){n("Invalid Query Parameters for the Query Service REST API - "+r,null)},0);o=c(z+W.Categories,e);var u=s(t),h=a(u);return h?(console.error("Invalid Request Headers for the Query Service REST API - "+h),void setTimeout(function(){n("Invalid Query Parameters for the Query Service REST API - "+h,null)},0)):void i(o,u,n)},this.suggestionTimeoutId=null,this.lastSentSuggestionNum=-1,this.lastDisplayedSuggestionNum=-1,this.suggest=function(e,t,n){var u=function(e,t,n){var u,h,d=l(e);if(d)return console.error("Invalid Request Parameters for the Query Service REST API - "+d),void setTimeout(function(){n("Invalid Request Parameters for the Query Service REST API - "+d,null)},0);h=o.lastSentSuggestionNum+1,o.lastSentSuggestionNum=h,u=c(z+W.Suggestions,e);var p=s(t),v=a(p);if(v)return console.error("Invalid Request Headers for the Query Service REST API - "+v),void setTimeout(function(){n("Invalid Request Headers for the Query Service REST API - "+v,null)},0);var g=function(e,i){if(h>o.lastDisplayedSuggestionNum)return o.lastDisplayedSuggestionNum=h,e||(C(i.queryId,t,i),T(i.queryId,t),r(i.queryId,t)),void n(e,i)};i(u,p,g)};clearTimeout(o.suggestionTimeoutId),o.suggestionTimeoutId=setTimeout(function(){u(e,t,n)},G)},this.logEvent=y,this.queryServiceInfo=function(e,t){var n=z+W.Health,o=s(e),r=a(o);if(r)return console.error("Invalid Request Headers for the Query Service REST API - "+r),void setTimeout(function(){t("Invalid Request Headers for the Query Service REST API - "+r,null)},0);var l=function(e,i){var n,o,r=0,s=!1;if(n=D.minRestApiVersion.split(".").map(function(e){return parseFloat(e)}),!e&&i.versionInfo&&i.versionInfo.version){for(o=i.versionInfo.version.split(".").map(function(e){return parseFloat(e)});r<o.length||r<n.length;)s=s||(n[r]||0)>(o[r]||0),r+=1;s&&console.error("Error: Remote API version ("+i.versionInfo.version+") is older than required ("+D.minRestApiVersion+")")}t(e,i)};i(n,o,l)},this.queryParamsToUrl=function(e,t,i,n){var o;if(!t||!i||!i.pushState)return console.error("queryParamsToUrl() requres a History object in the urlLocation parameter such as window.history."),!1;o=new URL(t),o.search=new URL(c(z+W.Query,e)).search;try{i.pushState(null,"",o)}catch(e){document.location.hash=o.search}return!0},this.urlParametersToQueryParams=function(t){var i={pid:void 0,query:null,modifier:null,filters:"",sort:"",page:1,language:"",oauth2Token:null,env:null},n={pid:1},o={access_token:"oauth2Token",expires_in:"oauth2TokenExpiresIn"},r=new URL(t),s=(r.search||"").slice(1)+"&"+(r.hash||"").slice(1),a=e(s);return a.forEach(function(e){void 0===typeof i[e[0]]||n[e[0]]||(i[o[e[0]]||e[0]]=e[1])}),i}}var M,R,P=new AutodeskNamespace("Autodesk.Search"),V=V||!1,I=+new Date,N=!1,D=Object.freeze({version:"1.0.0",buildDate:"[local-dev]",buildNumber:"[local-dev]",minRestApiVersion:"1.35.0"}),L="qs",O="search",_="v2",H="prod",B=Object.freeze({localdev:"http://search-localdev.api.autodesk.com:8080/"+L+"/"+_,dev:"https://search-dev.api.autodesk.com/"+L+"/"+_,"dev-dr":"https://search-dev-dr.api.autodesk.com/"+L+"/"+_,stg:"https://search-staging.api.autodesk.com/"+L+"/"+_,"stg-dr":"https://search-staging-dr.api.autodesk.com/"+L+"/"+_,prod:"https://search.api.autodesk.com/"+L+"/"+_,"prod-dr":"https://search-dr.api.autodesk.com/"+L+"/"+_,apidev:"https://developer-dev.api.autodesk.com/"+O+"/"+_,apistg:"https://developer-stg.api.autodesk.com/"+O+"/"+_,apiprod:"https://developer.api.autodesk.com/"+O+"/"+_}),F=H,z=B[F],U=null,G=250,W=Object.freeze({Query:"/search",Categories:"/categories",Suggestions:"/suggestions",Log:"/log",Health:"/health"}),j=+new Date,Y=+new Date,q=0,X=0;document.addEventListener&&document.addEventListener("visibilitychange",n,!1),window.addEventListener&&window.addEventListener("beforeunload",o,!1);var K={TOKEN_HEADER_NAME:"x-ads-token",ANON_SESSION_HEADER_NAME:"x-ads-anon-session",CLIENT_ID_HEADER_NAME:"x-ads-client-id",CLIENT_FEATURE_ID_HEADER_NAME:"x-ads-client-feature-id",SESSION_ID_HEADER_NAME:"x-ads-session-id",DEBUG_HEADER_NAME:"x-ads-debug",EXTRA_USER_ID_HEADER_NAME:"x-ads-ex-user-id",CONTENT_TYPE_HEADER_NAME:"Content-Type",ACCEPT_HEADER_NAME:"Accept",AUTHORIZATION_HEADER_NAME:"Authorization"},Q=t({listItemDelimiter:"!",nameValueDelimiter:"~",arrayListItemDelimiter:"'",arrayListValueDelimiter:"*",escapeCharacter:"\\",reservedArrayListFilterNames:["resourceIds"]}),Z=t({nameValueDelimiterEscSeq:Q.escapeCharacter+Q.nameValueDelimiter,listItemDelimiterEscSeq:Q.escapeCharacter+Q.listItemDelimiter,arrayListItemDelimiterEscSeq:Q.escapeCharacter+Q.arrayListItemDelimiter,arrayListValueDelimiterEscSeq:Q.escapeCharacter+Q.arrayListValueDelimiter,escapeCharacterEscSeq:Q.escapeCharacter+Q.escapeCharacter}),J=t({"pt-BR":"PTB",cs:"CSY",en:"ENU","en-us":"ENU",fr:"FRA",de:"DEU",hu:"HUN",it:"ITA",ja:"JPN",ko:"KOR",pl:"PLK",ru:"RUS","zh-CN":"CHS",es:"ESP","es-ES":"ESP","zh-TW":"CHT"});x.prototype.constructor=x,P.SearchQueryAPI=x}(),function(){"use strict";var e=Autodesk.Viewing.Private,t=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),i=e.ENABLE_INLINE_WORKER||!1,n=e.LMV_WORKER_URL,o=function(){var e=n.indexOf(".min.js")>0;this.propertyWorkerUrl=e?"searchworker.min.js":"searchworker.js",this.propertyWorkerFetchingScript=!1,this.propertyWorkerDataUrl=null,this.propertyWorkerFetchingCbs=[]},r=o.prototype;r.initPropertyWorkerScript=function(t,n){var o=this;if(i&&!this.propertyWorkerDataUrl){if(this.propertyWorkerFetchingCbs.push({successCB:t}),this.propertyWorkerFetchingScript)return;var r=new XMLHttpRequest,s=this.propertyWorkerUrl,a=e.getResourceUrl(this.propertyWorkerUrl);a&&(s=a),r.open("GET",s,!0),r.withCredentials=!1,r.onload=function(){o.propertyWorkerFetchingScript=!1;var e;window.URL=window.URL||window.webkitURL;try{e=new Blob([r.responseText],{type:"application/javascript"})}catch(t){e=new BlobBuilder,e.append(r.responseText),e=e.getBlob()}o.propertyWorkerDataUrl=URL.createObjectURL(e);var t=o.propertyWorkerFetchingCbs.concat();o.propertyWorkerFetchingCbs=[];for(var i=0;i<t.length;++i)t[i].successCB&&t[i].successCB()},o.propertyWorkerFetchingScript=!0,r.send()}else t&&t()},r.initInViewerSearchWorkersScripts=function(e,t){this.initPropertyWorkerScript(e,t)},r.createPropertyWorker=function(){var t;return t=i?new Worker(this.propertyWorkerDataUrl):new Worker(e.getResourceUrl(this.propertyWorkerUrl))},t.WorkerUtils=new o}(),function(){"use strict";function e(e,t,i){var n=e.viewer.model.myData.is2d;e.inViewerSearchThisView&&e.inViewerSearchThisView.initialize(e.qsApiService,e.viewerProperties,t,n,e.thisViewDom||E,i),e.inViewerSearchThisItem&&!e.inViewerSearchThisItem.initialized&&e.inViewerSearchThisItem.initialize(e.qsApiService,e.viewerProperties,t,e.thisItemDom||A,i,function(t){e.changeToThisViewTabAndSelectNode(t)}),e.inViewerSearchThisProject&&e.inViewerSearchThisProject.initialize(e.qsApiService,e.thisProjectDom||y)}function t(e){var t=e.cacheObj().searchInfoThisItem;t&&(l(e,t.str,t.node),e.inViewerSearchPanel&&(e.inViewerSearchPanel.setVisible(!0),s(e)),e.cacheObj.searchInfoThisItem=null)}function i(e){var t=null;return e.children.forEach(function(e){e.hasOwnProperty("sharedPropertyDbPath")&&(t=e.sharedPropertyDbPath)}),t}function n(e){return e.parent?n(e.parent):e}function o(e){var t=null;try{t=JSON.parse(e)}catch(e){console.error("JSON parse error: "+e)}return t}function r(e,t,i){var o=t.model.getDocumentNode(),r=o?t.model.getDocumentNode().parent:null;if(r){var s=n(r);return void setTimeout(function(){i(s)},0)}return e.noBubbleData=!0,e.inViewerSearchThisItem&&(delete e.inViewerSearchThisItem,e.inViewerSearchThisItem=null),m.logger.warn("InViewerSearch Extension: no ViewingApplication is being used so relatedItemsTab will not be visible"),void setTimeout(function(){i(null)},0)}function s(e){var t;e.options.uiEnabled&&e.searchToolButton&&e.inViewerSearchPanel&&(t=e.inViewerSearchPanel.isVisible(),e.searchToolButton.setState(t?g.Button.State.ACTIVE:g.Button.State.INACTIVE),e.searchToolButton.setToolTip(v.i18n.translate("Search")))}function a(n,o){var a=n.viewer,l={},c=m.env,u=m.docItemId,h=v.getViewingUrl(),d=n.cacheObj().searchInfoThisItem;n.showingTabs=!1;var p=function(e,i){var r;l[e]=i,r=Object.keys(l).every(function(e){return!!l[e]}),r?(n.initialized=!0,o(!0),t(n)):l[E]&&(d||s(n))},g=function(t){var o,r={},s="";if(t){var a=function(e){var t=e.children||[],i=this;t.forEach(function(e){if(!r[e.data.guid])switch(e.data.type){case"geometry":r[e.data.guid]=e;break;case"folder":a.call(i,e)}})};a(t),s=i(t)}if(n.flatGUIDS=r,m.logger.debug("InViewerSearchExtension - has sharedPropertyDBPath: "+s),n.qsApiService){var d={count:{}};o=0,Object.keys(r).forEach(function(e){r[e].data&&(o+=r[e].data.size?r[e].data.size:0,r[e].data.role&&(d.count[r[e].data.role]=d.count[r[e].data.role]+1||1))}),d.size=o;var v=av.getGlobal(),g=v.LMV_VIEWER_VERSION+"."+v.LMV_VIEWER_PATCH;n.qsApiService.initialize(g,c,n.options.clientId,n.options.sessionId),n.qsApiService.logInitEvent(n.viewer.model.myData.urn,d,"")}n.viewerProperties&&!n.viewerProperties.initialized&&n.viewerProperties.initialize(n.viewer,n.noBubbleData,h,n.flatGUIDS,u,n.qsApiService,s),l[E]=!1,n.inViewerSearchThisItem&&(l[A]=n.inViewerSearchThisItem.initialized),n.options.uiEnabled&&!n.initialized&&n.createTabs(),e(n,u,p)};r(n,a,g)}function l(e,t,i){var n=e.searchBarElem;t&&(n.value=t,e.uiSearch(i),e.updateRecentSearches(t))}function c(e,t){var i=document.createElement("li");return i.className="recent-item",i.appendChild(document.createTextNode(t)),i.addEventListener("click",function(){l(e,this.innerText)},!1),i}function u(e,t){var i,n,o,r;i=document.createElement("label"),i.className="recent-label",i.appendChild(document.createTextNode(v.i18n.translate("Recent Searches"))),n=document.createElement("ul"),n.className="recent-searches-list dockingPanelScroll",o=e.getRecentSearches(),o.forEach(function(t){n.appendChild(c(e,t))}),o.length<1&&(r=document.createElement("li"),r.className="recent-item empty-list",r.appendChild(document.createTextNode(v.i18n.translate("Recent Searches Empty"))),n.appendChild(r)),t.appendChild(i),t.appendChild(n)}function h(e,t,i,n){var o,r,s=[].slice.call(t.parentElement.children);s.forEach(function(e){e.classList.remove("selected")}),t.classList.add("selected"),e.qsApiService.logTabClickEvent(n),o=t.parentElement.parentElement.children[1],r=[].slice.call(o.children),r.forEach(function(e){e.id===i?e.classList.remove("hidden"):e.classList.add("hidden")})}function d(e,t,i,n,o){var r,s;return r=document.createElement("div"),r.className="tab-item "+i,r.addEventListener("click",function(){h(e,this,t,o)},!1),s=document.createElement("label"),s.appendChild(document.createTextNode(n)),r.appendChild(s),r}function p(e,t){var i,n,o,r,s,a;a=1,i=document.createElement("div"),n=document.createElement("div"),n.className="tab-content",i.appendChild(d(t,E,"this-view selected",t.options.loadedModelTab.displayName,"thisView")),o=document.createElement("div"),o.id=E,t.thisViewDom=o,n.appendChild(o),t.options.relatedItemsTab.enabled&&t.inViewerSearchThisItem&&(a++,i.appendChild(d(t,A,"this-item",t.options.relatedItemsTab.displayName,"thisItem")),r=document.createElement("div"),r.className="hidden",r.id=A,t.thisItemDom=r,n.appendChild(r)),t.options.serverSearchTab.enabled&&(a++,i.appendChild(d(t,y,"this-project",t.options.serverSearchTab.displayName,"thisProject")),s=document.createElement("div"),s.className="hidden",s.id=y,t.thisProjectDom=s,n.appendChild(s)),i.className="tab-items tabs-count-"+a,e.appendChild(i),e.appendChild(n),t.tabContent=n}var v=Autodesk.Viewing,g=Autodesk.Viewing.UI,m=Autodesk.Viewing.Private,f=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),E="in-viewer-search-this-view",A="in-viewer-search-this-item",y="in-viewer-search-this-project",T="recentSearches",w=3,b=200,C=null,S=null,k=Object.freeze({BACKSPACE:8,SPACE:32,ENTER:13});f.InViewerSearchMain=function(e,t,i){this.initialized=!1,this.cacheObj=i,this.viewer=e,this.toolbarTools=null,this.options=t,this.qsApiService=new f.QsApiService,this.viewerProperties=new f.ViewerPropertiesService(e),this.noBubbleData=!1,this.inViewerSearchPanel=null,this.inViewerSearchThisView=null,this.inViewerSearchThisItem=null,this.inViewerSearchThisProject=null,this.geometryLoadedCallback=null,this.tabsElem=null,this.searchBarElem=null,this.recentSearchesElem=null,this.saveLastQuery=null,this.recentSearches=null,this.flatGUIDS={},this.container=null,this.searchToolButton=null,this.tabContent=null,this.showingTabs=!1,this.initCb=null,this.closeCallback=null,this.workersScriptsInitialized=!1,this.initWorkersScripts=null,this.thisProjectDom=null,this.thisItemDom=null,this.thisViewDom=null},f.InViewerSearchMain.prototype.constructor=f.InViewerSearchMain,f.InViewerSearchMain.prototype.load=function(){var e=this,t=this.viewer,i=!!(this.options&&this.options.loadedModelTab&&this.options.relatedItemsTab&&this.options.serverSearchTab),n=i&&(this.options.loadedModelTab.enabled||this.options.relatedItemsTab.enabled||this.options.serverSearchTab.enabled);if(!n)return m.logger.log("InViewerSearch Extension - all search types disabled, nothing to do."),!1;f.WorkerUtils.initInViewerSearchWorkersScripts(function(){e.workersScriptsInitialized=!0,e.initWorkersScripts&&e.initWorkersScripts(),m.logger.info("InViewerSearch Extension: workers fetched.")},function(){m.logger.warn("InViewerSearch Extension: error fetching workers.")}),this.options.loadedModelTab.enabled&&!this.inViewerSearchThisView&&(this.inViewerSearchThisView=new f.InViewerSearchThisView(t,this.options)),this.options.relatedItemsTab.enabled&&!this.inViewerSearchThisItem&&(this.inViewerSearchThisItem=new f.InViewerSearchThisItem(t,this.options,this.cacheObj)),this.options.serverSearchTab.enabled&&!this.inViewerSearchThisProject&&(this.inViewerSearchThisProject=new f.InViewerSearchThisProject(this.options)),this.options.uiEnabled&&!this.inViewerSearchPanel&&(this.inViewerSearchPanel=new f.InViewerSearchPanel(t,"in-viewer-search","Search",this.options,this.qsApiService),this.container=this.inViewerSearchPanel.container,this.closeCallback=function(){e.closeSearch.call(e)},this.inViewerSearchPanel.addEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.options.uiEnabled&&!e.searchToolButton&&this.addToolbarUI(),this.onInitialized=function(t){t&&(e.initialized=!0,s(e),e.initCb&&e.initCb())},this.geometryLoadedCallback=function(){e.workersScriptsInitialized?a(e,e.onInitialized):e.initWorkersScripts=function(){a(e,e.onInitialized)}};var o=function(i){t.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,o),t.getObjectTree(function(){e.geometryLoadedCallback()},function(){m.logger.warn("InViewerSearch Extension - failed getObjectTree"),e.geometryLoadedCallback()})};return t.getObjectTree(function(){e.geometryLoadedCallback()},function(){if(t.model&&t.model.getData){var i=t.model.getData();i&&i.hasOwnProperty("hasObjectProperties")&&e.geometryLoadedCallback()}else t.addEventListener(v.GEOMETRY_LOADED_EVENT,o)}),!0},f.InViewerSearchMain.prototype.addToolbarUI=function(){var e,t=this,i=this.viewer;if(i.getToolbar){var n=Autodesk.Viewing.UI,o=i.getToolbar(!0);this.toolbarTools=o.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),e=new n.Button("toolbar-in-viewer-search"),e.setToolTip(v.i18n.translate("Loading Search")),e.setIcon("adsk-button-icon-search"),e.setState(n.Button.State.DISABLED),e.addEventListener("click",function(){if(t.inViewerSearchPanel){var e=t.inViewerSearchPanel.isVisible();t.qsApiService.logGeneralEvent(e?"searchWindowClose":"searchWindowOpen"),t.inViewerSearchPanel.setVisible(!e),t.searchBarElem.focus()}},!1),e.addClass("in-viewer-search-button"),t.inViewerSearchPanel&&t.inViewerSearchPanel.addVisibilityListener(function(t){e.setState(t?n.Button.State.ACTIVE:n.Button.State.INACTIVE)}),t.searchToolButton=e,t.toolbarTools.addControl(e)}},f.InViewerSearchMain.prototype.unload=function(){if(this.initialized=!1,this.options.uiEnabled){this.closeSearch(),this.toolbarTools&&this.toolbarTools.removeControl(this.searchToolButton);var e=this.cacheObj().searchInfoThisItem;e&&this.viewer.getPropertyPanel(!0).setVisible(!1)}return this.options.uiEnabled&&!this.options.saveExtensionStateEnabled&&(this.searchBarElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.searchBarElem),this.recentSearchesElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.recentSearchesElem),this.tabsElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.tabsElem),this.inViewerSearchPanel.removeEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.geometryLoadedCallback&&this.viewer.removeEventListener(v.GEOMETRY_LOADED_EVENT,this.geometryLoadedCallback),this.inViewerSearchThisView&&this.inViewerSearchThisView.initialized&&this.inViewerSearchThisView.uninitialize(),
this.options.saveExtensionStateEnabled||(this.inViewerSearchThisItem&&this.inViewerSearchThisItem.initialized&&this.inViewerSearchThisItem.uninitialize(),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.initialized&&this.inViewerSearchThisProject.uninitialize(),this.inViewerSearchPanel&&this.inViewerSearchPanel.uninitialize(),this.viewerProperties.uninitialize()),delete this.searchToolButton,delete this.inViewerSearchThisView,this.options&&!this.options.saveExtensionStateEnabled&&(delete this.inViewerSearchThisItem,delete this.inViewerSearchThisProject,delete this.inViewerSearchPanel,delete this.qsApiService,delete this.viewerProperties),!0},f.InViewerSearchMain.prototype.getRecentSearches=function(){return this.recentSearches||(this.recentSearches=o(window.localStorage[T]||"[]")),this.recentSearches},f.InViewerSearchMain.prototype.updateRecentSearches=function(e){var t,i,n,o;null!==e&&0!==e.length&&(t=this,this.recentSearches||this.getRecentSearches(),i=this.recentSearches.indexOf(e),0!==i&&(o=this.recentSearchesElem.children[1],i>0&&(this.recentSearches.splice(i,1),o.removeChild(o.childNodes[i]),i=-1),i<0&&(this.recentSearches=[e].concat(this.recentSearches.slice(0,20)),window.localStorage[T]=JSON.stringify(this.recentSearches),t.options.uiEnabled&&(n=o.children[0],n.className.indexOf("empty-list")>=0&&n.parentNode.removeChild(n),o.insertBefore(c(t,e),o.childNodes[0])))))},f.InViewerSearchMain.prototype.closeSearch=function(){var e=this;e.inViewerSearchPanel.setVisible(!1),e.hideTabs(),e.inViewerSearchThisView&&e.inViewerSearchThisView.clearSearchResults(),e.inViewerSearchThisItem&&e.inViewerSearchThisItem.clearSearch(),e.inViewerSearchThisProject&&e.inViewerSearchThisProject.clearSearch(),this.searchBarElem&&(this.searchBarElem.value="")},f.InViewerSearchMain.prototype.createTabs=function(){if(this.inViewerSearchPanel&&this.inViewerSearchPanel.scrollContainer){var e,t,i,n=this,o=this.inViewerSearchPanel?this.inViewerSearchPanel.scrollContainer:null,r="onsearch"in document.documentElement;if(!this.searchBarElem){t=document.createElement("input"),t.className="in-viewer-search-bar",t.id="in-viewer-search-bar",t.type="search",this.options.searchPlaceholder&&(t.placeholder=this.options.searchPlaceholder),t.addEventListener("keyup",function(e){var i=e.target.value.trim(),o=e.which||e.keyCode;r||o!==k.ENTER?i&&i.length>=w?(o===k.BACKSPACE||o===k.SPACE||o>40&&o<128||o>185&&o<193||o>218&&o<223)&&(clearTimeout(S),S=setTimeout(function(){n.saveLastQuery=!1,n.uiSearch()},b)):(n.hideTabs(),n.inViewerSearchThisView.clearSearchResults()):t.onsearch(e)});var s=function(e){var t=e.target.value.trim();clearTimeout(S),t?S=setTimeout(function(){n.saveLastQuery=!0,n.uiSearch()},b):(n.hideTabs(),n.inViewerSearchThisView.clearSearchResults())};t.onsearch=s,this.searchBarElem=t,e=document.createElement("div"),e.className="recent-searches",u(n,e),this.recentSearchesElem=e,i=document.createElement("div"),i.className="tabs-wrapper hidden",p(i,n),this.tabsElem=i,o&&(o.appendChild(t),this.searchBarElem.focus(),o.appendChild(e),o.appendChild(i))}}},f.InViewerSearchMain.prototype.search=function(e,t,i,n){var o=e.trim();o&&(this.qsApiService.generateQueryId(),this.inViewerSearchThisView&&this.inViewerSearchThisView.search(o,t,C),this.inViewerSearchThisItem&&this.inViewerSearchThisItem.search(o,i),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.search(o,n),this.saveLastQuery&&this.updateRecentSearches(o))},f.InViewerSearchMain.prototype.uiSearch=function(e){var t=this.searchBarElem,i=t.value.toLocaleLowerCase();C=e,i?(this.showTabs(),this.search(i)):this.hideTabs()},f.InViewerSearchMain.prototype.showTabs=function(){var e,t;!this.showingTabs&&this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(e=this.tabsElem,e.classList.remove("hidden"),h(this,e.firstChild.firstChild,E,"thisView"),t=this.recentSearchesElem,t.classList.add("hidden"),this.showingTabs=!0)},f.InViewerSearchMain.prototype.changeToThisViewTabAndSelectNode=function(e){var t;this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(t=this.tabsElem,h(this,t.firstChild.firstChild,E,"thisView"),this.inViewerSearchThisView.selectNode(null,e,!0))},f.InViewerSearchMain.prototype.hideTabs=function(){this.showingTabs&&(this.recentSearchesElem.classList.remove("hidden"),this.tabsElem.classList.add("hidden"),this.showingTabs=!1,this.searchBarElem.focus())}}(),function(){"use strict";var e=Autodesk.Viewing,t=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),i={searchPlaceholder:"",uiEnabled:!0,clientId:"adsk.viewer.defaultClientId",sessionId:"adsk.viewer.defaultSessionId",serverSearchTab:{enabled:!1,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50}};t.InViewerSearchExtension=function(n,o){var r;e.Extension.call(this,n,o),this.initialized=!1,this.viewer=n,this.toolbarTools=null,o||(o={}),o.inViewerSearchConfig=o.inViewerSearchConfig||i,this.options=o.inViewerSearchConfig,r=Autodesk.Viewing.Private.GuiViewer3D&&n instanceof Autodesk.Viewing.Private.GuiViewer3D,this.options.uiEnabled=r&&(void 0===this.options.uiEnabled?i.uiEnabled:this.options.uiEnabled),this.options.serverSearchTab=this.options.serverSearchTab||i.serverSearchTab,this.options.relatedItemsTab=this.options.relatedItemsTab||i.relatedItemsTab,this.options.loadedModelTab=this.options.loadedModelTab||i.loadedModelTab,this.options.serverSearchTab.displayName=this.options.serverSearchTab.displayName||i.serverSearchTab.displayName,this.options.relatedItemsTab.displayName=this.options.relatedItemsTab.displayName||i.relatedItemsTab.displayName,this.options.loadedModelTab.displayName=this.options.loadedModelTab.displayName||i.loadedModelTab.displayName,this.options.initialized||(this.inViewerSearchMain=new t.InViewerSearchMain(this.viewer,this.options,this.getCache))},t.InViewerSearchExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),t.InViewerSearchExtension.prototype.constructor=t.InViewerSearchExtension,t.InViewerSearchExtension.prototype.getInViewerSearch=function(){return this.inViewerSearchMain},t.InViewerSearchExtension.prototype.load=function(){return this.options.initialized&&this.options.inViewerSearchMain&&(this.inViewerSearchMain=this.options.inViewerSearchMain),this.inViewerSearchMain.load(),this.options.saveExtensionStateEnabled&&(this.options.inViewerSearchMain=this.inViewerSearchMain,this.options.initialized=!0),!0},t.InViewerSearchExtension.prototype.unload=function(){return this.inViewerSearchMain.unload(),this.options.saveExtensionStateEnabled||(delete this.inViewerSearchMain,this.inViewerSearchMain=null,this.options.initialized=!1,this.options.inViewerSearchMain=null),!0},t.InViewerSearchExtension.prototype.addInitListener=function(e){this.inViewerSearchMain&&this.inViewerSearchMain.initialized?setTimeout(function(){e()},0):this.inViewerSearchMain.initCb=e},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.InViewerSearch",t.InViewerSearchExtension)}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");t.InViewerSearchPanel=function(t,i,n,o,r){var s=this;this.viewer=t,this.qsApiService=r,e.DockingPanel.call(this,t.container,i,n,o),this.container.classList.add("inViewerSearchPanel"),o=o||{},o.heightAdjustment||(o.heightAdjustment=40),o.marginTop||(o.marginTop=0),o.left=!0,this.createScrollContainer(o),this.options=o,this.selectedNodes=[],this.uiCreated=!1,this.addVisibilityListener(function(e){e&&(s.uiCreated||s.createUI(),s.resizeToContent())})},t.InViewerSearchPanel.prototype=Object.create(e.DockingPanel.prototype),t.InViewerSearchPanel.prototype.constructor=t.InViewerSearchPanel,t.InViewerSearchPanel.prototype.createUI=function(){},t.InViewerSearchPanel.prototype.addClass=function(e,t){var i=null!==this.tree&&this.tree.addClass(e,t);return i},t.InViewerSearchPanel.prototype.removeClass=function(e,t){var i=null!==this.tree&&this.tree.removeClass(e,t);return i},t.InViewerSearchPanel.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",function(){t.qsApiService.logGeneralEvent("searchWindowClose")},!1)},Autodesk.Viewing.UI.InViewerSearchPanel=t.InViewerSearchPanel}(),function(){"use strict";function e(e,t,i,n,o){var r,s=document.createElement("li"),a=e.controller;if(i.displayName)r=i.displayName;else{var l=i.nodeName;if(l||(l=a.viewerProperties.defaultNodeName()),l.indexOf(a.searchedString)>=0||i.hasOwnProperty("fieldName")&&"Name"===i.fieldName)r=a.viewerProperties.highlightText(l,a.searchedString);else{var c="[object Number]"===Object.prototype.toString.call(i.fieldValue)?String(i.fieldValue):i.fieldValue;r=a.viewerProperties.highlightText(l)+" ("+a.viewerProperties.highlightText(i.fieldName)+": "+a.viewerProperties.highlightText(c,a.searchedString)+")"}}s.className="item-result",s.innerHTML=r,s.setAttribute("adskSearchGeoGuid",o),s.setAttribute("adskSearchDbId",i.dbId),s.setAttribute("adskSearchIndex",n),t.appendChild(s)}function t(e,t,i){var n,o;t&&t.children.length&&(o=t.lastChild.className.contains("more-items"),o||(n=document.createElement("li"),n.className="item-result more-items",n.textContent=c.i18n.translate("Load More"),n.addEventListener("click",function(t){e.qsApi.logLoadMoreClickEvent(i,"thisItem"),e.loadMoreItems(i,t)},!1),t.appendChild(n)))}function i(t,i,n,o){var r,s,a,l,c=t.controller;r=document.createElement("div"),r.className="geometry-results geometry_"+n.id,r.className=r.className+(c.geometriesCount>3?" collapsed":""),s=document.createElement("label"),s.className="geometry-name",s.setAttribute("adskGeomId",n.id),s.setAttribute("adskGeomIndex",o),s.addEventListener("click",function(e){var i=e.currentTarget.getAttribute("adskGeomId"),n=parseInt(e.currentTarget.getAttribute("adskGeomIndex"),10);t.qsApi.logResultGeomClickEvent(n+1,i,t.currentGeometry===i,"thisItem"),t.toggleGeometry(e)},!1),s.textContent=n.name,r.appendChild(s),a=document.createElement("ul"),a.className="geometry-result-list",l=Math.min(n.results.length,t.limit),t.geoPages[n.id]=l,n.results.slice(0,l).forEach(function(i,o){e(t,a,i,o,n.id)}),r.appendChild(a),c.bruteSearch&&o<c.geometriesCount-1?i.insertBefore(r,i.childNodes[o]):i.appendChild(r),t.geometriesContainer[n.id]=r}function n(e,t){var i,n,o,r;r=t.resultCountDom,r&&(i=r.getAttribute("term"),n=r.getAttribute("ctx"),o=c.i18n.translate("Results Count"),o=o.split("{0}").join(e),o=o.split("{1}").join(i),o=o.split("{2}").join(n),r.textContent=o)}function o(e,n,o,r,s,a,l){var u,h,d,p,v;h=e.controller,n.textContent="",p=document.createElement("div"),p.id="result-count-this-item-wrapper",p.className="result-count",u=document.createElement("span"),u.id="result-count-this-item",u.setAttribute("term",o),u.setAttribute("ctx",e.options.relatedItemsTab.displayName),d=c.i18n.translate("Results Count").split("{0}").join(s).split("{1}").join(o).split("{2}").join(e.options.relatedItemsTab.displayName),e.resultCountDom=u,u.textContent=d,p.appendChild(u),n.appendChild(p),v=document.createElement("div"),v.className="geometries-results-container dockingPanelScroll",a||(v.className=v.className+" too-many-geometries"),n.appendChild(v);var g,m,f=r.id;i(e,v,r,l),e.geoPages[f]>=e.limit&&(g=e.geometriesContainer[f],m=r.results.length>e.geoPages[f],m&&t(e,g.children[1],f))}function r(o,r,s,a,l){var c,u,h,d,p,v,g=o.controller;if(s.results&&s.results.length&&(o.geometriesContainer.hasOwnProperty(s.id)?o.geoPages[s.id]<o.limit&&(v=o.geometriesContainer[s.id],c=v.children[1],u=s.results.length,h=o.limit-o.geoPages[s.id],d=o.geoPages[s.id],p=0,d>0&&(p=d),u>o.limit?(o.geoPages[s.id]=o.limit,u=o.limit):o.geoPages[s.id]=o.geoPages[s.id]+(u-d),s.results.slice(p,u).forEach(function(t,i){e(o,c,t,i,s.id)})):i(o,r,s,l),o.geoPages[s.id]>=o.limit)){var m=g.totalResults[g.totalResultsIndex[s.id]].results.length>o.geoPages[s.id];m&&(v=o.geometriesContainer[s.id],t(o,v.children[1],s.id))}n(a,o)}function s(e,t,i,n){t.innerHTML="";var o=document.createElement("p");o.className="search-no-results";var r=c.i18n.translate("No Results").split("{0}").join(i).split("{1}").join(n);o.textContent=r,t.appendChild(o)}function a(e,t,i,n){function o(){var e=(new Date).getTime()-l;u.logger.log("Execution time INIT: "+e),i.logTimeEvent("initTime",e,"thisItem"),a.initialized=!0}function r(){return a.viewerProperties.tooManyNodes()}function s(e,t){c=(new Date).getTime(),a.viewerProperties.bruteSearch(e,function(e,n,o,r){if(a.lastSearchedString===e){a.totalResults=n.totalResults,a.searchInItemEnded=o,a.resultsCount=n.resultsCount,a.totalResultsIndex=n.totalResultsIndex,a.searchedString=e,a.geometriesCount++,a.bruteSearch=!0,s&&o&&(i.logTimeEvent("bruteSearchTime",(new Date).getTime()-c,"thisItem"),i.logSearchResults(a.resultsCount,e,"bruteSearch","thisItem"));var l=n.totalResults[n.totalResultsIndex[r]],u=null;return l&&(u={totalResults:[l]}),s&&o&&(i.logTimeEvent("bruteSearchTime",(new Date).getTime()-c,"thisItem"),i.logSearchResults(a.resultsCount,e,"bruteSearch","thisItem")),void t(u,a.viewerProperties.geometriesLoaded(),a.viewerProperties.getTotalCountGeometries(),o,r)}})}var a=this,l=null,c=null;a.initialized=!1,a.totalResults=[],a.searchInItemEnded=!1,a.resultsCount=-1,a.totalResultsIndex={},a.bigModels=!1,a.bigAmountGeometries=!1,a.viewerProperties=t,a.searchedString="",a.lastSearchedString="",a.geometriesCount=0,a.bruteSearch=!1,a.initializeAttributes=function(e,t){return a.initialized=!1,a.totalResults=[],a.searchInItemEnded=!1,a.resultsCount=-1,a.totalResultsIndex={},a.bigModels?(o(),void t()):void a.viewerProperties.getGeometriesAttributes(function(){o(),t()})},a.initialize=function(e){l=(new Date).getTime(),a.viewerProperties.initPropertyDatabases(function(t,i,n){return a.loadingGeom=t,a.bigAmountGeometries=n,a.bigModels=r(t),1===a.viewerProperties.getTotalCountGeometries()?(o(),void e()):(i&&a.initializeAttributes(t,function(){if(!n)return void e()}),n?void e():void 0)})},a.doSearch=function(e,t){if(a.totalResults=[],a.searchInItemEnded=!1,a.resultsCount=0,a.totalResultsIndex={},a.lastSearchedString=e,a.geometriesCount=0,a.bruteSearch=!1,a.bigModels||!a.initialized)s(e,t);else{var n=+new Date;a.viewerProperties.doSearch(e,function(e,o,r){if(a.lastSearchedString===e)return a.totalResults=o.totalResults,a.searchInItemEnded=r,a.resultsCount=o.resultsCount,a.totalResultsIndex=o.totalResultsIndex,a.searchedString=e,a.geometriesCount=o.totalResults.length,r&&(i.logTimeEvent("searchTime",new Date-n,"thisItem"),i.logSearchResults(a.resultsCount,e,"fullproof-StringSearch","thisItem")),void t(o,a.viewerProperties.geometriesLoaded(),a.viewerProperties.getTotalCountGeometries(),r)})}}}var l,c=Autodesk.Viewing,u=Autodesk.Viewing.Private,h=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");h.InViewerSearchThisItem=function(e,t,i){l=this,this.viewer=e,this.options=t,this.container=null,this.initialized=!1,this.controller=null,this.qsApi=null,this.searchString=null,this.geoPages={},this.currentGeometry=null,this.limit=t.relatedItemsTab.pageSize,this.clicked=null,this.extensionViewer=null,this.cacheObj=i,this.loading=null,this.stillLoadingAlertElemId="this-item-loading-alert",this.stillLoadingAlertElem=null,this.geometriesContainer={},this.resultCountDom=null},h.InViewerSearchThisItem.prototype.constructor=h.InViewerSearchThisItem,h.InViewerSearchThisItem.prototype.initialize=function(e,t,i,n,o,r){var s=this;this.qsApi=e,this.options.uiEnabled&&(this.container=n,this.container.addEventListener("click",this.clickHandler)),this.currentGeometry=i,this.changeTab=r,this.controller=new a(i,t,e,this.viewer.model.myData.urn),this.controller.initialize(function(){s.initialized=!0,s.options.uiEnabled&&s.viewer&&s.viewer.getPropertyPanel&&(s.extensionViewer=s.viewer.getPropertyPanel(!0));var e=n&&n.id?n.id:n;o(e,s.initialized)})},h.InViewerSearchThisItem.prototype.uninitialize=function(){this.options.uiEnabled&&this.container.removeEventListener("click",this.clickHandler),this.controller&&(this.controller=null)};var d=function(e){for(var t,i,n,o=e.target,r=!1;o&&this.container!==o&&!r;)r=o.hasAttribute("adskSearchDbId"),r||(o=o.parentNode);r&&(t=o.getAttribute("adskSearchGeoGuid"),i=parseInt(o.getAttribute("adskSearchDbId"),10),n=parseInt(o.getAttribute("adskSearchIndex"),10),"click"===e.type?l.currentGeometry===t?(l.qsApi.logResultClickEvent(n+1,i,!0,"thisItem"),l.changeTab(i)):l.loadGeometryInViewer(t,i,n):"dblclick"===e.type||"hover"===e.type)};h.InViewerSearchThisItem.prototype.clickHandler=function(e){e&&(l.mouseClickTimeout&&(clearTimeout(l.mouseClickTimeout),l.mouseClickTimeout=null),l.mouseClickTimeout=setTimeout(function(){d.call(l,e)},200))},h.InViewerSearchThisItem.prototype.toggleLoading=function(e){var t,i=this.loading;e&&!i?(i=document.createElement("div"),i.className="loading this-item-loading",t=document.createElement("span"),t.textContent=c.i18n.translate("Loading"),i.appendChild(t),this.container.appendChild(i),this.loading=i):!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),this.loading=null)},h.InViewerSearchThisItem.prototype.search=function(e,t){var i=this,n=i.controller,o=e.trim();this.clearSearch(),o&&(this.searchString=o,this.options.uiEnabled&&this.toggleLoading(!0),this.controller.doSearch(o,function(e,r,s,a,l){var c;if(i.options.uiEnabled)i.showResults(o,e,r,s,l);else if(a){c=n.totalResults.map(function(e){var t={id:e.id,name:e.name,results:e.results.slice(0,i.limit),moreResults:e.results.length>i.limit};return t});var u={page:1,results:c,resultsCount:n.resultsCount};return void t(u)}}))},h.InViewerSearchThisItem.prototype.loadGeometryInViewer=function(e,t,i){var n=this.cacheObj(),o=this.controller,r=o.viewerProperties.getGeometry(e),s=r?r.data:{guid:e};this.qsApi.logResultClickEvent(i+1,t,!1,"thisItem"),n.searchInfoThisItem={node:t,str:this.searchString};var a=function(){u.logger.error("Error loading geometry")},l=function(){u.logger.log("success loading geometry")};this.viewer.fireEvent({type:c.LOAD_GEOMETRY_EVENT,data:{item:s,onSuccessCb:l,onErrorCb:a}})},h.InViewerSearchThisItem.prototype.toggleGeometry=function(e){e.target.parentElement.className.indexOf("collapsed")===-1?e.target.parentElement.classList.add("collapsed"):e.target.parentElement.classList.remove("collapsed")},h.InViewerSearchThisItem.prototype.showResults=function(e,t,i,n,a){var l,u,h=this.controller,d=this,p=d.container,v=p.children.length>1,g=n===i,m=this.stillLoadingAlertElem;if(t&&t.totalResults&&t.totalResults.length>0){u=t.totalResults;var f=null;a||(u=h.viewerProperties.orderGeometriesByName(t)),d.toggleLoading(!1),u.forEach(function(t){l=h.totalResultsIndex[t.id],v?(f=p.children[1],r(d,f,t,h.resultsCount,l,h.bruteSearch)):(o(d,p,e,t,h.resultsCount,g,l,h.bruteSearch),v=!0)})}else h.searchInItemEnded&&(d.toggleLoading(!1),s(d,p,e,d.options.relatedItemsTab.displayName));if(!g&&h.searchInItemEnded&&!m){m=document.createElement("div"),m.id=d.stillLoadingAlertElemId,m.className="alert-geometries-loading";var E=c.i18n.translate("Geometries Loading");m.textContent=E,this.stillLoadingAlertElem=m,p.appendChild(m)}},h.InViewerSearchThisItem.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.innerHTML="",this.geometriesContainer={},this.stillLoadingAlertElem=null,this.resultCountDom=null),this.geoPages={},this.toggleLoading(!1)},h.InViewerSearchThisItem.prototype.getPage=function(e,t,i){var n,o,r,s,a,l=this.controller,c=this,u=c.limit*(t-1);s={id:"",name:"",results:[],moreResults:!1},n=l.totalResults[l.totalResultsIndex[e]],n&&(o=n.results,r=o.slice(u,u+c.limit),s={id:n.id,name:n.name,results:r,moreResults:o.length>u+c.limit}),a={page:t,results:s,resultsCount:l.resultsCount},i(a)},h.InViewerSearchThisItem.prototype.loadMoreItems=function(i,n){var o,r,s,a,l,c,u=this.controller,h=this,d=h.geoPages[i],p=d;o=u.totalResults[u.totalResultsIndex[i]],r=o.results,s=r.slice(d,d+h.limit),h.geoPages[i]=h.geoPages[i]+h.limit,a=this.geometriesContainer[i],l=a.children[1],n.target.parentNode.removeChild(n.target),c=r.length>h.geoPages[i],s.forEach(function(t){e(h,l,t,p,i),p++}),c&&t(h,l,i)}}(),function(){"use strict";function e(e,t,i,n){var o=e,r=/^https?:\/\//i;try{n?o=n(i):i.url&&(0===i.url.search(r)?o=i.url:(o=t+"/"+i.url,o=o.replace(/([^:]\/)\/+/g,"$1")))}catch(e){o=null}return o||e}function t(e,t,i,o){var r,s;t.textContent="",s=document.createElement("p"),s.className="search-no-results",r=n.i18n.translate("No Results"),r=r.split("{0}").join(i),r=r.split("{1}").join(o),s.textContent=r,t.appendChild(s)}function i(e){function t(t,i){var n=[];t&&(t.forEach(function(t){var i;t.suggestionCount>0&&(i={modifier:t.modifier,name:t.displayName,categoryResults:[],moreItems:t.suggestionCount>3},t.suggestions.forEach(function(t){var n={name:e.sanitizeAndHighlightString(t.title,"<b>","</b>"),logClick:t.logClick,url:t.url,resultData:t};i.categoryResults.push(n)}),o.count=o.count+t.suggestionCount,n.push(i),o.categoriesIndex[i.name]=n.length-1)}),o.categories=n),i(o.categories)}function i(i,n,o){i?(e.logErrorEvent("Error getting suggestions: "+i,"in_viewer_search_this_project","handleResult","thisProject"),o([])):n&&n.suggestionGroups&&t(n.suggestionGroups,o)}function n(t,i,n){var r,s,l;if(t)e.logErrorEvent("Error getting more item results: "+t,"in_viewer_search_this_project","loadMoreResults","thisProject");else if(i&&i.queryResults)return r=[],l=o.categories[o.categoriesIndex[a]].categoryResults,i.queryResults.forEach(function(t){var i={name:e.sanitizeAndHighlightString(t.title,"<b>","</b>"),logClick:t.logClick,url:t.url,resultData:t};r.push(i),l.push(i)}),s=i.queryResultCount>l.length,void n(r,s)}var o=this,r=null,s={},a="",l={};o.categories=null,o.categoriesIndex={},o.count=0,o.projectResults=null,o.search=function(t,n,a,c,u,h){1===u&&(o.categories=null,o.count=0,l={}),r=n,s={query:n,sort:a,filters:c};var d=+new Date;e.search(t,n,a,c,u,function(t,n){e.logTimeEvent("searchTime",new Date-d,"thisProject"),i(t,n,h)},"thisProject")},o.uninitialize=function(){},o.getMoreResults=function(t,i,o,r,c){var u=2;a=i,l.hasOwnProperty(i.name)&&(u=l[i.name]),c&&(u=c),e.getMoreResults(t,o,s.query,s.sort,s.filters,u,function(e,t){n(e,t,r)}),c||(l[i.name]=u+1)}}var n=Autodesk.Viewing,o=Autodesk.Viewing.Private,r=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),o=Autodesk.Viewing.Private,s="This feature has not been configured.";r.InViewerSearchThisProject=function(e){this.options=e,this.initialized=!1,this.controller=null,this.qsApi=null,this.container=null,this.contextMenu=null,this.urlCb=null,this.loadingId="this-project-loading",this.searchParams=null,e&&e.serverSearchTab&&e.serverSearchTab.parameters&&(this.searchParams=e.serverSearchTab.parameters),this.loadingElementDom=null,self.categoriesContainerDom=null},r.InViewerSearchThisProject.prototype.constructor=r.InViewerSearchThisProject,r.InViewerSearchThisProject.prototype.initialize=function(e,t){var n=this,r=+new Date;return this.qsApi=e,n.options&&n.options.serverSearchTab&&n.searchParams?(this.urlCb=n.searchParams.urlCallback,this.baseURL=n.searchParams.baseURL?n.searchParams.baseURL.replace(/\/$/g,""):"",this.fallbackURL=n.searchParams.fallbackURL,this.controller=new i(e),this.options.uiEnabled&&(this.container=t,window.addEventListener("click",function(){n.contextMenu&&n.contextMenu.classList.add("hidden")},!1)),e.logTimeEvent("initTime",new Date-r,"thisProject"),void(this.initialized=!0)):void o.logger.warn("Error initializing server search tab: missing options.")},r.InViewerSearchThisProject.prototype.uninitialize=function(){this.controller&&this.controller.uninitialize()},r.InViewerSearchThisProject.prototype.openMenu=function(t,i){var r,s,a,l=this.contextMenu,c=e(this.fallbackURL,this.baseURL,i,this.urlCb),u=this.container,h=u.getBoundingClientRect();i.logClick(),t.stopPropagation(),l.textContent="",c?(r=document.createElement("div"),r.className="menu-item open-another-window",r.innerHTML="<a href='"+c+"' target='_blank'>"+n.i18n.translate("Open Another Window")+"</a>",s=document.createElement("div"),s.className="menu-item open-this-window",s.innerHTML="<a href='"+c+"' target='_self'>"+n.i18n.translate("Open This Window")+"</a>",l.appendChild(r),l.appendChild(s),a=t.pageX-h.left+t.currentTarget.offsetLeft-10,a>195&&(a-=145),l.style.top=t.pageY-7+"px",l.style.left=a+"px",l.className=l.className.replace(" hidden","")):o.logger.warn("The url for "+i.name+" is empty")},r.InViewerSearchThisProject.prototype.toggleCategory=function(e){var t=e.target.parentElement.className.indexOf("collapsed")===-1;t?e.target.parentElement.classList.add("collapsed"):e.target.parentElement.classList.remove("collapsed")},r.InViewerSearchThisProject.prototype.toggleLoading=function(e){var t=this.loadingElementDom;e&&!t?(t=document.createElement("div"),t.id=this.loadingId,t.className="loading",t.innerHTML="<span>"+n.i18n.translate("Loading")+"</span>",this.loadingElementDom=t,this.container.appendChild(t)):!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),this.loadingElementDom=null)},r.InViewerSearchThisProject.prototype.loadMoreItems=function(e,t){var i=this,n=this.controller,o=e.target.parentElement;this.toggleLoading(!0),n.getMoreResults(this.searchParams.pid,t.name,t.modifier,function(t,n){var r;n||e.target.parentNode.removeChild(e.target),i.toggleLoading(!1),t.forEach(function(e){var t=document.createElement("li");t.innerHTML=e.name,t.className="item-result",t.addEventListener("click",function(t){i.openMenu(t,e)},!1),n?o.insertBefore(t,o.childNodes[o.childElementCount-1]):o.appendChild(t)}),r=this.categoriesContainerDom,r.scrollTop=r.scrollTop+70})},r.InViewerSearchThisProject.prototype.getPage=function(e,t,i){var n=this.controller;this.options.uiEnabled&&this.toggleLoading(!0),n.getMoreResults(this.searchParams.pid,e.name,e.modifier,function(e,o){var r={page:t,results:e,resultsCount:n.count};i(r)},t)},r.InViewerSearchThisProject.prototype.showResults=function(e,i){var o,r,s,a,l=this,c=this.container,u=this.controller;this.toggleLoading(!1),c.textContent="",l.qsApi.logSearchResults(u.count,e,"elasticsearch","thisProject"),u.count>0?(o=document.createElement("div"),o.className="result-count",r=n.i18n.translate("Results Count"),r=r.split("{0}").join(u.count),r=r.split("{1}").join(e),r=r.split("{2}").join(l.options.serverSearchTab.displayName),s=document.createElement("span"),s.id="result-count-this-project",s.textContent=r,o.appendChild(s),c.appendChild(o),a=document.createElement("div"),a.className="categories-results-container dockingPanelScroll",c.appendChild(a),l.categoriesContainerDom=a,l.contextMenu=document.createElement("div"),l.contextMenu.className="context-menu hidden",c.appendChild(l.contextMenu),i.forEach(function(e,t){var i,o,r,s;i=document.createElement("div"),i.id="category_"+e.name,i.className="category-results",o=document.createElement("label"),o.className="category-name",o.setAttribute("adskCatId",e.name),o.setAttribute("adskCatIndex",t),o.addEventListener("click",function(e){var t=e.currentTarget.getAttribute("adskCatId"),i=parseInt(e.currentTarget.getAttribute("adskCatIndex"),10);l.qsApi.logResultGeomClickEvent(i+1,t,!1,"thisProject"),l.toggleCategory(e)},!1),o.innerText=e.name,i.appendChild(o),r=document.createElement("ul"),r.className="category-result-list",[].slice.call(e.categoryResults).forEach(function(e,t){var i=document.createElement("li");i.className="item-result",i.innerHTML=e.name,i.setAttribute("adskItemId",e.url),i.setAttribute("adskItemIndex",t),i.addEventListener("click",function(t){var i=t.currentTarget.getAttribute("adskItemId"),n=parseInt(t.currentTarget.getAttribute("adskItemIndex"),10);l.qsApi.logResultClickEvent(n+1,i,!1,"thisProject"),l.openMenu(t,e)},!1),r.appendChild(i)}),e.moreItems&&(s=document.createElement("li"),s.className="more-items item-result",s.textContent=n.i18n.translate("Load More"),s.addEventListener("click",function(t){l.qsApi.logLoadMoreClickEvent(e.name,"thisProject"),l.loadMoreItems(t,e)},!1),r.appendChild(s)),i.appendChild(r),a.appendChild(i)})):t(l,c,e,l.options.serverSearchTab.displayName)},r.InViewerSearchThisProject.prototype.search=function(e,t){var i=this,n=this.controller,o=e.trim();return this.clearSearch(),this.searchParams.pid&&this.searchParams.filters?void(o&&(this.options.uiEnabled&&this.toggleLoading(!0),this.controller.search(this.searchParams.pid,o,"dateModifiedDescending",this.searchParams.filters,1,function(e){i.options.uiEnabled?i.showResults(o,e):t({page:1,results:e,resultsCount:n.count})}))):void i.displayMessage(s)},r.InViewerSearchThisProject.prototype.displayMessage=function(e){var t,i;this.container&&this.options.uiEnabled&&(t=this.container,this.toggleLoading(!1),t.textContent="",i=document.createElement("p"),i.className="display-message",i.textContent=e,t.appendChild(i))},r.InViewerSearchThisProject.prototype.clearSearch=function(){var e;this.container&&this.options.uiEnabled&&(e=this.container,e.textContent="",this.toggleLoading(!1))}}(),function(){"use strict";function e(e,t,i,n){var o=document.createElement("li");o.innerHTML=t.displayNameSanitized,o.setAttribute("adskSearchDbId",t.dbId),o.setAttribute("adskSearchIndex",n),o.className="in-viewer-search-item item-result dbId_"+t.dbId+"_",e.highlightNode===t.dbId&&(e.selectedNode=o,o.className=o.className+" selected",e.selectNode(o,t.dbId,!0)),e.resultsDom=o,i.appendChild(o)}function t(e,t,i,n){var o,r;t.textContent="",r=a.i18n.translate("No Results").split("{0}").join(i).split("{1}").join(n),o=document.createElement("p"),o.className="search-no-results",o.textContent=r,t.appendChild(o)}function i(e,t,i,n){var o,r,s;return r=t.nodeName,!r&&e.viewer.model.myData.instanceTree&&(r=e.viewer.model.myData.instanceTree.getNodeName(t.dbId)),r||(r=i.viewerProperties.defaultNodeName()),r.indexOf(n)>=0||t.hasOwnProperty("fieldName")&&"Name"===t.fieldName?s=i.viewerProperties.highlightText(r,n):t.hasOwnProperty("fieldName")&&t.hasOwnProperty("fieldValue")?(o="[object Number]"===Object.prototype.toString.call(t.fieldValue)?String(t.fieldValue):t.fieldValue,s=i.viewerProperties.highlightText(r)+" ("+i.viewerProperties.highlightText(t.fieldName)+": "+i.viewerProperties.highlightText(o,n)+")"):s=i.viewerProperties.highlightText(r),s}function n(e,t){var i,n,o,r;r=t.resultCountDOM,r&&(i=r.getAttribute("term"),n=r.getAttribute("ctx"),o=a.i18n.translate("Results Count"),o=o.split("{0}").join(e),o=o.split("{1}").join(i),o=o.split("{2}").join(n),r.textContent=o)}function o(t,o,r,s){var l,c,u,h,d,p=t.container,v=t.controller,g=r.length,m=t.limit,f=t.offset,E=f+m;g<m&&(E=f+g),g&&(t.options.uiEnabled&&(t.toggleLoading(!1),t.resultList||(p.textContent="",l=document.createElement("div"),l.className="result-count",c=document.createElement("span"),c.id="result-count-this-view",c.setAttribute("term",o),c.setAttribute("ctx",t.options.loadedModelTab.displayName),u=a.i18n.translate("Results Count"),c.textContent=u.split("{0}").join(g).split("{1}").join(o).split("{2}").join(t.options.loadedModelTab.displayName),t.resultCountDOM=c,l.appendChild(c),p.appendChild(l),t.resultList=document.createElement("ul"),t.resultList.className="search-result-list dockingPanelScroll",t.resultList.addEventListener("scroll",function(){this.scrollTop>t.scrollOffset&&(t.loadMoreResults(),t.scrollOffset=t.scrollOffset+t.limitScroll)}),p.appendChild(t.resultList))),r.slice(f,g).forEach(function(n,r){n.hasOwnProperty("dbId")||(n={fieldName:n.name,fieldValue:n.value,dbId:n.id,nodeName:n.nodeName}),t.isNodeVisible(n.dbId,function(){v.searchedIds.hasOwnProperty(n.dbId)||(h=i(t,n,v,o),d={displayNameSanitized:h,dbId:n.dbId,fieldName:n.fieldName,fieldValue:n.fieldValue},v.totalResults.push(d),v.searchResultIds.push(n.dbId),v.searchedIds[n.dbId]=1,v.resultsCount++,t.options.uiEnabled&&v.resultsCount<=m&&f<E&&(e(t,d,t.resultList,r),f+=1))})}),t.offset=f,t.options.uiEnabled&&n(v.resultsCount,t))}function r(e,t,i,n){
function o(){var e=(new Date).getTime()-c;l.logger.log("Execution time INIT: "+e),t.logTimeEvent("initTime",e,"thisView"),a.initialized=!0}function r(e,i){var n=(new Date).getTime(),o=function(o){a.searchEnded=!0,t.logTimeEvent("bruteSearchTime",(new Date).getTime()-n,"thisView"),t.logSearchResults(o.length,e,"bruteSearch","thisView"),i(e,o,!0)},r=function(){t.logErrorEvent("LMV search bruteForceSearch failed","in_viewer_search_this_view","bruteSearch","thisView")};a.viewerProperties.bruteSearchCurrent(e,o,r)}function s(){var e=a.viewerProperties.tooManyNodes(!0);return e}var a=this,c=null;a.initialized=!1,a.searchResultIds=[],a.searchedIds={},a.resultsCount=0,a.totalResults=[],a.searchEnded=null,a.viewerProperties=i,a.bigModel=!1,a.isSharedPropertyDb=!1,a.initializeAllAttributes=function(e){c=(new Date).getTime(),a.bigModel=s(),n||(a.bigModel=!0),a.bigModel?(o(),e()):a.viewerProperties.getCurrentGeometryAttributes(function(){o(),e()})},a.doSearch=function(e,i){var o;a.searchResultIds=[],a.searchedIds={},a.resultsCount=0,a.totalResults=[],a.searchEnded=!1,a.bigModel?r(e,i):(o=(new Date).getTime(),a.viewerProperties.doSearch(e,function(e,r,s){var l=[];r&&r.totalResults.length&&(l=r.totalResults[r.totalResultsIndex[n]].results),s&&(t.logTimeEvent("searchTime",(new Date).getTime()-o,"thisView"),t.logSearchResults(a.resultsCount.length,e,"fullproof-StringSearch","thisView")),i(e,l,s)}))}}var s,a=Autodesk.Viewing,l=Autodesk.Viewing.Private,c=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");c.InViewerSearchThisView=function(e,t){s=this,this.options=t,this.viewer=e,this.container=null,this.initialized=!1,this.controller=null,this.resultList=null,this.extensionViewer=null,this.clicked=null,this.is2DMode=null,this.qsApi=null,this.highlightNode=null,this.scrollOffset=500,this.limitScroll=200,this.limit=t.loadedModelTab.pageSize,this.offset=0,this.mouseClickTimeout=null,this.loadingId="this-view-loading",this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null},c.InViewerSearchThisView.prototype.constructor=c.InViewerSearchThisView,c.InViewerSearchThisView.prototype.initialize=function(e,t,i,n,o,s){var a=this,l=this.viewer;this.options.uiEnabled&&(this.container=o,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler),this.container.addEventListener("hover",this.clickHandler)),this.is2DMode=n,this.qsApi=e,this.controller=new r(l,e,t,i),this.controller.initializeAllAttributes(function(){a.initialized=!0,a.options.uiEnabled&&a.viewer&&a.viewer.getPropertyPanel&&(a.extensionViewer=a.viewer.getPropertyPanel(!0));var e=o&&o.id?o.id:o;s(e,a.initialized)})},c.InViewerSearchThisView.prototype.uninitialize=function(){this.options.uiEnabled&&(this.container.removeEventListener("click",this.clickHandler),this.container.removeEventListener("dblclick",this.clickHandler),this.container.removeEventListener("hover",this.clickHandler)),this.controller&&(this.controller=null)};var u=function(e){for(var t,i,n=e.target,o=!1;n&&this.container!==n&&!o;)o=n.hasAttribute("adskSearchDbId"),o||(n=n.parentNode);o&&(t=parseInt(n.getAttribute("adskSearchDbId"),10),i=parseInt(n.getAttribute("adskSearchIndex"),10),"click"===e.type?s.showNodeProperties(e,t,i):"dblclick"===e.type?(s.showNodeProperties(e,t,i,!0),s.viewer.fitToView()):"hover"===e.type&&s.viewer.impl.rolloverObjectNode(t))};c.InViewerSearchThisView.prototype.clickHandler=function(e){e&&(clearTimeout(s.mouseClickTimeout),s.mouseClickTimeout=setTimeout(function(){u.call(s,e)},200))},c.InViewerSearchThisView.prototype.search=function(e,t,i){var n=this,r=this.controller,s=e.trim();this.clearSearchResults(),s&&(n.resultList=null,this.options.uiEnabled&&(this.toggleLoading(!0),this.highlightNode=i),this.controller.doSearch(s,function(e,i,s){var a;if(n.options.uiEnabled)n.showResults(e,i,s);else if(o(n,e,i,s),s)return a={page:1,results:r.totalResults.slice(0,n.limit),resultsCount:r.resultsCount,moreResults:r.resultsCount>n.limit},void t(a)}))};var h=function(e,t){var i,t;i=e.selectedNode,i&&i.classList.remove("selected"),t&&(e.selectedNode=t,t&&t.classList.add("selected"))};c.InViewerSearchThisView.prototype.showNodeProperties=function(e,t,i,n){var o=this;this.qsApi.logResultClickEvent(i+1,t,!0,"thisView"),this.clicked===t?(this.clicked=null,this.viewer.clearSelection(),this.is2DMode?this.viewer.select(this.controller.searchResultIds):this.viewer.isolate(this.controller.searchResultIds),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!!n),n?h(o,e.target,e):h(o,null)):this.selectNode(e.target,t,!1)},c.InViewerSearchThisView.prototype.isNodeVisible=function(e,t){if(this.is2DMode)return void t();if(this.viewer.model&&this.viewer.model.getData()){var i=this.viewer.model.getData().instanceTree;if(i){i.nodeAccess.enumNodeFragments(e,function(e){t()})}}},c.InViewerSearchThisView.prototype.selectNode=function(e,t,i){var n,o,r=this,s=!1,a=this.controller;if(this.nodeNotVisibleAlert&&(clearTimeout(this.nodeNotVisibleAlertTimer),document.body.removeChild(this.nodeNotVisibleAlert),this.nodeNotVisibleAlert=null),this.clicked=t,!e&&this.container.children.length>1)for(o=this.container.children[1].children,length=o.length,n=0;!s&&n<length;)o[n].className.indexOf("dbId_"+t+"_")>=0&&(s=!0,e=o[n]),n++;this.is2DMode?this.viewer.select(t):this.viewer.isolate(t),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!0),h(r,e),i&&e&&e.parentNode&&(e.parentNode.scrollTop=e.offsetTop),!e&&a.searchResultIds.indexOf(t)<0&&(this.clicked=null,this.showAlertNodeNotVisible(r.container))},c.InViewerSearchThisView.prototype.clearSearchResults=function(){if(this.offset=0,this.scrollOffset=500,this.limitScroll=200,this.clicked=null,this.selectedNode=null,this.highlightNode=null,this.options.uiEnabled){if(this.container&&(this.container.textContent=""),this.controller&&this.controller.searchResultIds&&this.controller.searchResultIds.length>0){if(!this.is2DMode)try{this.viewer.showAll()}catch(e){l.logger.error(e)}this.toggleLoading(!1),this.viewer.clearSelection(),this.controller.searchResultIds=[],this.resultList=null}this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null}},c.InViewerSearchThisView.prototype.toggleLoading=function(e){var t=this.loadingDom;e&&!t?(t=document.createElement("div"),t.id=this.loadingId,t.className="loading",t.textContent=a.i18n.translate("Loading"),this.loadingDom=t,this.container.appendChild(t)):t&&(t.parentNode&&t.parentNode.removeChild(t),this.loadingDom=null)},c.InViewerSearchThisView.prototype.loadMoreResults=function(){var t,i,n=this.controller,o=this,r=this.offset,s=n.resultsCount;if(s>r){for(t=r+o.limit,i=r;i<t;i++)s>i&&e(o,n.totalResults[i],o.resultList,i);o.offset=r+o.limit}},c.InViewerSearchThisView.prototype.getPage=function(e,t){var i,n,o=this.controller,r=this,s=r.limit*(e-1);o.resultsCount>s?(i=o.totalResults.slice(s,s+r.limit),n={page:e,results:i,resultsCount:o.resultsCount,moreResults:o.resultsCount>s+r.limit}):n={page:e,results:[],resultsCount:o.resultsCount,moreResults:!1},setTimeout(function(){t(n)},0)},c.InViewerSearchThisView.prototype.showAlertNodeNotVisible=function(e){var t=this,i=document.createElement("div");i.className="alert-node-not-visible",i.textContent=a.i18n.translate("AlertNodeNotVisible"),document.body.appendChild(i),this.nodeNotVisibleAlertTimer=setTimeout(function(){i&&(document.body.removeChild(t.nodeNotVisibleAlert),t.nodeNotVisibleAlert=null)},7e3),this.nodeNotVisibleAlert=i},c.InViewerSearchThisView.prototype.showResults=function(e,i,n){var r=this,s=this.controller,a=r.container;o(r,e,i,n),s.searchResultIds&&s.searchResultIds.length&&(r.is2DMode?r.highlightNode?r.viewer.select(r.highlightNode):r.viewer.select(s.searchResultIds):r.highlightNode?(r.viewer.isolate(r.highlightNode),r.viewer.select(r.highlightNode)):r.viewer.isolate(s.searchResultIds)),n&&(s.resultsCount<1||!r.resultList.childNodes.length)&&(r.toggleLoading(!1),t(r,a,e,r.options.loadedModelTab.displayName)),n&&r.highlightNode&&(s.searchedIds.hasOwnProperty(r.highlightNode)||this.selectNode(null,r.highlightNode,!1)),n&&(s.searchedIds={}),s.searchEnded=n}}(),function(){"use strict";function e(e){return h?(h.indexOf("autodesk")>=0?(l.token=null,l.oauth2Token=n.token.accessToken):(l.token=n.token.getAccessToken?n.token.getAccessToken():null,l.oauth2Token=null),e&&(l.clientFeatureId=r+(e?"."+e:"")),l):l}function t(e){e&&n.logger.log("InViewerSearch Extension: QsApi not initialized")}function i(){var e=!!window.chrome&&!!window.chrome.webstore;if(e)return"Chrome";var t=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(t)return"Opera";var i="undefined"!=typeof InstallTrigger;if(i)return"Firefox";var n=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;if(n)return"Safari";var o=!!document.documentMode;if(o)return"Internet Explorer";var r=!o&&!!window.StyleMedia;if(r)return"Edge";var s=(e||t)&&!!window.CSS;return s?"Blink":"Unknown"}var n=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private),o=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),r="adsk.viewer";o.QsApiService=function(){this.qsAPI=null};var s=o.QsApiService.prototype,a={pid:"",query:"",sort:"",page:1,filters:"",language:"ENU",modifier:null},l={},c=null,u=null,h=null,d=null,p=Object.freeze({development:"apidev",staging:"apistg",production:"apiprod",autodeskstaging:"apistg",autodeskdevelopment:"apidev",autodeskproduction:"apiprod"});s.initialize=function(e,t,i,n){l={token:null,oauth2Token:null,clientId:i,sessionId:n,clientFeatureId:""},d=e,h=t.toLowerCase(),this.qsAPI=new Autodesk.Search.SearchQueryAPI(p[h])},s.generateQueryId=function(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)});u=t},s.search=function(t,i,o,r,s,l,u){this.qsAPI||n.logger.log("InViewerSearch Extension: QsApi not initialized"),c=i,a.pid=t,a.page=s,a.query=i,a.sort=o,a.filters=r;var h=e(u);this.qsAPI.suggest(a,h,l)},s.getMoreResults=function(t,i,o,r,s,l,u){this.qsAPI||n.logger.log("InViewerSearch Extension: QsApi not initialized"),c=o,a.pid=t,a.page=l,a.query=o,a.sort=r,a.filters=s,a.modifier=i;var h=e();this.qsAPI.query(a,h,u)},s.logEvent=function(e,i,n){this.qsAPI&&this.qsAPI.logEvent(u,i,e,n,t)},s.logInitEvent=function(t,n,o){var r="inViewer.initialization",s={viewerVersion:d,id:t,modelInfo:n,url:window.location.href,browser:i(),userAgent:window.navigator.userAgent},a=e(o);this.logEvent(r,a,s)},s.logGeneralEvent=function(t,i){var n="inViewer."+t,o=e(i);this.logEvent(n,o,"")},s.logTimeEvent=function(t,i,n){var o="inViewer."+t,r={};r[t+"DurationMs"]=i;var s=e(n);this.logEvent(o,s,r)},s.logSearchResults=function(t,i,n,o){var r="inViewer.searchResults",s={resultCount:t,queryString:i,algorithm:n},a=e(o);this.logEvent(r,a,s)},s.logTabClickEvent=function(t){var i="inViewer.tabClick",n=null,o=e(t);this.logEvent(i,o,n)},s.logResultClickEvent=function(e,t,i,n){var o="inViewer.resultClick";this.logResultComponentClickEvent(o,e,t,i,n)},s.logResultGeomClickEvent=function(e,t,i,n){var o="inViewer.resultGeomClick";this.logResultComponentClickEvent(o,e,t,i,n)},s.logResultComponentClickEvent=function(t,i,n,o,r){var s={position:i,nodeId:n,clickedCurrentGeometry:o},a=e(r);this.logEvent(t,a,s)},s.logLoadMoreClickEvent=function(t,i){var n="inViewer.loadMoreClick",o={id:t},r=e(i);this.logEvent(n,r,o)},s.logErrorEvent=function(t,i,n,o){var r="inViewer.error",s={file:i,method:n,querySource:"inViewer",message:t},a=e(o);this.logEvent(r,a,s)},s.sanitizeAndHighlightString=function(e,t,i){return this.qsAPI.sanitizeAndHighlightString(e,t,i)}}(),function(){"use strict";function e(e){var t;return e?([].slice.call(e).forEach(function(e){t||(t=e.urn(),t&&(t=t.substr(0,t.lastIndexOf("/")+1),t.indexOf("output/Resource")>0&&(t=t.substr(0,t.lastIndexOf("Resource")+9))))}),t||s.logger.warn("InViewerSearch Extension: No URN found for geometry")):s.logger.warn("InViewerSearch Extension: No URN to retrieve from in getUrnFromChildren()"),t}function t(e){if(C&&C.length)return C;var t=[];return Object.keys(p).forEach(function(e){t.push(p[e].data)}),C=t.sort(i)}function i(e,t){var i=e.name.toUpperCase(),n=t.name.toUpperCase();return i<n?-1:i>n?1:0}function n(e){var t=0,i=e.model.myData;return t=i.instanceTree&&i.instanceTree.objectCount?i.instanceTree.objectCount:i.instanceTree&&i.instanceTree.children?i.instanceTree.children.length:0}function o(e){return String(e).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var r=Autodesk.Viewing,s=r.Private,a=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");a.ViewerPropertiesService=function(){this.worker=void 0,this.viewerpropertiesworker=void 0,this.initialized=!1,this.viewer=null,this.isGeometry=!1,this.isSearching=!1,this.isSearchingTimer=null,this.searchingString="",this.searchingStringCb=null};var l=a.ViewerPropertiesService.prototype,c=300,u=20,h={},d=null,p=null,v=0,g=null,m=131e3,f=0,E=null,A=!1,y={},T=!1,w=null,b=null,C=[],S="_sharedPropertyDatabase_";l.uninitialize=function(){void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,self.viewerpropertiesworker=void 0),this.initialized=!1},l.initialize=function(e,t,i,n,o,l,c){if(this.viewer=e,g=l,t)void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,this.viewerpropertiesworker=void 0);else{h={};var u=this.viewer.model.myData.acmSessionId;this.viewer.model.myData.basePath;p=n,d=o,f=0,E=c,A=!!E,v=Object.keys(n).length,s.logger.debug("InViewerSearch Extension - Geometries amount: "+v);var m=r.isNodeJS?null:"domain="+encodeURIComponent(window.location.origin);y={url:r.getItemApi(),headers:{},basePath:e.model.myData.basePath,auth:!0,viewing_url:r.getItemApi(),queryParams:m+(u&&m?"&":"")+(u?"acmsession="+u:"")},void 0===this.viewerpropertiesworker?(this.worker=a.WorkerUtils.createPropertyWorker(),this.viewerpropertiesworker=this.worker):this.worker=this.viewerpropertiesworker,this.worker.postMessage({operation:"SET_DEBUG",enable:avp.ENABLE_DEBUG,level:avp.logger.level})}this.initialized=!0},l.initPropertyDatabases=function(t){var i,n=[],o=this,r=0,s=!1,a=function(e){var i=e.data;switch(i.operation){case"PROP_DB_CREATED":if(i.guid!==d)return f++,h[i.guid].objCount=i.objCount,f===r+1&&o.worker.removeEventListener("message",a),void t(h,f===r+1,s)}};return E?(Object.keys(p).forEach(function(e){var t;f<c&&(t=p[e],h.hasOwnProperty(e)||(h[e]={geometry:t.data,hasSharedProperties:!0,objCount:0}),f++)}),void t(h,v>1,s)):(Object.keys(p).forEach(function(t){var i,o=p[t];t!==d&&r<c&&(h.hasOwnProperty(t)||(h[t]={geometry:o.data},i=e(o.children),n.push({urn:i,geo:o.data}),r++))}),(i=n.length)?(s=i>u,o.worker.addEventListener("message",a),o.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:n,context:y}),void 0):void t(h,!0,!1))},l.initSharedPropertyDatabase=function(e){var t=this,i=S,n=function(o){var r=o.data;switch(r.operation){case"PROP_DB_CREATED":if(r.guid===i)return h[i].objCount=r.objCount,h[i].loading=!1,t.worker.removeEventListener("message",n),h[i].sharedDbInit&&h[i].sharedDbInit(),void e()}};if(h.hasOwnProperty(i)){if(!h[i].loading)return void e();h[i].sharedDbInit=e}else h[i]={isShared:!0,loading:!0},h[d]={isShared:!0,geometry:p[d].data},t.worker.addEventListener("message",n),t.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:E,geo:{guid:i}}],context:y})},l.initCurrentPropertyDatabase=function(t,i){var n,o,r=this;if(E)this.initSharedPropertyDatabase(function(){var e=p[t];h.hasOwnProperty(t)||(h[t]={geometry:e.data,hasSharedProperties:!0,objCount:0}),i()});else{var s=function(e){var t=e.data;switch(t.operation){case"PROP_DB_CREATED":if(h[t.guid].objCount=t.objCount,t.guid===d)return f++,r.worker.removeEventListener("message",s),void i()}};if(h.hasOwnProperty(t))return void i();n=p[d]||{},h[d]={geometry:n.data},o=e(n.children),r.worker.addEventListener("message",s),r.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:o,geo:n.data}],context:y})}},l.getCurrentGeometryAttributes=function(e){var t=this;this.initCurrentPropertyDatabase(d,function(){t.getGeometryAttributes(d,function(){e()})})},l.getGeometryAttributes=function(e,t){var i=this,n=function(o){var r=o.data;switch(r.operation){case"GEOMETRY_ATTR_OK":i.worker.removeEventListener("message",n),t();break;case"GEOMETRY_ATTR_ERR":i.worker.removeEventListener("message",n),s.logger.info("InViewerSearch Extension: No attributes found for: "+e),t();break;default:s.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(r.operation||"")+" Error: "+(r.error||"")+" Place: "+(r.place||"")+" Method: "+(r.method||""))}};this.worker.addEventListener("message",n),this.worker.postMessage({operation:"GEOMETRY_ATTR",guid:e,sharedPropDbKey:S,isSharedPropertyDb:A})},l.getGeometriesAttributes=function(e){var t=this,i=(this.getGeometry(d),function(n){var o=n.data;switch(o.operation){case"GEOMETRIES_ATTR_OK":e(),t.worker.removeEventListener("message",i);break;case"GEOMETRIES_ATTR_ERR":s.logger.info("InViewerSearch Extension: No attributes found for: "+o.geometry.guid),o.ended&&(e(),t.worker.removeEventListener("message",i));break;default:s.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(o.operation||"")+" Error: "+(o.error||"")+" Place: "+(o.place||"")+" Method: "+(o.method||""))}});return A?void e({},A,!0):(this.worker.addEventListener("message",i),void this.worker.postMessage({operation:"GEOMETRIES_ATTR",sharedPropDbKey:S,isSharedPropertyDb:A}))},l.getGeometry=function(e){var t;return t=p.hasOwnProperty(e)?p[e]:null},l.orderGeometriesByName=function(e){var i,n=[],o=t(this);return o.forEach(function(t){e.totalResultsIndex.hasOwnProperty(t.guid)&&(i=e.totalResultsIndex[t.guid],n.push(e.totalResults[i]))}),n},l.getTotalCountGeometries=function(){return v>c?c:v},l.areMoreGeometriesToLoad=function(){return p.length>c},l.geometriesLoaded=function(){return f},l.updateCurrent=function(e){d=e},l.tooManyNodes=function(e){var t=0,i=n(this.viewer);if(A)t=i;else{if(!e&&this.getTotalCountGeometries()>100)return!0;e?t=i:Object.keys(h).forEach(function(e){e!==d&&h[e].objCount&&(t+=h[e].objCount)})}return s.logger.log("Object count? "+t),m<t},l.bruteSearchCurrent=function(e,t,i){var n=function(e){T=!1,t(e),w&&(w(e),w=null)},o=function(){i(),b&&b()};if(d&&!h.hasOwnProperty(d)){f++;var r=p[d]||{};h[d]={geometry:r.data}}T?(w=t,b=i):(T=!0,this.viewer.search(e,n,o,[],!0))},l.bruteSearch=function(e,i){var n=this,o=t(this),r=function(e){var t=e.data;switch(t.operation){case"BRUTE_SEARCH_OK":return t.ended&&n.worker.removeEventListener("message",r),void i(t.str,t.result,t.ended,t.geometry)}},s=function(t){var i={geometry:d,results:t};n.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:e,results:i,sharedPropDbKey:S,isSharedPropertyDb:A,geometries:o})},a=function(){n.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:e,results:{geometry:d,results:[]},sharedPropDbKey:S,isSharedPropertyDb:A,geometries:o})};this.worker.addEventListener("message",r),this.bruteSearchCurrent(e,s,a),A||this.worker.postMessage({operation:"BRUTE_SEARCH",str:e,currentGeo:d,geometries:o})},l.highlightText=function(e,t){var i,n,r;return"[object String]"!==Object.prototype.toString.call(e)&&s.logger.error("Error: Non-string sent to highlightText(). Check type, and if correct, convert to String() first."),r=new RegExp("("+o(t)+")","gi"),i=t&&String(e).replace(r,"$1")||String(e),n=g.qsAPI.sanitizeAndHighlightString(i,'<span class="bolder">',"</span>")},l.replaceHtmlCh=function(e){return g.qsAPI.sanitizeAndHighlightString(e)},l.doSearch=function(e,t){var i,n=this,o=function(e){var i=e.data;switch(i.operation){case"SEARCH_RESULT":return i.ended&&(n.worker.removeEventListener("message",o),n.isSearching=!1,s.logger.debug("The last SEARCH_RESULT messgage received for query '"+i.str+"' Ready for another search"),n.searchingString=null),n.searchingStringCb&&(n.searchingStringCb(i.str,i.results,i.ended),i.ended&&(n.searchingStringCb=null)),void t(i.str,i.results,i.ended);case"OLD_SEARCH_RESULT":n.worker.removeEventListener("message",o),n.isSearching=!1;break;default:s.logger.warn("Received unexpected event for "+i.str)}};clearTimeout(n.isSearchingTimer),n.isSearching===!0?e===n.searchingString?n.searchingStringCb=t:n.isSearchingTimer=setTimeout(function(){n.doSearch(e,t)},100):(A&&(i={},Object.keys(h).forEach(function(e){e!==S&&(i[e]={guid:h[e].geometry.guid,name:h[e].geometry.name})})),s.logger.debug("Submitting a new search request for query '"+e+"'"),n.isSearching=!0,n.searchingString=e,n.worker.addEventListener("message",o),n.worker.postMessage({operation:"SEARCH",str:e,isSharedPropertyDb:A,geometries:i}))},l.defaultNodeName=function(){return"Untitled Node"}}(),function(){"use strict";function e(e,t){var i=this,o=e.getToolbar();i.toolbar=o,n.Extension.call(i,e,t)}function t(e){var t=";base64,";if(e.indexOf(t)==-1){var i=e.split(","),n=i[0].split(":")[1],o=decodeURIComponent(i[1]);return new Blob([o],{type:n})}for(var i=e.split(t),n=i[0].split(":")[1],o=window.atob(i[1]),r=o.length,s=new Uint8Array(r),a=0;a<r;++a)s[a]=o.charCodeAt(a);return new Blob([s],{type:n})}function i(){var e=this;return new Promise(function(i){var n=e.viewer,o=document.createElement("canvas"),r=o.getContext("2d"),s=n.container.getBoundingClientRect(),a=new Image;n.getScreenShotBuffer(s.width,s.height,function(e){a.src=e;var l=n.impl.getVisibleBounds(!0,!0),c=n.worldToClient(l.min),u=n.worldToClient(l.max);if(n.model.is2d()){var h=Math.max(c.x,0),d=Math.max(u.y,0),p=s.width-Math.min(u.x,s.width),v=s.height-Math.min(c.y,s.height),g=d,m=h,f=s.height-d-v,E=s.width-h-p;o.width=E,o.height=f,console.log(m,g,E,f),r.drawImage(a,m,g,E,f,0,0,E,f)}else o.width=s.width,o.height=s.height,r.drawImage(a,0,0,s.width,s.height);var e=window.URL.createObjectURL(t(o.toDataURL("image/png")));i(e)})})}var n=Autodesk.Viewing,o=n.UI,r=AutodeskNamespace("Autodesk.Viewing.Extensions.Print"),s="Print",a="settingsTools",l=Object.create(n.Extension.prototype);l.constructor=e,l.getPrintableScreenshot=function(){return i.call(this)},l.printSheet=function(){this.getPrintableScreenshot().then(function(e){var t=window.open(e);t.onload=function(){var e=t.document.querySelector("img");e.style.cssText="display:block; margin: 0 auto;",t.focus(),t.print()},t.onbeforeunload=setTimeout(function(){t.close()},500),t.onafterprint=setTimeout(function(){t.close()},500)})};var c=null;l.load=function(){var e=this,t=new o.Button(s);t.icon.innerHTML="&#9113;";var i=e.toolbar.getControl(a);return i.addControl(t,{index:0}),e.control=t,c=e.printSheet.bind(e),t.addEventListener("click",c),!0},l.unload=function(){var e=this,t=e.toolbar,i=t.getControl(a),n=e.control;return c&&(n.removeEventListener("click",c),c=null),i.removeControl(s),!0},e.prototype=l,r.Print=e,n.theExtensionManager.registerExtension("Autodesk.Print",r.Print)}(),void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(e,t,i,n,o,r,s,a){this.save(),this.translate(e,t),this.rotate(o),this.scale(i,n),this.arc(0,0,1,r,s,a),this.restore()}),"function"!=typeof Path2D&&!function(){function e(e){if(this.ops_=[],void 0!=e)if("string"==typeof e)try{this.ops_=parser.parse(e)}catch(e){}else{if(!e.hasOwnProperty("ops_"))throw"Error: "+typeof e+"is not a valid argument to Path";this.ops_=e.ops_.slice(0)}}function t(e){return function(){this.ops_.push({type:e,args:Array.prototype.slice.call(arguments,0)})}}parser=function(){function e(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}function t(e,t,i,n,o,r){this.message=e,this.expected=t,this.found=i,this.offset=n,this.line=o,this.column=r,this.name="SyntaxError"}function i(e){function i(t){function i(t,i,n){var o,r;for(o=i;o<n;o++)r=e.charAt(o),"\n"===r?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return yt!==t&&(yt>t&&(yt=0,Tt={line:1,column:1,seenCR:!1}),i(Tt,yt,t),yt=t),Tt}function n(e){Et<wt||(Et>wt&&(wt=Et,bt=[]),bt.push(e))}function o(n,o,r){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function a(e,t){function i(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,o,r,s=new Array(e.length);for(r=0;r<e.length;r++)s[r]=e[r].description;return n=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],o=t?'"'+i(t)+'"':"end of input","Expected "+n+" but "+o+" found."}var l=i(r),c=r<e.length?e.charAt(r):null;return null!==o&&s(o),new t(null!==n?n:a(o,c),o,c,r,l.line,l.column)}function r(){var e,t,i,n,o;for(e=Et,t=[],i=W();i!==he;)t.push(i),i=W();if(t!==he)if(i=s(),i===he&&(i=ge),i!==he){for(n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(At=e,t=me(i),e=t):(Et=e,e=ve)}else Et=e,e=ve;else Et=e,e=ve;return e}function s(){var e,t,i,n,o;if(e=Et,t=a(),t!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(o=s(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(t=[t,i],e=t):(Et=e,e=ve)}else Et=e,e=ve;return e}function a(){var e,t,i,n,o;if(e=Et,t=u(),t!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(o=l(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(t=[t,i],e=t):(Et=e,e=ve)}else Et=e,e=ve;return e}function l(){var e,t,i,n,o;if(e=Et,t=c(),t!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(o=l(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(t=[t,i],e=t):(Et=e,e=ve)}else Et=e,e=ve;return e}function c(){var e;return e=d(),e===he&&(e=p(),e===he&&(e=g(),e===he&&(e=f(),e===he&&(e=E(),e===he&&(e=T(),e===he&&(e=C(),e===he&&(e=x(),e===he&&(e=R())))))))),e}function u(){var t,i,o,r;if(t=Et,fe.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Ee)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=h(),r!==he?(At=t,i=Ae(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function h(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=v(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function d(){var t,i;return t=Et,Te.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(we)),i!==he&&(At=t,i=be()),t=i}function p(){var t,i,o,r;if(t=Et,Ce.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Se)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=v(),r!==he?(At=t,i=ke(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function v(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=v(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function g(){var t,i,o,r;if(t=Et,xe.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Me)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=m(),r!==he?(At=t,i=Re(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function m(){var e,t,i,n,o;return e=Et,t=N(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=m(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function f(){var t,i,o,r;if(t=Et,Pe.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Ve)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=m(),r!==he?(At=t,i=Ie(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function E(){var t,i,o,r;if(t=Et,Ne.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(De)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=A(),r!==he?(At=t,i=Le(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function A(){var e,t,i,n,o;return e=Et,t=y(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=A(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function y(){var e,t,i,n,o,r;return e=Et,t=I(),t!==he?(i=_(),i===he&&(i=ge),i!==he?(n=I(),n!==he?(o=_(),o===he&&(o=ge),o!==he?(r=I(),r!==he?(At=e,t=Oe(t,n,r),e=t):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve),e}function T(){var t,i,o,r;if(t=Et,_e.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(He)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=w(),r!==he?(At=t,i=Be(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function w(){var e,t,i,n,o;return e=Et,t=b(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=w(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function b(){var e,t,i,n;return e=Et,t=I(),t!==he?(i=_(),i===he&&(i=ge),i!==he?(n=I(),n!==he?(At=e,t=Fe(t,n),e=t):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve),e}function C(){var t,i,o,r;if(t=Et,ze.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Ue)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=S(),r!==he?(At=t,i=Ge(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function S(){var e,t,i,n,o;return e=Et,t=k(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=S(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function k(){var e,t,i,n;return e=Et,t=I(),t!==he?(i=_(),i===he&&(i=ge),i!==he?(n=I(),n!==he?(At=e,t=Fe(t,n),e=t):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve),e}function x(){var t,i,o,r;if(t=Et,We.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(je)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=M(),r!==he?(At=t,i=Ye(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function M(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=M(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function R(){var t,i,o,r;if(t=Et,qe.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(Xe)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he?(r=P(),r!==he?(At=t,i=Ke(i,r),t=i):(Et=t,t=ve)):(Et=t,t=ve)}else Et=t,t=ve;return t}function P(){var e,t,i,n,o;return e=Et,t=V(),t!==he?(i=Et,n=_(),n===he&&(n=ge),n!==he?(o=P(),o!==he?(n=[n,o],i=n):(Et=i,i=ve)):(Et=i,i=ve),i===he&&(i=ge),i!==he?(At=e,t=ye(t,i),e=t):(Et=e,e=ve)):(Et=e,e=ve),e}function V(){var e,t,i,n,o,r,s,a,l,c,u,h;return e=Et,t=D(),t!==he?(i=_(),i===he&&(i=ge),i!==he?(n=D(),n!==he?(o=_(),o===he&&(o=ge),o!==he?(r=L(),r!==he?(s=_(),s!==he?(a=O(),a!==he?(l=_(),l===he&&(l=ge),l!==he?(c=O(),c!==he?(u=_(),u===he&&(u=ge),u!==he?(h=I(),h!==he?(At=e,t=Qe(t,n,r,a,c,h),e=t):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve),e}function I(){var e,t,i,n;return e=Et,t=N(),t!==he?(i=_(),i===he&&(i=ge),i!==he?(n=N(),n!==he?(At=e,t=Ze(t,n),e=t):(Et=e,e=ve)):(Et=e,e=ve)):(Et=e,e=ve),e}function N(){var e,t;return e=Et,t=L(),t!==he&&(At=e,t=Je(t)),e=t}function D(){var e;return e=B(),e===he&&(e=G()),e}function L(){var e,t,i;return e=Et,t=U(),t===he&&(t=ge),t!==he?(i=B(),i!==he?(t=[t,i],e=t):(Et=e,e=ve)):(Et=e,e=ve),e===he&&(e=Et,t=U(),t===he&&(t=ge),t!==he?(i=G(),i!==he?(t=[t,i],e=t):(Et=e,e=ve)):(Et=e,e=ve)),e}function O(){var t;return 48===e.charCodeAt(Et)?(t=$e,Et++):(t=he,0===Ct&&n(et)),t===he&&(49===e.charCodeAt(Et)?(t=tt,Et++):(t=he,0===Ct&&n(it))),t}function _(){var e,t,i,n,o;if(e=Et,t=[],i=W(),i!==he)for(;i!==he;)t.push(i),i=W();else t=ve;if(t!==he)if(i=H(),i===he&&(i=ge),i!==he){
for(n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(t=[t,i,n],e=t):(Et=e,e=ve)}else Et=e,e=ve;else Et=e,e=ve;if(e===he)if(e=Et,t=H(),t!==he){for(i=[],n=W();n!==he;)i.push(n),n=W();i!==he?(t=[t,i],e=t):(Et=e,e=ve)}else Et=e,e=ve;return e}function H(){var t;return 44===e.charCodeAt(Et)?(t=nt,Et++):(t=he,0===Ct&&n(ot)),t}function B(){var e,t,i;return e=Et,t=F(),t!==he?(i=z(),i===he&&(i=ge),i!==he?(t=[t,i],e=t):(Et=e,e=ve)):(Et=e,e=ve),e===he&&(e=Et,t=G(),t!==he?(i=z(),i!==he?(t=[t,i],e=t):(Et=e,e=ve)):(Et=e,e=ve)),e}function F(){var t,i,o,r;return t=Et,i=G(),i===he&&(i=ge),i!==he?(46===e.charCodeAt(Et)?(o=rt,Et++):(o=he,0===Ct&&n(st)),o!==he?(r=G(),r!==he?(i=[i,o,r],t=i):(Et=t,t=ve)):(Et=t,t=ve)):(Et=t,t=ve),t===he&&(t=Et,i=G(),i!==he?(46===e.charCodeAt(Et)?(o=rt,Et++):(o=he,0===Ct&&n(st)),o!==he?(i=[i,o],t=i):(Et=t,t=ve)):(Et=t,t=ve)),t}function z(){var t,i,o,r;return t=Et,at.test(e.charAt(Et))?(i=e.charAt(Et),Et++):(i=he,0===Ct&&n(lt)),i!==he?(o=U(),o===he&&(o=ge),o!==he?(r=G(),r!==he?(i=[i,o,r],t=i):(Et=t,t=ve)):(Et=t,t=ve)):(Et=t,t=ve),t}function U(){var t;return 43===e.charCodeAt(Et)?(t=ct,Et++):(t=he,0===Ct&&n(ut)),t===he&&(45===e.charCodeAt(Et)?(t=ht,Et++):(t=he,0===Ct&&n(dt))),t}function G(){var t,i,o;if(t=Et,i=[],pt.test(e.charAt(Et))?(o=e.charAt(Et),Et++):(o=he,0===Ct&&n(vt)),o!==he)for(;o!==he;)i.push(o),pt.test(e.charAt(Et))?(o=e.charAt(Et),Et++):(o=he,0===Ct&&n(vt));else i=ve;return i!==he&&(At=t,i=gt(i)),t=i}function W(){var t;return mt.test(e.charAt(Et))?(t=e.charAt(Et),Et++):(t=he,0===Ct&&n(ft)),t}function j(e,t){return"mlazhvcsqt".indexOf(e)===-1?St=t:(St[0]+=t[0],St[1]+=t[1]),Rt=e,St.slice(0)}function Y(e,t){for(var i=[],n=St.slice(0),o=0;o<t.length;o+=2){St=n.slice(0);var r=j(e,t.slice(o,o+2));i=i.concat(r),o==t.length-4&&(kt=r.slice(0))}return i}function q(){"CcSsQqTt".indexOf(Rt)==-1&&(kt=St.slice(0));var e=[0,0];return e[0]=2*St[0]-kt[0],e[1]=2*St[1]-kt[1],e}function X(e,t){var i=[t,0];return"H"==e&&(i[1]=St[1]),j(e,i)}function K(e,t){var i=[0,t];return"V"==e&&(i[0]=St[0]),j(e,i)}function Q(e,t){var i=[e];if(t&&t.length>1)for(var n=t[1],o=0;o<n.length;o++)i.push(n[o]);return i}function Z(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function J(e,t){return e[0]*t[0]+e[1]*t[1]}function $(e,t){return J(e,t)/(Z(e)*Z(t))}function ee(e,t){var i=1;return e[0]*t[1]-e[1]*t[0]<0&&(i=-1),i*Math.acos($(e,t))}function te(e,t){var i=Math.cos(t),n=Math.sin(t);return[i*e[0]+n*e[1],-1*n*e[0]+i*e[1]]}function ie(e,t){var i=Math.cos(t),n=Math.sin(t);return[i*e[0]-n*e[1],n*e[0]+i*e[1]]}function ne(e,t){return[(e[0]-t[0])/2,(e[1]-t[1])/2]}function oe(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function re(e,t){return[e[0]*t[0],e[1]*t[1]]}function se(e,t){return[e*t[0],e*t[1]]}function ae(e,t){return[e[0]+t[0],e[1]+t[1]]}function le(e,t,i,n,o,r,s){if(0==t||0==i)return void xt.push({type:"lineTo",args:s});var n=n*(Math.PI/180);t=Math.abs(t),i=Math.abs(i);var a=te(ne(e,s),n),l=re(a,a),c=Math.pow(t,2),u=Math.pow(i,2),h=Math.sqrt(l[0]/c+l[1]/u);h>1&&(t*=h,i*=h,c=Math.pow(t,2),u=Math.pow(i,2));var d=Math.sqrt((c*u-c*l[1]-u*l[0])/(c*l[1]+u*l[0]));o==r&&(d*=-1);var p=se(d,[t*a[1]/i,-i*a[0]/t]),v=ae(ie(p,n),oe(e,s)),g=[(a[0]-p[0])/t,(a[1]-p[1])/i],m=[(-1*a[0]-p[0])/t,(-1*a[1]-p[1])/i],f=ee([1,0],g),E=ee(g,m),A=f,y=f+E;xt.push({type:"save",args:[]},{type:"translate",args:[v[0],v[1]]},{type:"rotate",args:[n]},{type:"scale",args:[t,i]},{type:"arc",args:[0,0,1,A,y,1-r]},{type:"restore",args:[]})}var ce,ue=arguments.length>1?arguments[1]:{},he={},de={svg_path:r},pe=r,ve=he,ge=null,me=function(e){return xt},fe=/^[Mm]/,Ee={type:"class",value:"[Mm]",description:"[Mm]"},Ae=function(e,t){var i=e;Mt&&(i="M",Mt=!1),xt.push({type:"moveTo",args:j(i,t[0])});for(var n=1;n<t.length;n++)xt.push({type:"lineTo",args:j(e,t[n])})},ye=function(e,t){return Q(e,t)},Te=/^[Zz]/,we={type:"class",value:"[Zz]",description:"[Zz]"},be=function(){xt.push({type:"closePath",args:[]})},Ce=/^[Ll]/,Se={type:"class",value:"[Ll]",description:"[Ll]"},ke=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"lineTo",args:j(e,t[i])})},xe=/^[Hh]/,Me={type:"class",value:"[Hh]",description:"[Hh]"},Re=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"lineTo",args:X(e,t[i])})},Pe=/^[Vv]/,Ve={type:"class",value:"[Vv]",description:"[Vv]"},Ie=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"lineTo",args:K(e,t[i])})},Ne=/^[Cc]/,De={type:"class",value:"[Cc]",description:"[Cc]"},Le=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"bezierCurveTo",args:Y(e,t[i])})},Oe=function(e,t,i){return e.concat(t,i)},_e=/^[Ss]/,He={type:"class",value:"[Ss]",description:"[Ss]"},Be=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"bezierCurveTo",args:q().concat(Y(e,t[i]))})},Fe=function(e,t){return e.concat(t)},ze=/^[Qq]/,Ue={type:"class",value:"[Qq]",description:"[Qq]"},Ge=function(e,t){for(var i=0;i<t.length;i++)xt.push({type:"quadraticCurveTo",args:Y(e,t[i])})},We=/^[Tt]/,je={type:"class",value:"[Tt]",description:"[Tt]"},Ye=function(e,t){for(var i=0;i<t.length;i++){var n=q();xt.push({type:"quadraticCurveTo",args:n.concat(Y(e,t[i]))}),kt=n.slice(0)}},qe=/^[Aa]/,Xe={type:"class",value:"[Aa]",description:"[Aa]"},Ke=function(e,t){for(var i=0;i<t.length;i++){var n=[St.slice()],o=[j(e,t[i].slice(-2))];absArgs=n.concat(t[i].slice(0,-2),o),le.apply(this,absArgs)}},Qe=function(e,t,i,n,o,r){return[parseFloat(e),parseFloat(t),parseFloat(i.join("")),parseInt(n),parseInt(o),r[0],r[1]]},Ze=function(e,t){return[e,t]},Je=function(e){return parseFloat(e.join(""))},$e="0",et={type:"literal",value:"0",description:'"0"'},tt="1",it={type:"literal",value:"1",description:'"1"'},nt=",",ot={type:"literal",value:",",description:'","'},rt=".",st={type:"literal",value:".",description:'"."'},at=/^[eE]/,lt={type:"class",value:"[eE]",description:"[eE]"},ct="+",ut={type:"literal",value:"+",description:'"+"'},ht="-",dt={type:"literal",value:"-",description:'"-"'},pt=/^[0-9]/,vt={type:"class",value:"[0-9]",description:"[0-9]"},gt=function(e){return e.join("")},mt=/^[ \t\n\r]/,ft={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Et=0,At=0,yt=0,Tt={line:1,column:1,seenCR:!1},wt=0,bt=[],Ct=0;if("startRule"in ue){if(!(ue.startRule in de))throw new Error("Can't start parsing from rule \""+ue.startRule+'".');pe=de[ue.startRule]}var St=[0,0],kt=[0,0],xt=[],Mt=!0,Rt="";if(ce=pe(),ce!==he&&Et===e.length)return ce;throw ce!==he&&Et<e.length&&n({type:"end",description:"end of input"}),o(null,bt,wt)}return e(t,Error),{SyntaxError:t,parse:i}}();for(var i=["closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","rect","arc","arcTo","ellipse","isPointInPath","isPointInStroke"],n=0;n<i.length;n++){var o=i[n];e.prototype[o]=t(o)}e.prototype.addPath=function(e,t){var i=!1;t&&t.hasOwnProperty("a")&&t.hasOwnProperty("b")&&t.hasOwnProperty("c")&&t.hasOwnProperty("d")&&t.hasOwnProperty("e")&&t.hasOwnProperty("f")&&(i=!0,this.ops_.push({type:"save",args:[]}),this.ops_.push({type:"transform",args:[t.a,t.b,t.c,t.d,t.e,t.f]})),this.ops_=this.ops_.concat(e.ops_),i&&this.ops_.push({type:"restore",args:[]})},original_fill=CanvasRenderingContext2D.prototype.fill,original_stroke=CanvasRenderingContext2D.prototype.stroke,original_clip=CanvasRenderingContext2D.prototype.clip,original_is_point_in_path=CanvasRenderingContext2D.prototype.isPointInPath,original_is_point_in_stroke=CanvasRenderingContext2D.prototype.isPointInStroke,CanvasRenderingContext2D.prototype.fill=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_fill.apply(this,Array.prototype.slice.call(arguments,1))}else original_fill.apply(this,arguments)},CanvasRenderingContext2D.prototype.stroke=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_stroke.call(this)}else original_stroke.call(this)},CanvasRenderingContext2D.prototype.clip=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_clip.apply(this,Array.prototype.slice.call(arguments,1))}else original_clip.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInPath=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}return original_is_point_in_path.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_path.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInStroke=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}return original_is_point_in_stroke.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_stroke.apply(this,arguments)},Path2D=e}(),function(e,t){"use strict";var i,n=e.document;i=function(){var i,o,r,s,a,l,c,u,h,d,p,v,g,m={},f={},E=!1,A={ENTER:13,ESC:27,SPACE:32},y=[];return f={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},g=function(){var e,i,o=!1,r=n.createElement("fakeelement"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in s)if(r.style[e]!==t){i=s[e],o=!0;break}return{type:i,supported:o}},i=function(e){return n.getElementById(e)},m={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:t,addListeners:function(e){var t,i,l,c,u,h="undefined"!=typeof r,d="undefined"!=typeof o,p="undefined"!=typeof v,g="",m=this;t=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),l(t),"undefined"!=typeof v&&(g=v.value),"function"==typeof e&&("undefined"!=typeof v?e(!0,g):e(!0)),!1},i=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),l(t),"function"==typeof e&&e(!1),!1},l=function(e){m.hide(),m.unbind(n.body,"keyup",c),m.unbind(s,"focus",u),h&&m.unbind(r,"click",t),d&&m.unbind(o,"click",i)},c=function(e){var n=e.keyCode;(n===A.SPACE&&!p||p&&n===A.ENTER)&&t(e),n===A.ESC&&d&&i(e)},u=function(e){p?v.focus():!d||m.buttonReverse?r.focus():o.focus()},this.bind(s,"focus",u),this.bind(a,"focus",u),h&&this.bind(r,"click",t),d&&this.bind(o,"click",i),this.bind(n.body,"keyup",c),this.transition.supported||this.setFocus()},bind:function(e,t,i){"function"==typeof e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},handleErrors:function(){if("undefined"!=typeof e.onerror){var t=this;return e.onerror=function(e,i,n){t.error("["+e+" on line "+n+" of "+i+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",i=e.type,n=e.message,o=e.cssClass||"";switch(t+='<div class="alertify-dialog">',t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===m.buttonFocus&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===i&&(t+='<div id="alertify-form">'),t+='<article class="alertify-inner">',t+=f.message.replace("{{message}}",n),"prompt"===i&&(t+=f.input),t+=f.buttons.holder,t+="</article>","prompt"===i&&(t+="</div>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>",i){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(f.buttons.cancel,f.buttons.ok)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",this.appendButtons(f.buttons.cancel,f.buttons.submit)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",f.buttons.ok),t=t.replace("{{ok}}",this.labels.ok)}return h.className="alertify alertify-"+i+" "+o,u.className="alertify-cover",t},close:function(e,t){var i,n,o=t&&!isNaN(t)?+t:this.delay,r=this;this.bind(e,"click",function(){i(e)}),n=function(e){e.stopPropagation(),r.unbind(this,r.transition.type,n),d.removeChild(this),d.hasChildNodes()||(d.className+=" alertify-logs-hidden")},i=function(e){"undefined"!=typeof e&&e.parentNode===d&&(r.transition.supported?(r.bind(e,r.transition.type,n),e.className+=" alertify-log-hide"):(d.removeChild(e),d.hasChildNodes()||(d.className+=" alertify-logs-hidden")))},0!==t&&setTimeout(function(){i(e)},o)},dialog:function(e,t,i,o,r){c=n.activeElement;var s=function(){d&&null!==d.scrollTop&&u&&null!==u.scrollTop||s()};if("string"!=typeof e)throw new Error("message must be a string");if("string"!=typeof t)throw new Error("type must be a string");if("undefined"!=typeof i&&"function"!=typeof i)throw new Error("fn must be a function");return this.init(),s(),y.push({type:t,message:e,callback:i,placeholder:o,cssClass:r}),E||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter");return function(t,i){return this.log(t,e,i),this}},hide:function(){var e,t=this;y.splice(0,1),y.length>0?this.setup(!0):(E=!1,e=function(i){i.stopPropagation(),t.unbind(h,t.transition.type,e)},this.transition.supported?(this.bind(h,this.transition.type,e),h.className="alertify alertify-hide alertify-hidden"):h.className="alertify alertify-hide alertify-hidden alertify-isHidden",u.className="alertify-cover alertify-cover-hidden",c.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),null==i("alertify-cover")&&(u=n.createElement("div"),u.setAttribute("id","alertify-cover"),u.className="alertify-cover alertify-cover-hidden",n.body.appendChild(u)),null==i("alertify")&&(E=!1,y=[],h=n.createElement("section"),h.setAttribute("id","alertify"),h.setAttribute("style","z-index : 999999999"),h.className="alertify alertify-hidden",n.body.appendChild(h)),null==i("alertify-logs")&&(d=n.createElement("section"),d.setAttribute("id","alertify-logs"),d.className="alertify-logs alertify-logs-hidden",n.body.appendChild(d)),n.body.setAttribute("tabindex","0"),this.transition=g()},log:function(e,t,i){var n=function(){d&&null!==d.scrollTop||n()};return this.init(),n(),d.className="alertify-logs",this.notify(e,t,i),this},notify:function(e,t,i){var o=n.createElement("article");o.className="alertify-log"+("string"==typeof t&&""!==t?" alertify-log-"+t:""),o.innerHTML=e,d.appendChild(o),setTimeout(function(){o.className=o.className+" alertify-log-show"},50),this.close(o,i)},set:function(e){var t;if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){v?(v.focus(),v.select()):l.focus()},setup:function(e){var n,c=y[0],u=this;E=!0,n=function(e){e.stopPropagation(),u.setFocus(),u.unbind(h,u.transition.type,n)},this.transition.supported&&!e&&this.bind(h,this.transition.type,n),h.innerHTML=this.build(c),s=i("alertify-resetFocus"),a=i("alertify-resetFocusBack"),r=i("alertify-ok")||t,o=i("alertify-cancel")||t,l="cancel"===m.buttonFocus?o:"none"===m.buttonFocus?i("alertify-noneFocus"):r,v=i("alertify-text")||t,p=i("alertify-form")||t,"string"==typeof c.placeholder&&""!==c.placeholder&&(v.value=c.placeholder),e&&this.setFocus(),this.addListeners(c.callback)},unbind:function(e,t,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)}},{alert:function(e,t,i){return m.dialog(e,"alert",t,"",i),this},confirm:function(e,t,i){return m.dialog(e,"confirm",t,"",i),this},extend:m.extend,init:m.init,log:function(e,t,i){return m.log(e,t,i),this},prompt:function(e,t,i,n){return m.dialog(e,"prompt",t,i,n),this},success:function(e,t){return m.log(e,"success",t),this},error:function(e,t){return m.log(e,"error",t),this},set:function(e){m.set(e)},hide:function(e){m.hide(e)},labels:m.labels,debug:m.handleErrors}},"undefined"==typeof e.alertify&&(e.alertify=new i)}(this),function(){var e=Autodesk.Viewing,t=(e.Private,""),i=!1,n=!1,o=!0;e.HTTP_REQUEST_HEADERS={},e.getApiEndpoint=function(){return t},e.setApiEndpoint=function(e,i,r){t=e,n=i,o=r,o||(n=!1)},e.getViewingUrl=function(e){return o?(e||t)+"/viewingservice/v1":(e||t)+"/derivativeservice/v2"},e.getUseCredentials=function(){return i},e.setUseCredentials=function(e){i=e},e.getManifestApi=function(t){var i=e.getViewingUrl(t);return n?i+"/bubbles/":o?i+"/":i+"/manifest/"},e.getItemApi=function(t){return o?e.getViewingUrl(t)+"/items/":e.getViewingUrl(t)+"/derivatives/"},e.getThumbnailApi=function(t){return e.getViewingUrl(t)+"/thumbnails/"},e.makeOssPath=function(e,i,n){return(e||t)+"/oss/v2/buckets/"+i+"/objects/"+encodeURIComponent(decodeURIComponent(n))}}(),function(){var e=Autodesk.Viewing,t=e.Private,i=e.getGlobal();i.PROTEIN_ROOT=null,i.PRISM_ROOT=null,i.LOCALIZATION_REL_PATH="",i.LMV_VIEWER_VERSION="2.11",i.LMV_VIEWER_PATCH="58",i.LMV_BUILD_TYPE="Production",i.LMV_RESOURCE_VERSION=null,i.LMV_RESOURCE_ROOT="",i.LMV_THIRD_PARTY_COOKIE=void 0,"v"===LMV_VIEWER_VERSION.charAt(0)&&(LMV_VIEWER_VERSION=LMV_VIEWER_VERSION.substr(1)),i.stderr=function(){console.warn('"stderr" is deprecated; please use "Autodesk.Viewing.Private.logger" instead')},t.env=null,t.docItemId=null,t.token={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},t.memoryOptimizedSvfLoading=!1,t.forceMemoryOptimizedModeOnSvfLoading=!1,t.assets=[],t.offline=!1,t.offlineResourcePrefix=null;var n={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},o={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},r={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},s={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}};t.EnvironmentConfigurations={Local:{ROOT:"",LMV:n.local},Development:{ROOT:o.dev,LMV:n.dev,bubbleManifest:!0},Staging:{ROOT:o.stg,LMV:n.stg,bubbleManifest:!0},Production:{ROOT:o.prod,LMV:n.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:r.dev,LMV:n.dev},AutodeskStaging:{ROOT:r.stg,LMV:n.stg},AutodeskProduction:{ROOT:r.prod,LMV:n.prod}},t.initializeEnvironmentVariable=function(e){var i;if(e&&e.env&&(i=e.env),i||(i=t.getParameterByName("env")),e&&e.offlineResourcePrefix&&(t.offlineResourcePrefix=e.offlineResourcePrefix),e&&e.offline&&"true"===e.offline&&(t.offline=!0),!i)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":i="Development";break;case"viewing-staging.api.autodesk.com":i="Staging";break;case"viewing.api.autodesk.com":i="Production";break;case"developer-dev.api.autodesk.com":i="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":i="AutodeskStaging";break;case"developer.api.autodesk.com":i="AutodeskProduction";break;case"localhost.autodesk.com":i="Local";break;case"":i="Local";break;case"127.0.0.1":i="Local";break;default:i="AutodeskProduction"}t.ENABLE_TRACE&&("undefined"!=typeof window&&console.log("Host name : "+window.location.hostname),console.log("Environment initialized as : "+i)),t.env=i},t.initializeServiceEndPoints=function(i){var n=i.endpoint,o=i.bubbleManifest,r=!i.useDerivativeServiceV2;if(!n){var s=t.EnvironmentConfigurations[t.env];n=s.ROOT,o=s.bubbleManifest&&r}if(e.setApiEndpoint(n,o,r),!e.isNodeJS){var a=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"];i&&i.hasOwnProperty("libraryName")&&a.push(i.libraryName);for(var l,c,u=0;u<a.length;u++){var h=t.getScript(a[u]);c=h?h.src:"";var d=c.indexOf(a[u]);if(d>=0){l=c.substr(0,d);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;var p=t.getParameterByNameFromPath("v",c);p&&p.length&&p!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+p+" vs. "+LMV_RESOURCE_VERSION+". Using "+p),LMV_RESOURCE_VERSION=p):p&&p.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT="/resources/libs/viewer/"}},t.initLoadContext=function(t){t=t||{},t.auth=e.getUseCredentials(),t.endpoint=e.getApiEndpoint(),t.headers||(t.headers={});for(var i in e.HTTP_REQUEST_HEADERS)t.headers[i]=e.HTTP_REQUEST_HEADERS[i];return t},t.refreshCookie=function(i,n,o){var r=new XMLHttpRequest;if(r.onload=n,r.onerror=o,r.ontimeout=o,0===t.env.indexOf("Autodesk")){var s=t.EnvironmentConfigurations[t.env].ROOT;r.open("POST",s+"/utility/v1/settoken",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.withCredentials=!0,r.send("access-token="+i),e.isIE11&&(t.accessToken=i)}else{var i={oauth:{token:i}};r.open("POST",e.getViewingUrl()+"/token",!0),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.send(JSON.stringify(i))}},t.refreshRequestHeader=function(t){e.HTTP_REQUEST_HEADERS.Authorization="Bearer "+t},t.refreshToken=function(e,i,n){function o(){LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,n):(t.refreshRequestHeader(e),i())}t.token.accessToken=e,void 0===LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,n):o()},t.initializeAuth=function(i,n){function o(e,r){a=e,t.refreshToken(a,t.token.tokenRefreshInterval?null:i);var s=r-60;s<=0&&(s=r),t.token.tokenRefreshInterval=1e3*s,setTimeout(function(){n.getAccessToken(o)},t.token.tokenRefreshInterval)}var r=n?n.shouldInitializeAuth:void 0;if(void 0===r){var s=t.getParameterByName("auth");r="false"!==s.toLowerCase()}if("Local"==t.env||!r)return setTimeout(i,0),e.setUseCredentials("undefined"!=typeof n.useCredentials&&n.useCredentials),e.getUseCredentials();e.isNodeJS&&(LMV_THIRD_PARTY_COOKIE=!1),e.setUseCredentials("undefined"==typeof n.useCredentials||n.useCredentials);var a;return n&&n.getAccessToken?(t.token.getAccessToken=n.getAccessToken,a=n.getAccessToken(o),"string"==typeof a&&a&&t.refreshToken(a,i)):n&&n.accessToken?(a=n.accessToken,t.refreshToken(a,i)):(a=t.getParameterByName("accessToken"),a||(a="9AMaRKBoPCIBy61JmQ8OLLLyRblS",t.logger.warn("Warning : no access token is provided. Use built in token : "+a)),t.refreshToken(a,i)),e.getUseCredentials()},t.initializeLogger=function(i){var n={eventCallback:i?i.eventCallback:void 0};if(t.logger.initialize(n),!(i&&i.hasOwnProperty("useADP")&&0==i.useADP||e.isNodeJS)){var o="https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",r=function(){if("undefined"==typeof Adp)return void t.logger.warn("Autodesk Data Platform SDK not found");var e;switch(LMV_BUILD_TYPE){case"Production":e=s.prod;break;default:e=s.stg}var i={product:{name:"LMV",line_name:"LMV",key:e.CLIENT_ID,id:e.CLIENT_KEY,id_provider:"appkey",build_id:LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH,build_tag:LMV_BUILD_TYPE}},n={server:e.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0};t.logger.adp=new Adp(i,n)};"undefined"!=typeof requirejs?requirejs([o],function(e){window.Adp=e,r()}):t.loadDependency("Adp",o,r)}},t.initializeProtein=function(){if((!t.ENABLE_DEBUG||"Local"!=t.env||e.getUseCredentials())&&!t.offline){var i=new XMLHttpRequest;i.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),i.responseType="json",i.onload=function(e){var n=i.response.url;n&&n.length&&(n=n.replace("http://","https://"),PROTEIN_ROOT=n+"/",t.logger.info("Protein root is: "+PROTEIN_ROOT))},i.send();var n=new XMLHttpRequest;n.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),n.responseType="json",n.onload=function(e){var i=n.response.url;i&&i.length&&(i=i.replace("http://","https://"),PRISM_ROOT=i+"/",t.logger.info("Prism root is: "+PRISM_ROOT))},n.send()}},t.getParameterByName=function(e){return"undefined"==typeof window?"":t.getParameterByNameFromPath(e,window.location.href)},t.getParameterByNameFromPath=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+e+"=([^&#]*)",n=new RegExp(i),o=n.exec(t);return null==o?"":decodeURIComponent(o[1].replace(/\+/g," "))},t.urlIsApiViewingOrDev=function(e){return e.indexOf("developer.api.autodesk.com")!==-1||e.indexOf("developer-stg.api.autodesk.com")!==-1||e.indexOf("developer-dev.api.autodesk.com")!==-1||e.indexOf("viewing.api.autodesk.com")!==-1||e.indexOf("viewing-staging.api.autodesk.com")!==-1||e.indexOf("viewing-dev.api.autodesk.com")!==-1},t.getDemoDocumentURN=function(){var e;switch(t.env){case"Development":e="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case"Staging":e="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case"Production":e="FIXME";break;default:e="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return e},t.setLanguage=function(e,t){var i={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.init(i,function(e){Autodesk.Viewing.i18n.clearDebugLocString(),t&&t()})},t.initializeLocalization=function(e){var i=e&&e.language||navigator.language,n=i.split("-");i=n.length>1?n[0].toLowerCase()+"-"+n[1].toUpperCase():n[0].toLowerCase();var o=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];o.indexOf(i)===-1&&(i=i.indexOf("zh-CN")>-1?"zh-HANS":i.indexOf("zh-TW")>-1?"zh-HANT":n.length>1&&o.indexOf(n[0])>-1?n[0]:"en"),t.setLanguage(i)},t.initializeUserInfo=function(e){e&&e.userInfo&&(t.setUserName(e.userInfo.name),e.comment2Token&&(t.comment2Token=e.comment2Token))},t.getScript=function(e){e=e.toLowerCase();var t=document.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i=0;i<t.length;++i)if(t[i].src&&t[i].src.toLowerCase().indexOf(e)!==-1)return t[i];return null},t.getResourceUrl=function(e){var t=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+e+(t?"?v="+t:"")},t.loadDependency=function(e,i,n){if("undefined"==typeof window[e]){var o=document.createElement("SCRIPT");o.src=i.indexOf("://")>0?i:t.getResourceUrl(i),document.head.appendChild(o),n&&(o.onload=n)}else n&&n()},Autodesk.Viewing.Initializer=function(i,n){function o(){t.initializeLegacyNamespaces(!1),THREE.warn=t.logger.warn.bind(t.logger),init_three_dds_loader(),init_three_pvr_loader(),t.initializeAuth(n,i),t.initializeLocalization(i),t.initializeUserInfo(i)}e.isNodeJS?(t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeAuth(n,i)):(t.WEBGL_HELP_LINK=i?i.webGLHelpLink:null,t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeProtein(),t.initWorkerScript(),t.loadDependency("THREE","three.min.js",function(){t.loadDependency("WGS","Local"===t.env?"wgs.js":"wgs.min.js",o)}))}}();
